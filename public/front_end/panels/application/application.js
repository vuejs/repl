import*as e from"../../core/common/common.js";import*as t from"../../core/host/host.js";import*as i from"../../core/i18n/i18n.js";import*as r from"../../core/platform/platform.js";import*as s from"../../core/root/root.js";import*as a from"../../core/sdk/sdk.js";import*as n from"../../ui/legacy/components/source_frame/source_frame.js";import*as o from"../../ui/legacy/legacy.js";import*as d from"../../ui/components/buttons/buttons.js";import*as c from"../../ui/lit-html/lit-html.js";import*as l from"../../ui/components/report_view/report_view.js";import*as h from"../../ui/components/icon_button/icon_button.js";import*as u from"../../ui/legacy/components/data_grid/data_grid.js";import*as g from"../network/network.js";import*as p from"../../ui/legacy/components/inline_editor/inline_editor.js";import*as m from"../../ui/legacy/components/utils/utils.js";import*as w from"../../models/bindings/bindings.js";import*as b from"./components/components.js";import*as v from"../../ui/legacy/components/object_ui/object_ui.js";import*as S from"../../models/logs/logs.js";import*as k from"../mobile_throttling/mobile_throttling.js";import*as f from"../network/forward/forward.js";import*as y from"../../ui/legacy/components/perf_ui/perf_ui.js";import*as C from"../../models/issues_manager/issues_manager.js";import*as T from"../../ui/legacy/components/cookie_table/cookie_table.js";import*as I from"../../models/text_utils/text_utils.js";class E extends o.TreeOutline.TreeElement{resourcesPanel;constructor(e,t,i){super(t,i),this.resourcesPanel=e,o.ARIAUtils.setAccessibleName(this.listItemElement,t)}get itemURL(){throw new Error("Unimplemented Method")}onselect(e){if(!e)return!1;const t=[];for(let e=this;e;e=e.parent){const i=e instanceof E&&e.itemURL;if(!i)break;t.push(i)}return this.resourcesPanel.setLastSelectedItemPath(t),!1}showView(e){this.resourcesPanel.showView(e)}}class x extends E{expandedSetting;categoryName;categoryLink;constructor(t,i,r,s=!1){super(t,i,!1),this.expandedSetting=e.Settings.Settings.instance().createSetting("resources"+r+"Expanded",s),this.categoryName=i,this.categoryLink=null}get itemURL(){return"category://"+this.categoryName}setLink(e){this.categoryLink=e}onselect(e){return super.onselect(e),this.resourcesPanel.showCategoryView(this.categoryName,this.categoryLink),!1}onattach(){super.onattach(),this.expandedSetting.get()&&this.expand()}onexpand(){this.expandedSetting.set(!0)}oncollapse(){this.expandedSetting.set(!1)}}const R={notMainFrame:"Navigation happened in a frame other than the main frame.",backForwardCacheDisabled:"Back/forward cache is disabled by flags. Visit chrome://flags/#back-forward-cache to enable it locally on this device.",relatedActiveContentsExist:"The page was opened using '`window.open()`' and another tab has a reference to it, or the page opened a window.",HTTPStatusNotOK:"Only pages with a status code of 2XX can be cached.",schemeNotHTTPOrHTTPS:"Only pages whose URL scheme is HTTP / HTTPS can be cached.",loading:"The page did not finish loading before navigating away.",wasGrantedMediaAccess:"Pages that have granted access to record video or audio are not currently eligible for back/forward cache.",HTTPMethodNotGET:"Only pages loaded via a GET request are eligible for back/forward cache.",subframeIsNavigating:"An iframe on the page started a navigation that did not complete.",timeout:"The page exceeded the maximum time in back/forward cache and was expired.",cacheLimit:"The page was evicted from the cache to allow another page to be cached.",JavaScriptExecution:"Chrome detected an attempt to execute JavaScript while in the cache.",rendererProcessKilled:"The renderer process for the page in back/forward cache was killed.",rendererProcessCrashed:"The renderer process for the page in back/forward cache crashed.",grantedMediaStreamAccess:"Pages that have granted media stream access are not currently eligible for back/forward cache.",cacheFlushed:"The cache was intentionally cleared.",serviceWorkerVersionActivation:"The page was evicted from back/forward cache due to a service worker activation.",sessionRestored:"Chrome restarted and cleared the back/forward cache entries.",serviceWorkerPostMessage:"A service worker attempted to send the page in back/forward cache a `MessageEvent`.",enteredBackForwardCacheBeforeServiceWorkerHostAdded:"A service worker was activated while the page was in back/forward cache.",serviceWorkerClaim:"The page was claimed by a service worker while it is in back/forward cache.",haveInnerContents:"Pages that use portals are not currently eligible for back/forward cache.",timeoutPuttingInCache:"The page timed out entering back/forward cache (likely due to long-running pagehide handlers).",backForwardCacheDisabledByLowMemory:"Back/forward cache is disabled due to insufficient memory.",backForwardCacheDisabledByCommandLine:"Back/forward cache is disabled by the command line.",networkRequestDatapipeDrainedAsBytesConsumer:"Pages that have inflight fetch() or XHR are not currently eligible for back/forward cache.",networkRequestRedirected:"The page was evicted from back/forward cache because an active network request involved a redirect.",networkRequestTimeout:"The page was evicted from the cache because a network connection was open too long. Chrome limits the amount of time that a page may receive data while cached.",networkExceedsBufferLimit:"The page was evicted from the cache because an active network connection received too much data. Chrome limits the amount of data that a page may receive while cached.",navigationCancelledWhileRestoring:"Navigation was cancelled before the page could be restored from back/forward cache.",backForwardCacheDisabledForPrerender:"Back/forward cache is disabled for prerenderer.",userAgentOverrideDiffers:"Browser has changed the user agent override header.",foregroundCacheLimit:"The page was evicted from the cache to allow another page to be cached.",backForwardCacheDisabledForDelegate:"Back/forward cache is not supported by delegate.",optInUnloadHeaderNotPresent:"The page has unload handler without the back/forward cache opt-in header.",unloadHandlerExistsInMainFrame:"The page has an unload handler in the main frame.",unloadHandlerExistsInSubFrame:"The page has an unload handler in a sub frame.",serviceWorkerUnregistration:"ServiceWorker was unregistered while a page was in back/forward cache.",noResponseHead:"Pages that do not have a valid response head cannot enter back/forward cache.",cacheControlNoStore:"Pages with cache-control:no-store header cannot enter back/forward cache.",ineligibleAPI:"Ineligible APIs were used.",internalError:"Internal error.",webSocket:"Pages with WebSocket cannot enter back/forward cache.",webTransport:"Pages with WebTransport cannot enter back/forward cache.",webRTC:"Pages with WebRTC cannot enter back/forward cache.",mainResourceHasCacheControlNoStore:"Pages whose main resource has cache-control:no-store cannot enter back/forward cache.",mainResourceHasCacheControlNoCache:"Pages whose main resource has cache-control:no-cache cannot enter back/forward cache.",subresourceHasCacheControlNoStore:"Pages whose subresource has cache-control:no-store cannot enter back/forward cache.",subresourceHasCacheControlNoCache:"Pages whose subresource has cache-control:no-cache cannot enter back/forward cache.",containsPlugins:"Pages containing plugins are not currently eligible for back/forward cache.",documentLoaded:"The document did not finish loading before navigating away.",dedicatedWorkerOrWorklet:"Pages that use a dedicated worker or worklet are not currently eligible for back/forward cache.",outstandingNetworkRequestOthers:"Pages with an in-flight network request are not currently eligible for back/forward cache.",outstandingIndexedDBTransaction:"Page with ongoing indexed DB transactions are not currently eligible for back/forward cache.",requestedNotificationsPermission:"Pages that have requested notifications permissions are not currently eligible for back/forward cache.",requestedMIDIPermission:"Pages that have requested MIDI permissions are not currently eligible for back/forward cache.",requestedAudioCapturePermission:"Pages that have requested audio capture permissions are not currently eligible for back/forward cache.",requestedVideoCapturePermission:"Pages that have requested video capture permissions are not currently eligible for back/forward cache.",requestedBackForwardCacheBlockedSensors:"Pages that have requested sensor permissions are not currently eligible for back/forward cache.",requestedBackgroundWorkPermission:"Pages that have requested background sync or fetch permissions are not currently eligible for back/forward cache.",broadcastChannel:"The page cannot be cached because it has a BroadcastChannel instance with registered listeners.",indexedDBConnection:"Pages that have an open IndexedDB connection are not currently eligible for back/forward cache.",webXR:"Pages that use WebXR are not currently eligible for back/forward cache.",sharedWorker:"Pages that use SharedWorker are not currently eligible for back/forward cache.",webLocks:"Pages that use WebLocks are not currently eligible for back/forward cache.",webHID:"Pages that use WebHID are not currently eligible for back/forward cache.",webShare:"Pages that use WebShare are not currently eligible for back/forwad cache.",requestedStorageAccessGrant:"Pages that have requested storage access are not currently eligible for back/forward cache.",webNfc:"Pages that use WebNfc are not currently eligible for back/forwad cache.",outstandingNetworkRequestFetch:"Pages with an in-flight fetch network request are not currently eligible for back/forward cache.",outstandingNetworkRequestXHR:"Pages with an in-flight XHR network request are not currently eligible for back/forward cache.",appBanner:"Pages that requested an AppBanner are not currently eligible for back/forward cache.",printing:"Pages that show Printing UI are not currently eligible for back/forward cache.",webDatabase:"Pages that use WebDatabase are not currently eligible for back/forward cache.",pictureInPicture:"Pages that use Picture-in-Picture are not currently eligible for back/forward cache.",portal:"Pages that use portals are not currently eligible for back/forward cache.",speechRecognizer:"Pages that use SpeechRecognizer are not currently eligible for back/forward cache.",idleManager:"Pages that use IdleManager are not currently eligible for back/forward cache.",paymentManager:"Pages that use PaymentManager are not currently eligible for back/forward cache.",speechSynthesis:"Pages that use SpeechSynthesis are not currently eligible for back/forward cache.",keyboardLock:"Pages that use Keyboard lock are not currently eligible for back/forward cache.",webOTPService:"Pages that use WebOTPService are not currently eligible for bfcache.",outstandingNetworkRequestDirectSocket:"Pages with an in-flight network request are not currently eligible for back/forward cache.",injectedJavascript:"IPages that JavaScript is injected into by extensions are not currently eligible for back/forward cache.",injectedStyleSheet:"Pages that StyleSheet is injected into by extensions are not currently eligible for back/forward cache.",contentSecurityHandler:"Pages that use SecurityHandler are not eligible for back/forward cache.",contentWebAuthenticationAPI:"Pages that use WebAuthetication API are not eligible for back/forward cache.",contentFileChooser:"Pages that use FileChooser API are not eligible for back/forward cache.",contentSerial:"Pages that use Serial API are not eligible for back/forward cache.",contentFileSystemAccess:"Pages that use File System Access API are not eligible for back/forward cache.",contentMediaDevicesDispatcherHost:"Pages that use Media Device Dispatcher are not eligible for back/forward cache.",contentWebBluetooth:"Pages that use WebBluetooth API are not eligible for back/forward cache.",contentWebUSB:"Pages that use WebUSB API are not eligible for back/forward cache.",contentMediaSession:"Pages that use MediaSession API and set a playback state are not eligible for back/forward cache.",contentMediaSessionService:"Pages that use MediaSession API and set action handlers are not eligible for back/forward cache.",contentMediaPlay:"A media player was playing upon navigating away."},M=i.i18n.registerUIStrings("panels/application/BackForwardCacheStrings.ts",R),P=i.i18n.getLazilyComputedLocalizedString.bind(void 0,M),L={NotMainFrame:{name:P(R.notMainFrame)},BackForwardCacheDisabled:{name:P(R.backForwardCacheDisabled)},RelatedActiveContentsExist:{name:P(R.relatedActiveContentsExist)},HTTPStatusNotOK:{name:P(R.HTTPStatusNotOK)},SchemeNotHTTPOrHTTPS:{name:P(R.schemeNotHTTPOrHTTPS)},Loading:{name:P(R.loading)},WasGrantedMediaAccess:{name:P(R.wasGrantedMediaAccess)},HTTPMethodNotGET:{name:P(R.HTTPMethodNotGET)},SubframeIsNavigating:{name:P(R.subframeIsNavigating)},Timeout:{name:P(R.timeout)},CacheLimit:{name:P(R.cacheLimit)},JavaScriptExecution:{name:P(R.JavaScriptExecution)},RendererProcessKilled:{name:P(R.rendererProcessKilled)},RendererProcessCrashed:{name:P(R.rendererProcessCrashed)},GrantedMediaStreamAccess:{name:P(R.grantedMediaStreamAccess)},CacheFlushed:{name:P(R.cacheFlushed)},ServiceWorkerVersionActivation:{name:P(R.serviceWorkerVersionActivation)},SessionRestored:{name:P(R.sessionRestored)},ServiceWorkerPostMessage:{name:P(R.serviceWorkerPostMessage)},EnteredBackForwardCacheBeforeServiceWorkerHostAdded:{name:P(R.enteredBackForwardCacheBeforeServiceWorkerHostAdded)},ServiceWorkerClaim:{name:P(R.serviceWorkerClaim)},HaveInnerContents:{name:P(R.haveInnerContents)},TimeoutPuttingInCache:{name:P(R.timeoutPuttingInCache)},BackForwardCacheDisabledByLowMemory:{name:P(R.backForwardCacheDisabledByLowMemory)},BackForwardCacheDisabledByCommandLine:{name:P(R.backForwardCacheDisabledByCommandLine)},NetworkRequestDatapipeDrainedAsBytesConsumer:{name:P(R.networkRequestDatapipeDrainedAsBytesConsumer)},NetworkRequestRedirected:{name:P(R.networkRequestRedirected)},NetworkRequestTimeout:{name:P(R.networkRequestTimeout)},NetworkExceedsBufferLimit:{name:P(R.networkExceedsBufferLimit)},NavigationCancelledWhileRestoring:{name:P(R.navigationCancelledWhileRestoring)},BackForwardCacheDisabledForPrerender:{name:P(R.backForwardCacheDisabledForPrerender)},UserAgentOverrideDiffers:{name:P(R.userAgentOverrideDiffers)},ForegroundCacheLimit:{name:P(R.foregroundCacheLimit)},BackForwardCacheDisabledForDelegate:{name:P(R.backForwardCacheDisabledForDelegate)},OptInUnloadHeaderNotPresent:{name:P(R.optInUnloadHeaderNotPresent)},UnloadHandlerExistsInMainFrame:{name:P(R.unloadHandlerExistsInMainFrame)},UnloadHandlerExistsInSubFrame:{name:P(R.unloadHandlerExistsInSubFrame)},ServiceWorkerUnregistration:{name:P(R.serviceWorkerUnregistration)},NoResponseHead:{name:P(R.noResponseHead)},CacheControlNoStore:{name:P(R.cacheControlNoStore)},CacheControlNoStoreCookieModified:{name:P(R.cacheControlNoStore)},CacheControlNoStoreHTTPOnlyCookieModified:{name:P(R.cacheControlNoStore)},DisableForRenderFrameHostCalled:{name:P(R.ineligibleAPI)},BlocklistedFeatures:{name:P(R.ineligibleAPI)},SchedulerTrackedFeatureUsed:{name:P(R.ineligibleAPI)},DomainNotAllowed:{name:P(R.internalError)},ConflictingBrowsingInstance:{name:P(R.internalError)},NotMostRecentNavigationEntry:{name:P(R.internalError)},IgnoreEventAndEvict:{name:P(R.internalError)},BrowsingInstanceNotSwapped:{name:P(R.internalError)},ActivationNavigationsDisallowedForBug1234857:{name:P(R.internalError)},Unknown:{name:P(R.internalError)},RenderFrameHostReused_SameSite:{name:P(R.internalError)},RenderFrameHostReused_CrossSite:{name:P(R.internalError)},WebSocket:{name:P(R.webSocket)},WebTransport:{name:P(R.webTransport)},WebRTC:{name:P(R.webRTC)},MainResourceHasCacheControlNoStore:{name:P(R.mainResourceHasCacheControlNoStore)},MainResourceHasCacheControlNoCache:{name:P(R.mainResourceHasCacheControlNoCache)},SubresourceHasCacheControlNoStore:{name:P(R.subresourceHasCacheControlNoStore)},SubresourceHasCacheControlNoCache:{name:P(R.subresourceHasCacheControlNoCache)},ContainsPlugins:{name:P(R.containsPlugins)},DocumentLoaded:{name:P(R.documentLoaded)},DedicatedWorkerOrWorklet:{name:P(R.dedicatedWorkerOrWorklet)},OutstandingNetworkRequestOthers:{name:P(R.outstandingNetworkRequestOthers)},OutstandingIndexedDBTransaction:{name:P(R.outstandingIndexedDBTransaction)},RequestedNotificationsPermission:{name:P(R.requestedNotificationsPermission)},RequestedMIDIPermission:{name:P(R.requestedMIDIPermission)},RequestedAudioCapturePermission:{name:P(R.requestedAudioCapturePermission)},RequestedVideoCapturePermission:{name:P(R.requestedVideoCapturePermission)},RequestedBackForwardCacheBlockedSensors:{name:P(R.requestedBackForwardCacheBlockedSensors)},RequestedBackgroundWorkPermission:{name:P(R.requestedBackgroundWorkPermission)},BroadcastChannel:{name:P(R.broadcastChannel)},IndexedDBConnection:{name:P(R.indexedDBConnection)},WebXR:{name:P(R.webXR)},SharedWorker:{name:P(R.sharedWorker)},WebLocks:{name:P(R.webLocks)},WebHID:{name:P(R.webHID)},WebShare:{name:P(R.webShare)},RequestedStorageAccessGrant:{name:P(R.requestedStorageAccessGrant)},WebNfc:{name:P(R.webNfc)},OutstandingNetworkRequestFetch:{name:P(R.outstandingNetworkRequestFetch)},OutstandingNetworkRequestXHR:{name:P(R.outstandingNetworkRequestXHR)},AppBanner:{name:P(R.appBanner)},Printing:{name:P(R.printing)},WebDatabase:{name:P(R.webDatabase)},PictureInPicture:{name:P(R.pictureInPicture)},Portal:{name:P(R.portal)},SpeechRecognizer:{name:P(R.speechRecognizer)},IdleManager:{name:P(R.idleManager)},PaymentManager:{name:P(R.paymentManager)},SpeechSynthesis:{name:P(R.speechSynthesis)},KeyboardLock:{name:P(R.keyboardLock)},WebOTPService:{name:P(R.webOTPService)},OutstandingNetworkRequestDirectSocket:{name:P(R.outstandingNetworkRequestDirectSocket)},InjectedJavascript:{name:P(R.injectedJavascript)},InjectedStyleSheet:{name:P(R.injectedStyleSheet)},Dummy:{name:P(R.internalError)},ContentSecurityHandler:{name:P(R.contentSecurityHandler)},ContentWebAuthenticationAPI:{name:P(R.contentWebAuthenticationAPI)},ContentFileChooser:{name:P(R.contentFileChooser)},ContentSerial:{name:P(R.contentSerial)},ContentFileSystemAccess:{name:P(R.contentFileSystemAccess)},ContentMediaDevicesDispatcherHost:{name:P(R.contentMediaDevicesDispatcherHost)},ContentWebBluetooth:{name:P(R.contentWebBluetooth)},ContentWebUSB:{name:P(R.contentWebUSB)},ContentMediaSession:{name:P(R.contentMediaSession)},ContentMediaSessionService:{name:P(R.contentMediaSessionService)},ContentMediaPlay:{name:P(R.contentMediaPlay)},ContentScreenReader:{name:i.i18n.lockedLazyString("ContentScreenReader")},EmbedderPopupBlockerTabHelper:{name:i.i18n.lockedLazyString("EmbedderPopupBlockerTabHelper")},EmbedderSafeBrowsingTriggeredPopupBlocker:{name:i.i18n.lockedLazyString("EmbedderSafeBrowsingTriggeredPopupBlocker")},EmbedderSafeBrowsingThreatDetails:{name:i.i18n.lockedLazyString("EmbedderSafeBrowsingThreatDetails")},EmbedderAppBannerManager:{name:i.i18n.lockedLazyString("EmbedderAppBannerManager")},EmbedderDomDistillerViewerSource:{name:i.i18n.lockedLazyString("EmbedderDomDistillerViewerSource")},EmbedderDomDistillerSelfDeletingRequestDelegate:{name:i.i18n.lockedLazyString("EmbedderDomDistillerSelfDeletingRequestDelegate")},EmbedderOomInterventionTabHelper:{name:i.i18n.lockedLazyString("EmbedderOomInterventionTabHelper")},EmbedderOfflinePage:{name:i.i18n.lockedLazyString("EmbedderOfflinePage")},EmbedderChromePasswordManagerClientBindCredentialManager:{name:i.i18n.lockedLazyString("EmbedderChromePasswordManagerClientBindCredentialManager")},EmbedderPermissionRequestManager:{name:i.i18n.lockedLazyString("EmbedderPermissionRequestManager")},EmbedderModalDialog:{name:i.i18n.lockedLazyString("EmbedderModalDialog")},EmbedderExtensions:{name:i.i18n.lockedLazyString("EmbedderExtensions")},EmbedderExtensionMessaging:{name:i.i18n.lockedLazyString("EmbedderExtensionMessaging")},EmbedderExtensionMessagingForOpenPort:{name:i.i18n.lockedLazyString("EmbedderExtensionMessagingForOpenPort")},EmbedderExtensionSentMessageToCachedFrame:{name:i.i18n.lockedLazyString("EmbedderExtensionSentMessageToCachedFrame")}},D=new CSSStyleSheet;D.replaceSync(".not-restored-reason-list{margin:0;list-style-type:none;padding-inline-start:0}.inline-icon{vertical-align:sub}\n/*# sourceURL=backForwardCacheView.css */\n");const F={mainFrame:"Main Frame",backForwardCacheTitle:"Back/forward cache",unavailable:"unavailable",url:"URL",bfcacheStatus:"Back/forward cache Status",unknown:"unknown",normalNavigation:"Normal navigation (Not restored from back/forward cache)",restoredFromBFCache:"Restored from back/forward cache",pageSupportNeeded:"Actionable",pageSupportNeededExplanation:"These reasons are actionable i.e. they can be cleaned up to make the page eligible for back/forward cache.",circumstantial:"Not Actionable",circumstantialExplanation:"These reasons are not actionable i.e. caching was prevented by something outside of the direct control of the page.",supportPending:"Pending Support",runTest:"Run Test",supportPendingExplanation:"Chrome support for these reasons is pending i.e. they will not prevent the page from being eligible for back/forward cache in a future version of Chrome."},O=i.i18n.registerUIStrings("panels/application/BackForwardCacheView.ts",F),B=i.i18n.getLocalizedString.bind(void 0,O);class N extends o.ThrottledWidget.ThrottledWidget{constructor(){super(!0,1e3),this.getMainResourceTreeModel()?.addEventListener(a.ResourceTreeModel.Events.MainFrameNavigated,this.onBackForwardCacheUpdate,this),this.getMainResourceTreeModel()?.addEventListener(a.ResourceTreeModel.Events.BackForwardCacheDetailsUpdated,this.onBackForwardCacheUpdate,this),this.update()}wasShown(){super.wasShown(),this.registerCSSFiles([D])}onBackForwardCacheUpdate(){this.update()}async doUpdate(){const e={reportTitle:B(F.backForwardCacheTitle)},t=c.html` <${l.ReportView.Report.litTagName} .data="${e}"> ${this.renderMainFrameInformation(this.getMainFrame())} </${l.ReportView.Report.litTagName}> `;c.render(t,this.contentElement,{host:this})}getMainResourceTreeModel(){return a.TargetManager.TargetManager.instance().mainTarget()?.model(a.ResourceTreeModel.ResourceTreeModel)||null}getMainFrame(){return this.getMainResourceTreeModel()?.mainFrame||null}async goBackOneHistoryEntry(){a.TargetManager.TargetManager.instance().removeModelListener(a.ResourceTreeModel.ResourceTreeModel,a.ResourceTreeModel.Events.FrameNavigated,this.goBackOneHistoryEntry,this);const e=a.TargetManager.TargetManager.instance().mainTarget();if(!e)return;const t=e.model(a.ResourceTreeModel.ResourceTreeModel);if(!t)return;const i=await t.navigationHistory();i&&t.navigateToHistoryEntry(i.entries[i.currentIndex-1])}async navigateAwayAndBack(){const e=a.TargetManager.TargetManager.instance().mainTarget();if(!e)return;const t=e.model(a.ResourceTreeModel.ResourceTreeModel);t&&(a.TargetManager.TargetManager.instance().addModelListener(a.ResourceTreeModel.ResourceTreeModel,a.ResourceTreeModel.Events.FrameNavigated,this.goBackOneHistoryEntry,this),t.navigate("chrome://terms"))}renderMainFrameInformation(e){return e?c.html` <${l.ReportView.ReportSectionHeader.litTagName}> <${d.Button.Button.litTagName} .variant="${"primary"}" @click="${this.navigateAwayAndBack}"> ${B(F.runTest)} </${d.Button.Button.litTagName}> </${l.ReportView.ReportSectionHeader.litTagName}> <${l.ReportView.ReportKey.litTagName}>${B(F.url)}</${l.ReportView.ReportKey.litTagName}> <${l.ReportView.ReportValue.litTagName}>${e.url}</${l.ReportView.ReportValue.litTagName}> <${l.ReportView.ReportKey.litTagName}>${B(F.bfcacheStatus)}</${l.ReportView.ReportKey.litTagName}> <${l.ReportView.ReportValue.litTagName}>${this.renderBackForwardCacheStatus(e.backForwardCacheDetails.restoredFromCache)}</${l.ReportView.ReportValue.litTagName}> ${this.maybeRenderExplanations(e.backForwardCacheDetails.explanations)} `:c.html`<${l.ReportView.ReportKey.litTagName}>${B(F.mainFrame)}</${l.ReportView.ReportKey.litTagName}> <${l.ReportView.ReportValue.litTagName}> ${B(F.unavailable)} </${l.ReportView.ReportValue.litTagName}>`}renderBackForwardCacheStatus(e){switch(e){case!0:return B(F.restoredFromBFCache);case!1:return B(F.normalNavigation)}return B(F.unknown)}maybeRenderExplanations(e){if(0===e.length)return c.nothing;const t=e.filter((e=>"PageSupportNeeded"===e.type)),i=e.filter((e=>"SupportPending"===e.type)),r=e.filter((e=>"Circumstantial"===e.type));return c.html` ${this.renderExplanations(B(F.pageSupportNeeded),B(F.pageSupportNeededExplanation),t)} ${this.renderExplanations(B(F.supportPending),B(F.supportPendingExplanation),i)} ${this.renderExplanations(B(F.circumstantial),B(F.circumstantialExplanation),r)} `}renderExplanations(e,t,i){return c.html` ${i.length>0?c.html` <${l.ReportView.ReportKey.litTagName}> ${e} <${h.Icon.Icon.litTagName} class="inline-icon" .data="${{iconName:"help_outline",color:"var(--color-text-secondary)",width:"16px",height:"16px"}}" title="${t}"></${h.Icon.Icon.litTagName}> </${l.ReportView.ReportKey.litTagName}> <${l.ReportView.ReportValue.litTagName}> <ul class="not-restored-reason-list">${i.map((e=>this.renderReason(e)))}</ul> </${l.ReportView.ReportValue.litTagName}> `:c.nothing} `}renderReason(e){return c.html` <li> <${h.Icon.Icon.litTagName} class="inline-icon" .data="${{iconName:"circled_exclamation_icon",color:"orange",width:"16px",height:"16px"}}"></${h.Icon.Icon.litTagName}> ${e.reason} : ${e.reason in L?c.html`${L[e.reason].name()}`:c.nothing} </li> `}}const W=new CSSStyleSheet;W.replaceSync(".service-worker-cache-data-view .data-view-toolbar{position:relative;background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-details-hairline);padding-right:10px}.service-worker-cache-data-view .data-grid{flex:auto}.service-worker-cache-data-view .data-grid .data-container tr:nth-last-child(1) td{border:0}.service-worker-cache-data-view .data-grid .data-container tr:nth-last-child(2) td{border-bottom:1px solid var(--color-details-hairline)}.service-worker-cache-data-view .data-grid .data-container tr.selected{background-color:var(--color-background-highlight);color:inherit}.service-worker-cache-data-view .data-grid:focus .data-container tr.selected{background-color:var(--color-primary);color:var(--color-background)}.service-worker-cache-data-view .section,.service-worker-cache-data-view .section>.header,.service-worker-cache-data-view .section>.header .title{margin:0;min-height:inherit;line-height:inherit}.service-worker-cache-data-view .data-grid .data-container td .section .header .title{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.cache-preview-panel-resizer{background-color:var(--color-background-elevation-1);height:4px;border-bottom:1px solid var(--color-details-hairline)}.cache-storage-summary-bar{flex:0 0 27px;line-height:27px;padding-left:5px;background-color:var(--color-background-elevation-1);border-top:1px solid var(--color-details-hairline);white-space:nowrap;text-overflow:ellipsis;overflow:hidden}\n/*# sourceURL=serviceWorkerCacheViews.css */\n");const V={cache:"Cache",refresh:"Refresh",deleteSelected:"Delete Selected",filterByPath:"Filter by Path",selectACacheEntryAboveToPreview:"Select a cache entry above to preview",name:"Name",timeCached:"Time Cached",varyHeaderWarning:"⚠️ Set ignoreVary to true when matching this entry",serviceWorkerCache:"`Service Worker` Cache",matchingEntriesS:"Matching entries: {PH1}",totalEntriesS:"Total entries: {PH1}",headers:"Headers",preview:"Preview"},A=i.i18n.registerUIStrings("panels/application/ServiceWorkerCacheViews.ts",V),U=i.i18n.getLocalizedString.bind(void 0,A);class H extends o.View.SimpleView{model;entriesForTest;splitWidget;previewPanel;preview;cache;dataGrid;refreshThrottler;refreshButton;deleteSelectedButton;entryPathFilter;returnCount;summaryBarElement;loadingPromise;constructor(t,i){super(U(V.cache)),this.model=t,this.entriesForTest=null,this.element.classList.add("service-worker-cache-data-view"),this.element.classList.add("storage-view");const r=new o.Toolbar.Toolbar("data-view-toolbar",this.element);this.splitWidget=new o.SplitWidget.SplitWidget(!1,!1),this.splitWidget.show(this.element),this.previewPanel=new o.Widget.VBox;const s=this.previewPanel.element.createChild("div","cache-preview-panel-resizer");this.splitWidget.setMainWidget(this.previewPanel),this.splitWidget.installResizer(s),this.preview=null,this.cache=i,this.dataGrid=null,this.refreshThrottler=new e.Throttler.Throttler(300),this.refreshButton=new o.Toolbar.ToolbarButton(U(V.refresh),"largeicon-refresh"),this.refreshButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.refreshButtonClicked,this),r.appendToolbarItem(this.refreshButton),this.deleteSelectedButton=new o.Toolbar.ToolbarButton(U(V.deleteSelected),"largeicon-delete"),this.deleteSelectedButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,(e=>{this.deleteButtonClicked(null)})),r.appendToolbarItem(this.deleteSelectedButton);const a=new o.Toolbar.ToolbarInput(U(V.filterByPath),"",1);r.appendToolbarItem(a);const n=new e.Throttler.Throttler(300);this.entryPathFilter="",a.addEventListener(o.Toolbar.ToolbarInput.Event.TextChanged,(()=>{n.schedule((()=>(this.entryPathFilter=a.value(),this.updateData(!0))))})),this.returnCount=null,this.summaryBarElement=null,this.loadingPromise=null,this.update(i)}resetDataGrid(){this.dataGrid&&this.dataGrid.asWidget().detach(),this.dataGrid=this.createDataGrid();const e=this.dataGrid.asWidget();this.splitWidget.setSidebarWidget(e),e.setMinimumSize(0,250)}wasShown(){this.model.addEventListener(a.ServiceWorkerCacheModel.Events.CacheStorageContentUpdated,this.cacheContentUpdated,this),this.registerCSSFiles([W]),this.updateData(!0)}willHide(){this.model.removeEventListener(a.ServiceWorkerCacheModel.Events.CacheStorageContentUpdated,this.cacheContentUpdated,this)}showPreview(e){e&&this.preview===e||(this.preview&&this.preview.detach(),e||(e=new o.EmptyWidget.EmptyWidget(U(V.selectACacheEntryAboveToPreview))),this.preview=e,this.preview.show(this.previewPanel.element))}createDataGrid(){const e=[{id:"number",title:"#",sortable:!1,width:"3px"},{id:"name",title:U(V.name),weight:4,sortable:!0},{id:"responseType",title:i.i18n.lockedString("Response-Type"),weight:1,align:u.DataGrid.Align.Right,sortable:!0},{id:"contentType",title:i.i18n.lockedString("Content-Type"),weight:1,sortable:!0},{id:"contentLength",title:i.i18n.lockedString("Content-Length"),weight:1,align:u.DataGrid.Align.Right,sortable:!0},{id:"responseTime",title:U(V.timeCached),width:"12em",weight:1,align:u.DataGrid.Align.Right,sortable:!0},{id:"varyHeader",title:i.i18n.lockedString("Vary Header"),weight:1,sortable:!0}],t=new u.DataGrid.DataGridImpl({displayName:U(V.serviceWorkerCache),columns:e,deleteCallback:this.deleteButtonClicked.bind(this),refreshCallback:this.updateData.bind(this,!0),editCallback:void 0});return t.addEventListener(u.DataGrid.Events.SortingChanged,this.sortingChanged,this),t.addEventListener(u.DataGrid.Events.SelectedNode,(e=>{this.previewCachedResponse(e.data.data)}),this),t.setStriped(!0),t}sortingChanged(){if(!this.dataGrid)return;const e=this.dataGrid,t=e.isSortOrderAscending(),i=e.sortColumnId();let r;"name"===i?r=(e,t)=>e.name.localeCompare(t.name):"contentType"===i?r=(e,t)=>e.data.mimeType.localeCompare(t.data.mimeType):"contentLength"===i?r=(e,t)=>e.data.resourceSize-t.data.resourceSize:"responseTime"===i?r=(e,t)=>e.data.endTime-t.data.endTime:"responseType"===i?r=(e,t)=>e.responseType.localeCompare(t.responseType):"varyHeader"===i&&(r=(e,t)=>e.varyHeader.localeCompare(t.varyHeader));const s=e.rootNode().children.slice();e.rootNode().removeChildren(),s.sort(((e,i)=>{const s=r(e,i);return t?s:-s})),s.forEach((t=>e.rootNode().appendChild(t)))}async deleteButtonClicked(e){(e||(e=this.dataGrid&&this.dataGrid.selectedNode))&&(await this.model.deleteCacheEntry(this.cache,e.data.url()),e.remove())}update(e){this.cache=e,this.resetDataGrid(),this.updateData(!0)}updateSummaryBar(){this.summaryBarElement||(this.summaryBarElement=this.element.createChild("div","cache-storage-summary-bar")),this.summaryBarElement.removeChildren();const e=this.summaryBarElement.createChild("span");this.entryPathFilter?e.textContent=U(V.matchingEntriesS,{PH1:String(this.returnCount)}):e.textContent=U(V.totalEntriesS,{PH1:String(this.returnCount)})}updateDataCallback(e,t,i){if(!this.dataGrid)return;const r=this.dataGrid.selectedNode&&this.dataGrid.selectedNode.data.url();this.refreshButton.setEnabled(!0),this.entriesForTest=t,this.returnCount=i,this.updateSummaryBar();const s=new Map,a=this.dataGrid.rootNode();for(const e of a.children)s.set(e.data.url,e);a.removeChildren();let n=null;for(let e=0;e<t.length;++e){const i=t[e];let o=s.get(i.requestURL);o&&o.data.responseTime===i.responseTime?o.data.number=e:(o=new _(e,this.createRequest(i),i.responseType),o.selectable=!0),a.appendChild(o),i.requestURL===r&&(n=o)}n?n.revealAndSelect():this.showPreview(null),this.updatedForTest()}async updateData(e){if(!e&&this.loadingPromise)return this.loadingPromise;if(this.refreshButton.setEnabled(!1),this.loadingPromise)return this.loadingPromise;this.loadingPromise=new Promise((e=>{this.model.loadAllCacheData(this.cache,this.entryPathFilter,((t,i)=>{e({entries:t,returnCount:i})}))}));const{entries:t,returnCount:i}=await this.loadingPromise;this.updateDataCallback(0,t,i),this.loadingPromise=null}refreshButtonClicked(){this.updateData(!0)}cacheContentUpdated(e){const{cacheName:t,origin:i}=e.data;this.cache.securityOrigin===i&&this.cache.cacheName===t&&this.refreshThrottler.schedule((()=>Promise.resolve(this.updateData(!0))),!0)}async previewCachedResponse(e){let t=q.get(e);t||(t=new j(e),q.set(e,t)),this.dataGrid&&this.dataGrid.selectedNode&&e===this.dataGrid.selectedNode.data&&this.showPreview(t)}createRequest(t){const i=a.NetworkRequest.NetworkRequest.createWithoutBackendRequest("cache-storage-"+t.requestURL,t.requestURL,"",null);i.requestMethod=t.requestMethod,i.setRequestHeaders(t.requestHeaders),i.statusCode=t.responseStatus,i.statusText=t.responseStatusText,i.protocol=new e.ParsedURL.ParsedURL(t.requestURL).scheme,i.responseHeaders=t.responseHeaders,i.setRequestHeadersText(""),i.endTime=t.responseTime;let r=t.responseHeaders.find((e=>"content-type"===e.name.toLowerCase()));const s=r?r.value:a.NetworkRequest.MIME_TYPE.PLAIN;i.mimeType=s,r=t.responseHeaders.find((e=>"content-length"===e.name.toLowerCase())),i.resourceSize=r&&Number(r.value)||0;let n=e.ResourceType.ResourceType.fromMimeType(s);return n||(n=e.ResourceType.ResourceType.fromURL(t.requestURL)||e.ResourceType.resourceTypes.Other),i.setResourceType(n),i.setContentDataProvider(this.requestContent.bind(this,i)),i}async requestContent(e){const t=e.resourceType().isTextType(),i={error:null,content:null,encoded:!t},r=await this.cache.requestCachedResponse(e.url(),e.requestHeaders());return r&&(i.content=t?window.atob(r.body):r.body),i}updatedForTest(){}static previewSymbol=Symbol("preview")}const q=new WeakMap;class _ extends u.DataGrid.DataGridNode{number;name;request;responseType;varyHeader;constructor(t,i,s){super(i),this.number=t;const a=new e.ParsedURL.ParsedURL(i.url());a.isValid?this.name=r.StringUtilities.trimURL(i.url(),a.domain()):this.name=i.url(),this.request=i,this.responseType=s,this.varyHeader=i.responseHeaders.find((e=>"vary"===e.name.toLowerCase()))?.value||""}createCell(e){const t=this.createTD(e);let i,r=this.request.url();return"number"===e?i=String(this.number):"name"===e?i=this.name:"responseType"===e?i="opaqueResponse"===this.responseType?"opaque":"opaqueRedirect"===this.responseType?"opaqueredirect":this.responseType:"contentType"===e?i=this.request.mimeType:"contentLength"===e?i=(0|this.request.resourceSize).toLocaleString("en-US"):"responseTime"===e?i=new Date(1e3*this.request.endTime).toLocaleString():"varyHeader"===e&&(i=this.varyHeader,this.varyHeader&&(r=U(V.varyHeaderWarning))),u.DataGrid.DataGridImpl.setElementText(t,i||"",!0),o.Tooltip.Tooltip.install(t,r),t}}class j extends o.Widget.VBox{tabbedPane;resourceViewTabSetting;constructor(t){super(),this.tabbedPane=new o.TabbedPane.TabbedPane,this.tabbedPane.addEventListener(o.TabbedPane.Events.TabSelected,this.tabSelected,this),this.resourceViewTabSetting=e.Settings.Settings.instance().createSetting("cacheStorageViewTab","preview"),this.tabbedPane.appendTab("headers",U(V.headers),new g.RequestHeadersView.RequestHeadersView(t)),this.tabbedPane.appendTab("preview",U(V.preview),new g.RequestPreviewView.RequestPreviewView(t)),this.tabbedPane.show(this.element)}wasShown(){super.wasShown(),this.selectTab()}selectTab(e){e||(e=this.resourceViewTabSetting.get()),e&&!this.tabbedPane.selectTab(e)&&this.tabbedPane.selectTab("headers")}tabSelected(e){e.data.isUserGesture&&this.resourceViewTabSetting.set(e.data.tabId)}}var z=Object.freeze({__proto__:null,ServiceWorkerCacheView:H,DataGridNode:_,RequestView:j});const G={cacheStorage:"Cache Storage",backForwardCache:"Back/forward cache",refreshCaches:"Refresh Caches",delete:"Delete"},K=i.i18n.registerUIStrings("panels/application/ApplicationPanelCacheSection.ts",G),$=i.i18n.getLocalizedString.bind(void 0,K);class Q extends x{swCacheModel;swCacheTreeElements;constructor(e){super(e,$(G.cacheStorage),"CacheStorage");const t=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLink("https://developer.chrome.com/docs/devtools/storage/cache/?utm_source=devtools"),this.setLeadingIcons([t]),this.swCacheModel=null,this.swCacheTreeElements=new Set}initialize(e){if(this.swCacheTreeElements.clear(),this.swCacheModel=e,e)for(const t of e.caches())this.addCache(e,t);a.TargetManager.TargetManager.instance().addModelListener(a.ServiceWorkerCacheModel.ServiceWorkerCacheModel,a.ServiceWorkerCacheModel.Events.CacheAdded,this.cacheAdded,this),a.TargetManager.TargetManager.instance().addModelListener(a.ServiceWorkerCacheModel.ServiceWorkerCacheModel,a.ServiceWorkerCacheModel.Events.CacheRemoved,this.cacheRemoved,this)}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem($(G.refreshCaches),this.refreshCaches.bind(this)),t.show()}refreshCaches(){this.swCacheModel&&this.swCacheModel.refreshCacheNames()}cacheAdded(e){const{model:t,cache:i}=e.data;this.addCache(t,i)}addCache(e,t){const i=new X(this.resourcesPanel,e,t);this.swCacheTreeElements.add(i),this.appendChild(i)}cacheRemoved(e){const{model:t,cache:i}=e.data,r=this.cacheTreeElement(t,i);r&&(this.removeChild(r),this.swCacheTreeElements.delete(r),this.setExpandable(this.childCount()>0))}cacheTreeElement(e,t){for(const i of this.swCacheTreeElements)if(i.hasModelAndCache(e,t))return i;return null}}class X extends E{model;cache;view;constructor(e,t,i){super(e,i.cacheName+" - "+i.securityOrigin,!1),this.model=t,this.cache=i,this.view=null;const r=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.setLeadingIcons([r])}get itemURL(){return"cache://"+this.cache.cacheId}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem($(G.delete),this.clearCache.bind(this)),t.show()}clearCache(){this.model.deleteCache(this.cache)}update(e){this.cache=e,this.view&&this.view.update(e)}onselect(e){return super.onselect(e),this.view||(this.view=new H(this.model,this.cache)),this.showView(this.view),!1}hasModelAndCache(e,t){return this.cache.equals(t)&&this.model===e}}class J extends E{view;constructor(e){super(e,$(G.backForwardCache),!1);const t=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"bfcache://"}onselect(e){return super.onselect(e),this.view||(this.view=new N),this.showView(this.view),!1}}const Y=new CSSStyleSheet;Y.replaceSync(".report-field-name{flex-basis:152px}.manifest-view-header{min-width:600px;flex-shrink:0;flex-grow:0}.manifest-container{overflow:auto}.inline-icon{margin-left:4px;vertical-align:middle}.multiline-value{white-space:normal}.learn-more{padding-left:4px}\n/*# sourceURL=appManifestView.css */\n");const Z={noManifestDetected:"No manifest detected",appManifest:"App Manifest",errorsAndWarnings:"Errors and warnings",installability:"Installability",identity:"Identity",presentation:"Presentation",icons:"Icons",name:"Name",shortName:"Short name",computedAppId:"Computed App Id",appIdExplainer:"This is used by the browser to know whether the manifest should be updating an existing application, or whether it refers to a new web app that can be installed.",learnMore:"Learn more",appIdNote:"{PH1} {PH2} is not specified in the manifest, {PH3} is used instead. To specify an App Id that matches the current identity, set the {PH4} field to {PH5} {PH6}.",note:"Note:",copyToClipboard:"Copy to clipboard",description:"Description",startUrl:"Start URL",themeColor:"Theme color",backgroundColor:"Background color",orientation:"Orientation",display:"Display",newNoteUrl:"New note URL",descriptionMayBeTruncated:"Description may be truncated.",showOnlyTheMinimumSafeAreaFor:"Show only the minimum safe area for maskable icons",documentationOnMaskableIcons:"documentation on maskable icons",needHelpReadOurS:"Need help? Read {PH1}.",primaryManifestIconFromS:"Primary manifest icon from {PH1}",primaryIconasUsedByChrome:"Primary icon as used by `Chrome`",shortcutS:"Shortcut #{PH1}",shortcutSShouldIncludeAXPixel:"Shortcut #{PH1} should include a 96x96 pixel icon",screenshotS:"Screenshot #{PH1}",pageIsNotLoadedInTheMainFrame:"Page is not loaded in the main frame",pageIsNotServedFromASecureOrigin:"Page is not served from a secure origin",pageHasNoManifestLinkUrl:"Page has no manifest <link> `URL`",manifestCouldNotBeFetchedIsEmpty:"Manifest could not be fetched, is empty, or could not be parsed",manifestStartUrlIsNotValid:"Manifest start `URL` is not valid",manifestDoesNotContainANameOr:"Manifest does not contain a '`name`' or '`short_name`' field",manifestDisplayPropertyMustBeOne:"Manifest '`display`' property must be one of '`standalone`', '`fullscreen`', or '`minimal-ui`'",manifestDoesNotContainASuitable:'Manifest does not contain a suitable icon - PNG, SVG or WebP format of at least {PH1}px is required, the `sizes` attribute must be set, and the `purpose` attribute, if set, must include `"any"`.',avoidPurposeAnyAndMaskable:'Declaring an icon with `purpose: "any maskable"` is discouraged. It is likely to look incorrect on some platforms due to too much or too little padding.',noMatchingServiceWorkerDetected:"No matching `service worker` detected. You may need to reload the page, or check that the scope of the `service worker` for the current page encloses the scope and start URL from the manifest.",noSuppliedIconIsAtLeastSpxSquare:'No supplied icon is at least {PH1} pixels square in `PNG`, `SVG` or `WebP` format, with the purpose attribute unset or set to `"any"`.',couldNotDownloadARequiredIcon:"Could not download a required icon from the manifest",downloadedIconWasEmptyOr:"Downloaded icon was empty or corrupted",theSpecifiedApplicationPlatform:"The specified application platform is not supported on `Android`",noPlayStoreIdProvided:"No Play store ID provided",thePlayStoreAppUrlAndPlayStoreId:"The Play Store app URL and Play Store ID do not match",theAppIsAlreadyInstalled:"The app is already installed",aUrlInTheManifestContainsA:"A URL in the manifest contains a username, password, or port",pageIsLoadedInAnIncognitoWindow:"Page is loaded in an incognito window",pageDoesNotWorkOffline:"Page does not work offline",couldNotCheckServiceWorker:"Could not check `service worker` without a '`start_url`' field in the manifest",manifestSpecifies:"Manifest specifies `prefer_related_applications`: true",preferrelatedapplicationsIsOnly:"`prefer_related_applications` is only supported on `Chrome` Beta and Stable channels on `Android`.",manifestContainsDisplayoverride:"Manifest contains '`display_override`' field, and the first supported display mode must be one of '`standalone`', '`fullscreen`', or '`minimal-ui`'",pageDoesNotWorkOfflineThePage:"Page does not work offline. Starting in Chrome 93, the installability criteria are changing, and this site will not be installable. See {PH1} for more information.",imageFromS:"Image from {PH1}",screenshot:"Screenshot",icon:"Icon",sSrcIsNotSet:"{PH1} `src` is not set",sUrlSFailedToParse:"{PH1} URL ''{PH2}'' failed to parse",sSFailedToLoad:"{PH1} {PH2} failed to load",sSDoesNotSpecifyItsSizeInThe:"{PH1} {PH2} does not specify its size in the manifest",sSShouldSpecifyItsSizeAs:"{PH1} {PH2} should specify its size as `[width]x[height]`",sSShouldHaveSquareIcon:"Most operating systems require square icons. Please include at least one square icon in the array.",actualSizeSspxOfSSDoesNotMatch:"Actual size ({PH1}×{PH2})px of {PH3} {PH4} does not match specified size ({PH5}×{PH6}px)",actualWidthSpxOfSSDoesNotMatch:"Actual width ({PH1}px) of {PH2} {PH3} does not match specified width ({PH4}px)",actualHeightSpxOfSSDoesNotMatch:"Actual height ({PH1}px) of {PH2} {PH3} does not match specified height ({PH4}px)",sSSizeShouldBeAtLeast320:"{PH1} {PH2} size should be at least 320×320",sSSizeShouldBeAtMost3840:"{PH1} {PH2} size should be at most 3840×3840",sSWidthDoesNotComplyWithRatioRequirement:"{PH1} {PH2} width can't be more than 2.3 times as long as the height",sSHeightDoesNotComplyWithRatioRequirement:"{PH1} {PH2} height can't be more than 2.3 times as long as the width",screenshotPixelSize:'Screenshot {url} should specify a pixel size `[width]x[height]` instead of `"any"` as first size.'},ee=i.i18n.registerUIStrings("panels/application/AppManifestView.ts",Z),te=i.i18n.getLocalizedString.bind(void 0,ee);class ie extends o.Widget.VBox{emptyView;reportView;errorsSection;installabilitySection;identitySection;presentationSection;iconsSection;shortcutSections;screenshotsSections;nameField;shortNameField;descriptionField;startURLField;themeColorSwatch;backgroundColorSwatch;orientationField;displayField;newNoteUrlField;throttler;registeredListeners;target;resourceTreeModel;serviceWorkerManager;constructor(){super(!0),this.contentElement.classList.add("manifest-container"),e.Settings.Settings.instance().moduleSetting("colorFormat").addChangeListener(this.updateManifest.bind(this,!0)),this.emptyView=new o.EmptyWidget.EmptyWidget(te(Z.noManifestDetected)),this.emptyView.appendLink("https://web.dev/add-manifest/"),this.emptyView.show(this.contentElement),this.emptyView.hideWidget(),this.reportView=new o.ReportView.ReportView(te(Z.appManifest)),this.reportView.element.classList.add("manifest-view-header"),this.reportView.show(this.contentElement),this.reportView.hideWidget(),this.errorsSection=this.reportView.appendSection(te(Z.errorsAndWarnings)),this.installabilitySection=this.reportView.appendSection(te(Z.installability)),this.identitySection=this.reportView.appendSection(te(Z.identity)),this.presentationSection=this.reportView.appendSection(te(Z.presentation)),this.iconsSection=this.reportView.appendSection(te(Z.icons),"report-section-icons"),this.shortcutSections=[],this.screenshotsSections=[],this.nameField=this.identitySection.appendField(te(Z.name)),this.shortNameField=this.identitySection.appendField(te(Z.shortName)),this.descriptionField=this.identitySection.appendFlexedField(te(Z.description)),this.startURLField=this.presentationSection.appendField(te(Z.startUrl));const t=this.presentationSection.appendField(te(Z.themeColor));this.themeColorSwatch=new p.ColorSwatch.ColorSwatch,t.appendChild(this.themeColorSwatch);const i=this.presentationSection.appendField(te(Z.backgroundColor));this.backgroundColorSwatch=new p.ColorSwatch.ColorSwatch,i.appendChild(this.backgroundColorSwatch),this.orientationField=this.presentationSection.appendField(te(Z.orientation)),this.displayField=this.presentationSection.appendField(te(Z.display)),this.newNoteUrlField=this.presentationSection.appendField(te(Z.newNoteUrl)),this.throttler=new e.Throttler.Throttler(1e3),a.TargetManager.TargetManager.instance().observeTargets(this),this.registeredListeners=[]}targetAdded(e){this.target||(this.target=e,this.resourceTreeModel=e.model(a.ResourceTreeModel.ResourceTreeModel),this.serviceWorkerManager=e.model(a.ServiceWorkerManager.ServiceWorkerManager),this.resourceTreeModel&&this.serviceWorkerManager&&(this.updateManifest(!0),this.registeredListeners=[this.resourceTreeModel.addEventListener(a.ResourceTreeModel.Events.DOMContentLoaded,(()=>{this.updateManifest(!0)})),this.serviceWorkerManager.addEventListener(a.ServiceWorkerManager.Events.RegistrationUpdated,(()=>{this.updateManifest(!1)}))]))}targetRemoved(t){this.target===t&&this.resourceTreeModel&&this.serviceWorkerManager&&(delete this.resourceTreeModel,delete this.serviceWorkerManager,e.EventTarget.removeEventListeners(this.registeredListeners))}async updateManifest(e){if(!this.resourceTreeModel)return;const[{url:t,data:i,errors:r},s,a,n]=await Promise.all([this.resourceTreeModel.fetchAppManifest(),this.resourceTreeModel.getInstallabilityErrors(),this.resourceTreeModel.getManifestIcons(),this.resourceTreeModel.getAppId()]);this.throttler.schedule((()=>this.renderManifest(t,i,r,s,a,n)),e)}async renderManifest(r,s,a,n,d,c){const l=c?.appId||null,u=c?.recommendedId||null;if(!s&&!a.length)return this.emptyView.showWidget(),void this.reportView.hideWidget();this.emptyView.hideWidget(),this.reportView.showWidget();const g=m.Linkifier.Linkifier.linkifyURL(r);g.tabIndex=0,this.reportView.setURL(g),this.errorsSection.clearContent(),this.errorsSection.element.classList.toggle("hidden",!a.length);for(const e of a)this.errorsSection.appendRow().appendChild(o.UIUtils.createIconLabel(e.message,e.critical?"smallicon-error":"smallicon-warning"));if(!s)return;65279===s.charCodeAt(0)&&(s=s.slice(1));const p=JSON.parse(s);this.nameField.textContent=O("name"),this.shortNameField.textContent=O("short_name");const w=[],b=O("description");this.descriptionField.textContent=b,b.length>324&&w.push(te(Z.descriptionMayBeTruncated));const v=O("start_url");if(l&&u){const e=this.identitySection.appendField(te(Z.computedAppId));o.ARIAUtils.setAccessibleName(e,"App Id"),e.textContent=l;const r=new h.Icon.Icon;if(r.data={iconName:"help_outline",color:"var(--color-text-secondary)",width:"16px",height:"16px"},r.classList.add("inline-icon"),r.title=te(Z.appIdExplainer),e.appendChild(r),e.appendChild(o.XLink.XLink.create("https://developer.chrome.com/blog/pwa-manifest-id/",te(Z.learnMore),"learn-more")),!O("id")){const r=e.createChild("div","multiline-value"),s=document.createElement("b");s.textContent=te(Z.note);const a=document.createElement("code");a.textContent="id";const n=document.createElement("code");n.textContent="id";const o=document.createElement("code");o.textContent="start_url";const d=document.createElement("code");d.textContent=u;const c=new h.IconButton.IconButton;c.title=te(Z.copyToClipboard),c.data={groups:[{iconName:"copy_icon",iconHeight:"12px",iconWidth:"12px",text:""}],clickHandler:()=>{t.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(u)},compact:!0},r.appendChild(i.i18n.getFormatLocalizedString(ee,Z.appIdNote,{PH1:s,PH2:a,PH3:o,PH4:n,PH5:d,PH6:c}))}}else this.identitySection.removeField(te(Z.computedAppId));if(this.startURLField.removeChildren(),v){const t=e.ParsedURL.ParsedURL.completeURL(r,v),i=m.Linkifier.Linkifier.linkifyURL(t,{text:v});i.tabIndex=0,this.startURLField.appendChild(i)}this.themeColorSwatch.classList.toggle("hidden",!O("theme_color"));const S=e.Color.Color.parse(O("theme_color")||"white")||e.Color.Color.parse("white");S&&this.themeColorSwatch.renderColor(S,!0),this.backgroundColorSwatch.classList.toggle("hidden",!O("background_color"));const k=e.Color.Color.parse(O("background_color")||"white")||e.Color.Color.parse("white");k&&this.backgroundColorSwatch.renderColor(k,!0),this.orientationField.textContent=O("orientation");const f=O("display");this.displayField.textContent=f;const y=(p.note_taking||{}).new_note_url,C="string"==typeof y;if(this.newNoteUrlField.parentElement?.classList.toggle("hidden",!C),this.newNoteUrlField.removeChildren(),C){const t=e.ParsedURL.ParsedURL.completeURL(r,y),i=m.Linkifier.Linkifier.linkifyURL(t,{text:y});i.tabIndex=0,this.newNoteUrlField.appendChild(i)}const T=p.icons||[];this.iconsSection.clearContent();const I=p.shortcuts||[];for(const e of this.shortcutSections)e.detach(!0);const E=p.screenshots||[];for(const e of this.screenshotsSections)e.detach(!0);const x=[],R=o.UIUtils.CheckboxLabel.create(te(Z.showOnlyTheMinimumSafeAreaFor));R.classList.add("mask-checkbox"),R.addEventListener("click",(()=>{this.iconsSection.setIconMasked(R.checkboxElement.checked)})),this.iconsSection.appendRow().appendChild(R);const M=o.XLink.XLink.create("https://web.dev/maskable-icon/",te(Z.documentationOnMaskableIcons));if(this.iconsSection.appendRow().appendChild(i.i18n.getFormatLocalizedString(ee,Z.needHelpReadOurS,{PH1:M})),d&&d.primaryIcon){const e=document.createElement("div");e.classList.add("image-wrapper");const t=document.createElement("img");t.style.maxWidth="200px",t.style.maxHeight="200px",t.src="data:image/png;base64,"+d.primaryIcon,t.alt=te(Z.primaryManifestIconFromS,{PH1:r});const i=te(Z.primaryIconasUsedByChrome),s=this.iconsSection.appendFlexedField(i);e.appendChild(t),s.appendChild(e)}let P=!1;for(const e of T){const t=await this.appendImageResourceToSection(r,e,this.iconsSection,!1);x.push(...t.imageResourceErrors),P=t.squareSizedIconAvailable||P}P||x.push(te(Z.sSShouldHaveSquareIcon));let L=1;for(const t of I){const i=this.reportView.appendSection(te(Z.shortcutS,{PH1:L}));this.shortcutSections.push(i),i.appendFlexedField("Name",t.name),t.short_name&&i.appendFlexedField("Short name",t.short_name),t.description&&i.appendFlexedField("Description",t.description);const s=i.appendFlexedField("URL"),a=e.ParsedURL.ParsedURL.completeURL(r,t.url),n=m.Linkifier.Linkifier.linkifyURL(a,{text:t.url});n.tabIndex=0,s.appendChild(n);const o=t.icons||[];let d=!1;for(const e of o){const{imageResourceErrors:t}=await this.appendImageResourceToSection(r,e,i,!1);if(x.push(...t),!d&&e.sizes){const t=e.sizes.match(/^(\d+)x(\d+)$/);t&&t[1]>=96&&t[2]>=96&&(d=!0)}}d||x.push(te(Z.shortcutSShouldIncludeAXPixel,{PH1:L})),L++}let D=1;for(const e of E){const t=this.reportView.appendSection(te(Z.screenshotS,{PH1:D}));this.screenshotsSections.push(t);const{imageResourceErrors:i}=await this.appendImageResourceToSection(r,e,t,!0);x.push(...i),D++}this.installabilitySection.clearContent(),this.installabilitySection.element.classList.toggle("hidden",!n.length);const F=this.getInstallabilityErrorMessages(n);for(const e of F)this.installabilitySection.appendRow().appendChild(o.UIUtils.createIconLabel(e,"smallicon-warning"));this.errorsSection.element.classList.toggle("hidden",!a.length&&!x.length&&!w.length);for(const e of w)this.errorsSection.appendRow().appendChild(o.UIUtils.createIconLabel(e,"smallicon-warning"));for(const e of x)this.errorsSection.appendRow().appendChild(o.UIUtils.createIconLabel(e,"smallicon-warning"));function O(e){const t=p[e];return"string"!=typeof t?"":t}}getInstallabilityErrorMessages(e){const t=[];for(const i of e){let e;switch(i.errorId){case"not-in-main-frame":e=te(Z.pageIsNotLoadedInTheMainFrame);break;case"not-from-secure-origin":e=te(Z.pageIsNotServedFromASecureOrigin);break;case"no-manifest":e=te(Z.pageHasNoManifestLinkUrl);break;case"manifest-empty":e=te(Z.manifestCouldNotBeFetchedIsEmpty);break;case"start-url-not-valid":e=te(Z.manifestStartUrlIsNotValid);break;case"manifest-missing-name-or-short-name":e=te(Z.manifestDoesNotContainANameOr);break;case"manifest-display-not-supported":e=te(Z.manifestDisplayPropertyMustBeOne);break;case"manifest-missing-suitable-icon":if(1!==i.errorArguments.length||"minimum-icon-size-in-pixels"!==i.errorArguments[0].name){console.error("Installability error does not have the correct errorArguments");break}e=te(Z.manifestDoesNotContainASuitable,{PH1:i.errorArguments[0].value});break;case"no-matching-service-worker":e=te(Z.noMatchingServiceWorkerDetected);break;case"no-acceptable-icon":if(1!==i.errorArguments.length||"minimum-icon-size-in-pixels"!==i.errorArguments[0].name){console.error("Installability error does not have the correct errorArguments");break}e=te(Z.noSuppliedIconIsAtLeastSpxSquare,{PH1:i.errorArguments[0].value});break;case"cannot-download-icon":e=te(Z.couldNotDownloadARequiredIcon);break;case"no-icon-available":e=te(Z.downloadedIconWasEmptyOr);break;case"platform-not-supported-on-android":e=te(Z.theSpecifiedApplicationPlatform);break;case"no-id-specified":e=te(Z.noPlayStoreIdProvided);break;case"ids-do-not-match":e=te(Z.thePlayStoreAppUrlAndPlayStoreId);break;case"already-installed":e=te(Z.theAppIsAlreadyInstalled);break;case"url-not-supported-for-webapk":e=te(Z.aUrlInTheManifestContainsA);break;case"in-incognito":e=te(Z.pageIsLoadedInAnIncognitoWindow);break;case"not-offline-capable":e=te(Z.pageDoesNotWorkOffline);break;case"no-url-for-service-worker":e=te(Z.couldNotCheckServiceWorker);break;case"prefer-related-applications":e=te(Z.manifestSpecifies);break;case"prefer-related-applications-only-beta-stable":e=te(Z.preferrelatedapplicationsIsOnly);break;case"manifest-display-override-not-supported":e=te(Z.manifestContainsDisplayoverride);break;case"warn-not-offline-capable":e=te(Z.pageDoesNotWorkOfflineThePage,{PH1:"https://developer.chrome.com/blog/improved-pwa-offline-detection/"});break;default:console.error(`Installability error id '${i.errorId}' is not recognized`)}e&&t.push(e)}return t}async loadImage(e){const t=document.createElement("div");t.classList.add("image-wrapper");const i=document.createElement("img"),r=new Promise(((e,t)=>{i.onload=e,i.onerror=t}));i.src=e,i.alt=te(Z.imageFromS,{PH1:e}),t.appendChild(i);try{return await r,{wrapper:t,image:i}}catch(e){}return null}parseSizes(e,t,i,r){const s=e.split(/\s+/),a=[];for(const e of s){if("any"===e){a.find((e=>"any"in e))||a.push({any:"any",formatted:"any"});continue}const s=e.match(/^(?<width>\d+)[xX](?<height>\d+)$/);if(s){const e=parseInt(s.groups?.width||"",10),t=parseInt(s.groups?.height||"",10),i=`${e}×${t}px`;a.push({width:e,height:t,formatted:i})}else r.push(te(Z.sSShouldSpecifyItsSizeAs,{PH1:t,PH2:i}))}return a}checkSizeProblem(e,t,i,r,s){if("any"in e)return{hasSquareSize:i.naturalWidth===i.naturalHeight};const a=e.width===e.height;return i.naturalWidth!==e.width&&i.naturalHeight!==e.height?{error:te(Z.actualSizeSspxOfSSDoesNotMatch,{PH1:i.naturalWidth,PH2:i.naturalHeight,PH3:r,PH4:s,PH5:e.width,PH6:e.height}),hasSquareSize:a}:i.naturalWidth!==e.width?{error:te(Z.actualWidthSpxOfSSDoesNotMatch,{PH1:i.naturalWidth,PH2:r,PH3:s,PH4:e.width}),hasSquareSize:a}:i.naturalHeight!==e.height?{error:te(Z.actualHeightSpxOfSSDoesNotMatch,{PH1:i.naturalHeight,PH2:r,PH3:s,PH4:e.height}),hasSquareSize:a}:{hasSquareSize:a}}async appendImageResourceToSection(t,i,r,s){const a=[],n=te(s?Z.screenshot:Z.icon);if(!i.src)return a.push(te(Z.sSrcIsNotSet,{PH1:n})),{imageResourceErrors:a};const o=e.ParsedURL.ParsedURL.completeURL(t,i.src);if(!o)return a.push(te(Z.sUrlSFailedToParse,{PH1:n,PH2:i.src})),{imageResourceErrors:a};const d=await this.loadImage(o);if(!d)return a.push(te(Z.sSFailedToLoad,{PH1:n,PH2:o})),{imageResourceErrors:a};const{wrapper:c,image:l}=d,h=this.parseSizes(i.sizes,n,o,a),u=h.map((e=>e.formatted)).join(" ")+"\n"+(i.type||""),g=r.appendFlexedField(u);let p=!1;if(i.sizes){s&&h.length>0&&"any"in h[0]&&a.push(te(Z.screenshotPixelSize,{url:o}));for(const e of h){const{error:t,hasSquareSize:r}=this.checkSizeProblem(e,i.type,l,n,o);if(p=p||r,t)a.push(t);else if(s){const t="any"in e?l.naturalWidth:e.width,i="any"in e?l.naturalHeight:e.height;t<320||i<320?a.push(te(Z.sSSizeShouldBeAtLeast320,{PH1:n,PH2:o})):t>3840||i>3840?a.push(te(Z.sSSizeShouldBeAtMost3840,{PH1:n,PH2:o})):t>2.3*i?a.push(te(Z.sSWidthDoesNotComplyWithRatioRequirement,{PH1:n,PH2:o})):i>2.3*t&&a.push(te(Z.sSHeightDoesNotComplyWithRatioRequirement,{PH1:n,PH2:o}))}}}else a.push(te(Z.sSDoesNotSpecifyItsSizeInThe,{PH1:n,PH2:o}));const m="string"==typeof i.purpose?i.purpose.toLowerCase():"";return m.includes("any")&&m.includes("maskable")&&a.push(te(Z.avoidPurposeAnyAndMaskable)),g.appendChild(c),{imageResourceErrors:a,squareSizedIconAvailable:p}}wasShown(){super.wasShown(),this.reportView.registerCSSFiles([Y]),this.registerCSSFiles([Y])}}var re,se=Object.freeze({__proto__:null,AppManifestView:ie});class ae extends a.SDKModel.SDKModel{backgroundServiceAgent;events;constructor(e){super(e),this.backgroundServiceAgent=e.backgroundServiceAgent(),e.registerBackgroundServiceDispatcher(this),this.events=new Map}enable(e){this.events.set(e,[]),this.backgroundServiceAgent.invoke_startObserving({service:e})}setRecording(e,t){this.backgroundServiceAgent.invoke_setRecording({shouldRecord:e,service:t})}clearEvents(e){this.events.set(e,[]),this.backgroundServiceAgent.invoke_clearEvents({service:e})}getEvents(e){return this.events.get(e)||[]}recordingStateChanged({isRecording:e,service:t}){this.dispatchEventToListeners(re.RecordingStateChanged,{isRecording:e,serviceName:t})}backgroundServiceEventReceived({backgroundServiceEvent:e}){this.events.get(e.service).push(e),this.dispatchEventToListeners(re.BackgroundServiceEventReceived,e)}}a.SDKModel.SDKModel.register(ae,{capabilities:a.Target.Capability.Browser,autostart:!1}),function(e){e.RecordingStateChanged="RecordingStateChanged",e.BackgroundServiceEventReceived="BackgroundServiceEventReceived"}(re||(re={}));var ne=Object.freeze({__proto__:null,BackgroundServiceModel:ae,get Events(){return re}});const oe=new CSSStyleSheet;oe.replaceSync(".empty-bold-text{display:block;font-size:1.5em;margin:.83em 0;font-weight:700}.empty-view{color:var(--color-text-secondary);padding:30px;text-align:center;min-width:70px}.empty-view-scroller{justify-content:center;overflow:auto}.empty-view p{white-space:initial;line-height:18px;max-width:300px;flex-shrink:0}\n/*# sourceURL=emptyWidget.css */\n");const de=new CSSStyleSheet;de.replaceSync(".background-service-toolbar{background-color:var(--color-background-elevation-1);border-bottom:var(--legacy-divider-border)}.data-grid{flex:auto;border:none}.background-service-preview{position:absolute;background-color:var(--color-background);justify-content:center;align-items:center;overflow:auto;font-size:13px;color:var(--color-text-secondary)}.background-service-preview>div{max-width:450px;margin:10px;text-align:center}.background-service-preview>div>p{flex:none;white-space:pre-line}.background-service-shortcut{color:var(--color-text-secondary)}.background-service-metadata{padding-left:5px;padding-top:10px}.background-service-metadata-entry{padding-left:10px;padding-bottom:5px}.background-service-metadata-name{color:var(--color-text-secondary);display:inline-block;margin-right:.25em;font-weight:700}.background-service-metadata-value{display:inline;margin-right:1em;white-space:pre-wrap;word-break:break-all;user-select:text}.background-service-empty-value{color:var(--color-text-disabled);font-style:italic}.background-service-record-inline-button{margin-bottom:6px}\n/*# sourceURL=backgroundServiceView.css */\n");const ce={backgroundFetch:"Background Fetch",backgroundSync:"Background Sync",pushMessaging:"Push Messaging",notifications:"Notifications",paymentHandler:"Payment Handler",periodicBackgroundSync:"Periodic Background Sync",clear:"Clear",saveEvents:"Save events",showEventsFromOtherDomains:"Show events from other domains",stopRecordingEvents:"Stop recording events",startRecordingEvents:"Start recording events",timestamp:"Timestamp",event:"Event",origin:"Origin",swScope:"Service Worker Scope",instanceId:"Instance ID",backgroundServices:"Background Services",learnMore:"Learn more",selectAnEntryToViewMetadata:"Select an entry to view metadata",recordingSActivity:"Recording {PH1} activity...",devtoolsWillRecordAllSActivity:"DevTools will record all {PH1} activity for up to 3 days, even when closed.",clickTheRecordButtonSOrHitSTo:"Click the record button {PH1} or hit {PH2} to start recording.",empty:"empty",noMetadataForThisEvent:"No metadata for this event"},le=i.i18n.registerUIStrings("panels/application/BackgroundServiceView.ts",ce),he=i.i18n.getLocalizedString.bind(void 0,le);class ue extends o.Widget.VBox{serviceName;model;serviceWorkerManager;securityOriginManager;recordAction;recordButton;originCheckbox;saveButton;toolbar;splitWidget;dataGrid;previewPanel;selectedEventNode;preview;static getUIString(e){switch(e){case"backgroundFetch":return he(ce.backgroundFetch);case"backgroundSync":return he(ce.backgroundSync);case"pushMessaging":return he(ce.pushMessaging);case"notifications":return he(ce.notifications);case"paymentHandler":return he(ce.paymentHandler);case"periodicBackgroundSync":return he(ce.periodicBackgroundSync);default:return""}}constructor(e,t){if(super(!0),this.serviceName=e,this.model=t,this.model.addEventListener(re.RecordingStateChanged,this.onRecordingStateChanged,this),this.model.addEventListener(re.BackgroundServiceEventReceived,this.onEventReceived,this),this.model.enable(this.serviceName),this.serviceWorkerManager=this.model.target().model(a.ServiceWorkerManager.ServiceWorkerManager),this.securityOriginManager=this.model.target().model(a.SecurityOriginManager.SecurityOriginManager),!this.securityOriginManager)throw new Error("SecurityOriginManager instance is missing");this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.MainSecurityOriginChanged,(()=>this.onOriginChanged())),this.recordAction=o.ActionRegistry.ActionRegistry.instance().action("background-service.toggle-recording"),this.toolbar=new o.Toolbar.Toolbar("background-service-toolbar",this.contentElement),this.setupToolbar(),this.splitWidget=new o.SplitWidget.SplitWidget(!1,!0),this.splitWidget.show(this.contentElement),this.dataGrid=this.createDataGrid(),this.previewPanel=new o.Widget.VBox,this.selectedEventNode=null,this.preview=null,this.splitWidget.setMainWidget(this.dataGrid.asWidget()),this.splitWidget.setSidebarWidget(this.previewPanel),this.showPreview(null)}async setupToolbar(){this.recordButton=o.Toolbar.Toolbar.createActionButton(this.recordAction),this.toolbar.appendToolbarItem(this.recordButton);const e=new o.Toolbar.ToolbarButton(he(ce.clear),"largeicon-clear");e.addEventListener(o.Toolbar.ToolbarButton.Events.Click,(()=>this.clearEvents())),this.toolbar.appendToolbarItem(e),this.toolbar.appendSeparator(),this.saveButton=new o.Toolbar.ToolbarButton(he(ce.saveEvents),"largeicon-download"),this.saveButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,(e=>{this.saveToFile()})),this.saveButton.setEnabled(!1),this.toolbar.appendToolbarItem(this.saveButton),this.toolbar.appendSeparator(),this.originCheckbox=new o.Toolbar.ToolbarCheckbox(he(ce.showEventsFromOtherDomains),he(ce.showEventsFromOtherDomains),(()=>this.refreshView())),this.toolbar.appendToolbarItem(this.originCheckbox)}refreshView(){this.clearView();const e=this.model.getEvents(this.serviceName).filter((e=>this.acceptEvent(e)));for(const t of e)this.addEvent(t)}clearView(){this.selectedEventNode=null,this.dataGrid.rootNode().removeChildren(),this.saveButton.setEnabled(!1),this.showPreview(null)}toggleRecording(){this.model.setRecording(!this.recordButton.toggled(),this.serviceName)}clearEvents(){this.model.clearEvents(this.serviceName),this.clearView()}onRecordingStateChanged({data:e}){e.serviceName===this.serviceName&&e.isRecording!==this.recordButton.toggled()&&(this.recordButton.setToggled(e.isRecording),this.updateRecordButtonTooltip(),this.showPreview(this.selectedEventNode))}updateRecordButtonTooltip(){const e=this.recordButton.toggled()?he(ce.stopRecordingEvents):he(ce.startRecordingEvents);this.recordButton.setTitle(e,"background-service.toggle-recording")}onEventReceived({data:e}){this.acceptEvent(e)&&this.addEvent(e)}onOriginChanged(){this.originCheckbox.checked()||this.refreshView()}addEvent(e){const t=this.createEventData(e),i=new ge(t,e.eventMetadata);this.dataGrid.rootNode().appendChild(i),1===this.dataGrid.rootNode().children.length&&(this.saveButton.setEnabled(!0),this.showPreview(this.selectedEventNode))}createDataGrid(){const e=[{id:"id",title:"#",weight:1},{id:"timestamp",title:he(ce.timestamp),weight:8},{id:"eventName",title:he(ce.event),weight:10},{id:"origin",title:he(ce.origin),weight:10},{id:"swScope",title:he(ce.swScope),weight:5},{id:"instanceId",title:he(ce.instanceId),weight:10}],t=new u.DataGrid.DataGridImpl({displayName:he(ce.backgroundServices),columns:e,editCallback:void 0,refreshCallback:void 0,deleteCallback:void 0});return t.setStriped(!0),t.addEventListener(u.DataGrid.Events.SelectedNode,(e=>this.showPreview(e.data))),t}createEventData(e){let t="";const i=this.serviceWorkerManager?this.serviceWorkerManager.registrations().get(e.serviceWorkerRegistrationId):void 0;return i&&(t=i.scopeURL.substr(i.securityOrigin.length)),{id:this.dataGrid.rootNode().children.length+1,timestamp:o.UIUtils.formatTimestamp(1e3*e.timestamp,!0),origin:e.origin,swScope:t,eventName:e.eventName,instanceId:e.instanceId}}acceptEvent(e){if(e.service!==this.serviceName)return!1;if(this.originCheckbox.checked())return!0;const t=e.origin.substr(0,e.origin.length-1);return this.securityOriginManager.securityOrigins().includes(t)}createLearnMoreLink(){let e="https://developer.chrome.com/docs/devtools/javascript/background-services/?utm_source=devtools";switch(this.serviceName){case"backgroundFetch":e+="#fetch";break;case"backgroundSync":e+="#sync";break;case"pushMessaging":e+="#push";break;case"notifications":e+="#notifications"}return o.XLink.XLink.create(e,he(ce.learnMore))}showPreview(e){if(this.selectedEventNode&&this.selectedEventNode===e)return;if(this.selectedEventNode=e,this.preview&&this.preview.detach(),this.selectedEventNode)return this.preview=this.selectedEventNode.createPreview(),void this.preview.show(this.previewPanel.contentElement);this.preview=new o.Widget.VBox,this.preview.contentElement.classList.add("background-service-preview","fill");const t=this.preview.contentElement.createChild("div");if(this.dataGrid.rootNode().children.length)t.createChild("p").textContent=he(ce.selectAnEntryToViewMetadata);else if(this.recordButton.toggled()){const e=ue.getUIString(this.serviceName);t.createChild("p").textContent=he(ce.recordingSActivity,{PH1:e}),t.createChild("p").textContent=he(ce.devtoolsWillRecordAllSActivity,{PH1:e})}else{const e=o.Toolbar.Toolbar.createActionButton(this.recordAction),r=document.createElement("b");r.classList.add("background-service-shortcut"),r.textContent=o.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction("background-service.toggle-recording")[0].title();const s=o.UIUtils.createInlineButton(e);s.classList.add("background-service-record-inline-button"),t.createChild("p").appendChild(i.i18n.getFormatLocalizedString(le,ce.clickTheRecordButtonSOrHitSTo,{PH1:s,PH2:r})),t.appendChild(this.createLearnMoreLink())}this.preview.show(this.previewPanel.contentElement)}async saveToFile(){const e=`${this.serviceName}-${r.DateUtilities.toISO8601Compact(new Date)}.json`,t=new w.FileUtils.FileOutputStream;if(!await t.open(e))return;const i=this.model.getEvents(this.serviceName).filter((e=>this.acceptEvent(e)));await t.write(JSON.stringify(i,void 0,2)),t.close()}wasShown(){super.wasShown(),this.registerCSSFiles([oe,de])}}class ge extends u.DataGrid.DataGridNode{eventMetadata;constructor(e,t){super(e),this.eventMetadata=t.sort(((e,t)=>r.StringUtilities.compare(e.key,t.key)))}createPreview(){const e=new o.Widget.VBox;e.element.classList.add("background-service-metadata");for(const t of this.eventMetadata){const i=document.createElement("div");i.classList.add("background-service-metadata-entry"),i.createChild("div","background-service-metadata-name").textContent=t.key+": ",t.value?i.createChild("div","background-service-metadata-value source-code").textContent=t.value:i.createChild("div","background-service-metadata-value background-service-empty-value").textContent=he(ce.empty),e.element.appendChild(i)}if(!e.element.children.length){const t=document.createElement("div");t.classList.add("background-service-metadata-entry"),t.createChild("div","background-service-metadata-name background-service-empty-value").textContent=he(ce.noMetadataForThisEvent),e.element.appendChild(t)}return e}}let pe;class me{static instance(e={forceNew:null}){const{forceNew:t}=e;return pe&&!t||(pe=new me),pe}handleAction(e,t){const i=e.flavor(ue);if("background-service.toggle-recording"===t){if(!i)throw new Error("BackgroundServiceView instance is missing");return i.toggleRecording(),!0}return!1}}var we=Object.freeze({__proto__:null,BackgroundServiceView:ue,EventDataNode:ge,ActionDelegate:me});const be=new CSSStyleSheet;be.replaceSync(".tree-outline{padding-left:0;color:var(--color-text-primary)}.tree-outline>ol{padding-bottom:10px}.tree-outline li{min-height:20px}li.storage-group-list-item{padding:10px 8px 6px}li.storage-group-list-item:not(:first-child){border-top:1px solid var(--color-details-hairline)}li.storage-group-list-item::before{display:none}.icons-container .red-icon{background-color:var(--color-accent-red)}.navigator-file-tree-item{background:linear-gradient(45deg,hsl(0deg 0% 50%),hsl(0deg 0% 70%))}.navigator-folder-tree-item{background:linear-gradient(45deg,hsl(210deg 82% 65%),hsl(210deg 82% 80%))}.navigator-script-tree-item{background:linear-gradient(45deg,hsl(48deg 70% 50%),hsl(48deg 70% 70%))}.navigator-stylesheet-tree-item{background:linear-gradient(45deg,hsl(256deg 50% 50%),hsl(256deg 50% 70%))}.navigator-font-tree-item,.navigator-image-tree-item{background:linear-gradient(45deg,hsl(109deg 33% 50%),hsl(109deg 33% 70%))}.window-closed .tree-element-title{text-decoration:line-through}\n/*# sourceURL=resourcesSidebar.css */\n");const ve={databaseNoLongerHasExpected:"Database no longer has expected version.",anUnexpectedErrorSOccurred:"An unexpected error {PH1} occurred."},Se=i.i18n.registerUIStrings("panels/application/DatabaseModel.ts",ve),ke=i.i18n.getLocalizedString.bind(void 0,Se);class fe{model;idInternal;domainInternal;nameInternal;versionInternal;constructor(e,t,i,r,s){this.model=e,this.idInternal=t,this.domainInternal=i,this.nameInternal=r,this.versionInternal=s}get id(){return this.idInternal}get name(){return this.nameInternal}set name(e){this.nameInternal=e}get version(){return this.versionInternal}set version(e){this.versionInternal=e}get domain(){return this.domainInternal}set domain(e){this.domainInternal=e}async tableNames(){const{tableNames:e}=await this.model.agent.invoke_getDatabaseTableNames({databaseId:this.idInternal})||[];return e.sort()}async executeSql(e,t,i){const r=await this.model.agent.invoke_executeSQL({databaseId:this.idInternal,query:e}),s=r.getError()||null;if(s)return void i(s);const a=r.sqlError;if(!a)return void t(r.columnNames||[],r.values||[]);let n;n=a.message?a.message:2===a.code?ke(ve.databaseNoLongerHasExpected):ke(ve.anUnexpectedErrorSOccurred,{PH1:a.code}),i(n)}}class ye extends a.SDKModel.SDKModel{databasesInternal;agent;enabled;constructor(e){super(e),this.databasesInternal=[],this.agent=e.databaseAgent(),this.target().registerDatabaseDispatcher(new Te(this))}enable(){this.enabled||(this.agent.invoke_enable(),this.enabled=!0)}disable(){this.enabled&&(this.enabled=!1,this.databasesInternal=[],this.agent.invoke_disable(),this.dispatchEventToListeners(Ce.DatabasesRemoved))}databases(){const e=[];for(const t of this.databasesInternal)e.push(t);return e}addDatabase(e){this.databasesInternal.push(e),this.dispatchEventToListeners(Ce.DatabaseAdded,e)}}var Ce;a.SDKModel.SDKModel.register(ye,{capabilities:a.Target.Capability.DOM,autostart:!1}),function(e){e.DatabaseAdded="DatabaseAdded",e.DatabasesRemoved="DatabasesRemoved"}(Ce||(Ce={}));class Te{model;constructor(e){this.model=e}addDatabase({database:e}){this.model.addDatabase(new fe(this.model,e.id,e.domain,e.name,e.version))}}var Ie=Object.freeze({__proto__:null,Database:fe,DatabaseModel:ye,get Events(){return Ce},DatabaseDispatcher:Te});const Ee={databaseQuery:"Database Query",queryS:"Query: {PH1}"},xe=i.i18n.registerUIStrings("panels/application/DatabaseQueryView.ts",Ee),Re=i.i18n.getLocalizedString.bind(void 0,xe);class Me extends(e.ObjectWrapper.eventMixin(o.Widget.VBox)){database;queryWrapper;promptContainer;promptElement;prompt;proxyElement;queryResults;virtualSelectedIndex;lastSelectedElement;selectionTimeout;constructor(e){super(),this.database=e,this.element.classList.add("storage-view","query","monospace"),this.element.addEventListener("selectstart",this.selectStart.bind(this),!1),this.queryWrapper=this.element.createChild("div","database-query-group-messages"),this.queryWrapper.addEventListener("focusin",this.onFocusIn.bind(this)),this.queryWrapper.addEventListener("focusout",this.onFocusOut.bind(this)),this.queryWrapper.addEventListener("keydown",this.onKeyDown.bind(this)),this.queryWrapper.tabIndex=-1,this.promptContainer=this.element.createChild("div","database-query-prompt-container"),this.promptContainer.appendChild(o.Icon.Icon.create("smallicon-text-prompt","prompt-icon")),this.promptElement=this.promptContainer.createChild("div"),this.promptElement.className="database-query-prompt",this.promptElement.addEventListener("keydown",this.promptKeyDown.bind(this)),this.prompt=new o.TextPrompt.TextPrompt,this.prompt.initialize(this.completions.bind(this)," "),this.proxyElement=this.prompt.attach(this.promptElement),this.element.addEventListener("click",this.messagesClicked.bind(this),!0),this.queryResults=[],this.virtualSelectedIndex=-1,this.selectionTimeout=0}messagesClicked(){this.prompt.focus(),this.prompt.isCaretInsidePrompt()||this.element.hasSelection()||this.prompt.moveCaretToEndOfPrompt()}onKeyDown(e){if(!o.UIUtils.isEditing()&&this.queryResults.length&&!e.shiftKey){switch(e.key){case"ArrowUp":if(!(this.virtualSelectedIndex>0))return;this.virtualSelectedIndex--;break;case"ArrowDown":if(!(this.virtualSelectedIndex<this.queryResults.length-1))return;this.virtualSelectedIndex++;break;case"Home":this.virtualSelectedIndex=0;break;case"End":this.virtualSelectedIndex=this.queryResults.length-1;break;default:return}e.consume(!0),this.updateFocusedItem()}}onFocusIn(e){-1===this.virtualSelectedIndex&&this.isOutsideViewport(e.relatedTarget)&&e.target===this.queryWrapper&&this.queryResults.length&&(this.virtualSelectedIndex=this.queryResults.length-1),this.updateFocusedItem()}onFocusOut(e){this.isOutsideViewport(e.relatedTarget)&&(this.virtualSelectedIndex=-1),this.updateFocusedItem(),this.queryWrapper.scrollTop=1e7}isOutsideViewport(e){return null!==e&&!e.isSelfOrDescendant(this.queryWrapper)}updateFocusedItem(){let e=this.virtualSelectedIndex;this.queryResults.length&&this.virtualSelectedIndex<0&&(e=this.queryResults.length-1);const t=e>=0?this.queryResults[e]:null,i=this.lastSelectedElement!==t,r=this.queryWrapper===this.element.ownerDocument.deepActiveElement();t&&(i||r)&&this.element.hasFocus()&&(t.hasFocus()||t.focus()),this.queryResults.length&&!this.queryWrapper.hasFocus()?this.queryWrapper.tabIndex=0:this.queryWrapper.tabIndex=-1,this.lastSelectedElement=t}async completions(e,t,i){if(!t)return[];t=t.toLowerCase();return(await this.database.tableNames()).map((e=>e+" ")).concat(Le).filter((e=>e.toLowerCase().startsWith(t))).map((e=>({text:e})))}selectStart(e){this.selectionTimeout&&clearTimeout(this.selectionTimeout),this.prompt.clearAutocomplete(),this.selectionTimeout=window.setTimeout(function(){this.selectionTimeout=0,this.prompt.isCaretInsidePrompt()||this.element.hasSelection()||this.prompt.moveCaretToEndOfPrompt(),this.prompt.autoCompleteSoon()}.bind(this),100)}promptKeyDown(e){"Enter"!==e.key||this.enterKeyPressed(e)}async enterKeyPressed(e){e.consume(!0);const t=this.prompt.textWithCurrentSuggestion();if(this.prompt.clearAutocomplete(),t.length){this.prompt.setEnabled(!1);try{const e=await new Promise(((e,i)=>{this.database.executeSql(t,((t,i)=>e({columnNames:t,values:i})),(e=>i(e)))}));this.queryFinished(t,e.columnNames,e.values)}catch(e){this.appendErrorQueryResult(t,e)}this.prompt.setEnabled(!0),this.prompt.setText(""),this.prompt.focus()}}queryFinished(e,t,i){const r=u.SortableDataGrid.SortableDataGrid.create(t,i,Re(Ee.databaseQuery)),s=e.trim();let a=null;r&&(r.setStriped(!0),r.renderInline(),r.autoSizeColumns(5),a=r.asWidget(),r.setFocusable(!1)),this.appendViewQueryResult(s,a),(s.match(/^create /i)||s.match(/^drop table /i))&&this.dispatchEventToListeners(Pe.SchemaUpdated,this.database)}appendViewQueryResult(e,t){const i=this.appendQueryResult(e);t?t.show(i):i.remove(),this.scrollResultIntoView()}appendErrorQueryResult(e,t){const i=this.appendQueryResult(e);i.classList.add("error"),i.appendChild(o.Icon.Icon.create("smallicon-error","prompt-icon")),o.UIUtils.createTextChild(i,t),this.scrollResultIntoView()}scrollResultIntoView(){this.queryResults[this.queryResults.length-1].scrollIntoView(!1),this.promptElement.scrollIntoView(!1)}appendQueryResult(e){const t=document.createElement("div");t.className="database-user-query",t.tabIndex=-1,o.ARIAUtils.setAccessibleName(t,Re(Ee.queryS,{PH1:e})),this.queryResults.push(t),this.updateFocusedItem(),t.appendChild(o.Icon.Icon.create("smallicon-user-command","prompt-icon"));const i=document.createElement("span");i.className="database-query-text",i.textContent=e,t.appendChild(i);const r=document.createElement("div");return r.className="database-query-result",t.appendChild(r),this.queryWrapper.appendChild(t),r}}var Pe;(Pe||(Pe={})).SchemaUpdated="SchemaUpdated";const Le=["SELECT ","FROM ","WHERE ","LIMIT ","DELETE FROM ","CREATE ","DROP ","TABLE ","INDEX ","UPDATE ","INSERT INTO ","VALUES ("];var De=Object.freeze({__proto__:null,DatabaseQueryView:Me,get Events(){return Pe},SQL_BUILT_INS:Le});const Fe={database:"Database",refresh:"Refresh",visibleColumns:"Visible columns",theStableIsEmpty:'The "{PH1}" table is empty.',anErrorOccurredTryingToreadTheS:'An error occurred trying to read the "{PH1}" table.'},Oe=i.i18n.registerUIStrings("panels/application/DatabaseTableView.ts",Fe),Be=i.i18n.getLocalizedString.bind(void 0,Oe);class Ne extends o.View.SimpleView{database;tableName;lastVisibleColumns;columnsMap;visibleColumnsSetting;refreshButton;visibleColumnsInput;dataGrid;emptyWidget;constructor(t,i){super(Be(Fe.database)),this.database=t,this.tableName=i,this.lastVisibleColumns="",this.columnsMap=new Map,this.element.classList.add("storage-view","table"),this.visibleColumnsSetting=e.Settings.Settings.instance().createSetting("databaseTableViewVisibleColumns",{}),this.refreshButton=new o.Toolbar.ToolbarButton(Be(Fe.refresh),"largeicon-refresh"),this.refreshButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.refreshButtonClicked,this),this.visibleColumnsInput=new o.Toolbar.ToolbarInput(Be(Fe.visibleColumns),"",1),this.visibleColumnsInput.addEventListener(o.Toolbar.ToolbarInput.Event.TextChanged,this.onVisibleColumnsChanged,this),this.dataGrid=null}wasShown(){this.update()}async toolbarItems(){return[this.refreshButton,this.visibleColumnsInput]}escapeTableName(e){return e.replace(/\"/g,'""')}update(){this.database.executeSql('SELECT rowid, * FROM "'+this.escapeTableName(this.tableName)+'"',this.queryFinished.bind(this),this.queryError.bind(this))}queryFinished(e,t){if(this.detachChildWidgets(),this.element.removeChildren(),this.dataGrid=u.SortableDataGrid.SortableDataGrid.create(e,t,Be(Fe.database)),this.visibleColumnsInput.setVisible(Boolean(this.dataGrid)),!this.dataGrid)return this.emptyWidget=new o.EmptyWidget.EmptyWidget(Be(Fe.theStableIsEmpty,{PH1:this.tableName})),void this.emptyWidget.show(this.element);this.dataGrid.setStriped(!0),this.dataGrid.asWidget().show(this.element),this.dataGrid.autoSizeColumns(5),this.columnsMap.clear();for(let t=1;t<e.length;++t)this.columnsMap.set(e[t],String(t));this.lastVisibleColumns="";const i=this.visibleColumnsSetting.get()[this.tableName]||"";this.visibleColumnsInput.setValue(i),this.onVisibleColumnsChanged()}onVisibleColumnsChanged(){if(!this.dataGrid)return;const e=this.visibleColumnsInput.value(),t=e.split(/[\s,]+/),i=new Set,r=new Set;r.add("0");for(const e of t){const t=this.columnsMap.get(e);void 0!==t&&(i.add(e),r.add(t))}const s=[...i].sort().join(", ");if(0===s.length)for(const e of this.columnsMap.values())r.add(e);if(s===this.lastVisibleColumns)return;const a=this.visibleColumnsSetting.get();a[this.tableName]=e,this.visibleColumnsSetting.set(a),this.dataGrid.setColumnsVisiblity(r),this.lastVisibleColumns=s}queryError(){this.detachChildWidgets(),this.element.removeChildren();const e=document.createElement("div");e.className="storage-table-error",e.textContent=Be(Fe.anErrorOccurredTryingToreadTheS,{PH1:this.tableName}),this.element.appendChild(e)}refreshButtonClicked(){this.update()}}var We,Ve=Object.freeze({__proto__:null,DatabaseTableView:Ne});class Ae extends e.ObjectWrapper.ObjectWrapper{model;securityOriginInternal;isLocalStorageInternal;constructor(e,t,i){super(),this.model=e,this.securityOriginInternal=t,this.isLocalStorageInternal=i}static storageId(e,t){return{securityOrigin:e,isLocalStorage:t}}get id(){return Ae.storageId(this.securityOriginInternal,this.isLocalStorageInternal)}get securityOrigin(){return this.securityOriginInternal}get isLocalStorage(){return this.isLocalStorageInternal}getItems(){return this.model.agent.invoke_getDOMStorageItems({storageId:this.id}).then((({entries:e})=>e))}setItem(e,t){this.model.agent.invoke_setDOMStorageItem({storageId:this.id,key:e,value:t})}removeItem(e){this.model.agent.invoke_removeDOMStorageItem({storageId:this.id,key:e})}clear(){this.model.agent.invoke_clear({storageId:this.id})}}!function(e){let t;!function(e){e.DOMStorageItemsCleared="DOMStorageItemsCleared",e.DOMStorageItemRemoved="DOMStorageItemRemoved",e.DOMStorageItemAdded="DOMStorageItemAdded",e.DOMStorageItemUpdated="DOMStorageItemUpdated"}(t=e.Events||(e.Events={}))}(Ae||(Ae={}));class Ue extends a.SDKModel.SDKModel{securityOriginManager;storagesInternal;agent;enabled;constructor(e){super(e),this.securityOriginManager=e.model(a.SecurityOriginManager.SecurityOriginManager),this.storagesInternal={},this.agent=e.domstorageAgent()}enable(){if(!this.enabled){if(this.target().registerDOMStorageDispatcher(new He(this)),this.securityOriginManager){this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginAdded,this.securityOriginAdded,this),this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginRemoved,this.securityOriginRemoved,this);for(const e of this.securityOriginManager.securityOrigins())this.addOrigin(e)}this.agent.invoke_enable(),this.enabled=!0}}clearForOrigin(e){if(this.enabled){for(const t of[!0,!1]){const i=this.storageKey(e,t),r=this.storagesInternal[i];if(!r)return;r.clear()}this.removeOrigin(e),this.addOrigin(e)}}securityOriginAdded(e){this.addOrigin(e.data)}addOrigin(t){const i=new e.ParsedURL.ParsedURL(t);if(i.isValid&&"data"!==i.scheme&&"about"!==i.scheme&&"javascript"!==i.scheme)for(const e of[!0,!1]){const i=this.storageKey(t,e);console.assert(!this.storagesInternal[i]);const r=new Ae(this,t,e);this.storagesInternal[i]=r,this.dispatchEventToListeners(We.DOMStorageAdded,r)}}securityOriginRemoved(e){this.removeOrigin(e.data)}removeOrigin(e){for(const t of[!0,!1]){const i=this.storageKey(e,t),r=this.storagesInternal[i];r&&(delete this.storagesInternal[i],this.dispatchEventToListeners(We.DOMStorageRemoved,r))}}storageKey(e,t){return JSON.stringify(Ae.storageId(e,t))}domStorageItemsCleared(e){const t=this.storageForId(e);t&&t.dispatchEventToListeners(Ae.Events.DOMStorageItemsCleared)}domStorageItemRemoved(e,t){const i=this.storageForId(e);if(!i)return;const r={key:t};i.dispatchEventToListeners(Ae.Events.DOMStorageItemRemoved,r)}domStorageItemAdded(e,t,i){const r=this.storageForId(e);if(!r)return;const s={key:t,value:i};r.dispatchEventToListeners(Ae.Events.DOMStorageItemAdded,s)}domStorageItemUpdated(e,t,i,r){const s=this.storageForId(e);if(!s)return;const a={key:t,oldValue:i,value:r};s.dispatchEventToListeners(Ae.Events.DOMStorageItemUpdated,a)}storageForId(e){return this.storagesInternal[JSON.stringify(e)]}storages(){const e=[];for(const t in this.storagesInternal)e.push(this.storagesInternal[t]);return e}}a.SDKModel.SDKModel.register(Ue,{capabilities:a.Target.Capability.DOM,autostart:!1}),function(e){e.DOMStorageAdded="DOMStorageAdded",e.DOMStorageRemoved="DOMStorageRemoved"}(We||(We={}));class He{model;constructor(e){this.model=e}domStorageItemsCleared({storageId:e}){this.model.domStorageItemsCleared(e)}domStorageItemRemoved({storageId:e,key:t}){this.model.domStorageItemRemoved(e,t)}domStorageItemAdded({storageId:e,key:t,newValue:i}){this.model.domStorageItemAdded(e,t,i)}domStorageItemUpdated({storageId:e,key:t,oldValue:i,newValue:r}){this.model.domStorageItemUpdated(e,t,i,r)}}var qe,_e=Object.freeze({__proto__:null,get DOMStorage(){return Ae},DOMStorageModel:Ue,get Events(){return We},DOMStorageDispatcher:He});class je extends a.SDKModel.SDKModel{securityOriginManager;indexedDBAgent;storageAgent;databasesInternal;databaseNamesBySecurityOrigin;originsUpdated;throttler;enabled;constructor(t){super(t),t.registerStorageDispatcher(this),this.securityOriginManager=t.model(a.SecurityOriginManager.SecurityOriginManager),this.indexedDBAgent=t.indexedDBAgent(),this.storageAgent=t.storageAgent(),this.databasesInternal=new Map,this.databaseNamesBySecurityOrigin={},this.originsUpdated=new Set,this.throttler=new e.Throttler.Throttler(1e3)}static keyFromIDBKey(e){if(null==e)return;let t;switch(typeof e){case"number":t={type:"number",number:e};break;case"string":t={type:"string",string:e};break;case"object":if(e instanceof Date)t={type:"date",date:e.getTime()};else{if(!Array.isArray(e))return;{const i=[];for(let t=0;t<e.length;++t){const r=je.keyFromIDBKey(e[t]);r&&i.push(r)}t={type:"array",array:i}}}break;default:return}return t}static keyRangeFromIDBKeyRange(e){return{lower:je.keyFromIDBKey(e.lower),upper:je.keyFromIDBKey(e.upper),lowerOpen:Boolean(e.lowerOpen),upperOpen:Boolean(e.upperOpen)}}static idbKeyPathFromKeyPath(e){let t;switch(e.type){case"null":t=null;break;case"string":t=e.string;break;case"array":t=e.array}return t}static keyPathStringFromIDBKeyPath(e){return"string"==typeof e?'"'+e+'"':e instanceof Array?'["'+e.join('", "')+'"]':null}enable(){if(!this.enabled){if(this.indexedDBAgent.invoke_enable(),this.securityOriginManager){this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginAdded,this.securityOriginAdded,this),this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginRemoved,this.securityOriginRemoved,this);for(const e of this.securityOriginManager.securityOrigins())this.addOrigin(e)}this.enabled=!0}}clearForOrigin(e){this.enabled&&this.databaseNamesBySecurityOrigin[e]&&(this.removeOrigin(e),this.addOrigin(e))}async deleteDatabase(e){this.enabled&&(await this.indexedDBAgent.invoke_deleteDatabase({securityOrigin:e.securityOrigin,databaseName:e.name}),this.loadDatabaseNames(e.securityOrigin))}async refreshDatabaseNames(){for(const e in this.databaseNamesBySecurityOrigin)await this.loadDatabaseNames(e);this.dispatchEventToListeners(qe.DatabaseNamesRefreshed)}refreshDatabase(e){this.loadDatabase(e,!0)}async clearObjectStore(e,t){await this.indexedDBAgent.invoke_clearObjectStore({securityOrigin:e.securityOrigin,databaseName:e.name,objectStoreName:t})}async deleteEntries(e,t,i){const r=je.keyRangeFromIDBKeyRange(i);await this.indexedDBAgent.invoke_deleteObjectStoreEntries({securityOrigin:e.securityOrigin,databaseName:e.name,objectStoreName:t,keyRange:r})}securityOriginAdded(e){this.addOrigin(e.data)}securityOriginRemoved(e){this.removeOrigin(e.data)}addOrigin(e){console.assert(!this.databaseNamesBySecurityOrigin[e]),this.databaseNamesBySecurityOrigin[e]=[],this.loadDatabaseNames(e),this.isValidSecurityOrigin(e)&&this.storageAgent.invoke_trackIndexedDBForOrigin({origin:e})}removeOrigin(e){console.assert(Boolean(this.databaseNamesBySecurityOrigin[e]));for(let t=0;t<this.databaseNamesBySecurityOrigin[e].length;++t)this.databaseRemoved(e,this.databaseNamesBySecurityOrigin[e][t]);delete this.databaseNamesBySecurityOrigin[e],this.isValidSecurityOrigin(e)&&this.storageAgent.invoke_untrackIndexedDBForOrigin({origin:e})}isValidSecurityOrigin(t){const i=e.ParsedURL.ParsedURL.fromString(t);return null!==i&&i.scheme.startsWith("http")}updateOriginDatabaseNames(e,t){const i=new Set(t),r=new Set(this.databaseNamesBySecurityOrigin[e]);this.databaseNamesBySecurityOrigin[e]=t;for(const t of r)i.has(t)||this.databaseRemoved(e,t);for(const t of i)r.has(t)||this.databaseAdded(e,t)}databases(){const e=[];for(const t in this.databaseNamesBySecurityOrigin){const i=this.databaseNamesBySecurityOrigin[t];for(let r=0;r<i.length;++r)e.push(new Ge(t,i[r]))}return e}databaseAdded(e,t){const i=new Ge(e,t);this.dispatchEventToListeners(qe.DatabaseAdded,{model:this,databaseId:i})}databaseRemoved(e,t){const i=new Ge(e,t);this.dispatchEventToListeners(qe.DatabaseRemoved,{model:this,databaseId:i})}async loadDatabaseNames(e){const{databaseNames:t}=await this.indexedDBAgent.invoke_requestDatabaseNames({securityOrigin:e});return t&&this.databaseNamesBySecurityOrigin[e]?(this.updateOriginDatabaseNames(e,t),t):[]}async loadDatabase(e,t){const{databaseWithObjectStores:i}=await this.indexedDBAgent.invoke_requestDatabase({securityOrigin:e.securityOrigin,databaseName:e.name});if(!i)return;if(!this.databaseNamesBySecurityOrigin[e.securityOrigin])return;const r=new Ke(e,i.version);this.databasesInternal.set(e,r);for(const e of i.objectStores){const t=je.idbKeyPathFromKeyPath(e.keyPath),i=new $e(e.name,t,e.autoIncrement);for(let t=0;t<e.indexes.length;++t){const r=e.indexes[t],s=je.idbKeyPathFromKeyPath(r.keyPath),a=new Qe(r.name,s,r.unique,r.multiEntry);i.indexes.set(a.name,a)}r.objectStores.set(i.name,i)}this.dispatchEventToListeners(qe.DatabaseLoaded,{model:this,database:r,entriesUpdated:t})}loadObjectStoreData(e,t,i,r,s,a){this.requestData(e,e.name,t,"",i,r,s,a)}loadIndexData(e,t,i,r,s,a,n){this.requestData(e,e.name,t,i,r,s,a,n)}async requestData(e,t,i,r,s,n,o,d){const c=s?je.keyRangeFromIDBKeyRange(s):void 0,l=await this.indexedDBAgent.invoke_requestData({securityOrigin:e.securityOrigin,databaseName:t,objectStoreName:i,indexName:r,skipCount:n,pageSize:o,keyRange:c});if(l.getError())return void console.error("IndexedDBAgent error: "+l.getError());const h=this.target().model(a.RuntimeModel.RuntimeModel);if(!h||!this.databaseNamesBySecurityOrigin[e.securityOrigin])return;const u=l.objectStoreDataEntries,g=[];for(const e of u){const t=h.createRemoteObject(e.key),i=h.createRemoteObject(e.primaryKey),r=h.createRemoteObject(e.value);g.push(new ze(t,i,r))}d(g,l.hasMore)}async getMetadata(e,t){const i=e.securityOrigin,r=e.name,s=t.name,a=await this.indexedDBAgent.invoke_getMetadata({securityOrigin:i,databaseName:r,objectStoreName:s});return a.getError()?(console.error("IndexedDBAgent error: "+a.getError()),null):{entriesCount:a.entriesCount,keyGeneratorValue:a.keyGeneratorValue}}async refreshDatabaseList(e){const t=await this.loadDatabaseNames(e);for(const i of t)this.loadDatabase(new Ge(e,i),!1)}indexedDBListUpdated({origin:e}){this.originsUpdated.add(e),this.throttler.schedule((()=>{const e=Array.from(this.originsUpdated,(e=>{this.refreshDatabaseList(e)}));return this.originsUpdated.clear(),Promise.all(e)}))}indexedDBContentUpdated({origin:e,databaseName:t,objectStoreName:i}){const r=new Ge(e,t);this.dispatchEventToListeners(qe.IndexedDBContentUpdated,{databaseId:r,objectStoreName:i,model:this})}cacheStorageListUpdated(e){}cacheStorageContentUpdated(e){}}a.SDKModel.SDKModel.register(je,{capabilities:a.Target.Capability.Storage,autostart:!1}),function(e){e.DatabaseAdded="DatabaseAdded",e.DatabaseRemoved="DatabaseRemoved",e.DatabaseLoaded="DatabaseLoaded",e.DatabaseNamesRefreshed="DatabaseNamesRefreshed",e.IndexedDBContentUpdated="IndexedDBContentUpdated"}(qe||(qe={}));class ze{key;primaryKey;value;constructor(e,t,i){this.key=e,this.primaryKey=t,this.value=i}}class Ge{securityOrigin;name;constructor(e,t){this.securityOrigin=e,this.name=t}equals(e){return this.name===e.name&&this.securityOrigin===e.securityOrigin}}class Ke{databaseId;version;objectStores;constructor(e,t){this.databaseId=e,this.version=t,this.objectStores=new Map}}class $e{name;keyPath;autoIncrement;indexes;constructor(e,t,i){this.name=e,this.keyPath=t,this.autoIncrement=i,this.indexes=new Map}get keyPathString(){return je.keyPathStringFromIDBKeyPath(this.keyPath)}}class Qe{name;keyPath;unique;multiEntry;constructor(e,t,i,r){this.name=e,this.keyPath=t,this.unique=i,this.multiEntry=r}get keyPathString(){return je.keyPathStringFromIDBKeyPath(this.keyPath)}}var Xe=Object.freeze({__proto__:null,IndexedDBModel:je,get Events(){return qe},Entry:ze,DatabaseId:Ge,Database:Ke,ObjectStore:$e,Index:Qe});const Je=new CSSStyleSheet;Je.replaceSync(".indexed-db-data-view .data-view-toolbar{position:relative;background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-details-hairline)}.indexed-db-data-view .data-grid{flex:auto}.indexed-db-data-view .data-grid .data-container tr:nth-last-child(1){background-color:var(--color-background)}.indexed-db-data-view .data-grid .data-container tr:nth-last-child(1) td{border:0}.indexed-db-data-view .data-grid .data-container tr:nth-last-child(2) td{border-bottom:1px solid var(--color-details-hairline)}.indexed-db-data-view .data-grid:focus .data-container tr.selected{background-color:var(--color-background-highlight);color:inherit}.indexed-db-data-view .section,.indexed-db-data-view .section>.header,.indexed-db-data-view .section>.header .title{margin:0;min-height:inherit;line-height:inherit}.indexed-db-data-view .data-grid .data-container td .section .header .title{white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.indexed-db-key-path{color:var(--color-accent-red);white-space:pre-wrap;unicode-bidi:-webkit-isolate}.indexed-db-container{overflow:auto}.indexed-db-header{min-width:400px;flex-shrink:0;flex-grow:0}.source-code.indexed-db-key-path{font-size:unset!important}.resources-toolbar{padding-right:10px}.object-store-summary-bar{flex:0 0 27px;line-height:27px;padding-left:5px;background-color:var(--color-background-elevation-1);border-top:1px solid var(--color-details-hairline);white-space:nowrap;text-overflow:ellipsis;overflow:hidden}\n/*# sourceURL=indexedDBViews.css */\n");const Ye={loading:"Loading…",securityOrigin:"Security origin",version:"Version",objectStores:"Object stores",deleteDatabase:"Delete database",refreshDatabase:"Refresh database",pleaseConfirmDeleteOfSDatabase:'Please confirm delete of "{PH1}" database.',idb:"IDB",refresh:"Refresh",deleteSelected:"Delete selected",clearObjectStore:"Clear object store",dataMayBeStale:"Data may be stale",someEntriesMayHaveBeenModified:"Some entries may have been modified",keyString:"Key",primaryKey:"Primary key",valueString:"Value",indexedDb:"Indexed DB",keyPath:"Key path: ",showPreviousPage:"Show previous page",showNextPage:"Show next page",startFromKey:"Start from key",expandRecursively:"Expand Recursively",collapse:"Collapse",totalEntriesS:"Total entries: {PH1}",keyGeneratorValueS:"Key generator value: {PH1}"},Ze=i.i18n.registerUIStrings("panels/application/IndexedDBViews.ts",Ye),et=i.i18n.getLocalizedString.bind(void 0,Ze);class tt extends o.Widget.VBox{model;database;reportView;securityOriginElement;versionElement;objectStoreCountElement;clearButton;refreshButton;constructor(e,t){super(),this.model=e;const i=t?t.databaseId.name:et(Ye.loading);this.contentElement.classList.add("indexed-db-container"),this.reportView=new o.ReportView.ReportView(i),this.reportView.show(this.contentElement),this.reportView.element.classList.add("indexed-db-header");const r=this.reportView.appendSection("");this.securityOriginElement=r.appendField(et(Ye.securityOrigin)),this.versionElement=r.appendField(et(Ye.version)),this.objectStoreCountElement=r.appendField(et(Ye.objectStores));const s=this.reportView.appendSection("").appendRow();this.clearButton=o.UIUtils.createTextButton(et(Ye.deleteDatabase),(()=>this.deleteDatabase()),et(Ye.deleteDatabase)),s.appendChild(this.clearButton),this.refreshButton=o.UIUtils.createTextButton(et(Ye.refreshDatabase),(()=>this.refreshDatabaseButtonClicked()),et(Ye.refreshDatabase)),s.appendChild(this.refreshButton),t&&this.update(t)}refreshDatabase(){this.securityOriginElement.textContent=this.database.databaseId.securityOrigin,this.versionElement&&(this.versionElement.textContent=this.database.version.toString()),this.objectStoreCountElement.textContent=this.database.objectStores.size.toString()}refreshDatabaseButtonClicked(){this.model.refreshDatabase(this.database.databaseId)}update(e){this.database=e,this.reportView.setTitle(this.database.databaseId.name),this.refreshDatabase(),this.updatedForTests()}updatedForTests(){}async deleteDatabase(){await o.UIUtils.ConfirmDialog.show(et(Ye.pleaseConfirmDeleteOfSDatabase,{PH1:this.database.databaseId.name}),this.element)&&this.model.deleteDatabase(this.database.databaseId)}wasShown(){super.wasShown(),this.reportView.registerCSSFiles([Je]),this.registerCSSFiles([Je])}}class it extends o.View.SimpleView{model;databaseId;isIndex;refreshObjectStoreCallback;refreshButton;deleteSelectedButton;clearButton;needsRefresh;clearingObjectStore;pageSize;skipCount;entries;objectStore;index;keyInput;dataGrid;lastPageSize;lastSkipCount;pageBackButton;pageForwardButton;lastKey;summaryBarElement;constructor(e,t,i,r,s){super(et(Ye.idb)),this.model=e,this.databaseId=t,this.isIndex=Boolean(r),this.refreshObjectStoreCallback=s,this.element.classList.add("indexed-db-data-view","storage-view"),this.refreshButton=new o.Toolbar.ToolbarButton(et(Ye.refresh),"largeicon-refresh"),this.refreshButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.refreshButtonClicked,this),this.deleteSelectedButton=new o.Toolbar.ToolbarButton(et(Ye.deleteSelected),"largeicon-delete"),this.deleteSelectedButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,(e=>{this.deleteButtonClicked(null)})),this.clearButton=new o.Toolbar.ToolbarButton(et(Ye.clearObjectStore),"largeicon-clear"),this.clearButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,(()=>{this.clearButtonClicked()}),this),this.needsRefresh=new o.Toolbar.ToolbarItem(o.UIUtils.createIconLabel(et(Ye.dataMayBeStale),"smallicon-warning")),this.needsRefresh.setVisible(!1),this.needsRefresh.setTitle(et(Ye.someEntriesMayHaveBeenModified)),this.clearingObjectStore=!1,this.createEditorToolbar(),this.pageSize=50,this.skipCount=0,this.update(i,r),this.entries=[]}createDataGrid(){const e=this.isIndex&&this.index?this.index.keyPath:this.objectStore.keyPath,t=[],i={title:void 0,titleDOMFragment:void 0,sortable:!1,sort:void 0,align:void 0,width:void 0,fixedWidth:void 0,editable:void 0,nonSelectable:void 0,longText:void 0,disclosure:void 0,weight:void 0,allowInSortByEvenWhenHidden:void 0,dataType:void 0,defaultWeight:void 0};t.push({...i,id:"number",title:"#",sortable:!1,width:"50px"}),t.push({...i,id:"key",titleDOMFragment:this.keyColumnHeaderFragment(et(Ye.keyString),e),sortable:!1}),this.isIndex&&t.push({...i,id:"primaryKey",titleDOMFragment:this.keyColumnHeaderFragment(et(Ye.primaryKey),this.objectStore.keyPath),sortable:!1});const r=et(Ye.valueString);t.push({...i,id:"value",title:r,sortable:!1});const s=new u.DataGrid.DataGridImpl({displayName:et(Ye.indexedDb),columns:t,deleteCallback:this.deleteButtonClicked.bind(this),refreshCallback:this.updateData.bind(this,!0),editCallback:void 0});return s.setStriped(!0),s.addEventListener(u.DataGrid.Events.SelectedNode,(()=>this.updateToolbarEnablement()),this),s}keyColumnHeaderFragment(e,t){const i=document.createDocumentFragment();if(o.UIUtils.createTextChild(i,e),null===t)return i;if(o.UIUtils.createTextChild(i," ("+et(Ye.keyPath)),Array.isArray(t)){o.UIUtils.createTextChild(i,"[");for(let e=0;e<t.length;++e)0!==e&&o.UIUtils.createTextChild(i,", "),i.appendChild(this.keyPathStringFragment(t[e]));o.UIUtils.createTextChild(i,"]")}else{const e=t;i.appendChild(this.keyPathStringFragment(e))}return o.UIUtils.createTextChild(i,")"),i}keyPathStringFragment(e){const t=document.createDocumentFragment();o.UIUtils.createTextChild(t,'"');return t.createChild("span","source-code indexed-db-key-path").textContent=e,o.UIUtils.createTextChild(t,'"'),t}createEditorToolbar(){const e=new o.Toolbar.Toolbar("data-view-toolbar",this.element);e.appendToolbarItem(this.refreshButton),e.appendToolbarItem(new o.Toolbar.ToolbarSeparator),this.pageBackButton=new o.Toolbar.ToolbarButton(et(Ye.showPreviousPage),"largeicon-play-back"),this.pageBackButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.pageBackButtonClicked,this),e.appendToolbarItem(this.pageBackButton),this.pageForwardButton=new o.Toolbar.ToolbarButton(et(Ye.showNextPage),"largeicon-play"),this.pageForwardButton.setEnabled(!1),this.pageForwardButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.pageForwardButtonClicked,this),e.appendToolbarItem(this.pageForwardButton),this.keyInput=new o.Toolbar.ToolbarInput(et(Ye.startFromKey),"",.5),this.keyInput.addEventListener(o.Toolbar.ToolbarInput.Event.TextChanged,this.updateData.bind(this,!1)),e.appendToolbarItem(this.keyInput),e.appendToolbarItem(new o.Toolbar.ToolbarSeparator),e.appendToolbarItem(this.clearButton),e.appendToolbarItem(this.deleteSelectedButton),e.appendToolbarItem(this.needsRefresh)}pageBackButtonClicked(){this.skipCount=Math.max(0,this.skipCount-this.pageSize),this.updateData(!1)}pageForwardButtonClicked(){this.skipCount=this.skipCount+this.pageSize,this.updateData(!1)}populateContextMenu(e,t){const i=t;i.valueObjectPresentation&&(e.revealSection().appendItem(et(Ye.expandRecursively),(()=>{i.valueObjectPresentation&&i.valueObjectPresentation.objectTreeElement().expandRecursively()})),e.revealSection().appendItem(et(Ye.collapse),(()=>{i.valueObjectPresentation&&i.valueObjectPresentation.objectTreeElement().collapse()})))}refreshData(){this.updateData(!0)}update(e,t){this.objectStore=e,this.index=t,this.dataGrid&&this.dataGrid.asWidget().detach(),this.dataGrid=this.createDataGrid(),this.dataGrid.setRowContextMenuCallback(this.populateContextMenu.bind(this)),this.dataGrid.asWidget().show(this.element),this.skipCount=0,this.updateData(!0)}parseKey(e){let t;try{t=JSON.parse(e)}catch(i){t=e}return t}updateData(e){const t=this.parseKey(this.keyInput.value()),i=this.pageSize;let r=this.skipCount,s=this.dataGrid.selectedNode?this.dataGrid.selectedNode.data.number:0;if(s=Math.max(s,this.skipCount),this.clearButton.setEnabled(!this.isIndex),!e&&this.lastKey===t&&this.lastPageSize===i&&this.lastSkipCount===r)return;function a(e,t){this.clear(),this.entries=e;let i=null;for(let t=0;t<e.length;++t){const a={};a.number=t+r,a.key=e[t].key,a.primaryKey=e[t].primaryKey,a.value=e[t].value;const n=new rt(a);this.dataGrid.rootNode().appendChild(n),a.number<=s&&(i=n)}i&&i.select(),this.pageBackButton.setEnabled(Boolean(r)),this.pageForwardButton.setEnabled(t),this.needsRefresh.setVisible(!1),this.updateToolbarEnablement(),this.updatedDataForTests()}this.lastKey===t&&this.lastPageSize===i||(r=0,this.skipCount=0),this.lastKey=t,this.lastPageSize=i,this.lastSkipCount=r;const n=t?window.IDBKeyRange.lowerBound(t):null;this.isIndex&&this.index?this.model.loadIndexData(this.databaseId,this.objectStore.name,this.index.name,n,r,i,a.bind(this)):this.model.loadObjectStoreData(this.databaseId,this.objectStore.name,n,r,i,a.bind(this)),this.model.getMetadata(this.databaseId,this.objectStore).then(this.updateSummaryBar.bind(this))}updateSummaryBar(e){if(this.summaryBarElement||(this.summaryBarElement=this.element.createChild("div","object-store-summary-bar")),this.summaryBarElement.removeChildren(),!e)return;const t=this.summaryBarElement.createChild("span");t.textContent=et(Ye.totalEntriesS,{PH1:String(e.entriesCount)}),this.objectStore.autoIncrement&&(t.textContent+=" ❘ ",t.textContent+=et(Ye.keyGeneratorValueS,{PH1:String(e.keyGeneratorValue)}))}updatedDataForTests(){}refreshButtonClicked(){this.updateData(!0)}async clearButtonClicked(){this.clearButton.setEnabled(!1),this.clearingObjectStore=!0,await this.model.clearObjectStore(this.databaseId,this.objectStore.name),this.clearingObjectStore=!1,this.clearButton.setEnabled(!0),this.updateData(!0)}markNeedsRefresh(){this.clearingObjectStore||this.needsRefresh.setVisible(!0)}async deleteButtonClicked(e){if(!e&&!(e=this.dataGrid.selectedNode))return;const t=(this.isIndex?e.data.primaryKey:e.data.key).value;await this.model.deleteEntries(this.databaseId,this.objectStore.name,window.IDBKeyRange.only(t)),this.refreshObjectStoreCallback()}clear(){this.dataGrid.rootNode().removeChildren(),this.entries=[]}updateToolbarEnablement(){const e=!this.dataGrid||0===this.dataGrid.rootNode().children.length;this.deleteSelectedButton.setEnabled(!e&&null!==this.dataGrid.selectedNode)}wasShown(){super.wasShown(),this.registerCSSFiles([Je])}}class rt extends u.DataGrid.DataGridNode{selectable;valueObjectPresentation;constructor(e){super(e,!1),this.selectable=!0,this.valueObjectPresentation=null}createCell(e){const t=super.createCell(e),i=this.data[e];switch(e){case"value":{t.removeChildren();const e=v.ObjectPropertiesSection.ObjectPropertiesSection.defaultObjectPropertiesSection(i,void 0,!0,!0);t.appendChild(e.element),this.valueObjectPresentation=e;break}case"key":case"primaryKey":{t.removeChildren();const e=v.ObjectPropertiesSection.ObjectPropertiesSection.defaultObjectPresentation(i,void 0,!0,!0);t.appendChild(e);break}}return t}}var st=Object.freeze({__proto__:null,IDBDatabaseView:tt,IDBDataView:it,IDBDataGridNode:rt});const at=new CSSStyleSheet;at.replaceSync('.report-content-box{overflow:initial}.report-field-name{flex:0 0 200px}.report-field-value{user-select:text;display:flex}.report-field .inline-name{color:var(--color-text-disabled);padding-left:2ex;user-select:none;white-space:pre-line}.report-field .inline-name::after{content:":\\A0"}.report-field .inline-comment{color:var(--color-text-secondary);padding-left:1ex;white-space:pre-line}.report-field .inline-comment::before{content:"("}.report-field .inline-comment::after{content:")"}.report-field .inline-span{color:var(--color-text-secondary);padding-left:1ex;white-space:pre-line}.report-field-value-link{display:inline-block}.icon-link.devtools-link{background-color:var(--color-link);vertical-align:sub}.frame-details-container{overflow:auto}.frame-details-report-container{min-width:550px}.text-ellipsis{max-width:200px;overflow:hidden;text-overflow:ellipsis}\n/*# sourceURL=frameDetailsReportView.css */\n');const nt={yes:"Yes",no:"No",clickToRevealInElementsPanel:"Click to reveal in Elements panel",document:"Document",url:"URL",security:"Security",openerFrame:"Opener Frame",accessToOpener:"Access to opener",showsWhetherTheOpenedWindowIs:"Shows whether the opened window is able to access its opener and vice versa",windowWithoutTitle:"Window without title",closed:"closed",worker:"worker",type:"Type",securityIsolation:"Security & Isolation",crossoriginEmbedderPolicy:"Cross-Origin Embedder Policy",webWorker:"Web Worker",unknown:"Unknown",reportingTo:"reporting to"},ot=i.i18n.registerUIStrings("panels/application/OpenedWindowDetailsView.ts",nt),dt=i.i18n.getLocalizedString.bind(void 0,ot);async function ct(t){let i=null;if(t instanceof a.ResourceTreeModel.ResourceTreeFrame?i=t:t&&(i=a.FrameManager.FrameManager.instance().getFrame(t)),!i)return null;const r=await i.getOwnerDOMNodeOrDocument();if(!r)return null;const s=function(e,t,i){const r=o.Icon.Icon.create(e,"icon-link devtools-link"),s=document.createElement("span");return o.Tooltip.Tooltip.install(s,t),s.classList.add("devtools-link"),s.tabIndex=0,s.appendChild(r),s.addEventListener("click",(e=>{e.consume(!0),i()})),s.addEventListener("keydown",(e=>{"Enter"===e.key&&(e.consume(!0),i())})),s}("mediumicon-elements-panel",dt(nt.clickToRevealInElementsPanel),(()=>e.Revealer.reveal(r))),n=document.createElement("span");return n.textContent=`<${r.nodeName().toLocaleLowerCase()}>`,s.insertBefore(n,s.firstChild),s.addEventListener("mouseenter",(()=>{i&&i.highlight()})),s.addEventListener("mouseleave",(()=>{a.OverlayModel.OverlayModel.hideDOMNodeHighlight()})),s}class lt extends o.ThrottledWidget.ThrottledWidget{targetInfo;isWindowClosed;reportView;documentSection;URLFieldValue;securitySection;openerElementField;hasDOMAccessValue;constructor(e,t){super(),this.targetInfo=e,this.isWindowClosed=t,this.contentElement.classList.add("frame-details-container"),this.reportView=new o.ReportView.ReportView(this.buildTitle()),this.reportView.show(this.contentElement),this.reportView.element.classList.add("frame-details-report-container"),this.documentSection=this.reportView.appendSection(dt(nt.document)),this.URLFieldValue=this.documentSection.appendField(dt(nt.url)),this.securitySection=this.reportView.appendSection(dt(nt.security)),this.openerElementField=this.securitySection.appendField(dt(nt.openerFrame)),this.securitySection.setFieldVisible(dt(nt.openerFrame),!1),this.hasDOMAccessValue=this.securitySection.appendField(dt(nt.accessToOpener)),o.Tooltip.Tooltip.install(this.hasDOMAccessValue,dt(nt.showsWhetherTheOpenedWindowIs)),this.update()}async doUpdate(){var e;this.reportView.setTitle(this.buildTitle()),this.URLFieldValue.textContent=this.targetInfo.url,this.hasDOMAccessValue.textContent=(e=this.targetInfo.canAccessOpener,dt(e?nt.yes:nt.no)),this.maybeDisplayOpenerFrame()}async maybeDisplayOpenerFrame(){this.openerElementField.removeChildren();const e=await ct(this.targetInfo.openerFrameId);if(e)return this.openerElementField.append(e),void this.securitySection.setFieldVisible(dt(nt.openerFrame),!0);this.securitySection.setFieldVisible(dt(nt.openerFrame),!1)}buildTitle(){let e=this.targetInfo.title||dt(nt.windowWithoutTitle);return this.isWindowClosed&&(e+=` (${dt(nt.closed)})`),e}setIsWindowClosed(e){this.isWindowClosed=e}setTargetInfo(e){this.targetInfo=e}wasShown(){super.wasShown(),this.reportView.registerCSSFiles([at]),this.registerCSSFiles([at])}}class ht extends o.ThrottledWidget.ThrottledWidget{targetInfo;reportView;documentSection;URLFieldValue;isolationSection;coepPolicy;constructor(e){super(),this.targetInfo=e,this.contentElement.classList.add("frame-details-container"),this.reportView=new o.ReportView.ReportView(this.targetInfo.title||this.targetInfo.url||dt(nt.worker)),this.reportView.show(this.contentElement),this.reportView.element.classList.add("frame-details-report-container"),this.documentSection=this.reportView.appendSection(dt(nt.document)),this.URLFieldValue=this.documentSection.appendField(dt(nt.url)),this.URLFieldValue.textContent=this.targetInfo.url;this.documentSection.appendField(dt(nt.type)).textContent=this.workerTypeToString(this.targetInfo.type),this.isolationSection=this.reportView.appendSection(dt(nt.securityIsolation)),this.coepPolicy=this.isolationSection.appendField(dt(nt.crossoriginEmbedderPolicy)),this.update()}workerTypeToString(e){return"worker"===e?dt(nt.webWorker):"service_worker"===e?i.i18n.lockedString("Service Worker"):dt(nt.unknown)}async updateCoopCoepStatus(){const e=a.TargetManager.TargetManager.instance().targetById(this.targetInfo.targetId);if(!e)return;const t=e.model(a.NetworkManager.NetworkManager),i=t&&await t.getSecurityIsolationStatus(null);if(!i)return;this.fillCrossOriginPolicy(this.coepPolicy,(e=>"None"!==e),i.coep)}fillCrossOriginPolicy(e,t,i){if(!i)return void(e.textContent="");const r=t(i.value);if(e.textContent=r?i.value:i.reportOnlyValue,!r&&t(i.reportOnlyValue)){const t=document.createElement("span");t.classList.add("inline-comment"),t.textContent="report-only",e.appendChild(t)}const s=r?i.reportingEndpoint:i.reportOnlyReportingEndpoint;if(s){e.createChild("span","inline-name").textContent=dt(nt.reportingTo);e.createChild("span").textContent=s}}async doUpdate(){await this.updateCoopCoepStatus()}wasShown(){super.wasShown(),this.reportView.registerCSSFiles([at]),this.registerCSSFiles([at])}}var ut=Object.freeze({__proto__:null,OpenedWindowDetailsView:lt,WorkerDetailsView:ht});const gt=new CSSStyleSheet;gt.replaceSync('.service-worker-version{display:flex;flex-wrap:wrap}.service-worker-version-stack{position:relative}.service-worker-version-stack-bar{position:absolute;top:10px;bottom:20px;left:4px;content:"";border-left:1px solid var(--color-details-hairline);z-index:0}.service-worker-version:not(:last-child){margin-bottom:7px}.service-worker-version-string{flex-shrink:0}.service-worker-active-circle,.service-worker-installing-circle,.service-worker-redundant-circle,.service-worker-waiting-circle{position:relative;display:inline-block;width:10px;height:10px;z-index:10;margin-right:5px;border-radius:50%;border:1px solid var(--color-text-secondary);align-self:center;flex-shrink:0}.service-worker-active-circle{background-color:#50b04f}.service-worker-waiting-circle{background-color:#f38e24}.service-worker-installing-circle{background-color:var(--color-background)}.service-worker-redundant-circle{background-color:grey}.service-worker-subtitle{padding-left:14px;line-height:14px;color:var(--color-text-disabled)}.link{margin-left:7px}.service-worker-editor-with-button{align-items:baseline;display:flex}.service-worker-notification-editor{border:1px solid var(--color-details-hairline);display:flex;flex:auto;margin-right:4px;max-width:400px;min-width:80px}.report-field-value{white-space:normal}.report-field-value-filename,.service-worker-client-string{max-width:400px;overflow:hidden;text-overflow:ellipsis}.report-field-value-filename{padding-left:2px;margin-left:-2px}.report-field-value-subtitle{overflow:hidden;text-overflow:ellipsis}.service-worker-client{display:flex}.service-worker-client-focus-link{flex:none;margin-right:2px;align-self:center}.service-worker-notification-editor.source-code{padding:4px}.service-worker-list{background-color:var(--color-background-elevation-1);overflow:auto}.service-workers-this-origin{flex-shrink:0;flex-grow:0}.service-workers-other-origin,.service-workers-this-origin{min-width:530px}.service-worker-has-current .service-workers-other-origin{margin-top:16px;border-top:1px solid var(--color-details-hairline)}.devtools-link{line-height:14px;align-self:center;padding:1px}button.link{padding:1px}button.link:focus-visible{background-color:inherit}\n/*# sourceURL=serviceWorkersView.css */\n');const pt=new CSSStyleSheet;pt.replaceSync('.resource-service-worker-update-view{display:block;margin:6px;color:rgb(30% 30% 30%);overflow:auto}.service-worker-update-timing-table{border:1px solid var(--color-details-hairline);border-spacing:0;padding-left:10px;padding-right:10px;line-height:initial;table-layout:auto;overflow:hidden}.service-worker-update-timing-row{position:relative;height:20px;overflow:hidden;min-width:80px}.service-worker-update-timing-bar{position:absolute;min-width:1px;top:0;bottom:0}.service-worker-update-timing-bar-clickable::before{user-select:none;-webkit-mask-image:var(--image-file-treeoutlineTriangles);-webkit-mask-position:0 0;-webkit-mask-size:32px 24px;float:left;width:8px;height:12px;margin-right:2px;content:"";position:relative;top:3px;background-color:rgb(110 110 110)}.service-worker-update-timing-bar-clickable{position:relative;left:-12px}.service-worker-update-timing-bar-clickable:focus-visible{background-color:var(--color-background-elevation-1)}.service-worker-update-timing-bar-clickable[aria-checked=true]::before{-webkit-mask-position:-16px 0}.service-worker-update-timing-bar-details-collapsed{display:none}.service-worker-update-timing-bar-details-expanded{display:table-row}.service-worker-update-timing-bar-details:focus-visible{background-color:var(--legacy-selection-bg-color)}.service-worker-update-timing-bar.activate{top:5px;height:10px;background-color:#ff9800}.service-worker-update-timing-bar.wait{top:5px;height:10px;background-color:#9c27b0}.service-worker-update-timing-bar.install{top:5px;height:10px;background-color:#009688}.service-worker-update-timing-table>tr>td{padding:4px 0;padding-right:10px}table.service-worker-update-timing-table>tr.service-worker-update-timing-table-header>td{border-top:5px solid transparent;color:#737373}table.service-worker-update-timing-table>tr.service-worker-update-timing-bar-details>td:first-child{padding-left:12px}table.service-worker-update-timing-table>tr.service-worker-update-timeline>td:first-child{padding-left:12px}\n/*# sourceURL=serviceWorkerUpdateCycleView.css */\n');const mt={version:"Version",updateActivity:"Update Activity",timeline:"Timeline",startTimeS:"Start time: {PH1}",endTimeS:"End time: {PH1}"},wt=i.i18n.registerUIStrings("panels/application/ServiceWorkerUpdateCycleView.ts",mt),bt=i.i18n.getLocalizedString.bind(void 0,wt);class vt{registration;rows;selectedRowIndex;tableElement;constructor(e){this.registration=e,this.rows=[],this.selectedRowIndex=-1,this.tableElement=document.createElement("table"),this.createTimingTable()}calculateServiceWorkerUpdateRanges(){function e(e,t){t.start<Number.MAX_VALUE&&t.start<=t.end&&e.push(t)}function t(t){let i=t.currentState,r=0,s=0,a=0,n=0;const o=i.status;if("new"===o)return[];for(;i;)"activated"===i.status?r=i.last_updated_timestamp:"activating"===i.status?(0===r&&(r=i.last_updated_timestamp),s=i.last_updated_timestamp):"installed"===i.status?a=i.last_updated_timestamp:"installing"===i.status&&(0===a&&(a=i.last_updated_timestamp),n=i.last_updated_timestamp),i=i.previousState;const d=[];return function(t,i,r,s,a,n,o){e(t,{id:i,phase:"Install",start:r,end:s}),"activating"!==o&&"activated"!==o&&"redundant"!==o||(e(t,{id:i,phase:"Wait",start:s,end:a}),e(t,{id:i,phase:"Activate",start:a,end:n}))}(d,t.id,n,a,s,r,o),d}const i=this.registration.versionsByMode(),r=[a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Active,a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Waiting,a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Installing,a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Redundant];for(const e of r){const r=i.get(e);if(r){return t(r)}}return[]}createTimingTable(){this.tableElement.classList.add("service-worker-update-timing-table");const e=this.calculateServiceWorkerUpdateRanges();this.updateTimingTable(e)}createTimingTableHead(){const e=this.tableElement.createChild("tr","service-worker-update-timing-table-header");o.UIUtils.createTextChild(e.createChild("td"),bt(mt.version)),o.UIUtils.createTextChild(e.createChild("td"),bt(mt.updateActivity)),o.UIUtils.createTextChild(e.createChild("td"),bt(mt.timeline))}removeRows(){const e=this.tableElement.getElementsByTagName("tr");for(;e[0];)e[0].parentNode&&e[0].parentNode.removeChild(e[0]);this.rows=[]}updateTimingTable(e){this.selectedRowIndex=-1,this.removeRows(),this.createTimingTableHead();const t=e;if(0===t.length)return;const i=t.map((e=>e.start)),r=t.map((e=>e.end)),s=i.reduce(((e,t)=>Math.min(e,t))),a=r.reduce(((e,t)=>Math.max(e,t))),n=100/(a-s);for(const e of t){const t=e.phase,i=n*(e.start-s),r=n*(a-e.end),d=this.tableElement.createChild("tr","service-worker-update-timeline");this.rows.push(d);const c=d.createChild("td");o.UIUtils.createTextChild(c,"#"+e.id),c.classList.add("service-worker-update-timing-bar-clickable"),c.setAttribute("tabindex","0"),c.setAttribute("role","switch"),c.addEventListener("focus",(e=>{this.onFocus(e)})),o.ARIAUtils.setChecked(c,!1);const l=d.createChild("td");o.UIUtils.createTextChild(l,t);const h=d.createChild("td").createChild("div","service-worker-update-timing-row").createChild("span","service-worker-update-timing-bar "+t.toLowerCase());h.style.left=i+"%",h.style.right=r+"%",h.textContent="​",this.constructUpdateDetails(d,e)}}constructUpdateDetails(e,t){const i=this.tableElement.createChild("tr","service-worker-update-timing-bar-details");i.classList.add("service-worker-update-timing-bar-details-collapsed");const r=i.createChild("td");r.colSpan=3;const s=new Date(t.start).toISOString();o.UIUtils.createTextChild(r.createChild("span"),bt(mt.startTimeS,{PH1:s})),i.tabIndex=0;const a=this.tableElement.createChild("tr","service-worker-update-timing-bar-details");a.classList.add("service-worker-update-timing-bar-details-collapsed");const n=a.createChild("td");n.colSpan=3;const d=new Date(t.end).toISOString();o.UIUtils.createTextChild(n.createChild("span"),bt(mt.endTimeS,{PH1:d})),a.tabIndex=0,e.addEventListener("keydown",(e=>{this.onKeydown(e,i,a)})),e.addEventListener("click",(e=>{this.onClick(e,i,a)}))}toggle(e,t,i,r){i.classList.contains("service-worker-update-timing-bar-clickable")&&(e.classList.toggle("service-worker-update-timing-bar-details-collapsed"),e.classList.toggle("service-worker-update-timing-bar-details-expanded"),t.classList.toggle("service-worker-update-timing-bar-details-collapsed"),t.classList.toggle("service-worker-update-timing-bar-details-expanded"),o.ARIAUtils.setChecked(i,!r))}onFocus(e){const t=e.target;if(!t)return;const i=t.parentElement;i&&(this.selectedRowIndex=this.rows.indexOf(i))}onKeydown(e,t,i){if(!e.target)return;const r=e.target,s=e,a="true"===r.getAttribute("aria-checked");return"Enter"===s.key||" "===s.key||!a&&"ArrowRight"===s.key||a&&"ArrowLeft"===s.key?(this.toggle(t,i,r,a),void e.preventDefault()):("ArrowDown"===s.key&&(this.selectedRowIndex>=0?this.selectNextRow():this.selectFirstRow(),e.preventDefault()),void("ArrowUp"===s.key&&(this.selectedRowIndex>=0?this.selectPreviousRow():this.selectLastRow(),e.preventDefault())))}focusRow(e){e.cells[0].focus()}blurRow(e){e.cells[0].blur()}selectFirstRow(){0!==this.rows.length&&(this.selectedRowIndex=0,this.focusRow(this.rows[0]))}selectLastRow(){0!==this.rows.length&&(this.selectedRowIndex=this.rows.length-1,this.focusRow(this.rows[this.selectedRowIndex]))}selectNextRow(){if(0===this.rows.length)return;const e=this.selectedRowIndex;this.selectedRowIndex++,this.selectedRowIndex>=this.rows.length&&(this.selectedRowIndex=0),this.blurRow(this.rows[e]),this.focusRow(this.rows[this.selectedRowIndex])}selectPreviousRow(){if(0===this.rows.length)return;const e=this.selectedRowIndex;this.selectedRowIndex--,this.selectedRowIndex<0&&(this.selectedRowIndex=this.rows.length-1),this.blurRow(this.rows[e]),this.focusRow(this.rows[this.selectedRowIndex])}onClick(e,t,i){const r=e.target;if(!r)return;const s="true"===r.getAttribute("aria-checked");this.toggle(t,i,r,s),e.preventDefault()}refresh(){const e=this.calculateServiceWorkerUpdateRanges();this.updateTimingTable(e)}}var St=Object.freeze({__proto__:null,ServiceWorkerUpdateCycleView:vt});const kt={serviceWorkersFromOtherOrigins:"Service workers from other origins",updateOnReload:"Update on reload",onPageReloadForceTheService:"On page reload, force the `service worker` to update, and activate it",bypassForNetwork:"Bypass for network",bypassTheServiceWorkerAndLoad:"Bypass the `service worker` and load resources from the network",serviceWorkerForS:"`Service worker` for {PH1}",testPushMessageFromDevtools:"Test push message from DevTools.",networkRequests:"Network requests",update:"Update",unregisterServiceWorker:"Unregister service worker",unregister:"Unregister",source:"Source",status:"Status",clients:"Clients",pushString:"Push",pushData:"Push data",syncString:"Sync",syncTag:"Sync tag",periodicSync:"Periodic Sync",periodicSyncTag:"Periodic Sync tag",sRegistrationErrors:"{PH1} registration errors",receivedS:"Received {PH1}",sDeleted:"{PH1} - deleted",sActivatedAndIsS:"#{PH1} activated and is {PH2}",stopString:"stop",inspect:"inspect",startString:"start",sIsRedundant:"#{PH1} is redundant",sWaitingToActivate:"#{PH1} waiting to activate",sTryingToInstall:"#{PH1} trying to install",updateCycle:"Update Cycle",workerS:"Worker: {PH1}",focus:"focus",seeAllRegistrations:"See all registrations"},ft=i.i18n.registerUIStrings("panels/application/ServiceWorkersView.ts",kt),yt=i.i18n.getLocalizedString.bind(void 0,ft);let Ct=!1;class Tt extends o.Widget.VBox{currentWorkersView;toolbar;sections;manager;securityOriginManager;sectionToRegistration;eventListeners;constructor(){super(!0),this.currentWorkersView=new o.ReportView.ReportView(i.i18n.lockedString("Service Workers")),this.currentWorkersView.setBodyScrollable(!1),this.contentElement.classList.add("service-worker-list"),this.currentWorkersView.show(this.contentElement),this.currentWorkersView.element.classList.add("service-workers-this-origin"),this.toolbar=this.currentWorkersView.createToolbar(),this.toolbar.makeWrappable(!0),this.sections=new Map,this.manager=null,this.securityOriginManager=null,this.sectionToRegistration=new WeakMap;const r=this.contentElement.createChild("div","service-workers-other-origin"),s=new o.ReportView.ReportView;s.setHeaderVisible(!1),s.show(r);const n=s.appendSection(yt(kt.serviceWorkersFromOtherOrigins)).appendRow(),d=o.Fragment.html`<a class="devtools-link" role="link" tabindex="0" href="chrome://serviceworker-internals" target="_blank" style="display: inline; cursor: pointer;">${yt(kt.seeAllRegistrations)}</a>`;self.onInvokeElement(d,(e=>{const t=a.TargetManager.TargetManager.instance().mainTarget();t&&t.targetAgent().invoke_createTarget({url:"chrome://serviceworker-internals?devtools"}),e.consume(!0)})),n.appendChild(d),this.toolbar.appendToolbarItem(k.ThrottlingManager.throttlingManager().createOfflineToolbarCheckbox());const c=e.Settings.Settings.instance().createSetting("serviceWorkerUpdateOnReload",!1);c.setTitle(yt(kt.updateOnReload));const l=new o.Toolbar.ToolbarSettingCheckbox(c,yt(kt.onPageReloadForceTheService));this.toolbar.appendToolbarItem(l);const h=e.Settings.Settings.instance().createSetting("bypassServiceWorker",!1);h.setTitle(yt(kt.bypassForNetwork));const u=new o.Toolbar.ToolbarSettingCheckbox(h,yt(kt.bypassTheServiceWorkerAndLoad));this.toolbar.appendToolbarItem(u),this.eventListeners=new Map,a.TargetManager.TargetManager.instance().observeModels(a.ServiceWorkerManager.ServiceWorkerManager,this),this.updateListVisibility();document.body.addEventListener(o.InspectorView.Events.DrawerChange,(i=>{const r=i.detail&&i.detail.isDrawerOpen;if(this.manager&&!r){const{serviceWorkerNetworkRequestsPanelStatus:{isOpen:i,openedAt:r}}=this.manager;if(i){const i=o.ViewManager.ViewManager.instance().locationNameForViewId("network");o.ViewManager.ViewManager.instance().showViewInLocation("network",i,!1),e.Revealer.reveal(f.UIFilter.UIRequestFilter.filters([]));Date.now()-r<2e3&&t.userMetrics.actionTaken(t.UserMetrics.Action.ServiceWorkerNetworkRequestClosedQuickly),this.manager.serviceWorkerNetworkRequestsPanelStatus={isOpen:!1,openedAt:0}}}}))}modelAdded(e){if(!this.manager){this.manager=e,this.securityOriginManager=e.target().model(a.SecurityOriginManager.SecurityOriginManager);for(const e of this.manager.registrations().values())this.updateRegistration(e);this.eventListeners.set(e,[this.manager.addEventListener(a.ServiceWorkerManager.Events.RegistrationUpdated,this.registrationUpdated,this),this.manager.addEventListener(a.ServiceWorkerManager.Events.RegistrationDeleted,this.registrationDeleted,this),this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginAdded,this.updateSectionVisibility,this),this.securityOriginManager.addEventListener(a.SecurityOriginManager.Events.SecurityOriginRemoved,this.updateSectionVisibility,this)])}}modelRemoved(t){this.manager&&this.manager===t&&(e.EventTarget.removeEventListeners(this.eventListeners.get(t)||[]),this.eventListeners.delete(t),this.manager=null,this.securityOriginManager=null)}getTimeStamp(e){const t=e.versionsByMode();let i=0;const r=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Active),s=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Installing),n=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Waiting),o=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Redundant);return r?i=r.scriptResponseTime:n?i=n.scriptResponseTime:s?i=s.scriptResponseTime:o&&(i=o.scriptResponseTime),i||0}updateSectionVisibility(){let e=!1;const t=[];for(const i of this.sections.values()){const r=this.getReportViewForOrigin(i.registration.securityOrigin);e=e||r===this.currentWorkersView,i.section.parentWidget()!==r&&t.push(i)}for(const e of t){const t=e.registration;this.removeRegistrationFromList(t),this.updateRegistration(t,!0)}this.currentWorkersView.sortSections(((e,t)=>{const i=this.sectionToRegistration.get(e),r=this.sectionToRegistration.get(t),s=i?this.getTimeStamp(i):0;return(r?this.getTimeStamp(r):0)-s}));for(const e of this.sections.values())e.section.parentWidget()===this.currentWorkersView||this.isRegistrationVisible(e.registration)?e.section.showWidget():e.section.hideWidget();this.contentElement.classList.toggle("service-worker-has-current",Boolean(e)),this.updateListVisibility()}registrationUpdated(e){this.updateRegistration(e.data),this.gcRegistrations()}gcRegistrations(){if(!this.manager||!this.securityOriginManager)return;let e=!1;const t=new Set(this.securityOriginManager.securityOrigins());for(const i of this.manager.registrations().values())if((t.has(i.securityOrigin)||this.isRegistrationVisible(i))&&!i.canBeRemoved()){e=!0;break}if(e)for(const e of this.manager.registrations().values()){!(t.has(e.securityOrigin)||this.isRegistrationVisible(e))&&e.canBeRemoved()&&this.removeRegistrationFromList(e)}}getReportViewForOrigin(e){return this.securityOriginManager&&(this.securityOriginManager.securityOrigins().includes(e)||this.securityOriginManager.unreachableMainSecurityOrigin()===e)?this.currentWorkersView:null}updateRegistration(e,t){let i=this.sections.get(e);if(!i){const t=e.scopeURL,r=this.getReportViewForOrigin(e.securityOrigin);if(!r)return;const s=r.appendSection(t);s.setUiGroupTitle(yt(kt.serviceWorkerForS,{PH1:t})),this.sectionToRegistration.set(s,e),i=new It(this.manager,s,e),this.sections.set(e,i)}t||(this.updateSectionVisibility(),i.scheduleUpdate())}registrationDeleted(e){this.removeRegistrationFromList(e.data)}removeRegistrationFromList(e){const t=this.sections.get(e);t&&t.section.detach(),this.sections.delete(e),this.updateSectionVisibility()}isRegistrationVisible(e){return!e.scopeURL}updateListVisibility(){this.contentElement.classList.toggle("service-worker-list-empty",0===this.sections.size)}wasShown(){super.wasShown(),this.registerCSSFiles([gt])}}class It{manager;section;registration;fingerprint;pushNotificationDataSetting;syncTagNameSetting;periodicSyncTagNameSetting;toolbar;updateCycleView;networkRequests;updateButton;deleteButton;sourceField;statusField;clientsField;linkifier;clientInfoCache;throttler;updateCycleField;constructor(t,i,r){this.manager=t,this.section=i,this.registration=r,this.fingerprint=null,this.pushNotificationDataSetting=e.Settings.Settings.instance().createLocalSetting("pushData",yt(kt.testPushMessageFromDevtools)),this.syncTagNameSetting=e.Settings.Settings.instance().createLocalSetting("syncTagName","test-tag-from-devtools"),this.periodicSyncTagNameSetting=e.Settings.Settings.instance().createLocalSetting("periodicSyncTagName","test-tag-from-devtools"),this.toolbar=i.createToolbar(),this.toolbar.renderAsLinks(),this.updateCycleView=new vt(r),this.networkRequests=new o.Toolbar.ToolbarButton(yt(kt.networkRequests),void 0,yt(kt.networkRequests)),this.networkRequests.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.networkRequestsClicked,this),this.toolbar.appendToolbarItem(this.networkRequests),this.updateButton=new o.Toolbar.ToolbarButton(yt(kt.update),void 0,yt(kt.update)),this.updateButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.updateButtonClicked,this),this.toolbar.appendToolbarItem(this.updateButton),this.deleteButton=new o.Toolbar.ToolbarButton(yt(kt.unregisterServiceWorker),void 0,yt(kt.unregister)),this.deleteButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.unregisterButtonClicked,this),this.toolbar.appendToolbarItem(this.deleteButton),this.sourceField=this.wrapWidget(this.section.appendField(yt(kt.source))),this.statusField=this.wrapWidget(this.section.appendField(yt(kt.status))),this.clientsField=this.wrapWidget(this.section.appendField(yt(kt.clients))),this.createSyncNotificationField(yt(kt.pushString),this.pushNotificationDataSetting.get(),yt(kt.pushData),this.push.bind(this)),this.createSyncNotificationField(yt(kt.syncString),this.syncTagNameSetting.get(),yt(kt.syncTag),this.sync.bind(this)),this.createSyncNotificationField(yt(kt.periodicSync),this.periodicSyncTagNameSetting.get(),yt(kt.periodicSyncTag),(e=>this.periodicSync(e))),this.createUpdateCycleField(),this.linkifier=new m.Linkifier.Linkifier,this.clientInfoCache=new Map,this.throttler=new e.Throttler.Throttler(500)}createSyncNotificationField(e,t,i,r){const s=this.wrapWidget(this.section.appendField(e)).createChild("form","service-worker-editor-with-button"),a=o.UIUtils.createInput("source-code service-worker-notification-editor");s.appendChild(a);const n=o.UIUtils.createTextButton(e);n.type="submit",s.appendChild(n),a.value=t,a.placeholder=i,o.ARIAUtils.setAccessibleName(a,e),s.addEventListener("submit",(e=>{r(a.value||""),e.consume(!0)}))}scheduleUpdate(){Ct?this.update():this.throttler.schedule(this.update.bind(this))}targetForVersionId(e){const t=this.manager.findVersion(e);return t&&t.targetId?a.TargetManager.TargetManager.instance().targetById(t.targetId):null}addVersion(e,t,i){const r=e.createChild("div","service-worker-version");r.createChild("div",t);const s=r.createChild("span","service-worker-version-string");return s.textContent=i,o.ARIAUtils.markAsAlert(s),r}updateClientsField(e){this.clientsField.removeChildren(),this.section.setFieldVisible(yt(kt.clients),Boolean(e.controlledClients.length));for(const t of e.controlledClients){const e=this.clientsField.createChild("div","service-worker-client"),i=this.clientInfoCache.get(t);i&&this.updateClientInfo(e,i),this.manager.target().targetAgent().invoke_getTargetInfo({targetId:t}).then(this.onClientInfo.bind(this,e))}}updateSourceField(t){this.sourceField.removeChildren();const i=e.ParsedURL.ParsedURL.extractName(t.scriptURL),r=this.sourceField.createChild("div","report-field-value-filename"),s=m.Linkifier.Linkifier.linkifyURL(t.scriptURL,{text:i});if(s.tabIndex=0,r.appendChild(s),this.registration.errors.length){const t=o.UIUtils.createIconLabel(String(this.registration.errors.length),"smallicon-error");t.classList.add("devtools-link","link"),t.tabIndex=0,o.ARIAUtils.setAccessibleName(t,yt(kt.sRegistrationErrors,{PH1:this.registration.errors.length})),self.onInvokeElement(t,(()=>e.Console.Console.instance().show())),r.appendChild(t)}void 0!==t.scriptResponseTime&&(this.sourceField.createChild("div","report-field-value-subtitle").textContent=yt(kt.receivedS,{PH1:new Date(1e3*t.scriptResponseTime).toLocaleString()}))}update(){const e=this.registration.fingerprint();if(e===this.fingerprint)return Promise.resolve();this.fingerprint=e,this.toolbar.setEnabled(!this.registration.isDeleted);const t=this.registration.versionsByMode(),r=this.registration.scopeURL,s=this.registration.isDeleted?yt(kt.sDeleted,{PH1:r}):r;this.section.setTitle(s);const n=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Active),o=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Waiting),d=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Installing),c=t.get(a.ServiceWorkerManager.ServiceWorkerVersion.Modes.Redundant);this.statusField.removeChildren();const l=this.statusField.createChild("div","service-worker-version-stack");if(l.createChild("div","service-worker-version-stack-bar"),n){this.updateSourceField(n);const e=a.ServiceWorkerManager.ServiceWorkerVersion.RunningStatus[n.currentState.runningStatus](),t=this.addVersion(l,"service-worker-active-circle",yt(kt.sActivatedAndIsS,{PH1:n.id,PH2:e}));n.isRunning()||n.isStarting()?(this.createLink(t,yt(kt.stopString),this.stopButtonClicked.bind(this,n.id)),this.targetForVersionId(n.id)||this.createLink(t,yt(kt.inspect),this.inspectButtonClicked.bind(this,n.id))):n.isStartable()&&this.createLink(t,yt(kt.startString),this.startButtonClicked.bind(this)),this.updateClientsField(n)}else c&&(this.updateSourceField(c),this.addVersion(l,"service-worker-redundant-circle",yt(kt.sIsRedundant,{PH1:c.id})),this.updateClientsField(c));if(o){const e=this.addVersion(l,"service-worker-waiting-circle",yt(kt.sWaitingToActivate,{PH1:o.id}));this.createLink(e,i.i18n.lockedString("skipWaiting"),this.skipButtonClicked.bind(this)),void 0!==o.scriptResponseTime&&(e.createChild("div","service-worker-subtitle").textContent=yt(kt.receivedS,{PH1:new Date(1e3*o.scriptResponseTime).toLocaleString()})),this.targetForVersionId(o.id)||!o.isRunning()&&!o.isStarting()||this.createLink(e,yt(kt.inspect),this.inspectButtonClicked.bind(this,o.id))}if(d){const e=this.addVersion(l,"service-worker-installing-circle",yt(kt.sTryingToInstall,{PH1:d.id}));void 0!==d.scriptResponseTime&&(e.createChild("div","service-worker-subtitle").textContent=yt(kt.receivedS,{PH1:new Date(1e3*d.scriptResponseTime).toLocaleString()})),this.targetForVersionId(d.id)||!d.isRunning()&&!d.isStarting()||this.createLink(e,yt(kt.inspect),this.inspectButtonClicked.bind(this,d.id))}return this.updateCycleView.refresh(),Promise.resolve()}createLink(e,t,i,r,s){const a=document.createElement("button");return r&&(a.className=r),a.classList.add("link","devtools-link"),a.textContent=t,a.tabIndex=0,a.addEventListener("click",i,s),e.appendChild(a),a}unregisterButtonClicked(){this.manager.deleteRegistration(this.registration.id)}createUpdateCycleField(){this.updateCycleField=this.wrapWidget(this.section.appendField(yt(kt.updateCycle))),this.updateCycleField.appendChild(this.updateCycleView.tableElement)}updateButtonClicked(){this.manager.updateRegistration(this.registration.id)}networkRequestsClicked(){const i="drawer-view"===o.ViewManager.ViewManager.instance().locationNameForViewId("resources")?"panel":"drawer-view";o.ViewManager.ViewManager.instance().showViewInLocation("network",i),e.Revealer.reveal(f.UIFilter.UIRequestFilter.filters([{filterType:f.UIFilter.FilterType.Is,filterValue:f.UIFilter.IsFilterType.ServiceWorkerIntercepted}]));const r=S.NetworkLog.NetworkLog.instance().requests();let s=null;if(Array.isArray(r))for(const e of r)!s&&e.fetchedViaServiceWorker&&(s=e),e.fetchedViaServiceWorker&&s&&s.responseReceivedTime<e.responseReceivedTime&&(s=e);if(s){const t=f.UIRequestLocation.UIRequestLocation.tab(s,f.UIRequestLocation.UIRequestTabs.Timing,{clearFilter:!1});e.Revealer.reveal(t)}this.manager.serviceWorkerNetworkRequestsPanelStatus={isOpen:!0,openedAt:Date.now()},t.userMetrics.actionTaken(t.UserMetrics.Action.ServiceWorkerNetworkRequestClicked)}push(e){this.pushNotificationDataSetting.set(e),this.manager.deliverPushMessage(this.registration.id,e)}sync(e){this.syncTagNameSetting.set(e),this.manager.dispatchSyncEvent(this.registration.id,e,!0)}periodicSync(e){this.periodicSyncTagNameSetting.set(e),this.manager.dispatchPeriodicSyncEvent(this.registration.id,e)}onClientInfo(e,t){const i=t.targetInfo;i&&(this.clientInfoCache.set(i.targetId,i),this.updateClientInfo(e,i))}updateClientInfo(e,t){if("page"!==t.type&&"iframe"===t.type){const i=e.createChild("span","service-worker-client-string");return void o.UIUtils.createTextChild(i,yt(kt.workerS,{PH1:t.url}))}e.removeChildren();const i=e.createChild("span","service-worker-client-string");o.UIUtils.createTextChild(i,t.url),this.createLink(e,yt(kt.focus),this.activateTarget.bind(this,t.targetId),"service-worker-client-focus-link")}activateTarget(e){this.manager.target().targetAgent().invoke_activateTarget({targetId:e})}startButtonClicked(){this.manager.startWorker(this.registration.scopeURL)}skipButtonClicked(){this.manager.skipWaiting(this.registration.scopeURL)}stopButtonClicked(e){this.manager.stopWorker(e)}inspectButtonClicked(e){this.manager.inspectWorker(e)}wrapWidget(e){const t=o.Utils.createShadowRootWithCoreStyles(e,{cssFile:[gt,pt],delegatesFocus:void 0}),i=document.createElement("div");return t.appendChild(i),i}}var Et=Object.freeze({__proto__:null,setThrottleDisabledForDebugging:e=>{Ct=e},ServiceWorkersView:Tt,Section:It});const xt=new CSSStyleSheet;xt.replaceSync(".report-row{display:flex;align-items:center;white-space:normal}.clear-storage-button .report-row{margin:0 0 0 17px;display:flex}.link{margin-left:10px;display:none}.report-row:hover .link{display:inline}.quota-override-editor-with-button{align-items:baseline;display:flex}.quota-override-notification-editor{border:solid 1px var(--color-background-highlight);display:flex;flex:auto;margin-right:4px;max-width:200px;min-width:50px;min-height:24px;padding-left:4px}.quota-override-notification-editor:focus{border:solid 1px var(--color-primary-variant)}.quota-override-error{padding-top:10px;color:red}.usage-breakdown-row{min-width:fit-content}.clear-storage-container{overflow:auto}.clear-storage-header{min-width:400px}.report-content-box{overflow:initial}.include-third-party-cookies{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-left:16px}\n/*# sourceURL=storageView.css */\n");const Rt={storageQuotaUsed:"{PH1} used out of {PH2} storage quota",storageQuotaUsedWithBytes:"{PH1} bytes used out of {PH2} bytes storage quota",storageWithCustomMarker:"{PH1} (custom)",storageTitle:"Storage",usage:"Usage",mb:"MB",learnMore:"Learn more",clearSiteData:"Clear site data",application:"Application",unregisterServiceWorker:"Unregister service workers",localAndSessionStorage:"Local and session storage",indexDB:"IndexedDB",webSql:"Web SQL",cookies:"Cookies",cache:"Cache",cacheStorage:"Cache storage",includingThirdPartyCookies:"including third-party cookies",sFailedToLoad:"{PH1} (failed to load)",internalError:"Internal error",pleaseEnterANumber:"Please enter a number",numberMustBeNonNegative:"Number must be non-negative",clearing:"Clearing...",storageQuotaIsLimitedIn:"Storage quota is limited in Incognito mode",fileSystem:"File System",other:"Other",storageUsage:"Storage usage",serviceWorkers:"Service Workers",simulateCustomStorage:"Simulate custom storage quota"},Mt=i.i18n.registerUIStrings("panels/application/StorageView.ts",Rt),Pt=i.i18n.getLocalizedString.bind(void 0,Mt);class Lt extends o.ThrottledWidget.ThrottledWidget{pieColors;reportView;target;securityOrigin;settings;includeThirdPartyCookiesSetting;quotaRow;quotaUsage;pieChart;previousOverrideFieldValue;quotaOverrideCheckbox;quotaOverrideControlRow;quotaOverrideEditor;quotaOverrideErrorMessage;clearButton;constructor(){super(!0,1e3),this.contentElement.classList.add("clear-storage-container"),this.pieColors=new Map([["appcache","rgb(110, 161, 226)"],["cache_storage","rgb(229, 113, 113)"],["cookies","rgb(239, 196, 87)"],["indexeddb","rgb(155, 127, 230)"],["local_storage","rgb(116, 178, 102)"],["service_workers","rgb(255, 167, 36)"],["websql","rgb(203, 220, 56)"]]),this.reportView=new o.ReportView.ReportView(Pt(Rt.storageTitle)),this.reportView.element.classList.add("clear-storage-header"),this.reportView.show(this.contentElement),this.target=null,this.securityOrigin=null,this.settings=new Map;for(const t of Dt)this.settings.set(t,e.Settings.Settings.instance().createSetting("clear-storage-"+t,!0));this.includeThirdPartyCookiesSetting=e.Settings.Settings.instance().createSetting("clear-storage-include-third-party-cookies",!1);const t=this.reportView.appendSection(Pt(Rt.usage));this.quotaRow=t.appendSelectableRow(),this.quotaRow.classList.add("quota-usage-row");const i=t.appendRow(),r=o.XLink.XLink.create("https://developer.chrome.com/docs/devtools/progressive-web-apps#opaque-responses",Pt(Rt.learnMore));i.appendChild(r),this.quotaUsage=null,this.pieChart=new y.PieChart.PieChart,this.populatePieChart(0,[]);const s=t.appendRow();s.classList.add("usage-breakdown-row"),s.appendChild(this.pieChart),this.previousOverrideFieldValue="";const n=t.appendRow();this.quotaOverrideCheckbox=o.UIUtils.CheckboxLabel.create(Pt(Rt.simulateCustomStorage),!1,""),n.appendChild(this.quotaOverrideCheckbox),this.quotaOverrideCheckbox.checkboxElement.addEventListener("click",this.onClickCheckbox.bind(this),!1),this.quotaOverrideControlRow=t.appendRow(),this.quotaOverrideEditor=this.quotaOverrideControlRow.createChild("input","quota-override-notification-editor"),this.quotaOverrideControlRow.appendChild(o.UIUtils.createLabel(Pt(Rt.mb))),this.quotaOverrideControlRow.classList.add("hidden"),this.quotaOverrideEditor.addEventListener("keyup",(e=>{"Enter"===e.key&&(this.applyQuotaOverrideFromInputField(),e.consume(!0))})),this.quotaOverrideEditor.addEventListener("focusout",(e=>{this.applyQuotaOverrideFromInputField(),e.consume(!0)}));const d=t.appendRow();this.quotaOverrideErrorMessage=d.createChild("div","quota-override-error");const c=this.reportView.appendSection("","clear-storage-button").appendRow();this.clearButton=o.UIUtils.createTextButton(Pt(Rt.clearSiteData),this.clear.bind(this)),this.clearButton.id="storage-view-clear-button",c.appendChild(this.clearButton);const l=o.SettingsUI.createSettingCheckbox(Pt(Rt.includingThirdPartyCookies),this.includeThirdPartyCookiesSetting,!0);if(l.classList.add("include-third-party-cookies"),c.appendChild(l),(!globalThis).chii){const e=this.reportView.appendSection(Pt(Rt.application));this.appendItem(e,Pt(Rt.unregisterServiceWorker),"service_workers"),e.markFieldListAsGroup()}const h=this.reportView.appendSection(Pt(Rt.storageTitle));if(this.appendItem(h,Pt(Rt.localAndSessionStorage),"local_storage"),globalThis.chii||(this.appendItem(h,Pt(Rt.indexDB),"indexeddb"),this.appendItem(h,Pt(Rt.webSql),"websql")),this.appendItem(h,Pt(Rt.cookies),"cookies"),h.markFieldListAsGroup(),!globalThis.chii){const e=this.reportView.appendSection(Pt(Rt.cache));this.appendItem(e,Pt(Rt.cacheStorage),"cache_storage"),e.markFieldListAsGroup()}a.TargetManager.TargetManager.instance().observeTargets(this)}appendItem(e,t,i){const r=e.appendRow(),s=this.settings.get(i);s&&r.appendChild(o.SettingsUI.createSettingCheckbox(t,s,!0))}targetAdded(e){if(this.target)return;this.target=e;const t=e.model(a.SecurityOriginManager.SecurityOriginManager);this.updateOrigin(t.mainSecurityOrigin(),t.unreachableMainSecurityOrigin()),t.addEventListener(a.SecurityOriginManager.Events.MainSecurityOriginChanged,this.originChanged,this)}targetRemoved(e){if(this.target!==e)return;e.model(a.SecurityOriginManager.SecurityOriginManager).removeEventListener(a.SecurityOriginManager.Events.MainSecurityOriginChanged,this.originChanged,this)}originChanged(e){const{mainSecurityOrigin:t,unreachableMainSecurityOrigin:i}=e.data;this.updateOrigin(t,i)}updateOrigin(e,t){const i=this.securityOrigin;t?(this.securityOrigin=t,this.reportView.setSubtitle(Pt(Rt.sFailedToLoad,{PH1:t}))):(this.securityOrigin=e,this.reportView.setSubtitle(e)),i!==this.securityOrigin&&(this.quotaOverrideControlRow.classList.add("hidden"),this.quotaOverrideCheckbox.checkboxElement.checked=!1,this.quotaOverrideErrorMessage.textContent=""),this.doUpdate()}async applyQuotaOverrideFromInputField(){if(!this.target||!this.securityOrigin)return void(this.quotaOverrideErrorMessage.textContent=Pt(Rt.internalError));this.quotaOverrideErrorMessage.textContent="";const e=this.quotaOverrideEditor.value;if(""===e)return await this.clearQuotaForOrigin(this.target,this.securityOrigin),void(this.previousOverrideFieldValue="");const t=parseFloat(e);if(!Number.isFinite(t))return void(this.quotaOverrideErrorMessage.textContent=Pt(Rt.pleaseEnterANumber));if(t<0)return void(this.quotaOverrideErrorMessage.textContent=Pt(Rt.numberMustBeNonNegative));const i=1e6,r=Math.round(t*i),s=""+r/i;this.quotaOverrideEditor.value=s,this.previousOverrideFieldValue=s,await this.target.storageAgent().invoke_overrideQuotaForOrigin({origin:this.securityOrigin,quotaSize:r})}async clearQuotaForOrigin(e,t){await e.storageAgent().invoke_overrideQuotaForOrigin({origin:t})}async onClickCheckbox(){this.quotaOverrideControlRow.classList.contains("hidden")?(this.quotaOverrideControlRow.classList.remove("hidden"),this.quotaOverrideCheckbox.checkboxElement.checked=!0,this.quotaOverrideEditor.value=this.previousOverrideFieldValue,this.quotaOverrideEditor.focus()):this.target&&this.securityOrigin&&(this.quotaOverrideControlRow.classList.add("hidden"),this.quotaOverrideCheckbox.checkboxElement.checked=!1,await this.clearQuotaForOrigin(this.target,this.securityOrigin),this.quotaOverrideErrorMessage.textContent="")}clear(){if(!this.securityOrigin)return;const e=[];for(const t of this.settings.keys()){const i=this.settings.get(t);i&&i.get()&&e.push(t)}if(this.target){const t=this.includeThirdPartyCookiesSetting.get();Lt.clear(this.target,this.securityOrigin,e,t)}this.clearButton.disabled=!0;const t=this.clearButton.textContent;this.clearButton.textContent=Pt(Rt.clearing),setTimeout((()=>{this.clearButton.disabled=!1,this.clearButton.textContent=t,this.clearButton.focus()}),500)}static clear(e,t,i,r){e.storageAgent().invoke_clearDataForOrigin({origin:t,storageTypes:i.join(",")});const s=new Set(i),n=s.has("all");if(s.has("cookies")||n){const i=e.model(a.CookieModel.CookieModel);i&&i.clear(void 0,r?void 0:t)}if(s.has("indexeddb")||n)for(const e of a.TargetManager.TargetManager.instance().targets()){const i=e.model(je);i&&i.clearForOrigin(t)}if(s.has("local_storage")||n){const i=e.model(Ue);i&&i.clearForOrigin(t)}if(s.has("websql")||n){const t=e.model(ye);t&&(t.disable(),t.enable())}if(s.has("cache_storage")||n){const e=a.TargetManager.TargetManager.instance().mainTarget(),i=e&&e.model(a.ServiceWorkerCacheModel.ServiceWorkerCacheModel);i&&i.clearForOrigin(t)}}async doUpdate(){if(!this.securityOrigin||!this.target)return this.quotaRow.textContent="",void this.populatePieChart(0,[]);const e=this.securityOrigin,t=await this.target.storageAgent().invoke_getUsageAndQuota({origin:e});if(this.quotaRow.textContent="",t.getError())return void this.populatePieChart(0,[]);const s=t.overrideActive,a=r.NumberUtilities.bytesToString(t.quota),n=r.NumberUtilities.bytesToString(t.usage),d=Pt(Rt.storageWithCustomMarker,{PH1:a}),c=s?o.Fragment.Fragment.build`<b>${d}</b>`.element():a,l=i.i18n.getFormatLocalizedString(Mt,Rt.storageQuotaUsed,{PH1:n,PH2:c});if(this.quotaRow.appendChild(l),o.Tooltip.Tooltip.install(this.quotaRow,Pt(Rt.storageQuotaUsedWithBytes,{PH1:t.usage.toLocaleString(),PH2:t.quota.toLocaleString()})),!t.overrideActive&&t.quota<125829120&&(o.Tooltip.Tooltip.install(this.quotaRow,Pt(Rt.storageQuotaIsLimitedIn)),this.quotaRow.appendChild(o.Icon.Icon.create("smallicon-info"))),null===this.quotaUsage||this.quotaUsage!==t.usage){this.quotaUsage=t.usage;const e=[];for(const i of t.usageBreakdown.sort(((e,t)=>t.usage-e.usage))){const t=i.usage;if(!t)continue;const r=this.getStorageTypeName(i.storageType),s=this.pieColors.get(i.storageType)||"#ccc";e.push({value:t,color:s,title:r})}this.populatePieChart(t.usage,e)}this.update()}populatePieChart(e,t){this.pieChart.data={chartName:Pt(Rt.storageUsage),size:110,formatter:r.NumberUtilities.bytesToString,showLegend:!0,total:e,slices:t}}getStorageTypeName(e){switch(e){case"file_systems":return Pt(Rt.fileSystem);case"websql":return Pt(Rt.webSql);case"appcache":return Pt(Rt.application);case"indexeddb":return Pt(Rt.indexDB);case"cache_storage":return Pt(Rt.cacheStorage);case"service_workers":return Pt(Rt.serviceWorkers);default:return Pt(Rt.other)}}wasShown(){super.wasShown(),this.reportView.registerCSSFiles([xt]),this.registerCSSFiles([xt])}}const Dt=["appcache","cache_storage","cookies","indexeddb","local_storage","service_workers","websql"];let Ft;class Ot{static instance(e={forceNew:null}){const{forceNew:t}=e;return Ft&&!t||(Ft=new Ot),Ft}handleAction(e,t){switch(t){case"resources.clear":return this.handleClear(!1);case"resources.clear-incl-third-party-cookies":return this.handleClear(!0)}return!1}handleClear(e){const t=a.TargetManager.TargetManager.instance().mainTarget();if(!t)return!1;const i=t.model(a.ResourceTreeModel.ResourceTreeModel);if(!i)return!1;const r=i.getMainSecurityOrigin();return!!r&&(Lt.clear(t,r,Dt,e),!0)}}var Bt=Object.freeze({__proto__:null,StorageView:Lt,AllStorageTypes:Dt,ActionDelegate:Ot});const Nt={trustTokens:"Trust Tokens"},Wt=i.i18n.registerUIStrings("panels/application/TrustTokensTreeElement.ts",Nt),Vt=i.i18n.getLocalizedString.bind(void 0,Wt);class At extends E{view;constructor(e){super(e,Vt(Nt.trustTokens),!1);const t=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"trustTokens://"}onselect(e){return super.onselect(e),this.view||(this.view=new Ut),this.showView(this.view),!1}}class Ut extends o.ThrottledWidget.ThrottledWidget{trustTokensView=new b.TrustTokensView.TrustTokensView;constructor(){super(!1,1e3),this.contentElement.appendChild(this.trustTokensView),this.update()}async doUpdate(){const e=a.TargetManager.TargetManager.instance().mainTarget();if(!e)return;const{tokens:t}=await e.storageAgent().invoke_getTrustTokens();this.trustTokensView.data={tokens:t,deleteClickHandler:t=>{e.storageAgent().invoke_clearTrustTokens({issuerOrigin:t})}},this.update()}}const Ht=new CSSStyleSheet;Ht.replaceSync(".placeholder{display:flex;align-items:center;justify-content:center;font-size:13px;color:var(--color-text-secondary)}\n/*# sourceURL=reportingApiReportsView.css */\n");const qt={clickToDisplayBody:"Click on any report to display its body"},_t=i.i18n.registerUIStrings("panels/application/ReportingApiReportsView.ts",qt),jt=i.i18n.getLocalizedString.bind(void 0,_t);class zt extends o.SplitWidget.SplitWidget{reportsGrid=new b.ReportsGrid.ReportsGrid;reports=[];constructor(e){super(!1,!0);const t=new o.Widget.VBox,i=new o.Widget.VBox;t.setMinimumSize(0,80),this.setMainWidget(t),i.setMinimumSize(0,40),this.setSidebarWidget(i),t.contentElement.appendChild(this.reportsGrid),this.reportsGrid.addEventListener("cellfocused",this.onFocus.bind(this)),i.contentElement.classList.add("placeholder");i.contentElement.createChild("div").textContent=jt(qt.clickToDisplayBody),e.addEventListener(a.NetworkManager.Events.ReportingApiReportAdded,(e=>this.onReportAdded(e.data)),this),e.addEventListener(a.NetworkManager.Events.ReportingApiReportUpdated,(e=>this.onReportUpdated(e.data)),this)}wasShown(){super.wasShown();const e=this.sidebarWidget();e&&e.registerCSSFiles([Ht])}onReportAdded(e){this.reports.push(e),this.reportsGrid.data={reports:this.reports}}onReportUpdated(e){const t=this.reports.findIndex((t=>t.id===e.id));this.reports[t]=e,this.reportsGrid.data={reports:this.reports}}async onFocus(e){const t=e.data.row.cells.find((e=>"id"===e.columnId)),i=t&&this.reports.find((e=>e.id===t.value));if(i){const e=await n.JSONView.JSONView.createView(JSON.stringify(i.body));e?.setMinimumSize(0,40),e&&this.setSidebarWidget(e)}}getReports(){return this.reports}getReportsGrid(){return this.reportsGrid}}var Gt=Object.freeze({__proto__:null,i18nString:jt,ReportingApiReportsView:zt});class Kt extends o.SplitWidget.SplitWidget{endpointsGrid=new b.EndpointsGrid.EndpointsGrid;endpoints;constructor(){super(!1,!0),this.endpoints=new Map;const e=a.TargetManager.TargetManager.instance().mainTarget(),t=e&&e.model(a.NetworkManager.NetworkManager);if(t){t.addEventListener(a.NetworkManager.Events.ReportingApiEndpointsChangedForOrigin,(e=>this.onEndpointsChangedForOrigin(e.data)),this);const e=new zt(t),i=new o.Widget.VBox;i.setMinimumSize(0,40),i.contentElement.appendChild(this.endpointsGrid),this.setMainWidget(e),this.setSidebarWidget(i),t.enableReportingApi()}}onEndpointsChangedForOrigin(e){this.endpoints.set(e.origin,e.endpoints),this.endpointsGrid.data={endpoints:this.endpoints}}}const $t={reportingApi:"Reporting API"},Qt=i.i18n.registerUIStrings("panels/application/ReportingApiTreeElement.ts",$t),Xt=i.i18n.getLocalizedString.bind(void 0,Qt);class Jt extends E{view;constructor(e){super(e,Xt($t.reportingApi),!1);const t=o.Icon.Icon.create("mediumicon-manifest","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"reportingApi://"}onselect(e){return super.onselect(e),this.view||(this.view=new Kt),this.showView(this.view),!1}}const Yt={application:"Application",storage:"Storage",localStorage:"Local Storage",sessionStorage:"Session Storage",webSql:"Web SQL",cookies:"Cookies",cache:"Cache",backgroundServices:"Background Services",frames:"Frames",manifest:"Manifest",indexeddb:"IndexedDB",refreshIndexeddb:"Refresh IndexedDB",versionSEmpty:"Version: {PH1} (empty)",versionS:"Version: {PH1}",clear:"Clear",keyPathS:"Key path: {PH1}",localFiles:"Local Files",cookiesUsedByFramesFromS:"Cookies used by frames from {PH1}",openedWindows:"Opened Windows",webWorkers:"Web Workers",documentNotAvailable:"Document not available",theContentOfThisDocumentHasBeen:"The content of this document has been generated dynamically via 'document.write()'.",windowWithoutTitle:"Window without title",worker:"worker"},Zt=i.i18n.registerUIStrings("panels/application/ApplicationPanelSidebar.ts",Yt),ei=i.i18n.getLocalizedString.bind(void 0,Zt);function ti(e){if("main"===e)throw new Error("Unexpected main target id")}class ii extends o.Widget.VBox{panel;sidebarTree;applicationTreeElement;serviceWorkersTreeElement;localStorageListTreeElement;sessionStorageListTreeElement;indexedDBListTreeElement;databasesListTreeElement;cookieListTreeElement;trustTokensTreeElement;cacheStorageListTreeElement;backForwardCacheListTreeElement;backgroundFetchTreeElement;backgroundSyncTreeElement;notificationsTreeElement;paymentHandlerTreeElement;periodicBackgroundSyncTreeElement;pushMessagingTreeElement;reportingApiTreeElement;resourcesSection;databaseTableViews;databaseQueryViews;databaseTreeElements;domStorageTreeElements;domains;target;databaseModel;previousHoveredElement;constructor(e){super(),this.panel=e,this.sidebarTree=new o.TreeOutline.TreeOutlineInShadow,this.sidebarTree.element.classList.add("resources-sidebar"),this.sidebarTree.element.classList.add("filter-all"),this.sidebarTree.addEventListener(o.TreeOutline.Events.ElementAttached,this.treeElementAdded,this),this.contentElement.appendChild(this.sidebarTree.element);const t=ei(Yt.application);this.applicationTreeElement=this.addSidebarSection(t);const i=new oi(e);this.applicationTreeElement.appendChild(i),this.serviceWorkersTreeElement=new ni(e),globalThis.chii||this.applicationTreeElement.appendChild(this.serviceWorkersTreeElement);const r=new di(e);this.applicationTreeElement.appendChild(r);const n=ei(Yt.storage),d=this.addSidebarSection(n);this.localStorageListTreeElement=new x(e,ei(Yt.localStorage),"LocalStorage"),this.localStorageListTreeElement.setLink("https://developer.chrome.com/docs/devtools/storage/localstorage/?utm_source=devtools");const c=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.localStorageListTreeElement.setLeadingIcons([c]),d.appendChild(this.localStorageListTreeElement),this.sessionStorageListTreeElement=new x(e,ei(Yt.sessionStorage),"SessionStorage"),this.sessionStorageListTreeElement.setLink("https://developer.chrome.com/docs/devtools/storage/sessionstorage/?utm_source=devtools");const l=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.sessionStorageListTreeElement.setLeadingIcons([l]),d.appendChild(this.sessionStorageListTreeElement),this.indexedDBListTreeElement=new ci(e),this.indexedDBListTreeElement.setLink("https://developer.chrome.com/docs/devtools/storage/indexeddb/?utm_source=devtools"),globalThis.chii||d.appendChild(this.indexedDBListTreeElement),this.databasesListTreeElement=new x(e,ei(Yt.webSql),"Databases"),this.databasesListTreeElement.setLink("https://developer.chrome.com/docs/devtools/storage/websql/?utm_source=devtools");const h=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.databasesListTreeElement.setLeadingIcons([h]),globalThis.chii||d.appendChild(this.databasesListTreeElement),this.cookieListTreeElement=new x(e,ei(Yt.cookies),"Cookies"),this.cookieListTreeElement.setLink("https://developer.chrome.com/docs/devtools/storage/cookies/?utm_source=devtools");const u=o.Icon.Icon.create("mediumicon-cookie","resource-tree-item");this.cookieListTreeElement.setLeadingIcons([u]),d.appendChild(this.cookieListTreeElement),this.trustTokensTreeElement=new At(e),globalThis.chii||d.appendChild(this.trustTokensTreeElement);const g=ei(Yt.cache),p=this.addSidebarSection(g);if(globalThis.chii&&this.sidebarTree.removeChild(p),this.cacheStorageListTreeElement=new Q(e),p.appendChild(this.cacheStorageListTreeElement),this.backForwardCacheListTreeElement=new J(e),p.appendChild(this.backForwardCacheListTreeElement),!globalThis.chii&&s.Runtime.experiments.isEnabled("backgroundServices")){const t=ei(Yt.backgroundServices),i=this.addSidebarSection(t);this.backgroundFetchTreeElement=new ri(e,"backgroundFetch"),i.appendChild(this.backgroundFetchTreeElement),this.backgroundSyncTreeElement=new ri(e,"backgroundSync"),i.appendChild(this.backgroundSyncTreeElement),s.Runtime.experiments.isEnabled("backgroundServicesNotifications")&&(this.notificationsTreeElement=new ri(e,"notifications"),i.appendChild(this.notificationsTreeElement)),s.Runtime.experiments.isEnabled("backgroundServicesPaymentHandler")&&(this.paymentHandlerTreeElement=new ri(e,"paymentHandler"),i.appendChild(this.paymentHandlerTreeElement)),this.periodicBackgroundSyncTreeElement=new ri(e,"periodicBackgroundSync"),i.appendChild(this.periodicBackgroundSyncTreeElement),s.Runtime.experiments.isEnabled("backgroundServicesPushMessaging")&&(this.pushMessagingTreeElement=new ri(e,"pushMessaging"),i.appendChild(this.pushMessagingTreeElement)),s.Runtime.experiments.isEnabled("reportingApiDebugging")&&(this.reportingApiTreeElement=new Jt(e),i.appendChild(this.reportingApiTreeElement))}const m=ei(Yt.frames),w=this.addSidebarSection(m);this.resourcesSection=new wi(e,w),this.databaseTableViews=new Map,this.databaseQueryViews=new Map,this.databaseTreeElements=new Map,this.domStorageTreeElements=new Map,this.domains={},this.sidebarTree.contentElement.addEventListener("mousemove",this.onmousemove.bind(this),!1),this.sidebarTree.contentElement.addEventListener("mouseleave",this.onmouseleave.bind(this),!1),a.TargetManager.TargetManager.instance().observeTargets(this),a.TargetManager.TargetManager.instance().addModelListener(a.ResourceTreeModel.ResourceTreeModel,a.ResourceTreeModel.Events.FrameNavigated,this.frameNavigated,this);this.panel.lastSelectedItemPath().length||i.select(),a.TargetManager.TargetManager.instance().observeModels(Ue,{modelAdded:e=>this.domStorageModelAdded(e),modelRemoved:e=>this.domStorageModelRemoved(e)}),a.TargetManager.TargetManager.instance().observeModels(je,{modelAdded:e=>e.enable(),modelRemoved:e=>this.indexedDBListTreeElement.removeIndexedDBForModel(e)}),this.contentElement.style.contain="layout style"}addSidebarSection(e){const t=new o.TreeOutline.TreeElement(e,!0);return t.listItemElement.classList.add("storage-group-list-item"),t.setCollapsible(!1),t.selectable=!1,this.sidebarTree.appendChild(t),o.ARIAUtils.setAccessibleName(t.childrenListElement,e),t}targetAdded(e){if(this.target)return;this.target=e,this.databaseModel=e.model(ye),this.databaseModel&&(this.databaseModel.addEventListener(Ce.DatabaseAdded,this.databaseAdded,this),this.databaseModel.addEventListener(Ce.DatabasesRemoved,this.resetWebSQL,this));const t=e.model(a.ResourceTreeModel.ResourceTreeModel);t&&(t.cachedResourcesLoaded()&&this.initialize(),t.addEventListener(a.ResourceTreeModel.Events.CachedResourcesLoaded,this.initialize,this),t.addEventListener(a.ResourceTreeModel.Events.WillLoadCachedResources,this.resetWithFrames,this))}targetRemoved(e){if(e!==this.target)return;delete this.target;const t=e.model(a.ResourceTreeModel.ResourceTreeModel);t&&(t.removeEventListener(a.ResourceTreeModel.Events.CachedResourcesLoaded,this.initialize,this),t.removeEventListener(a.ResourceTreeModel.Events.WillLoadCachedResources,this.resetWithFrames,this)),this.databaseModel&&(this.databaseModel.removeEventListener(Ce.DatabaseAdded,this.databaseAdded,this),this.databaseModel.removeEventListener(Ce.DatabasesRemoved,this.resetWebSQL,this),this.databaseModel=null),this.resetWithFrames()}focus(){this.sidebarTree.focus()}initialize(){for(const e of a.ResourceTreeModel.ResourceTreeModel.frames())this.addCookieDocument(e);this.databaseModel&&this.databaseModel.enable();const e=this.target&&this.target.model(a.ServiceWorkerCacheModel.ServiceWorkerCacheModel);if(e&&e.enable(),globalThis.chii)return;const t=this.target&&this.target.model(a.ServiceWorkerCacheModel.ServiceWorkerCacheModel)||null;this.cacheStorageListTreeElement.initialize(t);const i=this.target&&this.target.model(ae)||null;s.Runtime.experiments.isEnabled("backgroundServices")&&(this.backgroundFetchTreeElement&&this.backgroundFetchTreeElement.initialize(i),this.backgroundSyncTreeElement&&this.backgroundSyncTreeElement.initialize(i),s.Runtime.experiments.isEnabled("backgroundServicesNotifications")&&this.notificationsTreeElement&&this.notificationsTreeElement.initialize(i),s.Runtime.experiments.isEnabled("backgroundServicesPaymentHandler")&&this.paymentHandlerTreeElement&&this.paymentHandlerTreeElement.initialize(i),this.periodicBackgroundSyncTreeElement&&this.periodicBackgroundSyncTreeElement.initialize(i),s.Runtime.experiments.isEnabled("backgroundServicesPushMessaging")&&this.pushMessagingTreeElement&&this.pushMessagingTreeElement.initialize(i))}domStorageModelAdded(e){e.enable(),e.storages().forEach(this.addDOMStorage.bind(this)),e.addEventListener(We.DOMStorageAdded,this.domStorageAdded,this),e.addEventListener(We.DOMStorageRemoved,this.domStorageRemoved,this)}domStorageModelRemoved(e){e.storages().forEach(this.removeDOMStorage.bind(this)),e.removeEventListener(We.DOMStorageAdded,this.domStorageAdded,this),e.removeEventListener(We.DOMStorageRemoved,this.domStorageRemoved,this)}resetWithFrames(){this.resourcesSection.reset(),this.reset()}resetWebSQL(){if(!globalThis.chii){for(const e of this.databaseQueryViews.values())e.removeEventListener(Pe.SchemaUpdated,(e=>{this.updateDatabaseTables(e)}),this);this.databaseTableViews.clear(),this.databaseQueryViews.clear(),this.databaseTreeElements.clear(),this.databasesListTreeElement.removeChildren(),this.databasesListTreeElement.setExpandable(!1)}}treeElementAdded(e){const t=this.panel.lastSelectedItemPath();if(!t.length)return;const i=e.data,r=[i];for(let e=i.parent;e&&"itemURL"in e&&e.itemURL;e=e.parent)r.push(e);let s=t.length-1,a=r.length-1;for(;s>=0&&a>=0&&t[s]===r[a].itemURL;)r[a].expanded||(s>0&&r[a].expand(),r[a].selected||r[a].select()),s--,a--}reset(){this.domains={},this.resetWebSQL(),this.cookieListTreeElement.removeChildren()}frameNavigated(e){const t=e.data;t.isTopFrame()&&this.reset(),this.addCookieDocument(t)}databaseAdded({data:e}){const t=new si(this,e);this.databaseTreeElements.set(e,t),this.databasesListTreeElement.appendChild(t)}addCookieDocument(t){const i=t.unreachableUrl()||t.url,r=e.ParsedURL.ParsedURL.fromString(i);if(!r||"http"!==r.scheme&&"https"!==r.scheme&&"file"!==r.scheme)return;const s=r.securityOrigin();if(!this.domains[s]){this.domains[s]=!0;const e=new pi(this.panel,t,s);this.cookieListTreeElement.appendChild(e)}}domStorageAdded(e){const t=e.data;this.addDOMStorage(t)}addDOMStorage(e){console.assert(!this.domStorageTreeElements.get(e));const t=new gi(this.panel,e);this.domStorageTreeElements.set(e,t),e.isLocalStorage?this.localStorageListTreeElement.appendChild(t):this.sessionStorageListTreeElement.appendChild(t)}domStorageRemoved(e){const t=e.data;this.removeDOMStorage(t)}removeDOMStorage(e){const t=this.domStorageTreeElements.get(e);if(!t)return;const i=t.selected,r=t.parent;r&&(r.removeChild(t),i&&r.select()),this.domStorageTreeElements.delete(e)}selectDatabase(e){if(e){this.showDatabase(e);const t=this.databaseTreeElements.get(e);t&&t.select()}}async showResource(e,t,i){await this.resourcesSection.revealResource(e,t,i)}showFrame(e){this.resourcesSection.revealAndSelectFrame(e)}showDatabase(e,t){if(!e)return;let i;if(t){let r=this.databaseTableViews.get(e);r||(r={},this.databaseTableViews.set(e,r)),i=r[t],i||(i=new Ne(e,t),r[t]=i)}else i=this.databaseQueryViews.get(e),i||(i=new Me(e),this.databaseQueryViews.set(e,i),i.addEventListener(Pe.SchemaUpdated,(e=>{this.updateDatabaseTables(e)}),this));this.innerShowView(i)}showFileSystem(e){this.innerShowView(e)}innerShowView(e){this.panel.showView(e)}async updateDatabaseTables(e){const t=e.data;if(!t)return;const i=this.databaseTreeElements.get(t);if(!i)return;i.invalidateChildren();const r=this.databaseTableViews.get(t);if(!r)return;const s=new Set,a=this.panel,n=await t.tableNames();for(const e of n)s.add(e);for(const e in r)s.has(e)||(a.visibleView===r[e]&&a.showView(null),delete r[e]);await i.updateChildren()}onmousemove(e){const t=e.target;if(!t)return;const i=o.UIUtils.enclosingNodeOrSelfWithNodeName(t,"li");if(!i)return;const r=o.TreeOutline.TreeElement.getTreeElementBylistItemNode(i);this.previousHoveredElement!==r&&(this.previousHoveredElement&&(this.previousHoveredElement.hovered=!1,delete this.previousHoveredElement),r instanceof bi&&(this.previousHoveredElement=r,r.hovered=!0))}onmouseleave(e){this.previousHoveredElement&&(this.previousHoveredElement.hovered=!1,delete this.previousHoveredElement)}wasShown(){super.wasShown(),this.sidebarTree.registerCSSFiles([be])}}class ri extends E{serviceName;view;model;selectedInternal;constructor(e,t){super(e,ue.getUIString(t),!1),this.serviceName=t,this.selectedInternal=!1,this.view=null,this.model=null;const i=o.Icon.Icon.create(this.getIconType(),"resource-tree-item");this.setLeadingIcons([i])}getIconType(){switch(this.serviceName){case"backgroundFetch":return"mediumicon-fetch";case"backgroundSync":return"mediumicon-sync";case"pushMessaging":return"mediumicon-cloud";case"notifications":return"mediumicon-bell";case"paymentHandler":return"mediumicon-payment";case"periodicBackgroundSync":return"mediumicon-schedule";default:return console.error(`Service ${this.serviceName} does not have a dedicated icon`),"mediumicon-table"}}initialize(e){this.model=e,this.selectedInternal&&!this.view&&this.onselect(!1)}get itemURL(){return`background-service://${this.serviceName}`}onselect(e){return super.onselect(e),this.selectedInternal=!0,!!this.model&&(this.view||(this.view=new ue(this.serviceName,this.model)),this.showView(this.view),o.Context.Context.instance().setFlavor(ue,this.view),!1)}}class si extends E{sidebar;database;constructor(e,t){super(e.panel,t.name,!0),this.sidebar=e,this.database=t;const i=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([i])}get itemURL(){return"database://"+encodeURI(this.database.name)}onselect(e){return super.onselect(e),this.sidebar.showDatabase(this.database),!1}onexpand(){this.updateChildren()}async updateChildren(){this.removeChildren();const e=await this.database.tableNames();for(const t of e)this.appendChild(new ai(this.sidebar,this.database,t))}}class ai extends E{sidebar;database;tableName;constructor(e,t,i){super(e.panel,i,!1),this.sidebar=e,this.database=t,this.tableName=i;const r=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.setLeadingIcons([r])}get itemURL(){return"database://"+encodeURI(this.database.name)+"/"+encodeURI(this.tableName)}onselect(e){return super.onselect(e),this.sidebar.showDatabase(this.database,this.tableName),!1}}class ni extends E{view;constructor(e){super(e,i.i18n.lockedString("Service Workers"),!1);const t=o.Icon.Icon.create("mediumicon-service-worker","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"service-workers://"}onselect(e){return super.onselect(e),this.view||(this.view=new Tt),this.showView(this.view),!1}}class oi extends E{view;constructor(e){super(e,ei(Yt.manifest),!1);const t=o.Icon.Icon.create("mediumicon-manifest","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"manifest://"}onselect(e){return super.onselect(e),this.view||(this.view=new ie),this.showView(this.view),!1}}class di extends E{view;constructor(e){super(e,ei(Yt.storage),!1);const t=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([t])}get itemURL(){return"clear-storage://"}onselect(e){return super.onselect(e),this.view||(this.view=new Lt),this.showView(this.view),!1}}class ci extends x{idbDatabaseTreeElements;constructor(e){super(e,ei(Yt.indexeddb),"IndexedDB");const t=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([t]),this.idbDatabaseTreeElements=[],this.initialize()}initialize(){a.TargetManager.TargetManager.instance().addModelListener(je,qe.DatabaseAdded,this.indexedDBAdded,this),a.TargetManager.TargetManager.instance().addModelListener(je,qe.DatabaseRemoved,this.indexedDBRemoved,this),a.TargetManager.TargetManager.instance().addModelListener(je,qe.DatabaseLoaded,this.indexedDBLoaded,this),a.TargetManager.TargetManager.instance().addModelListener(je,qe.IndexedDBContentUpdated,this.indexedDBContentUpdated,this),this.idbDatabaseTreeElements=[];for(const e of a.TargetManager.TargetManager.instance().models(je)){const t=e.databases();for(let i=0;i<t.length;++i)this.addIndexedDB(e,t[i])}}removeIndexedDBForModel(e){const t=this.idbDatabaseTreeElements.filter((t=>t.model===e));for(const e of t)this.removeIDBDatabaseTreeElement(e)}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(ei(Yt.refreshIndexeddb),this.refreshIndexedDB.bind(this)),t.show()}refreshIndexedDB(){for(const e of a.TargetManager.TargetManager.instance().models(je))e.refreshDatabaseNames()}indexedDBAdded({data:{databaseId:e,model:t}}){this.addIndexedDB(t,e)}addIndexedDB(e,t){const i=new li(this.resourcesPanel,e,t);this.idbDatabaseTreeElements.push(i),this.appendChild(i),e.refreshDatabase(t)}indexedDBRemoved({data:{databaseId:e,model:t}}){const i=this.idbDatabaseTreeElement(t,e);i&&this.removeIDBDatabaseTreeElement(i)}removeIDBDatabaseTreeElement(e){e.clear(),this.removeChild(e),r.ArrayUtilities.removeElement(this.idbDatabaseTreeElements,e),this.setExpandable(this.childCount()>0)}indexedDBLoaded({data:{database:e,model:t,entriesUpdated:i}}){const r=this.idbDatabaseTreeElement(t,e.databaseId);r&&(r.update(e,i),this.indexedDBLoadedForTest())}indexedDBLoadedForTest(){}indexedDBContentUpdated({data:{databaseId:e,objectStoreName:t,model:i}}){const r=this.idbDatabaseTreeElement(i,e);r&&r.indexedDBContentUpdated(t)}idbDatabaseTreeElement(e,t){return this.idbDatabaseTreeElements.find((i=>i.databaseId.equals(t)&&i.model===e))||null}}class li extends E{model;databaseId;idbObjectStoreTreeElements;database;view;constructor(e,t,i){super(e,i.name+" - "+i.securityOrigin,!1),this.model=t,this.databaseId=i,this.idbObjectStoreTreeElements=new Map;const r=o.Icon.Icon.create("mediumicon-database","resource-tree-item");this.setLeadingIcons([r]),this.model.addEventListener(qe.DatabaseNamesRefreshed,this.refreshIndexedDB,this)}get itemURL(){return"indexedDB://"+this.databaseId.securityOrigin+"/"+this.databaseId.name}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(ei(Yt.refreshIndexeddb),this.refreshIndexedDB.bind(this)),t.show()}refreshIndexedDB(){this.model.refreshDatabase(this.databaseId)}indexedDBContentUpdated(e){const t=this.idbObjectStoreTreeElements.get(e);t&&t.markNeedsRefresh()}update(e,t){this.database=e;const i=new Set;for(const e of[...this.database.objectStores.keys()].sort()){const r=this.database.objectStores.get(e);if(!r)continue;i.add(r.name);let s=this.idbObjectStoreTreeElements.get(r.name);s||(s=new hi(this.resourcesPanel,this.model,this.databaseId,r),this.idbObjectStoreTreeElements.set(r.name,s),this.appendChild(s)),s.update(r,t)}for(const e of this.idbObjectStoreTreeElements.keys())i.has(e)||this.objectStoreRemoved(e);this.view&&this.view.update(e),this.updateTooltip()}updateTooltip(){const e=this.database?this.database.version:"-";0===Object.keys(this.idbObjectStoreTreeElements).length?this.tooltip=ei(Yt.versionSEmpty,{PH1:e}):this.tooltip=ei(Yt.versionS,{PH1:e})}onselect(e){return super.onselect(e),!!this.database&&(this.view||(this.view=new tt(this.model,this.database)),this.showView(this.view),!1)}objectStoreRemoved(e){const t=this.idbObjectStoreTreeElements.get(e);t&&(t.clear(),this.removeChild(t)),this.idbObjectStoreTreeElements.delete(e),this.updateTooltip()}clear(){for(const e of this.idbObjectStoreTreeElements.keys())this.objectStoreRemoved(e)}}class hi extends E{model;databaseId;idbIndexTreeElements;objectStore;view;constructor(e,t,i,r){super(e,r.name,!1),this.model=t,this.databaseId=i,this.idbIndexTreeElements=new Map,this.objectStore=r,this.view=null;const s=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.setLeadingIcons([s])}get itemURL(){return"indexedDB://"+this.databaseId.securityOrigin+"/"+this.databaseId.name+"/"+this.objectStore.name}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}markNeedsRefresh(){this.view&&this.view.markNeedsRefresh();for(const e of this.idbIndexTreeElements.values())e.markNeedsRefresh()}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(ei(Yt.clear),this.clearObjectStore.bind(this)),t.show()}refreshObjectStore(){this.view&&this.view.refreshData();for(const e of this.idbIndexTreeElements.values())e.refreshIndex()}async clearObjectStore(){await this.model.clearObjectStore(this.databaseId,this.objectStore.name),this.update(this.objectStore,!0)}update(e,t){this.objectStore=e;const i=new Set;for(const e of this.objectStore.indexes.values()){i.add(e.name);let r=this.idbIndexTreeElements.get(e.name);r||(r=new ui(this.resourcesPanel,this.model,this.databaseId,this.objectStore,e,this.refreshObjectStore.bind(this)),this.idbIndexTreeElements.set(e.name,r),this.appendChild(r)),r.update(this.objectStore,e,t)}for(const e of this.idbIndexTreeElements.keys())i.has(e)||this.indexRemoved(e);for(const[e,t]of this.idbIndexTreeElements.entries())i.has(e)||(this.removeChild(t),this.idbIndexTreeElements.delete(e));this.childCount()&&this.expand(),this.view&&t&&this.view.update(this.objectStore,null),this.updateTooltip()}updateTooltip(){const e=this.objectStore.keyPathString;let t=null!==e?ei(Yt.keyPathS,{PH1:e}):"";this.objectStore.autoIncrement&&(t+="\n"+i.i18n.lockedString("autoIncrement")),this.tooltip=t}onselect(e){return super.onselect(e),this.view||(this.view=new it(this.model,this.databaseId,this.objectStore,null,this.refreshObjectStore.bind(this))),this.showView(this.view),!1}indexRemoved(e){const t=this.idbIndexTreeElements.get(e);t&&(t.clear(),this.removeChild(t)),this.idbIndexTreeElements.delete(e)}clear(){for(const e of this.idbIndexTreeElements.keys())this.indexRemoved(e);this.view&&this.view.clear()}}class ui extends E{model;databaseId;objectStore;index;refreshObjectStore;view;constructor(e,t,i,r,s,a){super(e,s.name,!1),this.model=t,this.databaseId=i,this.objectStore=r,this.index=s,this.refreshObjectStore=a}get itemURL(){return"indexedDB://"+this.databaseId.securityOrigin+"/"+this.databaseId.name+"/"+this.objectStore.name+"/"+this.index.name}markNeedsRefresh(){this.view&&this.view.markNeedsRefresh()}refreshIndex(){this.view&&this.view.refreshData()}update(e,t,i){this.objectStore=e,this.index=t,this.view&&i&&this.view.update(this.objectStore,this.index),this.updateTooltip()}updateTooltip(){const e=[],t=this.index.keyPathString;e.push(ei(Yt.keyPathS,{PH1:t})),this.index.unique&&e.push(i.i18n.lockedString("unique")),this.index.multiEntry&&e.push(i.i18n.lockedString("multiEntry")),this.tooltip=e.join("\n")}onselect(e){return super.onselect(e),this.view||(this.view=new it(this.model,this.databaseId,this.objectStore,this.index,this.refreshObjectStore)),this.showView(this.view),!1}clear(){this.view&&this.view.clear()}}class gi extends E{domStorage;constructor(e,t){super(e,t.securityOrigin?t.securityOrigin:ei(Yt.localFiles),!1),this.domStorage=t;const i=o.Icon.Icon.create("mediumicon-table","resource-tree-item");this.setLeadingIcons([i])}get itemURL(){return"storage://"+this.domStorage.securityOrigin+"/"+(this.domStorage.isLocalStorage?"local":"session")}onselect(e){return super.onselect(e),this.resourcesPanel.showDOMStorage(this.domStorage),!1}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(ei(Yt.clear),(()=>this.domStorage.clear())),t.show()}}class pi extends E{target;cookieDomainInternal;constructor(e,t,i){super(e,i||ei(Yt.localFiles),!1),this.target=t.resourceTreeModel().target(),this.cookieDomainInternal=i,this.tooltip=ei(Yt.cookiesUsedByFramesFromS,{PH1:i});const r=o.Icon.Icon.create("mediumicon-cookie","resource-tree-item");this.setLeadingIcons([r])}get itemURL(){return"cookies://"+this.cookieDomainInternal}cookieDomain(){return this.cookieDomainInternal}onattach(){super.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.defaultSection().appendItem(ei(Yt.clear),(()=>this.resourcesPanel.clearCookies(this.target,this.cookieDomainInternal))),t.show()}onselect(e){return super.onselect(e),this.resourcesPanel.showCookies(this.target,this.cookieDomainInternal),!1}}class mi extends o.Widget.VBox{emptyWidget;linkElement;constructor(){super(),this.element.classList.add("storage-view"),this.emptyWidget=new o.EmptyWidget.EmptyWidget(""),this.linkElement=null,this.emptyWidget.show(this.element)}setText(e){this.emptyWidget.text=e}setLink(e){e&&!this.linkElement&&(this.linkElement=this.emptyWidget.appendLink(e)),!e&&this.linkElement&&this.linkElement.classList.add("hidden"),e&&this.linkElement&&(this.linkElement.setAttribute("href",e),this.linkElement.classList.remove("hidden"))}}class wi{panel;treeElement;treeElementForFrameId;treeElementForTargetId;constructor(e,t){this.panel=e,this.treeElement=t,o.ARIAUtils.setAccessibleName(this.treeElement.listItemNode,"Resources Section"),this.treeElementForFrameId=new Map,this.treeElementForTargetId=new Map;const i=a.FrameManager.FrameManager.instance();i.addEventListener(a.FrameManager.Events.FrameAddedToTarget,(e=>this.frameAdded(e.data.frame)),this),i.addEventListener(a.FrameManager.Events.FrameRemoved,(e=>this.frameDetached(e.data.frameId)),this),i.addEventListener(a.FrameManager.Events.FrameNavigated,(e=>this.frameNavigated(e.data.frame)),this),i.addEventListener(a.FrameManager.Events.ResourceAdded,(e=>this.resourceAdded(e.data.resource)),this),a.TargetManager.TargetManager.instance().addModelListener(a.ChildTargetManager.ChildTargetManager,a.ChildTargetManager.Events.TargetCreated,this.windowOpened,this),a.TargetManager.TargetManager.instance().addModelListener(a.ChildTargetManager.ChildTargetManager,a.ChildTargetManager.Events.TargetInfoChanged,this.windowChanged,this),a.TargetManager.TargetManager.instance().addModelListener(a.ChildTargetManager.ChildTargetManager,a.ChildTargetManager.Events.TargetDestroyed,this.windowDestroyed,this),a.TargetManager.TargetManager.instance().observeTargets(this);for(const e of i.getAllFrames()){this.treeElementForFrameId.get(e.id)||this.addFrameAndParents(e);const t=e.resourceTreeModel().target().model(a.ChildTargetManager.ChildTargetManager);if(t)for(const e of t.targetInfos())this.windowOpened({data:e})}}targetAdded(e){e.type()!==a.Target.Type.Worker&&e.type()!==a.Target.Type.ServiceWorker||this.workerAdded(e)}async workerAdded(e){const t=e.parentTarget();if(!t)return;const i=t.id(),r=this.treeElementForTargetId.get(i),s=e.id();ti(s);const{targetInfo:a}=await t.targetAgent().invoke_getTargetInfo({targetId:s});r&&a&&r.workerCreated(a)}targetRemoved(e){}addFrameAndParents(e){const t=e.parentFrame();t&&!this.treeElementForFrameId.get(t.id)&&this.addFrameAndParents(t),this.frameAdded(e)}expandFrame(e){if(!e)return!1;let t=this.treeElementForFrameId.get(e.id);return!(!t&&!this.expandFrame(e.parentFrame()))&&(t=this.treeElementForFrameId.get(e.id),!!t&&(t.expand(),!0))}async revealResource(e,t,i){if(!this.expandFrame(e.frame()))return;const r=Si.forResource(e);r&&await r.revealResource(t,i)}revealAndSelectFrame(e){const t=this.treeElementForFrameId.get(e.id);t?.reveal(),t?.select()}frameAdded(e){const t=e.parentFrame(),i=t?this.treeElementForFrameId.get(t.id):this.treeElement;if(!i)return;const r=this.treeElementForFrameId.get(e.id);r&&(this.treeElementForFrameId.delete(e.id),r.parent&&r.parent.removeChild(r));const s=new bi(this,e);this.treeElementForFrameId.set(e.id,s);const a=e.resourceTreeModel().target().id();this.treeElementForTargetId.get(a)||this.treeElementForTargetId.set(a,s),i.appendChild(s);for(const t of e.resources())this.resourceAdded(t)}frameDetached(e){const t=this.treeElementForFrameId.get(e);t&&(this.treeElementForFrameId.delete(e),t.parent&&t.parent.removeChild(t))}frameNavigated(e){const t=this.treeElementForFrameId.get(e.id);t&&t.frameNavigated(e)}resourceAdded(e){if(!e.frameId)return;const t=this.treeElementForFrameId.get(e.frameId);t&&t.appendResource(e)}windowOpened(e){const t=e.data;if(t.openerId&&"page"===t.type){const e=this.treeElementForFrameId.get(t.openerId);e&&(this.treeElementForTargetId.set(t.targetId,e),e.windowOpened(t))}}windowDestroyed(e){const t=e.data,i=this.treeElementForTargetId.get(t);i&&(i.windowDestroyed(t),this.treeElementForTargetId.delete(t))}windowChanged(e){const t=e.data;if(t.openerId&&"page"===t.type){const e=this.treeElementForFrameId.get(t.openerId);e&&e.windowChanged(t)}}reset(){this.treeElement.removeChildren(),this.treeElementForFrameId.clear(),this.treeElementForTargetId.clear()}}class bi extends E{section;frame;frameId;categoryElements;treeElementForResource;treeElementForWindow;treeElementForWorker;view;constructor(e,t){super(e.panel,"",!1),this.section=e,this.frame=t,this.frameId=t.id,this.categoryElements=new Map,this.treeElementForResource=new Map,this.treeElementForWindow=new Map,this.treeElementForWorker=new Map,this.frameNavigated(t),this.view=null}getIconTypeForFrame(e){return e.isTopFrame()?e.unreachableUrl()?"mediumicon-frame-blocked":"mediumicon-frame":e.unreachableUrl()?"mediumicon-frame-embedded-blocked":"mediumicon-frame-embedded"}async frameNavigated(e){const t=o.Icon.Icon.create(this.getIconTypeForFrame(e));if(e.unreachableUrl()&&t.classList.add("red-icon"),this.setLeadingIcons([t]),this.invalidateChildren(),this.frameId=e.id,this.title!==e.displayName()&&(this.title=e.displayName(),o.ARIAUtils.setAccessibleName(this.listItemElement,this.title),this.parent)){const e=this.parent;e.removeChild(this),e.appendChild(this)}if(this.categoryElements.clear(),this.treeElementForResource.clear(),this.treeElementForWorker.clear(),this.selected?(this.view=new b.FrameDetailsView.FrameDetailsView(this.frame),this.showView(this.view)):this.view=null,e.isTopFrame()){const t=a.TargetManager.TargetManager.instance().targets();for(const i of t)if(i.type()===a.Target.Type.ServiceWorker){const t=i.id();ti(t);const r=e.resourceTreeModel().target().targetAgent(),s=(await r.invoke_getTargetInfo({targetId:t})).targetInfo;this.workerCreated(s)}}}get itemURL(){return this.frame.isTopFrame()?"frame://":"frame://"+encodeURI(this.frame.url)}onselect(e){return super.onselect(e),this.view?this.view.update():this.view=new b.FrameDetailsView.FrameDetailsView(this.frame),this.showView(this.view),this.listItemElement.classList.remove("hovered"),a.OverlayModel.OverlayModel.hideDOMNodeHighlight(),!1}set hovered(e){e?(this.listItemElement.classList.add("hovered"),this.frame.highlight()):(this.listItemElement.classList.remove("hovered"),a.OverlayModel.OverlayModel.hideDOMNodeHighlight())}appendResource(t){const i=t.statusCode();if(i>=301&&i<=303)return;const r=t.resourceType(),s=r.name();let a=r===e.ResourceType.resourceTypes.Document?this:this.categoryElements.get(s);a||(a=new x(this.section.panel,t.resourceType().category().title(),s,"Frames"===s),this.categoryElements.set(r.name(),a),this.appendChild(a,bi.presentationOrderCompare));const n=new Si(this.section.panel,t);a.appendChild(n,bi.presentationOrderCompare),this.treeElementForResource.set(t.url,n)}windowOpened(e){const t="OpenedWindows";let i=this.categoryElements.get(t);if(i||(i=new x(this.section.panel,ei(Yt.openedWindows),t),this.categoryElements.set(t,i),this.appendChild(i,bi.presentationOrderCompare)),!this.treeElementForWindow.get(e.targetId)){const t=new ki(this.section.panel,e);i.appendChild(t),this.treeElementForWindow.set(e.targetId,t)}}workerCreated(e){const t="service_worker"===e.type?"Service Workers":"Web Workers",r="service_worker"===e.type?i.i18n.lockedString("Service Workers"):ei(Yt.webWorkers);let s=this.categoryElements.get(t);if(s||(s=new x(this.section.panel,r,t),this.categoryElements.set(t,s),this.appendChild(s,bi.presentationOrderCompare)),!this.treeElementForWorker.get(e.targetId)){const t=new fi(this.section.panel,e);s.appendChild(t),this.treeElementForWorker.set(e.targetId,t)}}windowChanged(e){const t=this.treeElementForWindow.get(e.targetId);t&&(t.title!==e.title&&(t.title=e.title),t.update(e))}windowDestroyed(e){const t=this.treeElementForWindow.get(e);t&&t.windowClosed()}appendChild(e,t=bi.presentationOrderCompare){super.appendChild(e,t)}static presentationOrderCompare(e,t){function i(e){return e instanceof x?2:e instanceof bi?1:3}return i(e)-i(t)||e.titleAsText().localeCompare(t.titleAsText())}}const vi=new WeakMap;class Si extends E{panel;resource;previewPromise;constructor(e,t){super(e,t.isGenerated?ei(Yt.documentNotAvailable):t.displayName,!1),this.panel=e,this.resource=t,this.previewPromise=null,this.tooltip=t.url,vi.set(this.resource,this);const i=o.Icon.Icon.create("mediumicon-manifest","navigator-file-tree-item");i.classList.add("navigator-"+t.resourceType().name()+"-tree-item"),this.setLeadingIcons([i])}static forResource(e){return vi.get(e)}get itemURL(){return this.resource.url}preparePreview(){if(this.previewPromise)return this.previewPromise;const e=n.PreviewFactory.PreviewFactory.createPreview(this.resource,this.resource.mimeType);return this.previewPromise=e.then((e=>e||new o.EmptyWidget.EmptyWidget(this.resource.url))),this.previewPromise}onselect(e){return super.onselect(e),this.resource.isGenerated?this.panel.showCategoryView(ei(Yt.theContentOfThisDocumentHasBeen),null):this.panel.scheduleShowView(this.preparePreview()),!1}ondblclick(e){return t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(this.resource.url),!1}onattach(){super.onattach(),this.listItemElement.draggable=!0,this.listItemElement.addEventListener("dragstart",this.ondragstart.bind(this),!1),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0)}ondragstart(e){return!!e.dataTransfer&&(e.dataTransfer.setData("text/plain",this.resource.content||""),e.dataTransfer.effectAllowed="copy",!0)}handleContextMenuEvent(e){const t=new o.ContextMenu.ContextMenu(e);t.appendApplicableItems(this.resource),t.show()}async revealResource(e,t){this.revealAndSelect(!0);const i=await this.panel.scheduleShowView(this.preparePreview());i instanceof n.ResourceSourceFrame.ResourceSourceFrame&&"number"==typeof e&&i.revealPosition({lineNumber:e,columnNumber:t},!0)}}class ki extends E{targetInfo;isWindowClosed;view;constructor(e,t){super(e,t.title||ei(Yt.windowWithoutTitle),!1),this.targetInfo=t,this.isWindowClosed=!1,this.view=null,this.updateIcon(t.canAccessOpener)}updateIcon(e){const t=e?"mediumicon-frame-opened":"mediumicon-frame",i=o.Icon.Icon.create(t);this.setLeadingIcons([i])}update(e){e.canAccessOpener!==this.targetInfo.canAccessOpener&&this.updateIcon(e.canAccessOpener),this.targetInfo=e,this.view&&(this.view.setTargetInfo(e),this.view.update())}windowClosed(){this.listItemElement.classList.add("window-closed"),this.isWindowClosed=!0,this.view&&(this.view.setIsWindowClosed(!0),this.view.update())}onselect(e){return super.onselect(e),this.view?this.view.update():this.view=new lt(this.targetInfo,this.isWindowClosed),this.showView(this.view),!1}get itemURL(){return this.targetInfo.url}}class fi extends E{targetInfo;view;constructor(e,t){super(e,t.title||t.url||ei(Yt.worker),!1),this.targetInfo=t,this.view=null;const i=o.Icon.Icon.create("mediumicon-service-worker","navigator-file-tree-item");this.setLeadingIcons([i])}onselect(e){return super.onselect(e),this.view?this.view.update():this.view=new ht(this.targetInfo),this.showView(this.view),!1}get itemURL(){return this.targetInfo.url}}var yi=Object.freeze({__proto__:null,ApplicationPanelSidebar:ii,BackgroundServiceTreeElement:ri,DatabaseTreeElement:si,DatabaseTableTreeElement:ai,ServiceWorkersTreeElement:ni,AppManifestTreeElement:oi,ClearStorageTreeElement:di,IndexedDBTreeElement:ci,IDBDatabaseTreeElement:li,IDBObjectStoreTreeElement:hi,IDBIndexTreeElement:ui,DOMStorageTreeElement:gi,CookieTreeElement:pi,StorageCategoryView:mi,ResourcesSection:wi,FrameTreeElement:bi,FrameResourceTreeElement:Si});const Ci=new CSSStyleSheet;Ci.replaceSync(".cookie-preview-widget{padding:2px 6px}.cookie-preview-widget-header{color:var(--color-text-secondary);font-weight:700;user-select:none;white-space:nowrap;margin-bottom:4px;flex:0 0 18px;display:flex;align-items:center}.cookie-preview-widget-header-label{line-height:18px}.cookie-preview-widget-cookie-value{user-select:text;word-break:break-all;flex:1;overflow:auto}.cookie-preview-widget-toggle{margin-left:12px;font-weight:400}\n/*# sourceURL=cookieItemsView.css */\n");const Ti={refresh:"Refresh",filter:"Filter",clearAll:"Clear All",deleteSelected:"Delete Selected",refreshedStatus:"Table refreshed"},Ii=i.i18n.registerUIStrings("panels/application/StorageItemsView.ts",Ti),Ei=i.i18n.getLocalizedString.bind(void 0,Ii);class xi extends o.Widget.VBox{filterRegex;refreshButton;mainToolbar;filterItem;deleteAllButton;deleteSelectedButton;constructor(e,t){super(!1),this.filterRegex=null,this.refreshButton=this.addButton(Ei(Ti.refresh),"largeicon-refresh",(()=>{this.refreshItems(),o.ARIAUtils.alert(Ei(Ti.refreshedStatus))})),this.mainToolbar=new o.Toolbar.Toolbar("top-resources-toolbar",this.element),this.filterItem=new o.Toolbar.ToolbarInput(Ei(Ti.filter),"",.4),this.filterItem.addEventListener(o.Toolbar.ToolbarInput.Event.TextChanged,this.filterChanged,this);const i=new o.Toolbar.ToolbarSeparator;this.deleteAllButton=this.addButton(Ei(Ti.clearAll),"largeicon-clear",this.deleteAllItems),this.deleteSelectedButton=this.addButton(Ei(Ti.deleteSelected),"largeicon-delete",this.deleteSelectedItem),this.deleteAllButton.element.id="storage-items-delete-all";const r=[this.refreshButton,this.filterItem,i,this.deleteAllButton,this.deleteSelectedButton];for(const e of r)this.mainToolbar.appendToolbarItem(e)}setDeleteAllTitle(e){this.deleteAllButton.setTitle(e)}setDeleteAllGlyph(e){this.deleteAllButton.setGlyph(e)}appendToolbarItem(e){this.mainToolbar.appendToolbarItem(e)}addButton(e,t,i){const r=new o.Toolbar.ToolbarButton(e,t);return r.addEventListener(o.Toolbar.ToolbarButton.Events.Click,i,this),r}filterChanged({data:e}){this.filterRegex=e?new RegExp(r.StringUtilities.escapeForRegExp(e),"i"):null,this.refreshItems()}filter(e,t){if(this.filterRegex){const i=this.filterRegex;return e.filter((e=>i.test(t(e))))}return e}hasFilter(){return Boolean(this.filterRegex)}wasShown(){this.refreshItems()}setCanDeleteAll(e){this.deleteAllButton.setEnabled(e)}setCanDeleteSelected(e){this.deleteSelectedButton.setEnabled(e)}setCanRefresh(e){this.refreshButton.setEnabled(e)}setCanFilter(e){this.filterItem.setEnabled(e)}deleteAllItems(){}deleteSelectedItem(){}refreshItems(){}}var Ri=Object.freeze({__proto__:null,StorageItemsView:xi});const Mi={showUrlDecoded:"Show URL decoded",cookies:"Cookies",selectACookieToPreviewItsValue:"Select a cookie to preview its value",onlyShowCookiesWithAnIssue:"Only show cookies with an issue",onlyShowCookiesWhichHaveAn:"Only show cookies which have an associated issue",clearFilteredCookies:"Clear filtered cookies",clearAllCookies:"Clear all cookies",numberOfCookiesShownInTableS:"Number of cookies shown in table: {PH1}"},Pi=i.i18n.registerUIStrings("panels/application/CookieItemsView.ts",Mi),Li=i.i18n.getLocalizedString.bind(void 0,Pi);class Di extends o.Widget.VBox{cookie;showDecodedSetting;toggle;value;constructor(){super(),this.setMinimumSize(230,45),this.cookie=null,this.showDecodedSetting=e.Settings.Settings.instance().createSetting("cookieViewShowDecoded",!1);const t=document.createElement("div");t.classList.add("cookie-preview-widget-header");const i=document.createElement("span");i.classList.add("cookie-preview-widget-header-label"),i.textContent="Cookie Value",t.appendChild(i),this.contentElement.appendChild(t);const r=o.UIUtils.CheckboxLabel.create(Li(Mi.showUrlDecoded),this.showDecodedSetting.get());r.classList.add("cookie-preview-widget-toggle"),r.checkboxElement.addEventListener("click",(()=>this.showDecoded(!this.showDecodedSetting.get()))),t.appendChild(r),this.toggle=r;const s=document.createElement("div");s.classList.add("cookie-preview-widget-cookie-value"),s.textContent="",s.addEventListener("dblclick",this.handleDblClickOnCookieValue.bind(this)),this.value=s,this.contentElement.classList.add("cookie-preview-widget"),this.contentElement.appendChild(s)}showDecoded(e){this.cookie&&(this.showDecodedSetting.set(e),this.toggle.checkboxElement.checked=e,this.updatePreview())}updatePreview(){this.cookie?this.value.textContent=this.showDecodedSetting.get()?decodeURIComponent(this.cookie.value()):this.cookie.value():this.value.textContent=""}setCookie(e){this.cookie=e,this.updatePreview()}handleDblClickOnCookieValue(e){e.preventDefault();const t=document.createRange();t.selectNode(this.value);const i=window.getSelection();i&&(i.removeAllRanges(),i.addRange(t))}}class Fi extends xi{model;cookieDomain;totalSize;cookiesTable;splitWidget;previewPanel;previewWidget;emptyWidget;onlyIssuesFilterUI;refreshThrottler;eventDescriptors;allCookies;shownCookies;selectedCookie;constructor(t,i){super(Li(Mi.cookies),"cookiesPanel"),this.element.classList.add("storage-view"),this.model=t,this.cookieDomain=i,this.totalSize=0,this.cookiesTable=new T.CookiesTable.CookiesTable(!1,this.saveCookie.bind(this),this.refreshItems.bind(this),this.handleCookieSelected.bind(this),this.deleteCookie.bind(this)),this.cookiesTable.setMinimumSize(0,50),this.splitWidget=new o.SplitWidget.SplitWidget(!1,!0,"cookieItemsSplitViewState"),this.splitWidget.show(this.element),this.previewPanel=new o.Widget.VBox;const r=this.previewPanel.element.createChild("div","preview-panel-resizer");this.splitWidget.setMainWidget(this.cookiesTable),this.splitWidget.setSidebarWidget(this.previewPanel),this.splitWidget.installResizer(r),this.previewWidget=new Di,this.emptyWidget=new o.EmptyWidget.EmptyWidget(Li(Mi.selectACookieToPreviewItsValue)),this.emptyWidget.show(this.previewPanel.contentElement),this.onlyIssuesFilterUI=new o.Toolbar.ToolbarCheckbox(Li(Mi.onlyShowCookiesWithAnIssue),Li(Mi.onlyShowCookiesWhichHaveAn),(()=>{this.updateWithCookies(this.allCookies)})),this.appendToolbarItem(this.onlyIssuesFilterUI),this.refreshThrottler=new e.Throttler.Throttler(300),this.eventDescriptors=[],this.allCookies=[],this.shownCookies=[],this.selectedCookie=null,this.setCookiesDomain(t,i)}setCookiesDomain(t,i){this.model=t,this.cookieDomain=i,this.refreshItems(),e.EventTarget.removeEventListeners(this.eventDescriptors);const r=t.target().model(a.NetworkManager.NetworkManager);r&&(this.eventDescriptors=[r.addEventListener(a.NetworkManager.Events.ResponseReceived,this.onResponseReceived,this),r.addEventListener(a.NetworkManager.Events.LoadingFinished,this.onLoadingFinished,this)])}showPreview(e){e!==this.selectedCookie&&(this.selectedCookie=e,e?(this.emptyWidget.detach(),this.previewWidget.setCookie(e),this.previewWidget.show(this.previewPanel.contentElement)):(this.previewWidget.detach(),this.emptyWidget.show(this.previewPanel.contentElement)))}handleCookieSelected(){const e=this.cookiesTable.selectedCookie();this.setCanDeleteSelected(Boolean(e)),this.showPreview(e)}async saveCookie(e,t){return t&&e.key()!==t.key()&&await this.model.deleteCookie(t),this.model.saveCookie(e)}deleteCookie(e,t){this.model.deleteCookie(e).then(t)}updateWithCookies(t){this.allCookies=t,this.totalSize=t.reduce(((e,t)=>e+t.size()),0);const i=e.ParsedURL.ParsedURL.fromString(this.cookieDomain),r=i?i.host:"";this.cookiesTable.setCookieDomain(r),this.shownCookies=this.filter(t,(e=>`${e.name()} ${e.value()} ${e.domain()}`)),this.hasFilter()?(this.setDeleteAllTitle(Li(Mi.clearFilteredCookies)),this.setDeleteAllGlyph("largeicon-delete-filter")):(this.setDeleteAllTitle(Li(Mi.clearAllCookies)),this.setDeleteAllGlyph("largeicon-delete-list")),this.cookiesTable.setCookies(this.shownCookies,this.model.getCookieToBlockedReasonsMap()),o.ARIAUtils.alert(Li(Mi.numberOfCookiesShownInTableS,{PH1:this.shownCookies.length})),this.setCanFilter(!0),this.setCanDeleteAll(this.shownCookies.length>0),this.setCanDeleteSelected(Boolean(this.cookiesTable.selectedCookie())),this.cookiesTable.selectedCookie()||this.showPreview(null)}filter(e,t){return super.filter(e,t).filter((e=>!this.onlyIssuesFilterUI.checked()||e instanceof a.Cookie.Cookie&&C.RelatedIssue.hasIssues(e)))}deleteAllItems(){this.showPreview(null),this.model.deleteCookies(this.shownCookies).then((()=>this.refreshItems()))}deleteSelectedItem(){const e=this.cookiesTable.selectedCookie();e&&(this.showPreview(null),this.model.deleteCookie(e).then((()=>this.refreshItems())))}refreshItems(){this.model.getCookiesForDomain(this.cookieDomain).then(this.updateWithCookies.bind(this))}refreshItemsThrottled(){this.refreshThrottler.schedule((()=>Promise.resolve(this.refreshItems())))}onResponseReceived(){this.refreshItemsThrottled()}onLoadingFinished(){this.refreshItemsThrottled()}wasShown(){super.wasShown(),this.registerCSSFiles([Ci])}}var Oi=Object.freeze({__proto__:null,CookieItemsView:Fi});const Bi={domStorage:"DOM Storage",key:"Key",value:"Value",domStorageItems:"DOM Storage Items",selectAValueToPreview:"Select a value to preview",domStorageItemDeleted:"The storage item was deleted.",domStorageNumberEntries:"Number of entries shown in table: {PH1}"},Ni=i.i18n.registerUIStrings("panels/application/DOMStorageItemsView.ts",Bi),Wi=i.i18n.getLocalizedString.bind(void 0,Ni);class Vi extends xi{domStorage;dataGrid;splitWidget;previewPanel;preview;previewValue;eventListeners;constructor(e){super(Wi(Bi.domStorage),"domStoragePanel"),this.domStorage=e,this.element.classList.add("storage-view","table");const t=[{id:"key",title:Wi(Bi.key),sortable:!1,editable:!0,longText:!0,weight:50},{id:"value",title:Wi(Bi.value),sortable:!1,editable:!0,longText:!0,weight:50}];this.dataGrid=new u.DataGrid.DataGridImpl({displayName:Wi(Bi.domStorageItems),columns:t,editCallback:this.editingCallback.bind(this),deleteCallback:this.deleteCallback.bind(this),refreshCallback:this.refreshItems.bind(this)}),this.dataGrid.addEventListener(u.DataGrid.Events.SelectedNode,(e=>{this.previewEntry(e.data)})),this.dataGrid.addEventListener(u.DataGrid.Events.DeselectedNode,(()=>{this.previewEntry(null)})),this.dataGrid.setStriped(!0),this.dataGrid.setName("DOMStorageItemsView"),this.splitWidget=new o.SplitWidget.SplitWidget(!1,!0,"domStorageSplitViewState"),this.splitWidget.show(this.element),this.previewPanel=new o.Widget.VBox,this.previewPanel.setMinimumSize(0,50);const i=this.previewPanel.element.createChild("div","preview-panel-resizer"),r=this.dataGrid.asWidget();r.setMinimumSize(0,50),this.splitWidget.setMainWidget(r),this.splitWidget.setSidebarWidget(this.previewPanel),this.splitWidget.installResizer(i),this.preview=null,this.previewValue=null,this.showPreview(null,null),this.eventListeners=[],this.setStorage(e)}setStorage(t){e.EventTarget.removeEventListeners(this.eventListeners),this.domStorage=t,this.eventListeners=[this.domStorage.addEventListener(Ae.Events.DOMStorageItemsCleared,this.domStorageItemsCleared,this),this.domStorage.addEventListener(Ae.Events.DOMStorageItemRemoved,this.domStorageItemRemoved,this),this.domStorage.addEventListener(Ae.Events.DOMStorageItemAdded,this.domStorageItemAdded,this),this.domStorage.addEventListener(Ae.Events.DOMStorageItemUpdated,this.domStorageItemUpdated,this)],this.refreshItems()}domStorageItemsCleared(){this.isShowing()&&this.dataGrid&&(this.dataGrid.rootNode().removeChildren(),this.dataGrid.addCreationNode(!1),this.setCanDeleteSelected(!1))}domStorageItemRemoved(e){if(!this.isShowing()||!this.dataGrid)return;const t=e.data,i=this.dataGrid.rootNode(),r=i.children;for(let e=0;e<r.length;++e){const s=r[e];if(s.data.key===t.key)return i.removeChild(s),void this.setCanDeleteSelected(r.length>1)}}domStorageItemAdded(e){if(!this.isShowing()||!this.dataGrid)return;const t=e.data,i=this.dataGrid.rootNode(),r=i.children;for(let e=0;e<r.length;++e)if(r[e].data.key===t.key)return;const s=new u.DataGrid.DataGridNode({key:t.key,value:t.value},!1);i.insertChild(s,r.length-1)}domStorageItemUpdated(e){if(!this.isShowing()||!this.dataGrid)return;const t=e.data,i=this.dataGrid.rootNode().children.find((e=>e.data.key===t.key));i&&i.data.value!==t.value&&(i.data.value=t.value,i.refresh(),i.selected&&(this.previewEntry(i),this.setCanDeleteSelected(!0)))}showDOMStorageItems(e){const t=this.dataGrid.rootNode();let i=null;for(const e of t.children)if(e.selected){i=e.data.key;break}t.removeChildren();let r=null;const s=this.filter(e,(e=>`${e[0]} ${e[1]}`));for(const e of s){const s=e[0],a=e[1],n=new u.DataGrid.DataGridNode({key:s,value:a},!1);n.selectable=!0,t.appendChild(n),r&&s!==i||(r=n)}r&&(r.selected=!0),this.dataGrid.addCreationNode(!1),this.setCanDeleteSelected(Boolean(r)),o.ARIAUtils.alert(Wi(Bi.domStorageNumberEntries,{PH1:s.length}))}deleteSelectedItem(){this.dataGrid&&this.dataGrid.selectedNode&&this.deleteCallback(this.dataGrid.selectedNode)}refreshItems(){this.domStorage.getItems().then((e=>e&&this.showDOMStorageItems(e)))}deleteAllItems(){this.domStorage.clear(),this.domStorageItemsCleared()}editingCallback(e,t,i,r){const s=this.domStorage;"key"===t?("string"==typeof i&&s.removeItem(i),s.setItem(r,e.data.value||""),this.removeDupes(e)):s.setItem(e.data.key||"",r)}removeDupes(e){const t=this.dataGrid.rootNode(),i=t.children;for(let r=i.length-1;r>=0;--r){const s=i[r];s.data.key===e.data.key&&e!==s&&t.removeChild(s)}}deleteCallback(e){e&&!e.isCreationNode&&(this.domStorage&&this.domStorage.removeItem(e.data.key),o.ARIAUtils.alert(Wi(Bi.domStorageItemDeleted)))}showPreview(e,t){this.preview&&this.previewValue===t||(this.preview&&this.preview.detach(),e||(e=new o.EmptyWidget.EmptyWidget(Wi(Bi.selectAValueToPreview))),this.previewValue=t,this.preview=e,e.show(this.previewPanel.contentElement))}async previewEntry(t){const i=t&&t.data&&t.data.value;if(t&&t.data&&t.data.value){const r=`${this.domStorage.isLocalStorage?"localstorage":"sessionstorage"}://${t.key}`,s=I.StaticContentProvider.StaticContentProvider.fromString(r,e.ResourceType.resourceTypes.XHR,i),a=await n.PreviewFactory.PreviewFactory.createPreview(s,"text/plain");t.selected&&this.showPreview(a,i)}else this.showPreview(null,i)}}var Ai=Object.freeze({__proto__:null,DOMStorageItemsView:Vi});const Ui=new CSSStyleSheet;let Hi,qi,_i,ji;Ui.replaceSync(".resources-toolbar{border-top:1px solid var(--color-details-hairline);background-color:var(--color-background-elevation-1)}.top-resources-toolbar{border-bottom:1px solid var(--color-details-hairline);background-color:var(--color-background-elevation-1)}.resources.panel .status{float:right;height:16px;margin-top:1px;margin-left:4px;line-height:1em}.storage-view{display:flex;overflow:hidden}.storage-view .data-grid:not(.inline){border:none;flex:auto}.storage-view .storage-table-error{color:var(--color-accent-red);font-size:24px;font-weight:700;padding:10px;display:flex;align-items:center;justify-content:center}.storage-view.query{padding:2px 0;overflow-y:overlay;overflow-x:hidden}.storage-view .filter-bar{border-top:none;border-bottom:1px solid var(--color-details-hairline)}.database-query-group-messages{overflow-y:auto}.database-query-prompt-container{position:relative;padding:1px 22px 1px 24px;min-height:16px}.database-query-prompt{white-space:pre-wrap}.prompt-icon{position:absolute;display:block;left:7px;top:9px;margin-top:-7px;user-select:none}.database-query-prompt-container .prompt-icon{top:10px}.database-user-query{position:relative;border-bottom:1px solid var(--color-details-hairline);padding:1px 22px 1px 24px;min-height:16px;flex-shrink:0}.database-user-query:focus-visible{background-color:var(--color-background-elevation-2)}.database-query-text{color:var(--color-primary-variant);user-select:text}.database-query-result{position:relative;padding:1px 22px;min-height:16px;margin-left:-22px;padding-right:0}.database-query-result.error{color:var(--color-syntax-1);user-select:text}.resources-sidebar{padding:0;overflow-x:auto;background-color:var(--color-background)}\n/*# sourceURL=resourcesPanel.css */\n");class zi extends o.Panel.PanelWithSidebar{resourcesLastSelectedItemSetting;visibleView;pendingViewPromise;categoryView;storageViews;storageViewToolbar;domStorageView;cookieView;emptyWidget;sidebar;constructor(){super("resources"),this.resourcesLastSelectedItemSetting=e.Settings.Settings.instance().createSetting("resourcesLastSelectedElementPath",[]),this.visibleView=null,this.pendingViewPromise=null,this.categoryView=null;const t=new o.Widget.VBox;this.storageViews=t.element.createChild("div","vbox flex-auto"),this.storageViewToolbar=new o.Toolbar.Toolbar("resources-toolbar",t.element),this.splitWidget().setMainWidget(t),this.domStorageView=null,this.cookieView=null,this.emptyWidget=null,this.sidebar=new ii(this),this.sidebar.show(this.panelSidebarElement())}static instance(e={forceNew:null}){const{forceNew:t}=e;return Hi&&!t||(Hi=new zi),Hi}static shouldCloseOnReset(e){return[n.ResourceSourceFrame.ResourceSourceFrame,n.ImageView.ImageView,n.FontView.FontView,xi,Me,Ne].some((t=>e instanceof t))}static async showAndGetSidebar(){return await o.ViewManager.ViewManager.instance().showView("resources"),zi.instance().sidebar}focus(){this.sidebar.focus()}lastSelectedItemPath(){return this.resourcesLastSelectedItemSetting.get()}setLastSelectedItemPath(e){this.resourcesLastSelectedItemSetting.set(e)}resetView(){this.visibleView&&zi.shouldCloseOnReset(this.visibleView)&&this.showView(null)}showView(e){this.pendingViewPromise=null,this.visibleView!==e&&(this.visibleView&&this.visibleView.detach(),e&&e.show(this.storageViews),this.visibleView=e,this.storageViewToolbar.removeToolbarItems(),this.storageViewToolbar.element.classList.toggle("hidden",!0),e instanceof o.View.SimpleView&&e.toolbarItems().then((e=>{e.map((e=>this.storageViewToolbar.appendToolbarItem(e))),this.storageViewToolbar.element.classList.toggle("hidden",!e.length)})))}async scheduleShowView(e){this.pendingViewPromise=e;const t=await e;return this.pendingViewPromise!==e?null:(this.showView(t),t)}showCategoryView(e,t){this.categoryView||(this.categoryView=new mi),this.categoryView.setText(e),this.categoryView.setLink(t),this.showView(this.categoryView)}showDOMStorage(e){e&&(this.domStorageView?this.domStorageView.setStorage(e):this.domStorageView=new Vi(e),this.showView(this.domStorageView))}showCookies(e,t){const i=e.model(a.CookieModel.CookieModel);i&&(this.cookieView?this.cookieView.setCookiesDomain(i,t):this.cookieView=new Fi(i,t),this.showView(this.cookieView))}clearCookies(e,t){const i=e.model(a.CookieModel.CookieModel);i&&i.clear(t).then((()=>{this.cookieView&&this.cookieView.refreshItems()}))}wasShown(){super.wasShown(),this.registerCSSFiles([Ui])}}class Gi{static instance(e={forceNew:null}){const{forceNew:t}=e;return qi&&!t||(qi=new Gi),qi}async reveal(e){if(!(e instanceof a.Resource.Resource))throw new Error("Internal error: not a resource");const t=await zi.showAndGetSidebar();await t.showResource(e)}}class Ki{static instance(e={forceNew:null}){const{forceNew:t}=e;return _i&&!t||(_i=new Ki),_i}async reveal(e){if(!(e instanceof a.Cookie.CookieReference))throw new Error("Internal error: not a cookie reference");const t=await zi.showAndGetSidebar();await t.cookieListTreeElement.select();const i=e.contextUrl();i&&await this.revealByDomain(t,i)||this.revealByDomain(t,e.domain())}async revealByDomain(e,t){const i=e.cookieListTreeElement.children().find((e=>e.cookieDomain().endsWith(t)));return!!i&&(await i.revealAndSelect(),!0)}}class $i{static instance(e={forceNew:null}){const{forceNew:t}=e;return ji&&!t||(ji=new $i),ji}async reveal(e){if(!(e instanceof a.ResourceTreeModel.ResourceTreeFrame))throw new Error("Internal error: not a frame");(await zi.showAndGetSidebar()).showFrame(e)}}var Qi=Object.freeze({__proto__:null,ResourcesPanel:zi,ResourceRevealer:Gi,CookieReferenceRevealer:Ki,FrameDetailsRevealer:$i});export{se as AppManifestView,yi as ApplicationPanelSidebar,ne as BackgroundServiceModel,we as BackgroundServiceView,Oi as CookieItemsView,Ai as DOMStorageItemsView,_e as DOMStorageModel,Ie as DatabaseModel,De as DatabaseQueryView,Ve as DatabaseTableView,Xe as IndexedDBModel,st as IndexedDBViews,ut as OpenedWindowDetailsView,Gt as ReportingApiReportsView,Qi as ResourcesPanel,z as ServiceWorkerCacheViews,St as ServiceWorkerUpdateCycleView,Et as ServiceWorkersView,Ri as StorageItemsView,Bt as StorageView};
