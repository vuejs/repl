import*as e from"../../core/i18n/i18n.js";import*as t from"../../ui/legacy/legacy.js";import*as i from"../../third_party/codemirror.next/codemirror.next.js";import*as o from"../../ui/components/text_editor/text_editor.js";import*as n from"../../core/common/common.js";import*as r from"../../core/host/host.js";import*as s from"../../core/platform/platform.js";import*as a from"../../core/sdk/sdk.js";import*as c from"../../models/bindings/bindings.js";import*as l from"../../models/persistence/persistence.js";import*as d from"../../models/workspace/workspace.js";import*as u from"../../models/formatter/formatter.js";import*as h from"../../ui/legacy/components/source_frame/source_frame.js";import*as p from"../coverage/coverage.js";import*as g from"../../core/root/root.js";import*as m from"../../models/text_utils/text_utils.js";import*as b from"../../ui/legacy/components/object_ui/object_ui.js";import*as f from"../../ui/legacy/components/quick_open/quick_open.js";import*as v from"../../models/extensions/extensions.js";import*as S from"../snippets/snippets.js";import*as C from"../../models/issues_manager/issues_manager.js";import*as w from"../../ui/components/icon_button/icon_button.js";import*as I from"../../ui/components/issue_counter/issue_counter.js";import*as k from"../../ui/legacy/components/color_picker/color_picker.js";import*as x from"../../ui/legacy/components/inline_editor/inline_editor.js";import*as y from"../../ui/legacy/components/utils/utils.js";import*as E from"../search/search.js";import{imageNameForResourceType as T}from"../utils/utils.js";import*as L from"../../ui/components/linear_memory_inspector/linear_memory_inspector.js";const M=new CSSStyleSheet;M.replaceSync(":host{padding:10px}.widget{align-items:center}label{white-space:nowrap}input[type=text].add-source-map{box-shadow:0 0 0 1px var(--box-shadow-outline-color);font-size:inherit;margin:0 8px 0 5px}\n/*# sourceURL=dialog.css */\n");const F={sourceMapUrl:"Source map URL: ",add:"Add"},P=e.i18n.registerUIStrings("panels/sources/AddSourceMapURLDialog.ts",F),D=e.i18n.getLocalizedString.bind(void 0,P);class A extends t.Widget.HBox{input;dialog;callback;constructor(e){super(!0),this.contentElement.createChild("label").textContent=D(F.sourceMapUrl),this.input=t.UIUtils.createInput("add-source-map","text"),this.input.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.contentElement.appendChild(this.input);const i=t.UIUtils.createTextButton(D(F.add),this.apply.bind(this));this.contentElement.appendChild(i),this.dialog=new t.Dialog.Dialog,this.dialog.setSizeBehavior("MeasureContent"),this.dialog.setDefaultFocusedElement(this.input),this.callback=e}show(){super.show(this.dialog.contentElement),this.dialog.show()}done(e){this.dialog.hide(),this.callback(e)}apply(){this.done(this.input.value)}onKeyDown(e){"Enter"===e.key&&(e.consume(!0),this.apply())}wasShown(){super.wasShown(),this.registerCSSFiles([M])}}var B=Object.freeze({__proto__:null,AddSourceMapURLDialog:A});const N=new CSSStyleSheet;N.replaceSync(":host{z-index:30;padding:4px;background-color:var(--color-background-elevation-1);border-radius:7px;border:2px solid var(--color-details-hairline);width:90%;pointer-events:auto}:host(.sources-edit-breakpoint-dialog){border-radius:0;z-index:30;background-color:var(--color-background-elevation-1);width:555px;pointer-events:auto;margin:2px 0 2px -1px;padding:0 10px 10px 5px;border:1px solid var(--color-details-hairline)}:host-context(.sources-edit-breakpoint-dialog) .condition-editor{background-color:var(--color-background);margin-left:3px}:host-context(.sources-edit-breakpoint-dialog) .source-frame-breakpoint-toolbar{font-family:sans-serif;font-size:12px}\n/*# sourceURL=breakpointEditDialog.css */\n");const U={breakpointType:"Breakpoint type",breakpoint:"Breakpoint",conditionalBreakpoint:"Conditional breakpoint",logpoint:"Logpoint",expressionToCheckBeforePausingEg:"Expression to check before pausing, e.g. x > 5",pauseOnlyWhenTheConditionIsTrue:"Pause only when the condition is true",logMessageEgXIsX:"Log message, e.g. `'x is', x`",logAMessageToConsoleDoNotBreak:"Log a message to Console, do not break"},V=e.i18n.registerUIStrings("panels/sources/BreakpointEditDialog.ts",U),j=e.i18n.getLocalizedString.bind(void 0,V);class W extends t.Widget.Widget{onFinish;finished;editor;isLogpoint;typeSelector;placeholderCompartment;constructor(e,n,r,s){super(!0);const a=[i.javascript.javascriptLanguage,o.Config.baseConfiguration(n||""),o.Config.closeBrackets,o.Config.autocompletion,i.EditorView.lineWrapping,o.Config.showCompletionHint,o.JavaScript.completion(),o.JavaScript.argumentHints()];this.onFinish=s,this.finished=!1,this.element.tabIndex=-1;const c=O,l=R;this.isLogpoint=n.startsWith(c)&&n.endsWith(l),this.isLogpoint&&(n=n.substring(c.length,n.length-l.length)),this.isLogpoint=this.isLogpoint||r,this.element.classList.add("sources-edit-breakpoint-dialog");const d=new t.Toolbar.Toolbar("source-frame-breakpoint-toolbar",this.contentElement);d.appendText(`Line ${e+1}:`),this.typeSelector=new t.Toolbar.ToolbarComboBox(this.onTypeChanged.bind(this),j(U.breakpointType)),this.typeSelector.createOption(j(U.breakpoint),H.Breakpoint);const u=this.typeSelector.createOption(j(U.conditionalBreakpoint),H.Conditional),h=this.typeSelector.createOption(j(U.logpoint),H.Logpoint);this.typeSelector.select(this.isLogpoint?h:u),d.appendToolbarItem(this.typeSelector);const p=n||"",g=e=>!!o.JavaScript.isExpressionComplete(e.state)&&(this.finishEditing(!0,this.editor.state.doc.toString()),!0),m=[{key:"Mod-Enter",run:g},{key:"Enter",run:g},{key:"Shift-Enter",run:i.insertNewlineAndIndent},{key:"Escape",run:()=>(this.finishEditing(!1,""),!0)}];this.placeholderCompartment=new i.Compartment;const b=this.contentElement.appendChild(document.createElement("div"));b.classList.add("condition-editor"),this.editor=new o.TextEditor.TextEditor(i.EditorState.create({doc:p,selection:{anchor:0,head:p.length},extensions:[this.placeholderCompartment.of(this.getPlaceholder()),i.keymap.of(m),a]})),b.appendChild(this.editor),this.updateTooltip(),this.element.addEventListener("blur",(e=>{(!e.relatedTarget||e.relatedTarget&&!e.relatedTarget.isSelfOrDescendant(this.element))&&this.finishEditing(!0,this.editor.state.doc.toString())}),!0)}focusEditor(){this.editor.editor.focus()}static conditionForLogpoint(e){return`${O}${e}${R}`}onTypeChanged(){this.breakpointType===H.Breakpoint?this.finishEditing(!0,""):(this.editor.dispatch({effects:this.placeholderCompartment.reconfigure(this.getPlaceholder())}),this.updateTooltip())}get breakpointType(){const e=this.typeSelector.selectedOption();return e?e.value:null}getPlaceholder(){const e=this.breakpointType;return e===H.Conditional?i.placeholder(j(U.expressionToCheckBeforePausingEg)):e===H.Logpoint?i.placeholder(j(U.logMessageEgXIsX)):[]}updateTooltip(){const e=this.breakpointType;e===H.Conditional?t.Tooltip.Tooltip.install(this.typeSelector.element,j(U.pauseOnlyWhenTheConditionIsTrue)):e===H.Logpoint&&t.Tooltip.Tooltip.install(this.typeSelector.element,j(U.logAMessageToConsoleDoNotBreak))}finishEditing(e,t){this.finished||(this.finished=!0,this.editor.remove(),this.isLogpoint&&(t=W.conditionForLogpoint(t)),this.onFinish({committed:e,condition:t}))}wasShown(){super.wasShown(),this.registerCSSFiles([N])}}const O="/** DEVTOOLS_LOGPOINT */ console.log(",R=")",H={Breakpoint:"Breakpoint",Conditional:"Conditional",Logpoint:"Logpoint"};var _=Object.freeze({__proto__:null,BreakpointEditDialog:W,LogpointPrefix:O,LogpointSuffix:R,BreakpointType:H});const z=new CSSStyleSheet;z.replaceSync('.ignore-listed-message{--override-ignore-message-background-color:#ffffc2;text-align:center;font-style:italic;padding:4px;color:var(--color-text-secondary);background-color:var(--override-ignore-message-background-color)}.-theme-with-dark-background .ignore-listed-message,:host-context(.-theme-with-dark-background) .ignore-listed-message{--override-ignore-message-background-color:rgb(72 72 0)}.show-more-message>.link{margin-left:5px}.ignore-listed-message>.link{margin-left:5px}.ignore-listed-message>.link:focus{outline-width:unset}.show-more-message{text-align:center;font-style:italic;padding:4px;border-top:1px solid var(--color-details-hairline)}.call-frame-item{padding:3px 8px 3px 20px;position:relative;min-height:18px;line-height:15px;display:flex;flex-wrap:wrap}.call-frame-title-text{text-overflow:ellipsis;overflow:hidden}.async-header+.call-frame-item{border-top:0}.call-frame-item:not(.async-header){border-top:1px solid var(--color-details-hairline)}.call-frame-item-title,.call-frame-location{display:flex;white-space:nowrap}.async-header .call-frame-item-title{font-weight:700;color:var(--color-text-primary);background-color:var(--color-background);margin-left:-5px;padding:0 5px;z-index:1}.call-frame-item.async-header:focus-visible .call-frame-item-title,.call-frame-item:focus-visible{background-color:var(--legacy-focus-bg-color)}.call-frame-item:not(.async-header):hover{background-color:var(--color-background-elevation-1)}.call-frame-location{color:var(--color-text-secondary);margin-left:auto;padding:0 10px}.async-header::before{content:" ";width:100%;border-top:1px solid var(--color-details-hairline);margin-top:8px;position:absolute;left:0}.ignore-listed-call-frame{opacity:60%;font-style:italic}.selected-call-frame-icon{display:none;position:absolute;top:5px;left:4px}.call-frame-item.selected .selected-call-frame-icon{display:block}.call-frame-warning-icon{display:block;position:absolute;top:5px;right:4px}@media (forced-colors:active){.call-frame-item:focus-visible,.call-frame-item:not(.async-header):hover{forced-color-adjust:none;background-color:Highlight}.call-frame-item:focus-visible *,.call-frame-item:not(.async-header):hover *{color:HighlightText}}\n/*# sourceURL=callStackSidebarPane.css */\n');const q={callStack:"Call Stack",notPaused:"Not paused",onIgnoreList:"on ignore list",showIgnorelistedFrames:"Show ignore-listed frames",showMore:"Show more",copyStackTrace:"Copy stack trace",removeFromIgnoreList:"Remove from ignore list",addScriptToIgnoreList:"Add script to ignore list",removeAllContentScriptsFrom:"Remove all content scripts from ignore list",addAllContentScriptsToIgnoreList:"Add all content scripts to ignore list",callFrameWarnings:"Some call frames have warnings"},G=e.i18n.registerUIStrings("panels/sources/CallStackSidebarPane.ts",q),K=e.i18n.getLocalizedString.bind(void 0,G);let $;class J extends t.View.SimpleView{ignoreListMessageElement;notPausedMessageElement;callFrameWarningsElement;items;list;showMoreMessageElement;showIgnoreListed;locationPool;updateThrottler;maxAsyncStackChainDepth;updateItemThrottler;scheduledForUpdateItems;muteActivateItem;constructor(){super(K(q.callStack),!0),this.ignoreListMessageElement=this.createIgnoreListMessageElement(),this.contentElement.appendChild(this.ignoreListMessageElement),this.notPausedMessageElement=this.contentElement.createChild("div","gray-info-message"),this.notPausedMessageElement.textContent=K(q.notPaused),this.notPausedMessageElement.tabIndex=-1,this.callFrameWarningsElement=this.contentElement.createChild("div","ignore-listed-message");const e=t.Icon.Icon.create("smallicon-warning","call-frame-warning-icon");this.callFrameWarningsElement.appendChild(e),this.callFrameWarningsElement.appendChild(document.createTextNode(K(q.callFrameWarnings))),this.callFrameWarningsElement.tabIndex=-1,this.items=new t.ListModel.ListModel,this.list=new t.ListControl.ListControl(this.items,this,t.ListControl.ListMode.NonViewport),this.contentElement.appendChild(this.list.element),this.list.element.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),self.onInvokeElement(this.list.element,(e=>{const t=this.list.itemForNode(e.target);t&&(this.activateItem(t),e.consume(!0))})),this.showMoreMessageElement=this.createShowMoreMessageElement(),this.showMoreMessageElement.classList.add("hidden"),this.contentElement.appendChild(this.showMoreMessageElement),this.showIgnoreListed=!1,this.locationPool=new c.LiveLocation.LiveLocationPool,this.updateThrottler=new n.Throttler.Throttler(100),this.maxAsyncStackChainDepth=Q,this.update(),this.updateItemThrottler=new n.Throttler.Throttler(100),this.scheduledForUpdateItems=new Set}static instance(e={forceNew:null}){const{forceNew:t}=e;return $&&!t||($=new J),$}flavorChanged(e){this.showIgnoreListed=!1,this.maxAsyncStackChainDepth=Q,this.update()}update(){this.updateThrottler.schedule((()=>this.doUpdate()))}async doUpdate(){this.locationPool.disposeAll(),this.callFrameWarningsElement.classList.add("hidden");const e=t.Context.Context.instance().flavor(a.DebuggerModel.DebuggerPausedDetails);if(!e)return this.notPausedMessageElement.classList.remove("hidden"),this.ignoreListMessageElement.classList.add("hidden"),this.showMoreMessageElement.classList.add("hidden"),this.items.replaceAll([]),void t.Context.Context.instance().setFlavor(a.DebuggerModel.CallFrame,null);this.notPausedMessageElement.classList.add("hidden");const i=[],o=new Set;for(const t of e.callFrames){const e=te.createForDebuggerCallFrame(t,this.locationPool,this.refreshItem.bind(this)).then((e=>(Y.set(e,t),e)));i.push(e);for(const e of t.warnings)o.add(e)}const n=await Promise.all(i);o.size&&(this.callFrameWarningsElement.classList.remove("hidden"),t.Tooltip.Tooltip.install(this.callFrameWarningsElement,Array.from(o).join("\n")));let r=e.debuggerModel,s=e.asyncStackTraceId,c=e.asyncStackTrace,l=e.callFrames;for(let{maxAsyncStackChainDepth:e}=this;e>0;--e){if(!c){if(!s)break;if(s.debuggerId){const e=await a.DebuggerModel.DebuggerModel.modelForDebuggerId(s.debuggerId);if(!e)break;r=e}if(c=await r.fetchAsyncStackTrace(s),!c)break}const e=t.UIUtils.asyncStackTraceLabel(c.description,l);n.push(...await te.createItemsForAsyncStack(e,r,c.callFrames,this.locationPool,this.refreshItem.bind(this))),l=c.callFrames,s=c.parentId,c=c.parent}if(this.showMoreMessageElement.classList.toggle("hidden",!c),this.items.replaceAll(n),this.maxAsyncStackChainDepth===Q){this.list.selectNextItem(!0,!1);const e=this.list.selectedItem();e&&this.activateItem(e)}this.updatedForTest()}updatedForTest(){}refreshItem(e){this.scheduledForUpdateItems.add(e),this.updateItemThrottler.schedule((async()=>{const e=Array.from(this.scheduledForUpdateItems);if(this.scheduledForUpdateItems.clear(),this.muteActivateItem=!0,!this.showIgnoreListed&&this.items.every((e=>e.isIgnoreListed))){this.showIgnoreListed=!0;for(let e=0;e<this.items.length;++e)this.list.refreshItemByIndex(e);this.ignoreListMessageElement.classList.toggle("hidden",!0)}else{const t=new Set(e);let i=!1;for(let e=0;e<this.items.length;++e){const o=this.items.at(e);t.has(o)&&this.list.refreshItemByIndex(e),i=i||o.isIgnoreListed}this.ignoreListMessageElement.classList.toggle("hidden",this.showIgnoreListed||!i)}delete this.muteActivateItem}))}createElementForItem(e){const i=document.createElement("div");i.classList.add("call-frame-item");const o=i.createChild("div","call-frame-item-title").createChild("div","call-frame-title-text");if(o.textContent=e.title,e.isAsyncHeader)i.classList.add("async-header");else{t.Tooltip.Tooltip.install(o,e.title);const n=i.createChild("div","call-frame-location");n.textContent=s.StringUtilities.trimMiddle(e.linkText,30),t.Tooltip.Tooltip.install(n,e.linkText),i.classList.toggle("ignore-listed-call-frame",e.isIgnoreListed),e.isIgnoreListed&&t.ARIAUtils.setDescription(i,K(q.onIgnoreList)),Y.has(e)||t.ARIAUtils.setDisabled(i,!0)}const n=Y.get(e),r=n===t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);if(i.classList.toggle("selected",r),t.ARIAUtils.setSelected(i,r),i.classList.toggle("hidden",!this.showIgnoreListed&&e.isIgnoreListed),i.appendChild(t.Icon.Icon.create("smallicon-thick-right-arrow","selected-call-frame-icon")),i.tabIndex=e===this.list.selectedItem()?0:-1,n&&n.warnings.length){const e=t.Icon.Icon.create("smallicon-warning","call-frame-warning-icon");t.Tooltip.Tooltip.install(e,n.warnings.join("\n")),i.appendChild(e)}return i}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,o){i&&(i.tabIndex=-1),o&&(this.setDefaultFocusedElement(o),o.tabIndex=0,this.hasFocus()&&o.focus())}updateSelectedItemARIA(e,t){return!0}createIgnoreListMessageElement(){const e=document.createElement("div");e.classList.add("ignore-listed-message"),e.createChild("span");const i=e.createChild("span","link");i.textContent=K(q.showIgnorelistedFrames),t.ARIAUtils.markAsLink(i),i.tabIndex=0;const o=()=>{this.showIgnoreListed=!0;for(const e of this.items)this.refreshItem(e);this.ignoreListMessageElement.classList.toggle("hidden",!0)};return i.addEventListener("click",o),i.addEventListener("keydown",(e=>"Enter"===e.key&&o())),e}createShowMoreMessageElement(){const e=document.createElement("div");e.classList.add("show-more-message"),e.createChild("span");const t=e.createChild("span","link");return t.textContent=K(q.showMore),t.addEventListener("click",(()=>{this.maxAsyncStackChainDepth+=Q,this.update()}),!1),e}onContextMenu(e){const i=this.list.itemForNode(e.target);if(!i)return;const o=new t.ContextMenu.ContextMenu(e);o.defaultSection().appendItem(K(q.copyStackTrace),this.copyStackTrace.bind(this)),i.uiLocation&&this.appendIgnoreListURLContextMenuItems(o,i.uiLocation.uiSourceCode),o.show()}onClick(e){const t=this.list.itemForNode(e.target);t&&this.activateItem(t)}activateItem(e){const i=e.uiLocation;if(this.muteActivateItem||!i)return;this.list.selectItem(e);const o=Y.get(e),r=this.activeCallFrameItem();o&&r!==e?(o.debuggerModel.setSelectedCallFrame(o),t.Context.Context.instance().setFlavor(a.DebuggerModel.CallFrame,o),r&&this.refreshItem(r),this.refreshItem(e)):n.Revealer.reveal(i)}activeCallFrameItem(){const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);return e&&this.items.find((t=>Y.get(t)===e))||null}appendIgnoreListURLContextMenuItems(e,t){const i=l.Persistence.PersistenceImpl.instance().binding(t);if(i&&(t=i.network),t.project().type()===d.Workspace.projectTypes.FileSystem)return;const o=c.IgnoreListManager.IgnoreListManager.instance().canIgnoreListUISourceCode(t),n=c.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(t),r=t.project().type()===d.Workspace.projectTypes.ContentScripts,s=c.IgnoreListManager.IgnoreListManager.instance();o&&(n?e.defaultSection().appendItem(K(q.removeFromIgnoreList),s.unIgnoreListUISourceCode.bind(s,t)):e.defaultSection().appendItem(K(q.addScriptToIgnoreList),s.ignoreListUISourceCode.bind(s,t))),r&&(n?e.defaultSection().appendItem(K(q.removeAllContentScriptsFrom),s.ignoreListContentScripts.bind(s)):e.defaultSection().appendItem(K(q.addAllContentScriptsToIgnoreList),s.unIgnoreListContentScripts.bind(s)))}selectNextCallFrameOnStack(){const e=this.activeCallFrameItem();for(let t=e?this.items.indexOf(e)+1:0;t<this.items.length;t++){const e=this.items.at(t);if(Y.has(e)){this.activateItem(e);break}}}selectPreviousCallFrameOnStack(){const e=this.activeCallFrameItem();for(let t=e?this.items.indexOf(e)-1:this.items.length-1;t>=0;t--){const e=this.items.at(t);if(Y.has(e)){this.activateItem(e);break}}}copyStackTrace(){const e=[];for(const t of this.items){let i=t.title;t.uiLocation&&(i+=" ("+t.uiLocation.linkText(!0)+")"),e.push(i)}r.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(e.join("\n"))}wasShown(){super.wasShown(),this.registerCSSFiles([z])}}const Y=new WeakMap,X=Symbol("element"),Q=32;let Z;class ee{static instance(e={forceNew:null}){const{forceNew:t}=e;return Z&&!t||(Z=new ee),Z}handleAction(e,t){switch(t){case"debugger.next-call-frame":return J.instance().selectNextCallFrameOnStack(),!0;case"debugger.previous-call-frame":return J.instance().selectPreviousCallFrameOnStack(),!0}return!1}}class te{isIgnoreListed;title;linkText;uiLocation;isAsyncHeader;updateDelegate;static async createForDebuggerCallFrame(e,i,o){const n=new te(t.UIUtils.beautifyFunctionName(e.functionName),o);return await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),n.update.bind(n),i),n}static async createItemsForAsyncStack(e,i,o,n,r){const s=new WeakMap,a=new te(e,r);s.set(a,new Set),a.isAsyncHeader=!0;const l=[],d=[];for(const e of o){const o=new te(t.UIUtils.beautifyFunctionName(e.functionName),u),r=i.createRawLocationByScriptId(e.scriptId,e.lineNumber,e.columnNumber);d.push(c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(r,o.update.bind(o),n)),l.push(o)}return await Promise.all(d),r(a),[a,...l];function u(e){r(e);let t=!1;const i=s.get(a);i&&(e.isIgnoreListed?(i.delete(e),t=0===i.size):(t=0===i.size,i.add(e)),a.isIgnoreListed=0===i.size),t&&r(a)}}constructor(e,t){this.isIgnoreListed=!1,this.title=e,this.linkText="",this.uiLocation=null,this.isAsyncHeader=!1,this.updateDelegate=t}async update(e){const t=await e.uiLocation();this.isIgnoreListed=await e.isIgnoreListed(),this.linkText=t?t.linkText():"",this.uiLocation=t,this.updateDelegate(this)}}var ie=Object.freeze({__proto__:null,CallStackSidebarPane:J,elementSymbol:X,defaultMaxAsyncStackChainDepth:Q,ActionDelegate:ee,Item:te});class oe{uiSourceCode;constructor(e,t){this.uiSourceCode=e}static accepts(e){return!1}willHide(){}async rightToolbarItems(){return[]}leftToolbarItems(){return[]}populateLineGutterContextMenu(e,t){}populateTextAreaContextMenu(e,t,i){}decorationChanged(e,t){}editorExtension(){return[]}editorInitialized(e){}dispose(){}}var ne=Object.freeze({__proto__:null,Plugin:oe});const re={clickToShowCoveragePanel:"Click to show Coverage Panel",showDetails:"Show Details",coverageS:"Coverage: {PH1}",coverageNa:"Coverage: n/a"},se=e.i18n.registerUIStrings("panels/sources/CoveragePlugin.ts",re),ae=e.i18n.getLocalizedString.bind(void 0,se);class ce extends oe{originalSourceCode;infoInToolbar;model;coverage;constructor(e){super(e),this.originalSourceCode=u.SourceFormatter.SourceFormatter.instance().getOriginalUISourceCode(this.uiSourceCode),this.infoInToolbar=new t.Toolbar.ToolbarButton(ae(re.clickToShowCoveragePanel)),this.infoInToolbar.setSecondary(),this.infoInToolbar.addEventListener(t.Toolbar.ToolbarButton.Events.Click,(()=>{t.ViewManager.ViewManager.instance().showView("coverage")}));const i=a.TargetManager.TargetManager.instance().mainTarget();i&&(this.model=i.model(p.CoverageModel.CoverageModel),this.model&&(this.model.addEventListener(p.CoverageModel.Events.CoverageReset,this.handleReset,this),this.coverage=this.model.getCoverageForUrl(this.originalSourceCode.url()),this.coverage&&this.coverage.addEventListener(p.CoverageModel.URLCoverageInfo.Events.SizesChanged,this.handleCoverageSizesChanged,this))),this.updateStats()}dispose(){this.coverage&&this.coverage.removeEventListener(p.CoverageModel.URLCoverageInfo.Events.SizesChanged,this.handleCoverageSizesChanged,this),this.model&&this.model.removeEventListener(p.CoverageModel.Events.CoverageReset,this.handleReset,this)}static accepts(e){return e.contentType().isDocumentOrScriptOrStyleSheet()}handleReset(){this.coverage=null,this.updateStats()}handleCoverageSizesChanged(){this.updateStats()}updateStats(){if(this.coverage){this.infoInToolbar.setTitle(ae(re.showDetails));const t=new Intl.NumberFormat(e.DevToolsLocale.DevToolsLocale.instance().locale,{style:"percent",maximumFractionDigits:1});this.infoInToolbar.setText(ae(re.coverageS,{PH1:t.format(this.coverage.usedPercentage())}))}else this.infoInToolbar.setTitle(ae(re.clickToShowCoveragePanel)),this.infoInToolbar.setText(ae(re.coverageNa))}async rightToolbarItems(){return[this.infoInToolbar]}editorExtension(){return ge.of([])}getCoverageManager(){return this.uiSourceCode.getDecorationData(h.SourceFrame.DecoratorType.COVERAGE)}editorInitialized(e){this.getCoverageManager()&&this.startDecoUpdate(e)}decorationChanged(e,t){e===h.SourceFrame.DecoratorType.COVERAGE&&this.startDecoUpdate(t)}startDecoUpdate(e){const o=this.getCoverageManager();(o?o.usageByLine(this.uiSourceCode):Promise.resolve([])).then((o=>{const n=Boolean(e.state.field(pe,!1));var r;o.length?n?e.dispatch({effects:he.of(o)}):e.dispatch({effects:ge.reconfigure([pe.init((e=>ue(o,e))),(r=this.uiSourceCode.url(),i.gutter({markers:e=>e.state.field(pe),domEventHandlers:{click:()=>(t.ViewManager.ViewManager.instance().showView("coverage").then((()=>{const e=t.ViewManager.ViewManager.instance().view("coverage");return e&&e.widget()})).then((e=>{const t=r.match(/(.*):formatted$/),i=t&&t[1]||r;e.selectCoverageItemByUrl(i)})),!0)},class:"cm-coverageGutter"})),me])}):n&&e.dispatch({effects:ge.reconfigure([])})}))}}const le=new class extends i.GutterMarker{elementClass="cm-coverageUsed"},de=new class extends i.GutterMarker{elementClass="cm-coverageUnused"};function ue(e,t){const o=new i.RangeSetBuilder;for(let i=0;i<e.length;i++){const n=e[i];if(void 0!==n&&i<t.doc.lines){const e=t.doc.line(i+1).from;o.add(e,e,n?le:de)}}return o.finish()}const he=i.StateEffect.define(),pe=i.StateField.define({create:()=>i.RangeSet.empty,update:(e,t)=>t.effects.reduce(((e,i)=>i.is(he)?ue(i.value,t.state):e),e.map(t.changes))});const ge=new i.Compartment,me=i.EditorView.baseTheme({".cm-coverageGutter":{width:"5px",marginLeft:"3px"},".cm-coverageUnused":{backgroundColor:"var(--color-accent-red)"},".cm-coverageUsed":{backgroundColor:"var(--color-coverage-used)"}});var be=Object.freeze({__proto__:null,CoveragePlugin:ce});const fe=new CSSStyleSheet;fe.replaceSync(".paused-status{--override-paused-status-background-color:hsl(50deg 100% 95%);--override-paused-status-color:rgb(107 97 48);padding:6px;border-bottom:1px solid transparent;border-top:1px solid var(--color-details-hairline);background-color:var(--override-paused-status-background-color);color:var(--override-paused-status-color)}.-theme-with-dark-background .paused-status,:host-context(.-theme-with-dark-background) .paused-status{--override-paused-status-background-color:hsl(46deg 98% 22%);--override-paused-status-color:#ccc}.paused-status.error-reason{--override-error-reason-background-color:hsl(0deg 100% 97%);--override-error-reason-color:rgb(107 59 59);background-color:var(--override-error-reason-background-color);color:var(--override-error-reason-color)}.-theme-with-dark-background .paused-status.error-reason,:host-context(.-theme-with-dark-background) .paused-status.error-reason{--override-error-reason-background-color:rgb(79 0 0);--override-error-reason-color:rgb(196 148 148)}.status-main{font-weight:700;padding-left:15px;position:relative}.status-sub:not(:empty){padding-left:15px;padding-top:5px;overflow:hidden;text-overflow:ellipsis}.paused-status.error-reason .status-sub{color:var(--color-red);line-height:11px;max-height:27px;user-select:text}.status-icon{filter:hue-rotate(190deg);position:absolute;left:0;top:calc(50% - 5px)}.paused-status.error-reason .status-icon{filter:none}\n/*# sourceURL=debuggerPausedMessage.css */\n");const ve={pausedOnS:"Paused on {PH1}",childSAdded:"Child {PH1} added",descendantSAdded:"Descendant {PH1} added",descendantSRemoved:"Descendant {PH1} removed",pausedOnEventListener:"Paused on event listener",pausedOnXhrOrFetch:"Paused on XHR or fetch",pausedOnException:"Paused on exception",pausedOnPromiseRejection:"Paused on `promise` rejection",pausedOnAssertion:"Paused on assertion",pausedOnDebuggedFunction:"Paused on debugged function",pausedBeforePotentialOutofmemory:"Paused before potential out-of-memory crash",pausedOnCspViolation:"Paused on CSP violation",trustedTypeSinkViolation:"`Trusted Type` Sink Violation",trustedTypePolicyViolation:"`Trusted Type` Policy Violation",pausedOnBreakpoint:"Paused on breakpoint",debuggerPaused:"Debugger paused",subtreeModifications:"subtree modifications",attributeModifications:"attribute modifications",nodeRemoval:"node removal"},Se=e.i18n.registerUIStrings("panels/sources/DebuggerPausedMessage.ts",ve),Ce=e.i18n.getLocalizedString.bind(void 0,Se),we=e.i18n.getLazilyComputedLocalizedString.bind(void 0,Se);class Ie{elementInternal;contentElement;constructor(){this.elementInternal=document.createElement("div"),this.elementInternal.classList.add("paused-message"),this.elementInternal.classList.add("flex-none");const e=t.Utils.createShadowRootWithCoreStyles(this.elementInternal,{cssFile:[fe],delegatesFocus:void 0});this.contentElement=e.createChild("div"),t.ARIAUtils.markAsPoliteLiveRegion(this.elementInternal,!1)}element(){return this.elementInternal}static descriptionWithoutStack(e){const t=/^\s+at\s/m.exec(e);return t?e.substring(0,t.index-1):e.substring(0,e.lastIndexOf("\n"))}static async createDOMBreakpointHitMessage(i){const o=document.createElement("span"),r=i.debuggerModel.target().model(a.DOMDebuggerModel.DOMDebuggerModel);if(!i.auxData||!r)return o;const s=r.resolveDOMBreakpointData(i.auxData);if(!s)return o;const c=o.createChild("div","status-main");c.appendChild(t.Icon.Icon.create("smallicon-info","status-icon"));const l=ke.get(s.type);c.appendChild(document.createTextNode(Ce(ve.pausedOnS,{PH1:l?l():String(null)})));const d=o.createChild("div","status-sub monospace"),u=await n.Linkifier.Linkifier.linkify(s.node);if(d.appendChild(u),s.targetNode){const t=await n.Linkifier.Linkifier.linkify(s.targetNode);let i;i=s.insertion?s.targetNode===s.node?e.i18n.getFormatLocalizedString(Se,ve.childSAdded,{PH1:t}):e.i18n.getFormatLocalizedString(Se,ve.descendantSAdded,{PH1:t}):e.i18n.getFormatLocalizedString(Se,ve.descendantSRemoved,{PH1:t}),d.appendChild(document.createElement("br")),d.appendChild(i)}return o}async render(e,i,o){if(this.contentElement.removeChildren(),this.contentElement.hidden=!e,!e)return;const n=this.contentElement.createChild("div","paused-status"),r="exception"===e.reason||"promiseRejection"===e.reason||"assert"===e.reason||"OOM"===e.reason;let s;if("DOM"===e.reason)s=await Ie.createDOMBreakpointHitMessage(e);else if("EventListener"===e.reason){let t="";if(e.auxData){const i=a.EventBreakpointsModel.EventBreakpointsManager.instance().resolveEventListenerBreakpointTitle(e.auxData);t=i||a.DOMDebuggerModel.DOMDebuggerManager.instance().resolveEventListenerBreakpointTitle(e.auxData)}s=c(Ce(ve.pausedOnEventListener),t)}else if("XHR"===e.reason){const t=e.auxData;s=c(Ce(ve.pausedOnXhrOrFetch),t.url||"")}else if("exception"===e.reason){const t=e.auxData,i=t.description||t.value||"",o=Ie.descriptionWithoutStack(i);s=c(Ce(ve.pausedOnException),o,i)}else if("promiseRejection"===e.reason){const t=e.auxData,i=t.description||t.value||"",o=Ie.descriptionWithoutStack(i);s=c(Ce(ve.pausedOnPromiseRejection),o,i)}else if("assert"===e.reason)s=c(Ce(ve.pausedOnAssertion));else if("debugCommand"===e.reason)s=c(Ce(ve.pausedOnDebuggedFunction));else if("OOM"===e.reason)s=c(Ce(ve.pausedBeforePotentialOutofmemory));else if("CSPViolation"===e.reason&&e.auxData&&e.auxData.violationType){const t=e.auxData.violationType;"trustedtype-sink-violation"===t?s=c(Ce(ve.pausedOnCspViolation),Ce(ve.trustedTypeSinkViolation)):"trustedtype-policy-violation"===t&&(s=c(Ce(ve.pausedOnCspViolation),Ce(ve.trustedTypePolicyViolation)))}else if(e.callFrames.length){const t=await i.rawLocationToUILocation(e.callFrames[0].location()),n=t?o.findBreakpoint(t):null;s=c(Ce(n?ve.pausedOnBreakpoint:ve.debuggerPaused))}else console.warn("ScriptsPanel paused, but callFrames.length is zero.");function c(e,i,o){const n=document.createElement("span"),s=n.createChild("div","status-main"),a=t.Icon.Icon.create(r?"smallicon-error":"smallicon-info","status-icon");if(s.appendChild(a),s.appendChild(document.createTextNode(e)),i){const e=n.createChild("div","status-sub monospace");e.textContent=i,t.Tooltip.Tooltip.install(e,o||i)}return n}n.classList.toggle("error-reason",r),s&&n.appendChild(s)}}const ke=new Map([["subtree-modified",we(ve.subtreeModifications)],["attribute-modified",we(ve.attributeModifications)],["node-removed",we(ve.nodeRemoval)]]);var xe=Object.freeze({__proto__:null,DebuggerPausedMessage:Ie,BreakpointTypeNouns:ke});class ye{sourcesView;entries=[];current=-1;revealing=!1;constructor(e){this.sourcesView=e}trackSourceFrameCursorJumps(e){e.addEventListener("EditorUpdate",(t=>this.onEditorUpdate(t.data,e)))}onEditorUpdate(e,t){e.docChanged&&this.mapEntriesFor(t.uiSourceCode(),e.changes);const i=e.startState.selection.main,o=e.state.selection.main;!this.revealing&&i.anchor!==o.anchor&&e.transactions.some((e=>Boolean(e.isUserEvent("select.pointer")||e.isUserEvent("select.reveal")||e.isUserEvent("select.search"))))&&(this.updateCurrentState(t.uiSourceCode(),i.head),this.entries.length>this.current+1&&(this.entries.length=this.current+1),this.entries.push(new Ee(t.uiSourceCode(),o.head)),this.current++,this.entries.length>20&&(this.entries.shift(),this.current--))}updateCurrentState(e,t){if(!this.revealing){const i=this.current>=0?this.entries[this.current]:null;i?.matches(e)&&(i.position=t)}}mapEntriesFor(e,t){for(const i of this.entries)i.matches(e)&&(i.position=t.mapPos(i.position))}reveal(e){const t=d.Workspace.WorkspaceImpl.instance().uiSourceCode(e.projectId,e.url);t&&(this.revealing=!0,this.sourcesView.showSourceLocation(t,e.position,!1,!0),this.revealing=!1)}rollback(){this.current>0&&(this.current--,this.reveal(this.entries[this.current]))}rollover(){this.current<this.entries.length-1&&(this.current++,this.reveal(this.entries[this.current]))}removeHistoryForSourceCode(e){for(let t=this.entries.length-1;t>=0;t--)this.entries[t].matches(e)&&(this.entries.splice(t,1),this.current>=t&&this.current--)}}class Ee{projectId;url;position;constructor(e,t){this.projectId=e.project().id(),this.url=e.url(),this.position=t}matches(e){return this.url===e.url()&&this.projectId===e.project().id()}}var Te=Object.freeze({__proto__:null,HistoryDepth:20,EditingLocationHistoryManager:ye});const Le=new CSSStyleSheet;Le.replaceSync("#sources-panel-sources-view{--override-highlight-animation-10pc-background-color:rgb(158 54 153);--override-highlight-animation-10pc-foreground-color:rgb(255 255 255);flex:auto;position:relative}#sources-panel-sources-view .sources-toolbar{display:flex;flex:0 0 27px;background-color:var(--color-background-elevation-1);border-top:var(--legacy-divider-border);overflow:hidden;z-index:0}.sources-toolbar .toolbar{cursor:default}.source-frame-debugger-script{--override-debugger-background-tint:rgb(255 255 194 / 50%);background-color:var(--override-debugger-background-tint)}.-theme-with-dark-background .source-frame-debugger-script{--override-debugger-background-tint:rgb(61 61 0 / 50%)}\n/*# sourceURL=sourcesView.css */\n");const Me={openColorPicker:"Open color picker.",openCubicBezierEditor:"Open cubic bezier editor."},Fe=e.i18n.registerUIStrings("panels/sources/CSSPlugin.ts",Me),Pe=e.i18n.getLocalizedString.bind(void 0,Fe);function De(){const{cssCompletionSource:e}=i.css;return i.autocompletion({override:[async t=>await function(e){const t=i.syntaxTree(e.state).resolveInner(e.pos,-1),o=function(e,t){if(Ae.has(e.name))return null;for(let i=e;i&&"StyleSheet"!==i.name;i=i.parent)if("Declaration"===i.name){const e=i.getChild("PropertyName"),o=i.getChild(":");return e&&o&&o.to<=t?e:null}return null}(t,e.pos);if(!o)return null;const n=a.CSSMetadata.cssMetadata().getPropertyValues(e.state.sliceDoc(o.from,o.to));return{from:"ValueName"===t.name?t.from:e.pos,options:n.map((e=>({type:"constant",label:e}))),span:/^[\w\P{ASCII}\-]+$/u}}(t)||e(t)]})}const Ae=new Set(["ColorLiteral","NumberLiteral","StringLiteral","Comment","Important"]);class Be extends i.WidgetType{color;text;constructor(e,t){super(),this.color=e,this.text=t}eq(e){return this.color.equal(e.color)&&this.text===e.text}toDOM(e){const t=new x.ColorSwatch.ColorSwatch;t.renderColor(this.color,!1,Pe(Me.openColorPicker));const i=t.createChild("span");return i.textContent=this.text,i.setAttribute("hidden","true"),t.addEventListener(x.ColorSwatch.ClickEvent.eventName,(i=>{i.consume(!0),e.dispatch({effects:Ue.of({type:0,pos:e.posAtDOM(t),text:this.text,swatch:t,color:this.color})})})),t}ignoreEvent(){return!0}}class Ne extends i.WidgetType{curve;text;constructor(e,t){super(),this.curve=e,this.text=t}eq(e){return this.curve.asCSSText()===e.curve.asCSSText()&&this.text===e.text}toDOM(e){const i=x.Swatches.BezierSwatch.create();return i.setBezierText(this.text),t.Tooltip.Tooltip.install(i.iconElement(),Pe(Me.openCubicBezierEditor)),i.iconElement().addEventListener("click",(t=>{t.consume(!0),e.dispatch({effects:Ue.of({type:1,pos:e.posAtDOM(i),text:this.text,swatch:i,curve:this.curve})})}),!1),i.hideText(!0),i}ignoreEvent(){return!0}}const Ue=i.StateEffect.define(),Ve=i.Annotation.define(),je=i.StateField.define({create:()=>null,update(e,t){!t.docChanged&&!t.selection||t.annotation(Ve)||(e=null);for(const i of t.effects)i.is(Ue)&&(e=i.value);return e},provide:e=>i.showTooltip.from(e,(e=>e&&function(e){return{pos:e.pos,arrow:!0,create(t){let i,o,n=e.text;if(0===e.type){const n=new k.Spectrum.Spectrum;o=e=>{n.addEventListener(k.Spectrum.Events.ColorChanged,e)},n.addEventListener(k.Spectrum.Events.SizeChanged,(()=>t.requestMeasure())),n.setColor(e.color,e.color.format()),i=n}else{const t=new x.BezierEditor.BezierEditor(e.curve);i=t,o=e=>{t.addEventListener(x.BezierEditor.Events.BezierChanged,e)}}const r=document.createElement("div");return r.className="cm-tooltip-swatchEdit",i.markAsRoot(),i.show(r),i.showWidget(),i.element.addEventListener("keydown",(i=>{"Escape"===i.key&&(i.consume(),t.dispatch({effects:Ue.of(null),changes:n===e.text?void 0:{from:e.pos,to:e.pos+n.length,insert:e.text}}),t.focus())})),i.element.addEventListener("focusout",(e=>{e.relatedTarget&&!i.element.contains(e.relatedTarget)&&t.dispatch({effects:Ue.of(null)})}),!1),i.element.addEventListener("mousedown",(e=>e.consume())),{dom:r,offset:{x:-8,y:0},mount:()=>{i.focus(),i.wasShown(),o((i=>{t.dispatch({changes:{from:e.pos,to:e.pos+n.length,insert:i.data},annotations:Ve.of(!0)}),n=i.data}))}}}}}(e)))});function We(e,o,r){const s=new i.RangeSetBuilder;return function(e,o,r,s,a){let c=e.doc.lineAt(o);function l(t,i){return t>=c.to&&(c=e.doc.lineAt(t)),c.text.slice(t-c.from,i-c.from)}const d=i.ensureSyntaxTree(e,r,100);d&&d.iterate({from:o,to:r,enter:(i,o,r,c)=>{let d;if("ValueName"===i.name||"ColorLiteral"===i.name?d=l(o,r):"Callee"===i.name&&/^(?:(?:rgb|hsl)a?|cubic-bezier)$/.test(l(o,r))&&(d=e.sliceDoc(o,c().parent.to)),d){const e=n.Color.Color.parse(d);if(e)s(o,e,d);else{const e=t.Geometry.CubicBezier.parse(d);e&&a(o,e,d)}}}})}(e,o,r,((e,t,o)=>{s.add(e,e,i.Decoration.widget({widget:new Be(t,o)}))}),((e,t,o)=>{s.add(e,e,i.Decoration.widget({widget:new Ne(t,o)}))})),s.finish()}const Oe=i.ViewPlugin.fromClass(class{decorations;constructor(e){this.decorations=We(e.state,e.viewport.from,e.viewport.to)}update(e){(e.viewportChanged||e.docChanged)&&(this.decorations=We(e.state,e.view.viewport.from,e.view.viewport.to))}},{decorations:e=>e.decorations});function Re(e){if("Unit"===e.name&&(e=e.parent),"NumberLiteral"===e.name){const t=e.lastChild;return{from:e.from,to:t&&"Unit"===t.name?t.from:e.to}}return null}function He(e,t){const{head:o}=e.state.selection.main,n=i.syntaxTree(e.state).resolveInner(o,-1),r=Re(n)||Re(n.resolve(o,1));if(!r)return!1;const s=Number(e.state.sliceDoc(r.from,r.to));return!isNaN(s)&&(e.dispatch({changes:{from:r.from,to:r.to,insert:String(s+t)},scrollIntoView:!0,userEvent:"insert.modifyUnit"}),!0)}function _e(){let e=null;const o=t.ShortcutRegistry.ShortcutRegistry.instance().getShortcutListener({"sources.increment-css":()=>Promise.resolve(He(e,1)),"sources.increment-css-by-ten":()=>Promise.resolve(He(e,10)),"sources.decrement-css":()=>Promise.resolve(He(e,-1)),"sources.decrement-css-by-ten":()=>Promise.resolve(He(e,-10))});return i.EditorView.domEventHandlers({keydown:(t,i)=>{const n=e;return e=i,o(t),e=n,t.defaultPrevented}})}class ze extends oe{static accepts(e){return e.contentType().isStyleSheet()}editorExtension(){return[_e(),De(),[Oe,je]]}}const qe={ms:"ms",mb:"MB",kb:"kB"},Ge=e.i18n.registerUIStrings("panels/sources/ProfilePlugin.ts",qe),Ke=e.i18n.getLocalizedString.bind(void 0,Ge);class $e extends i.GutterMarker{value;constructor(e){super(),this.value=e}eq(e){return this.value===e.value}toDOM(){const e=document.createElement("div");e.className="cm-profileMarker";let t=this.value;const i=s.NumberUtilities.clamp(Math.log10(1+.002*t)/5,.02,1);let o,n;e.style.backgroundColor=`hsla(217, 100%, 70%, ${i.toFixed(3)})`,t/=1e3,t>=1e3?(o=Ke(qe.mb),t/=1e3,n=t>=20?0:1):(o=Ke(qe.kb),n=0),e.textContent=t.toFixed(n);const r=e.appendChild(document.createElement("span"));return r.className="cm-units",r.textContent=o,e}}class Je extends i.GutterMarker{value;constructor(e){super(),this.value=e}eq(e){return this.value===e.value}toDOM(){const e=document.createElement("div");e.className="cm-profileMarker";const t=s.NumberUtilities.clamp(Math.log10(1+10*this.value)/5,.02,1);e.textContent=this.value.toFixed(1),e.style.backgroundColor=`hsla(44, 100%, 50%, ${t.toFixed(3)})`;const i=document.createElement("span");return i.className="cm-units",i.textContent=Ke(qe.ms),e.appendChild(i),e}}function Ye(e,t,o){const n=o===h.SourceFrame.DecoratorType.PERFORMANCE?Je:$e,r=[];for(const[i,o]of e)if(i<=t.doc.lines){const{from:e}=t.doc.line(i);r.push(new n(o).range(e))}return i.RangeSet.of(r,!0)}const Xe=e=>class extends oe{updateEffect=i.StateEffect.define();field;gutter;compartment=new i.Compartment;constructor(t){super(t),this.field=i.StateField.define({create:()=>i.RangeSet.empty,update:(t,i)=>i.effects.reduce(((t,o)=>o.is(this.updateEffect)?Ye(o.value,i.state,e):t),t.map(i.changes))}),this.gutter=i.gutter({markers:e=>e.state.field(this.field),class:`cm-${e}Gutter`})}static accepts(e){return e.contentType().hasScripts()}getLineMap(){return this.uiSourceCode.getDecorationData(e)}editorExtension(){const t=this.getLineMap();return this.compartment.of(t?[this.field.init((i=>Ye(t,i,e))),this.gutter,Qe]:[])}decorationChanged(e,t){const i=Boolean(t.state.field(this.field,!1)),o=this.getLineMap();o?i?t.dispatch({effects:this.updateEffect.of(o)}):t.dispatch({effects:this.compartment.reconfigure([this.field.init((t=>Ye(o,t,e))),this.gutter,Qe])}):i&&t.dispatch({effects:this.compartment.reconfigure([])})}},Qe=i.EditorView.baseTheme({".cm-performanceGutter":{width:"60px",backgroundColor:"var(--color-background)",marginLeft:"3px"},".cm-memoryGutter":{width:"48px",backgroundColor:"var(--color-background)",marginLeft:"3px"},".cm-profileMarker":{textAlign:"right",paddingRight:"3px"},".cm-profileMarker .cm-units":{color:"var(--color-text-secondary)",fontSize:"75%",marginLeft:"3px"}}),Ze=Xe(h.SourceFrame.DecoratorType.MEMORY),et=Xe(h.SourceFrame.DecoratorType.PERFORMANCE);class tt extends oe{compiling=!1;recompileScheduled=!1;timeout=null;message=null;disposed=!1;editor=null;constructor(e){super(e)}editorExtension(){return i.EditorView.updateListener.of((e=>{e.docChanged&&this.scheduleCompile()}))}editorInitialized(e){this.editor=e,(this.uiSourceCode.hasCommits()||this.uiSourceCode.isDirty())&&this.scheduleCompile()}static accepts(e){if("js"===e.extension())return!0;if(S.ScriptSnippetFileSystem.isSnippetsUISourceCode(e))return!0;for(const t of a.TargetManager.TargetManager.instance().models(a.DebuggerModel.DebuggerModel))if(c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptFile(e,t))return!0;return!1}scheduleCompile(){this.compiling?this.recompileScheduled=!0:(this.timeout&&clearTimeout(this.timeout),this.timeout=window.setTimeout(this.compile.bind(this),it))}findRuntimeModel(){const e=a.TargetManager.TargetManager.instance().models(a.DebuggerModel.DebuggerModel);for(let t=0;t<e.length;++t){if(c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptFile(this.uiSourceCode,e[t]))return e[t].runtimeModel()}const t=a.TargetManager.TargetManager.instance().mainTarget();return t?t.model(a.RuntimeModel.RuntimeModel):null}async compile(){const e=this.findRuntimeModel();if(!e||!this.editor)return;const i=t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);if(!i)return;if(this.editor.state.doc.length>102400)return;const o=this.editor.state.doc.toString();if(c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptsForResource(this.uiSourceCode).reduce(((e,t)=>e||!0===t.isModule),!1))return;this.compiling=!0;const n=await e.compileScript(o,"",!1,i.id);if(this.compiling=!1,this.recompileScheduled)return this.recompileScheduled=!1,void this.scheduleCompile();if(this.message&&(this.uiSourceCode.removeMessage(this.message),this.message=null),this.disposed||!n||!n.exceptionDetails)return;const r=n.exceptionDetails,s=a.RuntimeModel.RuntimeModel.simpleTextFromException(r);this.message=this.uiSourceCode.addLineMessage(d.UISourceCode.Message.Level.Error,s,r.lineNumber,r.columnNumber),this.compilationFinishedForTest()}compilationFinishedForTest(){}dispose(){this.message&&this.uiSourceCode.removeMessage(this.message),this.disposed=!0,this.timeout&&clearTimeout(this.timeout)}}const it=1e3;var ot=Object.freeze({__proto__:null,JavaScriptCompilerPlugin:tt,CompileDelay:it});const nt={sourceMappedFromS:"(source mapped from {PH1})",providedViaDebugInfoByS:"(provided via debug info by {PH1})"},rt=e.i18n.registerUIStrings("panels/sources/ScriptOriginPlugin.ts",nt);class st extends oe{static accepts(e){return e.contentType().hasScripts()||Boolean(st.script(e))}async rightToolbarItems(){const i=c.CompilerScriptMapping.CompilerScriptMapping.uiSourceCodeOrigin(this.uiSourceCode);if(i.length)return i.map((i=>{const o=e.i18n.getFormatLocalizedString(rt,nt.sourceMappedFromS,{PH1:y.Linkifier.Linkifier.linkifyURL(i)});return new t.Toolbar.ToolbarItem(o)}));const o=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().pluginManager;if(o)for(const i of o.scriptsForUISourceCode(this.uiSourceCode))if(i.sourceURL){const o=e.i18n.getFormatLocalizedString(rt,nt.providedViaDebugInfoByS,{PH1:y.Linkifier.Linkifier.linkifyURL(i.sourceURL)});return[new t.Toolbar.ToolbarItem(o)]}const n=await st.script(this.uiSourceCode);if(!n||!n.originStackTrace)return[];const r=at.linkifyStackTraceTopFrame(n.debuggerModel.target(),n.originStackTrace);return[new t.Toolbar.ToolbarItem(r)]}static async script(e){const t=await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(e,0,0);for(const e of t){const t=e.script();if(t&&t.originStackTrace)return t}return null}}const at=new y.Linkifier.Linkifier;var ct=Object.freeze({__proto__:null,ScriptOriginPlugin:st,linkifier:at});const lt={enter:"âŒ˜+Enter",ctrlenter:"Ctrl+Enter"},dt=e.i18n.registerUIStrings("panels/sources/SnippetsPlugin.ts",lt),ut=e.i18n.getLocalizedString.bind(void 0,dt);class ht extends oe{static accepts(e){return S.ScriptSnippetFileSystem.isSnippetsUISourceCode(e)}async rightToolbarItems(){const e=t.Toolbar.Toolbar.createActionButtonForId("debugger.run-snippet");return e.setText(r.Platform.isMac()?ut(lt.enter):ut(lt.ctrlenter)),[e]}}var pt=Object.freeze({__proto__:null,SnippetsPlugin:ht});const gt=new CSSStyleSheet;gt.replaceSync(".scripts-debug-toolbar{position:absolute;top:0;width:100%;background-color:var(--color-background-elevation-1);border-bottom:1px solid var(--color-details-hairline);overflow:hidden;z-index:1}.scripts-debug-toolbar-drawer{flex:0 0 52px;transition:margin-top .1s ease-in-out;margin-top:-26px;padding-top:25px;background-color:var(--color-background);overflow:hidden;white-space:nowrap}.scripts-debug-toolbar-drawer.expanded{margin-top:0}.scripts-debug-toolbar-drawer>[is=dt-checkbox]{display:none;padding-left:3px;height:28px}.scripts-debug-toolbar-drawer.expanded>[is=dt-checkbox]{display:flex}.cursor-auto{cursor:auto}.navigator-tabbed-pane{background-color:var(--color-background-elevation-1)}\n/*# sourceURL=sourcesPanel.css */\n");const mt=new CSSStyleSheet;mt.replaceSync(":host{overflow-y:auto}.icon,.icon-badge{margin:-3px -5px}.icon-stack{position:relative;display:inline-flex}.icon-stack>[is=ui-icon]:not(:first-child){position:absolute;left:0;top:0}.tree-outline{--override-folder-tree-item-color:#555;--override-file-tree-item-color:hsl(0deg 0% 50%);--override-sm-folder-fs-tree-fs-folder-item-color:hsl(28deg 75% 50%);--override-nw-folder-tree-item-color:hsl(210deg 82% 62%);--override-script-snippet-tree-item-color:hsl(48deg 70% 50%);--override-stylesheet-tree-item-color:hsl(256deg 50% 50%);--override-image-font-tree-item-color:hsl(109deg 33% 50%)}.-theme-with-dark-background .tree-outline,:host-context(.-theme-with-dark-background) .tree-outline{--override-folder-tree-item-color:rgb(170 170 170);--override-file-tree-item-color:rgb(127 127 127);--override-sm-folder-fs-tree-fs-folder-item-color:rgb(223 121 32);--override-nw-folder-tree-item-color:rgb(17 96 176);--override-script-snippet-tree-item-color:rgb(217 181 38);--override-stylesheet-tree-item-color:rgb(98 64 191);--override-image-font-tree-item-color:rgb(101 170 85)}.navigator-file-tree-item .icon{background:var(--override-file-tree-item-color)}.navigator-fs-folder-tree-item:not(.has-mapped-files):not(.selected)>:not(.selection),.navigator-fs-tree-item:not(.has-mapped-files):not(.selected)>:not(.selection){filter:grayscale(50%);opacity:50%}.tree-outline li{min-height:20px}.tree-outline li:hover:not(.selected) .selection{display:block;background-color:var(--item-hover-color)}.navigator-folder-tree-item .icon{background-color:var(--override-folder-tree-item-color)}.navigator-fs-folder-tree-item .icon,.navigator-fs-tree-item .icon,.navigator-sm-folder-tree-item .icon{background:var(--override-sm-folder-fs-tree-fs-folder-item-color)}.navigator-nw-folder-tree-item .icon{background:var(--override-nw-folder-tree-item-color)}.navigator-script-tree-item .icon,.navigator-sm-script-tree-item .icon,.navigator-snippet-tree-item .icon{background:var(--override-script-snippet-tree-item-color)}.navigator-sm-stylesheet-tree-item .icon,.navigator-stylesheet-tree-item .icon{background:var(--override-stylesheet-tree-item-color)}.navigator-font-tree-item .icon,.navigator-image-tree-item .icon{background:var(--override-image-font-tree-item-color)}.navigator-sm-folder-tree-item .tree-element-title,.navigator-sm-script-tree-item .tree-element-title,.navigator-sm-stylesheet-tree-item .tree-element-title{font-style:italic}@media (forced-colors:active){.tree-outline li .leading-icons [is=ui-icon].icon-mask{background:ButtonText}.tree-outline li:hover:not(.selected) .selection{forced-color-adjust:none;background-color:Highlight}.tree-outline:not(.hide-selection-when-blurred) li.parent:hover:not(.selected)::before,.tree-outline:not(.hide-selection-when-blurred) li:hover:not(.selected) [is=ui-icon].icon-mask{background-color:HighlightText}.tree-outline li:not(.selected):hover .tree-element-title{forced-color-adjust:none;color:HighlightText}}\n/*# sourceURL=navigatorTree.css */\n");const bt=new CSSStyleSheet;bt.replaceSync(".navigator-toolbar{border-bottom:1px solid var(--color-details-hairline);padding-left:8px}\n/*# sourceURL=navigatorView.css */\n");class ft{searchId;searchResultCandidates;searchResultCallback;searchFinishedCallback;searchConfig;constructor(){this.searchId=0,this.searchResultCandidates=[],this.searchResultCallback=null,this.searchFinishedCallback=null,this.searchConfig=null}static filesComparator(e,t){if(e.isDirty()&&!t.isDirty())return-1;if(!e.isDirty()&&t.isDirty())return 1;const i=e.project().type()===d.Workspace.projectTypes.FileSystem&&!l.Persistence.PersistenceImpl.instance().binding(e);if(i!==(t.project().type()===d.Workspace.projectTypes.FileSystem&&!l.Persistence.PersistenceImpl.instance().binding(t)))return i?1:-1;const o=e.url(),n=t.url();return o&&!n?-1:!o&&n?1:s.StringUtilities.naturalOrderComparator(e.fullDisplayName(),t.fullDisplayName())}performIndexing(e){this.stopSearch();const t=this.projects(),i=new n.Progress.CompositeProgress(e);for(let e=0;e<t.length;++e){const o=t[e],n=i.createSubProgress(o.uiSourceCodes().length);o.indexContent(n)}}projects(){const e=n.Settings.Settings.instance().moduleSetting("searchInAnonymousAndContentScripts").get();return d.Workspace.WorkspaceImpl.instance().projects().filter((t=>t.type()!==d.Workspace.projectTypes.Service&&(!(!e&&t.isServiceProject()&&t.type()!==d.Workspace.projectTypes.Formatter)&&!(!e&&t.type()===d.Workspace.projectTypes.ContentScripts))))}performSearch(e,t,i,o){this.stopSearch(),this.searchResultCandidates=[],this.searchResultCallback=i,this.searchFinishedCallback=o,this.searchConfig=e;const r=[],s=new n.Progress.CompositeProgress(t),a=s.createSubProgress(),c=new n.Progress.CompositeProgress(s.createSubProgress());for(const t of this.projects()){const i=t.uiSourceCodes().length,o=c.createSubProgress(i),n=this.projectFilesMatchingFileQuery(t,e),s=t.findFilesMatchingSearchRequest(e,n,o).then(this.processMatchingFilesForProject.bind(this,this.searchId,t,e,n));r.push(s)}Promise.all(r).then(this.processMatchingFiles.bind(this,this.searchId,a,this.searchFinishedCallback.bind(this,!0)))}projectFilesMatchingFileQuery(e,t,i){const o=[],n=e.uiSourceCodes();for(let e=0;e<n.length;++e){const r=n[e];if(!r.contentType().isTextType())continue;const s=l.Persistence.PersistenceImpl.instance().binding(r);s&&s.network===r||(i&&!r.isDirty()||t.filePathMatchesFileQuery(r.fullDisplayName())&&o.push(r.url()))}return o.sort(s.StringUtilities.naturalOrderComparator),o}processMatchingFilesForProject(e,t,i,o,n){if(e!==this.searchId&&this.searchFinishedCallback)return void this.searchFinishedCallback(!1);n.sort(s.StringUtilities.naturalOrderComparator),n=s.ArrayUtilities.intersectOrdered(n,o,s.StringUtilities.naturalOrderComparator);const r=this.projectFilesMatchingFileQuery(t,i,!0);n=s.ArrayUtilities.mergeOrdered(n,r,s.StringUtilities.naturalOrderComparator);const a=[];for(const e of n){const i=t.uiSourceCodeForURL(e);if(!i)continue;const o=c.DefaultScriptMapping.DefaultScriptMapping.scriptForUISourceCode(i);o&&!o.isAnonymousScript()||a.push(i)}a.sort(ft.filesComparator),this.searchResultCandidates=s.ArrayUtilities.mergeOrdered(this.searchResultCandidates,a,ft.filesComparator)}processMatchingFiles(e,t,i){if(e!==this.searchId&&this.searchFinishedCallback)return void this.searchFinishedCallback(!1);const o=this.searchResultCandidates;if(!o.length)return t.done(),void i();t.setTotalWork(o.length);let n=0;let r=0;for(let e=0;e<20&&e<o.length;++e)c.call(this);function a(e){e.isDirty()?l.call(this,e,e.workingCopy()):e.requestContent().then((t=>{l.call(this,e,t.content||"")}))}function c(){if(n>=o.length)return r?void 0:(t.done(),void i());++r;const e=o[n++];setTimeout(a.bind(this,e),0)}function l(e,i){function o(e,t){return e.lineNumber-t.lineNumber}t.incrementWorked(1);let n=[];const a=this.searchConfig,l=a.queries();if(null!==i)for(let e=0;e<l.length;++e){const t=m.TextUtils.performSearchInContent(i,l[e],!a.ignoreCase(),a.isRegex());n=s.ArrayUtilities.mergeOrdered(n,t,o)}if(n&&this.searchResultCallback){const t=new vt(e,n);this.searchResultCallback(t)}--r,c.call(this)}}stopSearch(){++this.searchId}}class vt{uiSourceCode;searchMatches;constructor(e,t){this.uiSourceCode=e,this.searchMatches=t}label(){return this.uiSourceCode.displayName()}description(){return this.uiSourceCode.fullDisplayName()}matchesCount(){return this.searchMatches.length}matchLineContent(e){return this.searchMatches[e].lineContent}matchRevealable(e){const t=this.searchMatches[e];return this.uiSourceCode.uiLocation(t.lineNumber,t.columnNumber)}matchLabel(e){return this.searchMatches[e].lineNumber+1}}var St=Object.freeze({__proto__:null,SourcesSearchScope:ft,FileBasedSearchResult:vt});let Ct,wt;class It extends E.SearchView.SearchView{constructor(){super("sources")}static instance(){return Ct||(Ct=new It),Ct}static async openSearch(e,i){const o=t.ViewManager.ViewManager.instance().view("sources.search-sources-tab");(await t.ViewManager.ViewManager.instance().resolveLocation("drawer-view")).appendView(o),await t.ViewManager.ViewManager.instance().revealView(o);const n=await o.widget();return n.toggle(e,Boolean(i)),n}createScope(){return new ft}}class kt{static instance(e={forceNew:null}){const{forceNew:t}=e;return wt&&!t||(wt=new kt),wt}handleAction(e,t){return this.showSearch(),!0}showSearch(){const e=t.InspectorView.InspectorView.instance().element.window().getSelection();let i="";return e&&e.rangeCount&&(i=e.toString().replace(/\r?\n.*/,"")),It.openSearch(i)}}var xt=Object.freeze({__proto__:null,SearchSourcesView:It,ActionDelegate:kt});const yt={searchInFolder:"Search in folder",searchInAllFiles:"Search in all files",noDomain:"(no domain)",areYouSureYouWantToExcludeThis:"Are you sure you want to exclude this folder?",areYouSureYouWantToDeleteThis:"Are you sure you want to delete this file?",rename:"Renameâ€¦",makeACopy:"Make a copyâ€¦",delete:"Delete",areYouSureYouWantToDeleteAll:"Are you sure you want to delete all overrides contained in this folder?",openFolder:"Open folder",newFile:"New file",excludeFolder:"Exclude folder",removeFolderFromWorkspace:"Remove folder from workspace",areYouSureYouWantToRemoveThis:"Are you sure you want to remove this folder?",deleteAllOverrides:"Delete all overrides",sFromSourceMap:"{PH1} (from source map)"},Et=e.i18n.registerUIStrings("panels/sources/NavigatorView.ts",yt),Tt=e.i18n.getLocalizedString.bind(void 0,Et),Lt={Domain:"domain",File:"file",FileSystem:"fs",FileSystemFolder:"fs-folder",Frame:"frame",NetworkFolder:"nw-folder",Root:"root",SourceMapFolder:"sm-folder",Worker:"worker"},Mt=new Map([[Lt.Root,1],[Lt.Domain,10],[Lt.FileSystemFolder,1],[Lt.NetworkFolder,1],[Lt.SourceMapFolder,2],[Lt.File,10],[Lt.Frame,70],[Lt.Worker,90],[Lt.FileSystem,100]]);class Ft extends t.Widget.VBox{placeholder;scriptsTree;uiSourceCodeNodes;subfolderNodes;rootNode;frameNodes;navigatorGroupByFolderSetting;workspaceInternal;lastSelectedUISourceCode;groupByFrame;groupByDomain;groupByFolder;constructor(){super(!0),this.placeholder=null,this.scriptsTree=new t.TreeOutline.TreeOutlineInShadow,this.scriptsTree.setComparator(Ft.treeElementsCompare),this.scriptsTree.setFocusable(!1),this.contentElement.appendChild(this.scriptsTree.element),this.setDefaultFocusedElement(this.scriptsTree.element),this.uiSourceCodeNodes=new s.MapUtilities.Multimap,this.subfolderNodes=new Map,this.rootNode=new Nt(this),this.rootNode.populate(),this.frameNodes=new Map,this.contentElement.addEventListener("contextmenu",this.handleContextMenu.bind(this),!1),t.ShortcutRegistry.ShortcutRegistry.instance().addShortcutListener(this.contentElement,{"sources.rename":this.renameShortcut.bind(this)}),this.navigatorGroupByFolderSetting=n.Settings.Settings.instance().moduleSetting("navigatorGroupByFolder"),this.navigatorGroupByFolderSetting.addChangeListener(this.groupingChanged.bind(this)),this.initGrouping(),l.Persistence.PersistenceImpl.instance().addEventListener(l.Persistence.Events.BindingCreated,this.onBindingChanged,this),l.Persistence.PersistenceImpl.instance().addEventListener(l.Persistence.Events.BindingRemoved,this.onBindingChanged,this),a.TargetManager.TargetManager.instance().addEventListener(a.TargetManager.Events.NameChanged,this.targetNameChanged,this),a.TargetManager.TargetManager.instance().observeTargets(this),this.resetWorkspace(d.Workspace.WorkspaceImpl.instance()),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this)),c.NetworkProject.NetworkProjectManager.instance().addEventListener(c.NetworkProject.Events.FrameAttributionAdded,this.frameAttributionAdded,this),c.NetworkProject.NetworkProjectManager.instance().addEventListener(c.NetworkProject.Events.FrameAttributionRemoved,this.frameAttributionRemoved,this)}static treeElementOrder(e){if(Pt.has(e))return 0;const t=e;let i=Mt.get(t.nodeType)||0;if(t.uiSourceCode){const e=t.uiSourceCode.contentType();e.isDocument()?i+=3:e.isScript()?i+=5:e.isStyleSheet()?i+=10:i+=15}return i}static appendSearchItem(e,t){let i=Tt(yt.searchInFolder);t&&t.trim()||(t="*",i=Tt(yt.searchInAllFiles)),e.viewSection().appendItem(i,(()=>{t&&It.openSearch(`file:${t.trim()}`)}))}static treeElementsCompare(e,t){const i=Ft.treeElementOrder(e),o=Ft.treeElementOrder(t);return i>o?1:i<o?-1:s.StringUtilities.naturalOrderComparator(e.titleAsText(),t.titleAsText())}setPlaceholder(e){function i(){const t=this.scriptsTree.firstChild();t?e.hideWidget():e.showWidget(),this.scriptsTree.element.classList.toggle("hidden",!t)}console.assert(!this.placeholder,"A placeholder widget was already set"),this.placeholder=e,e.show(this.contentElement,this.contentElement.firstChild),i.call(this),this.scriptsTree.addEventListener(t.TreeOutline.Events.ElementAttached,i.bind(this)),this.scriptsTree.addEventListener(t.TreeOutline.Events.ElementsDetached,i.bind(this))}onBindingChanged(e){const t=e.data,i=this.uiSourceCodeNodes.get(t.network);for(const e of i)e.updateTitle();const o=this.uiSourceCodeNodes.get(t.fileSystem);for(const e of o)e.updateTitle();const n=l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.relativePath(t.fileSystem);let r="";for(let e=0;e<n.length-1;++e){r+=n[e];const i=this.folderNodeId(t.fileSystem.project(),null,null,t.fileSystem.origin(),r),o=this.subfolderNodes.get(i);o&&o.updateTitle(),r+="/"}const s=this.rootNode.child(t.fileSystem.project().id());s&&s.updateTitle()}focus(){this.scriptsTree.focus()}appendChild(e,t){this.scriptsTree.setFocusable(!0),e.appendChild(t)}removeChild(e,t){e.removeChild(t),0===this.scriptsTree.rootElement().childCount()&&this.scriptsTree.setFocusable(!1)}resetWorkspace(e){this.workspaceInternal&&(this.workspaceInternal.removeEventListener(d.Workspace.Events.UISourceCodeAdded,this.uiSourceCodeAddedCallback,this),this.workspaceInternal.removeEventListener(d.Workspace.Events.UISourceCodeRemoved,this.uiSourceCodeRemovedCallback,this),this.workspaceInternal.removeEventListener(d.Workspace.Events.ProjectAdded,this.projectAddedCallback,this),this.workspaceInternal.removeEventListener(d.Workspace.Events.ProjectRemoved,this.projectRemovedCallback,this)),this.workspaceInternal=e,this.workspaceInternal.addEventListener(d.Workspace.Events.UISourceCodeAdded,this.uiSourceCodeAddedCallback,this),this.workspaceInternal.addEventListener(d.Workspace.Events.UISourceCodeRemoved,this.uiSourceCodeRemovedCallback,this),this.workspaceInternal.addEventListener(d.Workspace.Events.ProjectAdded,this.projectAddedCallback,this),this.workspaceInternal.addEventListener(d.Workspace.Events.ProjectRemoved,this.projectRemovedCallback,this),this.workspaceInternal.projects().forEach(this.projectAdded.bind(this)),this.computeUniqueFileSystemProjectNames()}projectAddedCallback(e){const t=e.data;this.projectAdded(t),t.type()===d.Workspace.projectTypes.FileSystem&&this.computeUniqueFileSystemProjectNames()}projectRemovedCallback(e){const t=e.data;this.removeProject(t),t.type()===d.Workspace.projectTypes.FileSystem&&this.computeUniqueFileSystemProjectNames()}workspace(){return this.workspaceInternal}acceptProject(e){return!e.isServiceProject()}frameAttributionAdded(e){const{uiSourceCode:t}=e.data;if(!this.acceptsUISourceCode(t))return;const i=e.data.frame;this.addUISourceCodeNode(t,i)}frameAttributionRemoved(e){const{uiSourceCode:t}=e.data;if(!this.acceptsUISourceCode(t))return;const i=e.data.frame,o=Array.from(this.uiSourceCodeNodes.get(t)).find((e=>e.frame()===i));this.removeUISourceCodeNode(o)}acceptsUISourceCode(e){return this.acceptProject(e.project())}addUISourceCode(e){if(!this.acceptsUISourceCode(e))return;const t=c.NetworkProject.NetworkProject.framesForUISourceCode(e);if(t.length)for(const i of t)this.addUISourceCodeNode(e,i);else this.addUISourceCodeNode(e,null);this.uiSourceCodeAdded(e)}addUISourceCodeNode(e,t){const i=e.contentType().isFromSourceMap();let o;o=e.project().type()===d.Workspace.projectTypes.FileSystem?l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.relativePath(e).slice(0,-1):n.ParsedURL.ParsedURL.extractPath(e.url()).split("/").slice(1,-1);const r=e.project(),s=c.NetworkProject.NetworkProject.targetForUISourceCode(e),a=this.folderNode(e,r,s,t,e.origin(),o,i),u=new Ut(this,e,t);a.appendChild(u),this.uiSourceCodeNodes.set(e,u),this.selectDefaultTreeNode()}uiSourceCodeAdded(e){}uiSourceCodeAddedCallback(e){const t=e.data;this.addUISourceCode(t)}uiSourceCodeRemovedCallback(e){const t=e.data;this.removeUISourceCode(t)}tryAddProject(e){this.projectAdded(e),e.uiSourceCodes().forEach(this.addUISourceCode.bind(this))}projectAdded(e){!this.acceptProject(e)||e.type()!==d.Workspace.projectTypes.FileSystem||S.ScriptSnippetFileSystem.isSnippetsProject(e)||this.rootNode.child(e.id())||(this.rootNode.appendChild(new jt(this,e,e.id(),Lt.FileSystem,e.displayName())),this.selectDefaultTreeNode())}selectDefaultTreeNode(){const e=this.rootNode.children();e.length&&!this.scriptsTree.selectedTreeElement&&e[0].treeNode().select(!0,!1)}computeUniqueFileSystemProjectNames(){const e=this.workspaceInternal.projectsForType(d.Workspace.projectTypes.FileSystem);if(!e.length)return;const t=new l.Persistence.PathEncoder,i=e.map((e=>{const i=e;return s.StringUtilities.reverse(t.encode(i.fileSystemPath()))})),o=new n.Trie.Trie;for(const e of i)o.add(e);for(let n=0;n<e.length;++n){const r=i[n],a=e[n];o.remove(r);const c=o.longestPrefix(r,!1);o.add(r);const l=r.substring(0,c.length+1),d=t.decode(s.StringUtilities.reverse(l)),u=this.rootNode.child(a.id());u&&u.setTitle(d)}}removeProject(e){const t=e.uiSourceCodes();for(let e=0;e<t.length;++e)this.removeUISourceCode(t[e]);if(e.type()!==d.Workspace.projectTypes.FileSystem)return;const i=this.rootNode.child(e.id());i&&this.rootNode.removeChild(i)}folderNodeId(e,t,i,o,n){return(t?t.id():"")+":"+(e.type()===d.Workspace.projectTypes.FileSystem?e.id():"")+":"+(this.groupByFrame&&i?i.id:"")+":"+o+":"+n}folderNode(e,t,i,o,n,r,s){if(S.ScriptSnippetFileSystem.isSnippetsUISourceCode(e))return this.rootNode;if(i&&!this.groupByFolder&&!s)return this.domainNode(e,t,i,o,n);const a=r.join("/"),c=this.folderNodeId(t,i,o,n,a);let l=this.subfolderNodes.get(c);if(l)return l;if(!r.length)return i?this.domainNode(e,t,i,o,n):this.rootNode.child(t.id());const u=this.folderNode(e,t,i,o,n,r.slice(0,-1),s);let h=s?Lt.SourceMapFolder:Lt.NetworkFolder;t.type()===d.Workspace.projectTypes.FileSystem&&(h=Lt.FileSystemFolder);const p=r[r.length-1];return l=new Vt(this,t,c,h,a,p),this.subfolderNodes.set(c,l),u.appendChild(l),l}domainNode(e,t,i,o,r){const s=this.frameNode(t,i,o);if(!this.groupByDomain)return s;let a=s.child(r);return a||(a=new jt(this,t,r,Lt.Domain,this.computeProjectDisplayName(i,r)),o&&r===n.ParsedURL.ParsedURL.extractOrigin(o.url)&&Pt.add(a.treeNode()),s.appendChild(a),a)}frameNode(e,t,i){if(!this.groupByFrame||!i)return this.targetNode(e,t);let o=this.frameNodes.get(i);if(o)return o;o=new jt(this,e,t.id()+":"+i.id,Lt.Frame,i.displayName()),o.setHoverCallback((function(e){if(e){const e=t.model(a.OverlayModel.OverlayModel);e&&i&&e.highlightFrame(i.id)}else a.OverlayModel.OverlayModel.hideDOMNodeHighlight()})),this.frameNodes.set(i,o);const n=i.parentFrame();return this.frameNode(e,n?n.resourceTreeModel().target():t,n).appendChild(o),n||(Pt.add(o.treeNode()),o.treeNode().expand()),o}targetNode(e,t){if(t===a.TargetManager.TargetManager.instance().mainTarget())return this.rootNode;let i=this.rootNode.child("target:"+t.id());return i||(i=new jt(this,e,"target:"+t.id(),t.type()===a.Target.Type.Frame?Lt.Frame:Lt.Worker,t.name()),this.rootNode.appendChild(i)),i}computeProjectDisplayName(e,t){const i=e.model(a.RuntimeModel.RuntimeModel),o=i?i.executionContexts():[];for(const e of o)if(e.name&&e.origin&&t.startsWith(e.origin))return e.name;if(!t)return Tt(yt.noDomain);const r=new n.ParsedURL.ParsedURL(t);return(r.isValid?r.host+(r.port?":"+r.port:""):"")||t}revealUISourceCode(e,t){const i=this.uiSourceCodeNodes.get(e);if(0===i.size)return null;const o=i.values().next().value;return o?(this.scriptsTree.selectedTreeElement&&this.scriptsTree.selectedTreeElement.deselect(),this.lastSelectedUISourceCode=e,o.reveal(t),o):null}sourceSelected(e,t){this.lastSelectedUISourceCode=e,n.Revealer.reveal(e,!t)}removeUISourceCode(e){const t=this.uiSourceCodeNodes.get(e);for(const e of t)this.removeUISourceCodeNode(e)}removeUISourceCodeNode(e){const t=e.uiSourceCode();this.uiSourceCodeNodes.delete(t,e);const i=t.project(),o=c.NetworkProject.NetworkProject.targetForUISourceCode(t),n=e.frame();let r=e.parent;if(!r)return;r.removeChild(e);let s=r;for(;s&&(r=s.parent,r&&s.isEmpty())&&(r!==this.rootNode||i.type()!==d.Workspace.projectTypes.FileSystem)&&(s instanceof jt||s instanceof Vt);){if(s.type===Lt.Frame){this.discardFrame(n);break}const e=this.folderNodeId(i,o,n,t.origin(),s instanceof Vt&&s.folderPath||"");this.subfolderNodes.delete(e),r.removeChild(s),s=r}}reset(){for(const e of this.uiSourceCodeNodes.valuesArray())e.dispose();this.scriptsTree.removeChildren(),this.scriptsTree.setFocusable(!1),this.uiSourceCodeNodes.clear(),this.subfolderNodes.clear(),this.frameNodes.clear(),this.rootNode.reset(),this.resetWorkspace(d.Workspace.WorkspaceImpl.instance())}handleContextMenu(e){}async renameShortcut(){const e=this.scriptsTree.selectedTreeElement,t=e&&e.node;return!!(t&&t.uiSourceCode()&&t.uiSourceCode().canRename())&&(this.rename(t,!1),!0)}handleContextMenuCreate(e,t,i){if(i){const e=l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.relativePath(i);e.pop(),t=e.join("/")}this.create(e,t,i)}handleContextMenuRename(e){this.rename(e,!1)}async handleContextMenuExclude(e,i){await t.UIUtils.ConfirmDialog.show(Tt(yt.areYouSureYouWantToExcludeThis))&&(t.UIUtils.startBatchUpdate(),e.excludeFolder(l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.completeURL(e,i)),t.UIUtils.endBatchUpdate())}async handleContextMenuDelete(e){await t.UIUtils.ConfirmDialog.show(Tt(yt.areYouSureYouWantToDeleteThis))&&e.project().deleteFile(e)}handleFileContextMenu(e,i){const o=i.uiSourceCode(),n=new t.ContextMenu.ContextMenu(e);n.appendApplicableItems(o);const r=o.project();r.type()===d.Workspace.projectTypes.FileSystem&&(n.editSection().appendItem(Tt(yt.rename),this.handleContextMenuRename.bind(this,i)),n.editSection().appendItem(Tt(yt.makeACopy),this.handleContextMenuCreate.bind(this,r,"",o)),n.editSection().appendItem(Tt(yt.delete),this.handleContextMenuDelete.bind(this,o))),n.show()}async handleDeleteOverrides(e){await t.UIUtils.ConfirmDialog.show(Tt(yt.areYouSureYouWantToDeleteAll))&&this.handleDeleteOverridesHelper(e)}handleDeleteOverridesHelper(e){if(e.children().forEach((e=>{this.handleDeleteOverridesHelper(e)})),e instanceof Ut){l.Persistence.PersistenceImpl.instance().binding(e.uiSourceCode())&&e.uiSourceCode().project().deleteFile(e.uiSourceCode())}}handleFolderContextMenu(e,i){const o=i.folderPath||"",s=i.project||null,a=new t.ContextMenu.ContextMenu(e);if(Ft.appendSearchItem(a,o),s){if(s.type()===d.Workspace.projectTypes.FileSystem){const e=n.ParsedURL.ParsedURL.capFilePrefix(l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.completeURL(s,o),r.Platform.isWin());a.revealSection().appendItem(Tt(yt.openFolder),(()=>r.InspectorFrontendHost.InspectorFrontendHostInstance.showItemInFolder(e))),s.canCreateFile()&&a.defaultSection().appendItem(Tt(yt.newFile),(()=>{this.handleContextMenuCreate(s,o,void 0)}))}s.canExcludeFolder(o)&&a.defaultSection().appendItem(Tt(yt.excludeFolder),this.handleContextMenuExclude.bind(this,s,o)),s.type()===d.Workspace.projectTypes.FileSystem&&(a.defaultSection().appendAction("sources.add-folder-to-workspace",void 0,!0),i instanceof jt&&a.defaultSection().appendItem(Tt(yt.removeFolderFromWorkspace),(async()=>{await t.UIUtils.ConfirmDialog.show(Tt(yt.areYouSureYouWantToRemoveThis))&&s.remove()})),"overrides"===s.fileSystem().type()&&a.defaultSection().appendItem(Tt(yt.deleteAllOverrides),this.handleDeleteOverrides.bind(this,i))),a.show()}}rename(e,t){const i=e.uiSourceCode();e.rename(function(o){if(!t)return;o?e.treeElement&&e.treeElement.listItemElement.hasFocus()&&this.sourceSelected(i,!0):i.remove()}.bind(this))}async create(e,t,i){let o="";i&&(o=(await i.requestContent()).content||"");const n=await e.createFile(t,null,o);if(!n)return;this.sourceSelected(n,!1);const r=this.revealUISourceCode(n,!0);r&&this.rename(r,!0)}groupingChanged(){this.reset(),this.initGrouping(),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this))}initGrouping(){this.groupByFrame=!0,this.groupByDomain=this.navigatorGroupByFolderSetting.get(),this.groupByFolder=this.groupByDomain}resetForTest(){this.reset(),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this))}discardFrame(e){const t=this.frameNodes.get(e);if(t){t.parent&&t.parent.removeChild(t),this.frameNodes.delete(e);for(const t of e.childFrames)this.discardFrame(t)}}targetAdded(e){}targetRemoved(e){const t=this.rootNode.child("target:"+e.id());t&&this.rootNode.removeChild(t)}targetNameChanged(e){const t=e.data,i=this.rootNode.child("target:"+t.id());i&&i.setTitle(t.name())}wasShown(){super.wasShown(),this.scriptsTree.registerCSSFiles([mt]),this.registerCSSFiles([bt])}}const Pt=new WeakSet;class Dt extends t.TreeOutline.TreeElement{nodeType;navigatorView;hoverCallback;node;hovered;constructor(e,i,o,n){super("",!0),this.listItemElement.classList.add("navigator-"+i+"-tree-item","navigator-folder-tree-item"),t.ARIAUtils.setAccessibleName(this.listItemElement,`${o}, ${i}`),this.nodeType=i,this.title=o,this.tooltip=o,this.navigatorView=e,this.hoverCallback=n;let r="largeicon-navigator-folder";i===Lt.Domain?r="largeicon-navigator-domain":i===Lt.Frame?r="largeicon-navigator-frame":i===Lt.Worker&&(r="largeicon-navigator-worker"),this.setLeadingIcons([t.Icon.Icon.create(r,"icon")])}async onpopulate(){this.node.populate()}onattach(){this.collapse(),this.node.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("mousemove",this.mouseMove.bind(this),!1),this.listItemElement.addEventListener("mouseleave",this.mouseLeave.bind(this),!1)}setNode(e){this.node=e;const i=[];let o=e;for(;o&&!o.isRoot();)i.push(o.title),o=o.parent;i.reverse(),this.tooltip=i.join("/"),t.ARIAUtils.setAccessibleName(this.listItemElement,`${this.title}, ${this.nodeType}`)}handleContextMenuEvent(e){this.node&&(this.select(),this.navigatorView.handleFolderContextMenu(e,this.node))}mouseMove(e){!this.hovered&&this.hoverCallback&&(this.hovered=!0,this.hoverCallback(!0))}mouseLeave(e){this.hoverCallback&&(this.hovered=!1,this.hoverCallback(!1))}}class At extends t.TreeOutline.TreeElement{nodeType;node;navigatorView;uiSourceCodeInternal;constructor(e,i,o,r){super("",!1),this.nodeType=Lt.File,this.node=r,this.title=o,this.listItemElement.classList.add("navigator-"+i.contentType().name()+"-tree-item","navigator-file-tree-item"),this.tooltip=i.url(),t.ARIAUtils.setAccessibleName(this.listItemElement,`${i.name()}, ${this.nodeType}`),n.EventTarget.fireEvent("source-tree-file-added",i.fullDisplayName()),this.navigatorView=e,this.uiSourceCodeInternal=i,this.updateIcon()}updateIcon(){const e=l.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);if(e){const i=document.createElement("span");i.classList.add("icon-stack");let o="largeicon-navigator-file-sync";S.ScriptSnippetFileSystem.isSnippetsUISourceCode(e.fileSystem)&&(o="largeicon-navigator-snippet");const n=t.Icon.Icon.create(o,"icon"),r=t.Icon.Icon.create("badge-navigator-file-sync","icon-badge");l.NetworkPersistenceManager.NetworkPersistenceManager.instance().project()===e.fileSystem.project()&&(r.style.filter="hue-rotate(160deg)"),i.appendChild(n),i.appendChild(r),t.Tooltip.Tooltip.install(i,l.PersistenceUtils.PersistenceUtils.tooltipForUISourceCode(this.uiSourceCodeInternal)),this.setLeadingIcons([i])}else{let e="largeicon-navigator-file";S.ScriptSnippetFileSystem.isSnippetsUISourceCode(this.uiSourceCodeInternal)&&(e="largeicon-navigator-snippet");const i=t.Icon.Icon.create(e,"icon");this.setLeadingIcons([i])}}get uiSourceCode(){return this.uiSourceCodeInternal}onattach(){this.listItemElement.draggable=!0,this.listItemElement.addEventListener("click",this.onclick.bind(this),!1),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("dragstart",this.ondragstart.bind(this),!1)}shouldRenameOnMouseDown(){if(!this.uiSourceCodeInternal.canRename())return!1;if(!this.treeOutline)return!1;return this===this.treeOutline.selectedTreeElement&&this.treeOutline.element.hasFocus()&&!t.UIUtils.isBeingEdited(this.treeOutline.element)}selectOnMouseDown(e){1===e.which&&this.shouldRenameOnMouseDown()?setTimeout(function(){this.shouldRenameOnMouseDown()&&this.navigatorView.rename(this.node,!1)}.bind(this),300):super.selectOnMouseDown(e)}ondragstart(e){e.dataTransfer&&(e.dataTransfer.setData("text/plain",this.uiSourceCodeInternal.url()),e.dataTransfer.effectAllowed="copy")}onspace(){return this.navigatorView.sourceSelected(this.uiSourceCode,!0),!0}onclick(e){this.navigatorView.sourceSelected(this.uiSourceCode,!1)}ondblclick(e){const t=1===e.button;return this.navigatorView.sourceSelected(this.uiSourceCode,!t),!1}onenter(){return this.navigatorView.sourceSelected(this.uiSourceCode,!0),!0}ondelete(){return!0}handleContextMenuEvent(e){this.select(),this.navigatorView.handleFileContextMenu(e,this.node)}}class Bt{id;navigatorView;type;childrenInternal;populated;isMerged;parent;title;constructor(e,t,i){this.id=t,this.navigatorView=e,this.type=i,this.childrenInternal=new Map,this.populated=!1,this.isMerged=!1}treeNode(){throw"Not implemented"}dispose(){}updateTitle(){}isRoot(){return!1}hasChildren(){return!0}onattach(){}setTitle(e){throw"Not implemented"}populate(){this.isPopulated()||(this.parent&&this.parent.populate(),this.populated=!0,this.wasPopulated())}wasPopulated(){const e=this.children();for(let t=0;t<e.length;++t)this.navigatorView.appendChild(this.treeNode(),e[t].treeNode())}didAddChild(e){this.isPopulated()&&this.navigatorView.appendChild(this.treeNode(),e.treeNode())}willRemoveChild(e){this.isPopulated()&&this.navigatorView.removeChild(this.treeNode(),e.treeNode())}isPopulated(){return this.populated}isEmpty(){return!this.childrenInternal.size}children(){return[...this.childrenInternal.values()]}child(e){return this.childrenInternal.get(e)||null}appendChild(e){this.childrenInternal.set(e.id,e),e.parent=this,this.didAddChild(e)}removeChild(e){this.willRemoveChild(e),this.childrenInternal.delete(e.id),e.parent=null,e.dispose()}reset(){this.childrenInternal.clear()}}class Nt extends Bt{constructor(e){super(e,"",Lt.Root)}isRoot(){return!0}treeNode(){return this.navigatorView.scriptsTree.rootElement()}}class Ut extends Bt{uiSourceCodeInternal;treeElement;eventListeners;frameInternal;constructor(e,t,i){super(e,t.project().id()+":"+t.url(),Lt.File),this.uiSourceCodeInternal=t,this.treeElement=null,this.eventListeners=[],this.frameInternal=i}frame(){return this.frameInternal}uiSourceCode(){return this.uiSourceCodeInternal}treeNode(){if(this.treeElement)return this.treeElement;this.treeElement=new At(this.navigatorView,this.uiSourceCodeInternal,"",this),this.updateTitle();const e=this.updateTitle.bind(this,void 0);return this.eventListeners=[this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.TitleChanged,e),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.WorkingCopyChanged,e),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.WorkingCopyCommitted,e)],this.treeElement}updateTitle(e){if(!this.treeElement)return;let t=this.uiSourceCodeInternal.displayName();!e&&this.uiSourceCodeInternal.isDirty()&&(t="*"+t),this.treeElement.title=t,this.treeElement.updateIcon();let i=this.uiSourceCodeInternal.url();this.uiSourceCodeInternal.contentType().isFromSourceMap()&&(i=Tt(yt.sFromSourceMap,{PH1:this.uiSourceCodeInternal.displayName()})),this.treeElement.tooltip=i}hasChildren(){return!1}dispose(){n.EventTarget.removeEventListeners(this.eventListeners)}reveal(e){this.parent&&(this.parent.populate(),this.parent.treeNode().expand()),this.treeElement&&(this.treeElement.reveal(!0),e&&this.treeElement.select(!0))}rename(e){if(!this.treeElement)return;if(this.treeElement.listItemElement.focus(),!this.treeElement.treeOutline)return;const i=this.treeElement.treeOutline.element;function o(o){if(!o)return t.UIUtils.markBeingEdited(i,!1),this.updateTitle(),void this.rename(e);if(this.treeElement){const{parent:e}=this.treeElement;e&&(e.removeChild(this.treeElement),e.appendChild(this.treeElement),this.treeElement.select())}n.call(this,!0)}function n(o){t.UIUtils.markBeingEdited(i,!1),this.updateTitle(),e&&e(o)}t.UIUtils.markBeingEdited(i,!0),this.updateTitle(!0),this.treeElement.startEditingTitle(new t.InplaceEditor.Config(function(e,t,i){if(t!==i)return this.treeElement&&(this.treeElement.title=t),void this.uiSourceCodeInternal.rename(t).then(o.bind(this));n.call(this,!0)}.bind(this),n.bind(this,!1)))}}class Vt extends Bt{project;folderPath;title;treeElement;constructor(e,t,i,o,n,r){super(e,i,o),this.project=t,this.folderPath=n,this.title=r}treeNode(){return this.treeElement||(this.treeElement=this.createTreeElement(this.title,this),this.updateTitle()),this.treeElement}updateTitle(){if(!this.treeElement||!this.project||this.project.type()!==d.Workspace.projectTypes.FileSystem)return;const e=l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemPath(this.project.id())+"/"+this.folderPath,t=l.Persistence.PersistenceImpl.instance().filePathHasBindings(e);this.treeElement.listItemElement.classList.toggle("has-mapped-files",t)}createTreeElement(e,t){if(this.project&&this.project.type()!==d.Workspace.projectTypes.FileSystem)try{e=decodeURI(e)}catch(e){}const i=new Dt(this.navigatorView,this.type,e);return i.setNode(t),i}wasPopulated(){this.treeElement&&this.treeElement.node===this&&this.addChildrenRecursive()}addChildrenRecursive(){const e=this.children();for(let t=0;t<e.length;++t){const i=e[t];this.didAddChild(i),i instanceof Vt&&i.addChildrenRecursive()}}shouldMerge(e){return this.type!==Lt.Domain&&e instanceof Vt}didAddChild(e){if(!this.treeElement)return;let t,i=this.children();if(1===i.length&&this.shouldMerge(e))return e.isMerged=!0,this.treeElement.title=this.treeElement.title+"/"+e.title,e.treeElement=this.treeElement,void this.treeElement.setNode(e);if(2===i.length&&(t=i[0]!==e?i[0]:i[1]),t&&t.isMerged){t.isMerged=!1;const e=[];e.push(this);let o=this;for(;o&&o.isMerged;)o=o.parent,o&&e.push(o);e.reverse();const n=e.map((e=>e.title)).join("/"),r=[];o=t;do{r.push(o),i=o.children(),o=1===i.length?i[0]:null}while(o&&o.isMerged);if(!this.isPopulated()){this.treeElement.title=n,this.treeElement.setNode(this);for(let e=0;e<r.length;++e)r[e].treeElement=null,r[e].isMerged=!1;return}const s=this.treeElement,a=this.createTreeElement(n,this);for(let t=0;t<e.length;++t)e[t].treeElement=a;s.parent&&this.navigatorView.appendChild(s.parent,a),s.setNode(r[r.length-1]),s.title=r.map((e=>e.title)).join("/"),s.parent&&this.navigatorView.removeChild(s.parent,s),this.navigatorView.appendChild(this.treeElement,s),s.expanded&&a.expand()}this.isPopulated()&&this.navigatorView.appendChild(this.treeElement,e.treeNode())}willRemoveChild(e){const t=e;!t.isMerged&&this.isPopulated()&&this.treeElement&&t.treeElement&&this.navigatorView.removeChild(this.treeElement,t.treeElement)}}class jt extends Bt{project;title;hoverCallback;treeElement;constructor(e,t,i,o,n){super(e,i,o),this.project=t,this.title=n,this.populate()}setHoverCallback(e){this.hoverCallback=e}treeNode(){return this.treeElement||(this.treeElement=new Dt(this.navigatorView,this.type,this.title,this.hoverCallback),this.treeElement.setNode(this)),this.treeElement}onattach(){this.updateTitle()}updateTitle(){if(!this.treeElement||this.project.type()!==d.Workspace.projectTypes.FileSystem)return;const e=l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemPath(this.project.id()),t=this.treeElement.listItemElement.classList.contains("has-mapped-files"),i=l.Persistence.PersistenceImpl.instance().filePathHasBindings(e);t!==i&&(this.treeElement.listItemElement.classList.toggle("has-mapped-files",i),this.treeElement.childrenListElement.hasFocus()||(i?this.treeElement.expand():this.treeElement.collapse()))}setTitle(e){this.title=e,this.treeElement&&(this.treeElement.title=this.title)}}var Wt=Object.freeze({__proto__:null,Types:Lt,NavigatorView:Ft,NavigatorFolderTreeElement:Dt,NavigatorSourceTreeElement:At,NavigatorTreeNode:Bt,NavigatorRootTreeNode:Nt,NavigatorUISourceCodeTreeNode:Ut,NavigatorFolderTreeNode:Vt,NavigatorGroupTreeNode:jt});const Ot={syncChangesInDevtoolsWithThe:"Sync changes in DevTools with the local filesystem",learnMoreAboutWorkspaces:"Learn more about Workspaces",overridePageAssetsWithFilesFromA:"Override page assets with files from a local folder",learnMore:"Learn more",clearConfiguration:"Clear configuration",selectFolderForOverrides:"Select folder for overrides",contentScriptsServedByExtensions:"Content scripts served by extensions appear here",createAndSaveCodeSnippetsFor:"Create and save code snippets for later reuse",newSnippet:"New snippet",createNewSnippet:"Create new snippet",run:"Run",rename:"Renameâ€¦",remove:"Remove",saveAs:"Save as..."},Rt=e.i18n.registerUIStrings("panels/sources/SourcesNavigator.ts",Ot),Ht=e.i18n.getLocalizedString.bind(void 0,Rt);let _t,zt,qt,Gt,Kt,$t;class Jt extends Ft{constructor(){super(),a.TargetManager.TargetManager.instance().addEventListener(a.TargetManager.Events.InspectedURLChanged,this.inspectedURLChanged,this),r.userMetrics.panelLoaded("sources","DevTools.Launch.Sources")}static instance(e={forceNew:null}){const{forceNew:t}=e;return _t&&!t||(_t=new Jt),_t}acceptProject(e){return e.type()===d.Workspace.projectTypes.Network}inspectedURLChanged(e){const t=a.TargetManager.TargetManager.instance().mainTarget();if(e.data!==t)return;const i=t&&t.inspectedURL();if(i)for(const e of this.workspace().uiSourceCodes())this.acceptProject(e.project())&&e.url()===i&&this.revealUISourceCode(e,!0)}uiSourceCodeAdded(e){const t=a.TargetManager.TargetManager.instance().mainTarget(),i=t&&t.inspectedURL();i&&e.url()===i&&this.revealUISourceCode(e,!0)}}class Yt extends Ft{constructor(){super();const e=new t.EmptyWidget.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(t.Fragment.html` <div>${Ht(Ot.syncChangesInDevtoolsWithThe)}</div><br> ${t.XLink.XLink.create("https://developer.chrome.com/docs/devtools/workspaces/",Ht(Ot.learnMoreAboutWorkspaces))} `);const i=new t.Toolbar.Toolbar("navigator-toolbar");i.appendItemsAtLocation("files-navigator-toolbar").then((()=>{i.empty()||this.contentElement.insertBefore(i.element,this.contentElement.firstChild)}))}static instance(){return zt||(zt=new Yt),zt}acceptProject(e){return e.type()===d.Workspace.projectTypes.FileSystem&&"overrides"!==l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemType(e)&&!S.ScriptSnippetFileSystem.isSnippetsProject(e)}handleContextMenu(e){const i=new t.ContextMenu.ContextMenu(e);i.defaultSection().appendAction("sources.add-folder-to-workspace",void 0,!0),i.show()}}class Xt extends Ft{toolbar;constructor(){super();const e=new t.EmptyWidget.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(t.Fragment.html` <div>${Ht(Ot.overridePageAssetsWithFilesFromA)}</div><br> ${t.XLink.XLink.create("https://developers.google.com/web/updates/2018/01/devtools#overrides",Ht(Ot.learnMore))} `),this.toolbar=new t.Toolbar.Toolbar("navigator-toolbar"),this.contentElement.insertBefore(this.toolbar.element,this.contentElement.firstChild),l.NetworkPersistenceManager.NetworkPersistenceManager.instance().addEventListener(l.NetworkPersistenceManager.Events.ProjectChanged,this.updateProjectAndUI,this),this.workspace().addEventListener(d.Workspace.Events.ProjectAdded,this.onProjectAddOrRemoved,this),this.workspace().addEventListener(d.Workspace.Events.ProjectRemoved,this.onProjectAddOrRemoved,this),this.updateProjectAndUI()}static instance(e={forceNew:null}){const{forceNew:t}=e;return qt&&!t||(qt=new Xt),qt}onProjectAddOrRemoved(e){const t=e.data;t&&t.type()===d.Workspace.projectTypes.FileSystem&&"overrides"!==l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemType(t)||this.updateUI()}updateProjectAndUI(){this.reset();const e=l.NetworkPersistenceManager.NetworkPersistenceManager.instance().project();e&&this.tryAddProject(e),this.updateUI()}updateUI(){this.toolbar.removeToolbarItems();const e=l.NetworkPersistenceManager.NetworkPersistenceManager.instance().project();if(e){const i=new t.Toolbar.ToolbarSettingCheckbox(n.Settings.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled"));this.toolbar.appendToolbarItem(i),this.toolbar.appendToolbarItem(new t.Toolbar.ToolbarSeparator(!0));const o=new t.Toolbar.ToolbarButton(Ht(Ot.clearConfiguration),"largeicon-clear");return o.addEventListener(t.Toolbar.ToolbarButton.Events.Click,(()=>{e.remove()})),void this.toolbar.appendToolbarItem(o)}const i=Ht(Ot.selectFolderForOverrides),o=new t.Toolbar.ToolbarButton(i,"largeicon-add",i);o.addEventListener(t.Toolbar.ToolbarButton.Events.Click,(e=>{this.setupNewWorkspace()}),this),this.toolbar.appendToolbarItem(o)}async setupNewWorkspace(){await l.IsolatedFileSystemManager.IsolatedFileSystemManager.instance().addFileSystem("overrides")&&n.Settings.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").set(!0)}acceptProject(e){return e===l.NetworkPersistenceManager.NetworkPersistenceManager.instance().project()}}class Qt extends Ft{constructor(){super();const e=new t.EmptyWidget.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(t.Fragment.html` <div>${Ht(Ot.contentScriptsServedByExtensions)}</div><br> ${t.XLink.XLink.create("https://developer.chrome.com/extensions/content_scripts",Ht(Ot.learnMore))} `)}static instance(e={forceNew:null}){const{forceNew:t}=e;return Gt&&!t||(Gt=new Qt),Gt}acceptProject(e){return e.type()===d.Workspace.projectTypes.ContentScripts}}class Zt extends Ft{constructor(){super();const e=new t.EmptyWidget.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(t.Fragment.html` <div>${Ht(Ot.createAndSaveCodeSnippetsFor)}</div><br> ${t.XLink.XLink.create("https://developer.chrome.com/docs/devtools/javascript/snippets/",Ht(Ot.learnMore))} `);const i=new t.Toolbar.Toolbar("navigator-toolbar"),o=new t.Toolbar.ToolbarButton(Ht(Ot.newSnippet),"largeicon-add",Ht(Ot.newSnippet));o.addEventListener(t.Toolbar.ToolbarButton.Events.Click,(e=>{this.create(S.ScriptSnippetFileSystem.findSnippetsProject(),"")})),i.appendToolbarItem(o),this.contentElement.insertBefore(i.element,this.contentElement.firstChild)}static instance(){return Kt||(Kt=new Zt),Kt}acceptProject(e){return S.ScriptSnippetFileSystem.isSnippetsProject(e)}handleContextMenu(e){const i=new t.ContextMenu.ContextMenu(e);i.headerSection().appendItem(Ht(Ot.createNewSnippet),(()=>this.create(S.ScriptSnippetFileSystem.findSnippetsProject(),""))),i.show()}handleFileContextMenu(e,i){const o=i.uiSourceCode(),n=new t.ContextMenu.ContextMenu(e);n.headerSection().appendItem(Ht(Ot.run),(()=>S.ScriptSnippetFileSystem.evaluateScriptSnippet(o))),n.editSection().appendItem(Ht(Ot.rename),(()=>this.rename(i,!1))),n.editSection().appendItem(Ht(Ot.remove),(()=>o.project().deleteFile(o))),n.saveSection().appendItem(Ht(Ot.saveAs),this.handleSaveAs.bind(this,o)),n.show()}async handleSaveAs(e){e.commitWorkingCopy();const{content:t}=await e.requestContent();d.FileManager.FileManager.instance().save(e.url(),t||"",!0),d.FileManager.FileManager.instance().close(e.url())}}class ei{static instance(e={forceNew:null}){const{forceNew:t}=e;return $t&&!t||($t=new ei),$t}handleAction(e,t){switch(t){case"sources.create-snippet":return S.ScriptSnippetFileSystem.findSnippetsProject().createFile("",null,"").then((e=>n.Revealer.reveal(e))),!0;case"sources.add-folder-to-workspace":return l.IsolatedFileSystemManager.IsolatedFileSystemManager.instance().addFileSystem(),!0}return!1}}var ti=Object.freeze({__proto__:null,NetworkNavigatorView:Jt,FilesNavigatorView:Yt,OverridesNavigatorView:Xt,ContentScriptsNavigatorView:Qt,SnippetsNavigatorView:Zt,ActionDelegate:ei});const ii=new CSSStyleSheet;ii.replaceSync(".thread-item{padding:3px 8px 3px 20px;position:relative;min-height:18px;line-height:15px;display:flex;flex-wrap:wrap}.thread-item+.thread-item{border-top:1px solid var(--color-details-hairline-light)}.thread-item:hover{background-color:var(--color-background-elevation-1)}.thread-item:focus-visible{background-color:var(--legacy-focus-bg-color)}.thread-item-paused-state,.thread-item-title{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.thread-item-paused-state{color:var(--color-text-disabled);margin-left:auto;padding:0 10px}.selected-thread-icon{display:none;position:absolute;top:5px;left:4px}.thread-item.selected .selected-thread-icon{display:block}@media (forced-colors:active){.thread-item:focus-visible,.thread-item:hover{forced-color-adjust:none;background-color:Highlight}.thread-item:focus-visible>div,.thread-item:hover>div{color:HighlightText}}\n/*# sourceURL=threadsSidebarPane.css */\n");const oi={paused:"paused"},ni=e.i18n.registerUIStrings("panels/sources/ThreadsSidebarPane.ts",oi),ri=e.i18n.getLocalizedString.bind(void 0,ni);let si;class ai extends t.Widget.VBox{items;list;selectedModel;constructor(){super(!0),this.items=new t.ListModel.ListModel,this.list=new t.ListControl.ListControl(this.items,this,t.ListControl.ListMode.NonViewport);const e=t.Context.Context.instance().flavor(a.Target.Target);this.selectedModel=null!==e?e.model(a.DebuggerModel.DebuggerModel):null,this.contentElement.appendChild(this.list.element),t.Context.Context.instance().addFlavorChangeListener(a.Target.Target,this.targetFlavorChanged,this),a.TargetManager.TargetManager.instance().observeModels(a.DebuggerModel.DebuggerModel,this)}static instance(){return si||(si=new ai),si}static shouldBeShown(){return a.TargetManager.TargetManager.instance().models(a.DebuggerModel.DebuggerModel).length>=2}createElementForItem(e){const i=document.createElement("div");i.classList.add("thread-item");const o=i.createChild("div","thread-item-title"),n=i.createChild("div","thread-item-paused-state");i.appendChild(t.Icon.Icon.create("smallicon-thick-right-arrow","selected-thread-icon")),i.tabIndex=-1,self.onInvokeElement(i,(i=>{t.Context.Context.instance().setFlavor(a.Target.Target,e.target()),i.consume(!0)}));const r=t.Context.Context.instance().flavor(a.Target.Target)===e.target();function s(){const t=e.runtimeModel().defaultExecutionContext();o.textContent=t&&t.label()?t.label():e.target().name()}function c(){n.textContent=e.isPaused()?ri(oi.paused):""}return i.classList.toggle("selected",r),t.ARIAUtils.setSelected(i,r),e.addEventListener(a.DebuggerModel.Events.DebuggerPaused,c),e.addEventListener(a.DebuggerModel.Events.DebuggerResumed,c),e.runtimeModel().addEventListener(a.RuntimeModel.Events.ExecutionContextChanged,s),a.TargetManager.TargetManager.instance().addEventListener(a.TargetManager.Events.NameChanged,(function(t){t.data===e.target()&&s()})),c(),s(),i}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,o){i&&(i.tabIndex=-1);const n=o;n&&(this.setDefaultFocusedElement(n),n.tabIndex=0,this.hasFocus()&&n.focus())}updateSelectedItemARIA(e,t){return!1}modelAdded(e){this.items.insert(this.items.length,e);t.Context.Context.instance().flavor(a.Target.Target)===e.target()&&this.list.selectItem(e)}modelRemoved(e){this.items.remove(this.items.indexOf(e))}targetFlavorChanged({data:e}){const t=this.hasFocus(),i=e.model(a.DebuggerModel.DebuggerModel);this.list.selectItem(i),i&&this.list.refreshItem(i),null!==this.selectedModel&&this.list.refreshItem(this.selectedModel),this.selectedModel=i,t&&this.focus()}wasShown(){super.wasShown(),this.registerCSSFiles([ii])}}var ci=Object.freeze({__proto__:null,ThreadsSidebarPane:ai});const li={dropWorkspaceFolderHere:"Drop workspace folder here",moreOptions:"More options",showNavigator:"Show navigator",hideNavigator:"Hide navigator",showDebugger:"Show debugger",hideDebugger:"Hide debugger",groupByFolder:"Group by folder",pauseOnExceptions:"Pause on exceptions",dontPauseOnExceptions:"Don't pause on exceptions",resumeWithAllPausesBlockedForMs:"Resume with all pauses blocked for 500 ms",terminateCurrentJavascriptCall:"Terminate current JavaScript call",pauseOnCaughtExceptions:"Pause on caught exceptions",revealInSidebar:"Reveal in sidebar",continueToHere:"Continue to here",storeSAsGlobalVariable:"Store {PH1} as global variable",copyS:"Copy {PH1}",copyStringContents:"Copy string contents",copyStringAsJSLiteral:"Copy string as JavaScript literal",copyStringAsJSONLiteral:"Copy string as JSON literal",showFunctionDefinition:"Show function definition",openInSourcesPanel:"Open in Sources panel"},di=e.i18n.registerUIStrings("panels/sources/SourcesPanel.ts",li),ui=e.i18n.getLocalizedString.bind(void 0,di),hi=new Set(["number","boolean","bigint","undefined"]);let pi,gi;class mi extends t.Panel.Panel{workspace;togglePauseAction;stepOverAction;stepIntoAction;stepOutAction;stepAction;toggleBreakpointsActiveAction;debugToolbar;debugToolbarDrawer;debuggerPausedMessage;splitWidget;editorView;navigatorTabbedLocation;sourcesViewInternal;toggleNavigatorSidebarButton;toggleDebuggerSidebarButton;threadsSidebarPane;watchSidebarPane;callstackPane;liveLocationPool;lastModificationTime;pausedInternal;switchToPausedTargetTimeout;ignoreExecutionLineEvents;executionLineLocation;pauseOnExceptionButton;sidebarPaneStack;tabbedLocationHeader;extensionSidebarPanesContainer;sidebarPaneView;constructor(){super("sources"),new t.DropTarget.DropTarget(this.element,[t.DropTarget.Type.Folder],ui(li.dropWorkspaceFolderHere),this.handleDrop.bind(this)),this.workspace=d.Workspace.WorkspaceImpl.instance(),this.togglePauseAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.toggle-pause"),this.stepOverAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.step-over"),this.stepIntoAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.step-into"),this.stepOutAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.step-out"),this.stepAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.step"),this.toggleBreakpointsActiveAction=t.ActionRegistry.ActionRegistry.instance().action("debugger.toggle-breakpoints-active"),this.debugToolbar=this.createDebugToolbar(),this.debugToolbarDrawer=this.createDebugToolbarDrawer(),this.debuggerPausedMessage=new Ie;this.splitWidget=new t.SplitWidget.SplitWidget(!0,!0,"sourcesPanelSplitViewState",225),this.splitWidget.enableShowModeSaving(),this.splitWidget.show(this.element),globalThis.chii&&this.splitWidget.hideSidebar(!0);this.editorView=new t.SplitWidget.SplitWidget(!0,!1,"sourcesPanelNavigatorSplitViewState",225),this.editorView.enableShowModeSaving(),this.splitWidget.setMainWidget(this.editorView),this.navigatorTabbedLocation=t.ViewManager.ViewManager.instance().createTabbedLocation(this.revealNavigatorSidebar.bind(this),"navigator-view",!0);const e=this.navigatorTabbedLocation.tabbedPane();e.setMinimumSize(100,25),e.element.classList.add("navigator-tabbed-pane");const i=new t.Toolbar.ToolbarMenuButton(this.populateNavigatorMenu.bind(this),!0);if(i.setTitle(ui(li.moreOptions)),e.rightToolbar().appendToolbarItem(i),t.ViewManager.ViewManager.instance().hasViewsForLocation("run-view-sidebar")){const i=new t.SplitWidget.SplitWidget(!1,!0,"sourcePanelNavigatorSidebarSplitViewState");i.setMainWidget(e);const o=t.ViewManager.ViewManager.instance().createTabbedLocation(this.revealNavigatorSidebar.bind(this),"run-view-sidebar").tabbedPane();i.setSidebarWidget(o),i.installResizer(o.headerElement()),this.editorView.setSidebarWidget(i)}else this.editorView.setSidebarWidget(e);this.sourcesViewInternal=new co,this.sourcesViewInternal.addEventListener(lo.EditorSelected,this.editorSelected.bind(this)),this.toggleNavigatorSidebarButton=this.editorView.createShowHideSidebarButton(ui(li.showNavigator),ui(li.hideNavigator)),this.toggleDebuggerSidebarButton=this.splitWidget.createShowHideSidebarButton(ui(li.showDebugger),ui(li.hideDebugger)),this.editorView.setMainWidget(this.sourcesViewInternal),this.threadsSidebarPane=null,this.watchSidebarPane=t.ViewManager.ViewManager.instance().view("sources.watch"),this.callstackPane=J.instance(),n.Settings.Settings.instance().moduleSetting("sidebarPosition").addChangeListener(this.updateSidebarPosition.bind(this)),this.updateSidebarPosition(),this.updateDebuggerButtonsAndStatus(),this.pauseOnExceptionEnabledChanged(),n.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").addChangeListener(this.pauseOnExceptionEnabledChanged,this),this.liveLocationPool=new c.LiveLocation.LiveLocationPool,this.setTarget(t.Context.Context.instance().flavor(a.Target.Target)),n.Settings.Settings.instance().moduleSetting("breakpointsActive").addChangeListener(this.breakpointsActiveStateChanged,this),t.Context.Context.instance().addFlavorChangeListener(a.Target.Target,this.onCurrentTargetChanged,this),t.Context.Context.instance().addFlavorChangeListener(a.DebuggerModel.CallFrame,this.callFrameChanged,this),a.TargetManager.TargetManager.instance().addModelListener(a.DebuggerModel.DebuggerModel,a.DebuggerModel.Events.DebuggerWasEnabled,this.debuggerWasEnabled,this),a.TargetManager.TargetManager.instance().addModelListener(a.DebuggerModel.DebuggerModel,a.DebuggerModel.Events.DebuggerPaused,this.debuggerPaused,this),a.TargetManager.TargetManager.instance().addModelListener(a.DebuggerModel.DebuggerModel,a.DebuggerModel.Events.DebuggerResumed,(e=>this.debuggerResumed(e.data))),a.TargetManager.TargetManager.instance().addModelListener(a.DebuggerModel.DebuggerModel,a.DebuggerModel.Events.GlobalObjectCleared,(e=>this.debuggerResumed(e.data))),v.ExtensionServer.ExtensionServer.instance().addEventListener(v.ExtensionServer.Events.SidebarPaneAdded,this.extensionSidebarPaneAdded,this),a.TargetManager.TargetManager.instance().observeTargets(this),this.lastModificationTime=window.performance.now()}static instance(e={forceNew:null}){const{forceNew:t}=e;return pi&&!t||(pi=new mi),pi}static updateResizerAndSidebarButtons(e){e.sourcesViewInternal.leftToolbar().removeToolbarItems(),e.sourcesViewInternal.rightToolbar().removeToolbarItems(),e.sourcesViewInternal.bottomToolbar().removeToolbarItems();const i=Fi.isShowing()&&!t.InspectorView.InspectorView.instance().isDrawerMinimized();e.splitWidget.isVertical()||i?e.splitWidget.uninstallResizer(e.sourcesViewInternal.toolbarContainerElement()):e.splitWidget.installResizer(e.sourcesViewInternal.toolbarContainerElement()),i||(e.sourcesViewInternal.leftToolbar().appendToolbarItem(e.toggleNavigatorSidebarButton),globalThis.chii||(e.splitWidget.isVertical()?e.sourcesViewInternal.rightToolbar().appendToolbarItem(e.toggleDebuggerSidebarButton):e.sourcesViewInternal.bottomToolbar().appendToolbarItem(e.toggleDebuggerSidebarButton)))}targetAdded(e){this.showThreadsIfNeeded()}targetRemoved(e){}showThreadsIfNeeded(){ai.shouldBeShown()&&!this.threadsSidebarPane&&(this.threadsSidebarPane=t.ViewManager.ViewManager.instance().view("sources.threads"),this.sidebarPaneStack&&this.threadsSidebarPane&&this.sidebarPaneStack.showView(this.threadsSidebarPane,this.splitWidget.isVertical()?this.watchSidebarPane:this.callstackPane))}setTarget(e){if(!e)return;const t=e.model(a.DebuggerModel.DebuggerModel);t&&(t.isPaused()?this.showDebuggerPausedDetails(t.debuggerPausedDetails()):(this.pausedInternal=!1,this.clearInterface(),this.toggleDebuggerSidebarButton.setEnabled(!0)))}onCurrentTargetChanged({data:e}){this.setTarget(e)}paused(){return this.pausedInternal||!1}wasShown(){t.Context.Context.instance().setFlavor(mi,this),this.registerCSSFiles([gt]),super.wasShown();const e=Fi.instance();e&&e.isShowing()&&(t.InspectorView.InspectorView.instance().setDrawerMinimized(!0),mi.updateResizerAndSidebarButtons(this)),this.editorView.setMainWidget(this.sourcesViewInternal)}willHide(){super.willHide(),t.Context.Context.instance().setFlavor(mi,null),Fi.isShowing()&&(Fi.instance().showViewInWrapper(),t.InspectorView.InspectorView.instance().setDrawerMinimized(!1),mi.updateResizerAndSidebarButtons(this))}resolveLocation(e){return"sources.sidebar-top"===e||"sources.sidebar-bottom"===e||"sources.sidebar-tabs"===e?this.sidebarPaneStack||null:this.navigatorTabbedLocation}ensureSourcesViewVisible(){return!!Fi.isShowing()||!!t.InspectorView.InspectorView.instance().canSelectPanel("sources")&&(t.ViewManager.ViewManager.instance().showView("sources"),!0)}onResize(){"auto"===n.Settings.Settings.instance().moduleSetting("sidebarPosition").get()&&this.element.window().requestAnimationFrame(this.updateSidebarPosition.bind(this))}searchableView(){return this.sourcesViewInternal.searchableView()}debuggerPaused(e){const i=e.data,o=i.debuggerPausedDetails();!this.pausedInternal&&n.Settings.Settings.instance().moduleSetting("autoFocusOnDebuggerPausedEnabled").get()&&this.setAsCurrentPanel(),t.Context.Context.instance().flavor(a.Target.Target)===i.target()?this.showDebuggerPausedDetails(o):this.pausedInternal||t.Context.Context.instance().setFlavor(a.Target.Target,i.target())}showDebuggerPausedDetails(e){this.pausedInternal=!0,this.updateDebuggerButtonsAndStatus(),t.Context.Context.instance().setFlavor(a.DebuggerModel.DebuggerPausedDetails,e),this.toggleDebuggerSidebarButton.setEnabled(!1),this.revealDebuggerSidebar(),window.focus(),r.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront()}debuggerResumed(e){const i=e.target();t.Context.Context.instance().flavor(a.Target.Target)===i&&(this.pausedInternal=!1,this.clearInterface(),this.toggleDebuggerSidebarButton.setEnabled(!0),this.switchToPausedTargetTimeout=window.setTimeout(this.switchToPausedTarget.bind(this,e),500))}debuggerWasEnabled(e){const i=e.data;t.Context.Context.instance().flavor(a.Target.Target)===i.target()&&this.updateDebuggerButtonsAndStatus()}get visibleView(){return this.sourcesViewInternal.visibleView()}showUISourceCode(e,t,i,o){if(o){const e=Fi.isShowing();if(!this.isShowing()&&!e)return}else this.showEditor();this.sourcesViewInternal.showSourceLocation(e,void 0===t?void 0:{lineNumber:t,columnNumber:i},o)}showEditor(){Fi.isShowing()||this.setAsCurrentPanel()}showUILocation(e,t){this.showUISourceCode(e.uiSourceCode,e.lineNumber,e.columnNumber,t)}revealInNavigator(e,i){for(const o of Pi){const n=o.navigatorView(),r=o.viewId;r&&n.acceptProject(e.project())&&(n.revealUISourceCode(e,!0),i?this.navigatorTabbedLocation.tabbedPane().selectTab(r):t.ViewManager.ViewManager.instance().showView(r))}}populateNavigatorMenu(e){const t=n.Settings.Settings.instance().moduleSetting("navigatorGroupByFolder");e.appendItemsAtLocation("navigatorMenu"),e.viewSection().appendCheckboxItem(ui(li.groupByFolder),(()=>t.set(!t.get())),t.get())}setIgnoreExecutionLineEvents(e){this.ignoreExecutionLineEvents=e}updateLastModificationTime(){this.lastModificationTime=window.performance.now()}async executionLineChanged(e){const t=await e.uiLocation();t&&(window.performance.now()-this.lastModificationTime<bi||this.sourcesViewInternal.showSourceLocation(t.uiSourceCode,t,void 0,!0))}lastModificationTimeoutPassedForTest(){bi=Number.MIN_VALUE}updateLastModificationTimeForTest(){bi=Number.MAX_VALUE}async callFrameChanged(){const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);e&&(this.executionLineLocation&&this.executionLineLocation.dispose(),this.executionLineLocation=await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),this.executionLineChanged.bind(this),this.liveLocationPool))}pauseOnExceptionEnabledChanged(){const e=n.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").get(),t=this.pauseOnExceptionButton;t.setToggled(e),t.setTitle(ui(e?li.pauseOnExceptions:li.dontPauseOnExceptions)),this.debugToolbarDrawer.classList.toggle("expanded",e)}async updateDebuggerButtonsAndStatus(){const e=t.Context.Context.instance().flavor(a.Target.Target),i=e?e.model(a.DebuggerModel.DebuggerModel):null;i?this.pausedInternal?(this.togglePauseAction.setToggled(!0),this.togglePauseAction.setEnabled(!0),this.stepOverAction.setEnabled(!0),this.stepIntoAction.setEnabled(!0),this.stepOutAction.setEnabled(!0),this.stepAction.setEnabled(!0)):(this.togglePauseAction.setToggled(!1),this.togglePauseAction.setEnabled(!i.isPausing()),this.stepOverAction.setEnabled(!1),this.stepIntoAction.setEnabled(!1),this.stepOutAction.setEnabled(!1),this.stepAction.setEnabled(!1)):(this.togglePauseAction.setEnabled(!1),this.stepOverAction.setEnabled(!1),this.stepIntoAction.setEnabled(!1),this.stepOutAction.setEnabled(!1),this.stepAction.setEnabled(!1));const o=i?i.debuggerPausedDetails():null;await this.debuggerPausedMessage.render(o,c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance(),c.BreakpointManager.BreakpointManager.instance()),o&&this.updateDebuggerButtonsAndStatusForTest()}updateDebuggerButtonsAndStatusForTest(){}clearInterface(){this.updateDebuggerButtonsAndStatus(),t.Context.Context.instance().setFlavor(a.DebuggerModel.DebuggerPausedDetails,null),this.switchToPausedTargetTimeout&&clearTimeout(this.switchToPausedTargetTimeout),this.liveLocationPool.disposeAll()}switchToPausedTarget(e){if(delete this.switchToPausedTargetTimeout,!this.pausedInternal&&!e.isPaused())for(const e of a.TargetManager.TargetManager.instance().models(a.DebuggerModel.DebuggerModel))if(e.isPaused()){t.Context.Context.instance().setFlavor(a.Target.Target,e.target());break}}togglePauseOnExceptions(){n.Settings.Settings.instance().moduleSetting("pauseOnExceptionEnabled").set(!this.pauseOnExceptionButton.toggled())}runSnippet(){const e=this.sourcesViewInternal.currentUISourceCode();e&&S.ScriptSnippetFileSystem.evaluateScriptSnippet(e)}editorSelected(e){const t=e.data;this.editorView.mainWidget()&&n.Settings.Settings.instance().moduleSetting("autoRevealInNavigator").get()&&this.revealInNavigator(t,!0)}togglePause(){const e=t.Context.Context.instance().flavor(a.Target.Target);if(!e)return!0;const i=e.model(a.DebuggerModel.DebuggerModel);return!i||(this.pausedInternal?(this.pausedInternal=!1,i.resume()):i.pause(),this.clearInterface(),!0)}prepareToResume(){if(!this.pausedInternal)return null;this.pausedInternal=!1,this.clearInterface();const e=t.Context.Context.instance().flavor(a.Target.Target);return e?e.model(a.DebuggerModel.DebuggerModel):null}longResume(){const e=this.prepareToResume();e&&(e.skipAllPausesUntilReloadOrTimeout(500),e.resume())}terminateExecution(){const e=this.prepareToResume();e&&(e.runtimeModel().terminateExecution(),e.resume())}stepOver(){const e=this.prepareToResume();return e&&e.stepOver(),!0}stepInto(){const e=this.prepareToResume();return e&&e.stepInto(),!0}stepIntoAsync(){const e=this.prepareToResume();return e&&e.scheduleStepIntoAsync(),!0}stepOut(){const e=this.prepareToResume();return e&&e.stepOut(),!0}async continueToLocation(e){const i=t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);if(!i)return;const o=(await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(e.uiSourceCode,e.lineNumber,0)).find((e=>e.debuggerModel===i.debuggerModel));o&&this.prepareToResume()&&o.continueToLocation()}toggleBreakpointsActive(){n.Settings.Settings.instance().moduleSetting("breakpointsActive").set(!n.Settings.Settings.instance().moduleSetting("breakpointsActive").get())}breakpointsActiveStateChanged(){const e=n.Settings.Settings.instance().moduleSetting("breakpointsActive").get();this.toggleBreakpointsActiveAction.setToggled(!e),this.sourcesViewInternal.toggleBreakpointsActiveState(e)}createDebugToolbar(){const e=new t.Toolbar.Toolbar("scripts-debug-toolbar"),i=new t.Toolbar.ToolbarButton(ui(li.resumeWithAllPausesBlockedForMs),"largeicon-play");i.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.longResume,this);const o=new t.Toolbar.ToolbarButton(ui(li.terminateCurrentJavascriptCall),"largeicon-terminate-execution");return o.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.terminateExecution,this),e.appendToolbarItem(t.Toolbar.Toolbar.createLongPressActionButton(this.togglePauseAction,[o,i],[])),e.appendToolbarItem(t.Toolbar.Toolbar.createActionButton(this.stepOverAction)),e.appendToolbarItem(t.Toolbar.Toolbar.createActionButton(this.stepIntoAction)),e.appendToolbarItem(t.Toolbar.Toolbar.createActionButton(this.stepOutAction)),e.appendToolbarItem(t.Toolbar.Toolbar.createActionButton(this.stepAction)),e.appendSeparator(),e.appendToolbarItem(t.Toolbar.Toolbar.createActionButton(this.toggleBreakpointsActiveAction)),this.pauseOnExceptionButton=new t.Toolbar.ToolbarToggle("","largeicon-pause-on-exceptions"),this.pauseOnExceptionButton.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.togglePauseOnExceptions,this),e.appendToolbarItem(this.pauseOnExceptionButton),e}createDebugToolbarDrawer(){const e=document.createElement("div");e.classList.add("scripts-debug-toolbar-drawer");const i=ui(li.pauseOnCaughtExceptions),o=n.Settings.Settings.instance().moduleSetting("pauseOnCaughtException");return e.appendChild(t.SettingsUI.createSettingCheckbox(i,o,!0)),e}appendApplicableItems(e,t,i){this.appendUISourceCodeItems(e,t,i),this.appendUISourceCodeFrameItems(e,t,i),this.appendUILocationItems(t,i),this.appendRemoteObjectItems(t,i),this.appendNetworkRequestItems(t,i)}appendUISourceCodeItems(e,t,i){if(!(i instanceof d.UISourceCode.UISourceCode&&e.target))return;const o=i,n=e.target;o.project().isServiceProject()||n.isSelfOrDescendant(this.navigatorTabbedLocation.widget().element)||t.revealSection().appendItem(ui(li.revealInSidebar),this.handleContextMenuReveal.bind(this,o))}appendUISourceCodeFrameItems(e,t,i){i instanceof Bi&&(i.uiSourceCode().contentType().isFromSourceMap()||i.textEditor.state.selection.main.empty||t.debugSection().appendAction("debugger.evaluate-selection"))}appendUILocationItems(e,i){if(!(i instanceof d.UISourceCode.UILocation))return;const o=i,n=o.uiSourceCode;if(!c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptsForUISourceCode(n).every((e=>e.isJavaScript())))return;if(n.contentType().hasScripts()){const i=t.Context.Context.instance().flavor(a.Target.Target),r=i?i.model(a.DebuggerModel.DebuggerModel):null;r&&r.isPaused()&&e.debugSection().appendItem(ui(li.continueToHere),this.continueToLocation.bind(this,o)),this.callstackPane.appendIgnoreListURLContextMenuItems(e,n)}}handleContextMenuReveal(e){this.editorView.showBoth(),this.revealInNavigator(e)}appendRemoteObjectItems(e,i){if(!(i instanceof a.RemoteObject.RemoteObject))return;const o=n.Settings.Settings.instance().moduleSetting("textEditorIndent").get(),c=i,l=t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);const d="wasm"===c.type?c.subtype:"node"===c.subtype?"outerHTML":c.type;e.debugSection().appendItem(ui(li.storeSAsGlobalVariable,{PH1:String(d)}),(()=>a.ConsoleModel.ConsoleModel.instance().saveToTempVariable(l,c)));const u=e.clipboardSection(),h=r.InspectorFrontendHost.InspectorFrontendHostInstance;if("string"===c.type)u.appendItem(ui(li.copyStringContents),(()=>{h.copyText(c.value)})),u.appendItem(ui(li.copyStringAsJSLiteral),(()=>{h.copyText(s.StringUtilities.formatAsJSLiteral(c.value))})),u.appendItem(ui(li.copyStringAsJSONLiteral),(()=>{h.copyText(JSON.stringify(c.value))}));else if(hi.has(c.type))u.appendItem(ui(li.copyS,{PH1:String(d)}),(()=>{h.copyText(c.description)}));else if("object"===c.type){const e=async()=>{const e=await c.callFunctionJSON(p,[{value:{subtype:c.subtype,indent:o}}]);h.copyText(e)};u.appendItem(ui(li.copyS,{PH1:String(d)}),e)}else"function"===c.type&&(globalThis.chii||e.debugSection().appendItem(ui(li.showFunctionDefinition),this.showFunctionDefinition.bind(this,c)));function p(e){const t=e.subtype,i=e.indent;if("node"===t)return this instanceof Element?this.outerHTML:void 0;if(t&&void 0===this)return String(t);try{return JSON.stringify(this,null,i)}catch(e){return String(this)}}}appendNetworkRequestItems(e,t){if(!(t instanceof a.NetworkRequest.NetworkRequest))return;const i=t,o=this.workspace.uiSourceCodeForURL(i.url());if(!o)return;const n=ui(li.openInSourcesPanel),r=this.showUILocation.bind(this,o.uiLocation(0,0));e.revealSection().appendItem(n,r)}showFunctionDefinition(e){e.debuggerModel().functionDetailsPromise(e).then(this.didGetFunctionDetails.bind(this))}async didGetFunctionDetails(e){if(!e||!e.location)return;const t=await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.location);t&&this.showUILocation(t)}revealNavigatorSidebar(){this.setAsCurrentPanel(),this.editorView.showBoth(!0)}revealDebuggerSidebar(){n.Settings.Settings.instance().moduleSetting("autoFocusOnDebuggerPausedEnabled").get()&&(this.setAsCurrentPanel(),this.splitWidget.showBoth(!0))}updateSidebarPosition(){let e;const i=n.Settings.Settings.instance().moduleSetting("sidebarPosition").get();if(e="right"!==i&&("bottom"===i||t.InspectorView.InspectorView.instance().element.offsetWidth<680),this.sidebarPaneView&&e===!this.splitWidget.isVertical())return;if(this.sidebarPaneView&&this.sidebarPaneView.shouldHideOnDetach())return;this.sidebarPaneView&&this.sidebarPaneView.detach(),this.splitWidget.setVertical(!e),this.splitWidget.element.classList.toggle("sources-split-view-vertical",e),mi.updateResizerAndSidebarButtons(this);const o=new t.Widget.VBox;o.element.appendChild(this.debugToolbar.element),o.element.appendChild(this.debugToolbarDrawer),o.setMinimumAndPreferredSizes(fi,25,fi,100),this.sidebarPaneStack=t.ViewManager.ViewManager.instance().createStackLocation(this.revealDebuggerSidebar.bind(this)),this.sidebarPaneStack.widget().element.classList.add("overflow-auto"),this.sidebarPaneStack.widget().show(o.element),this.sidebarPaneStack.widget().element.appendChild(this.debuggerPausedMessage.element()),this.sidebarPaneStack.appendApplicableItems("sources.sidebar-top"),this.threadsSidebarPane&&this.sidebarPaneStack.showView(this.threadsSidebarPane);const r=t.ViewManager.ViewManager.instance().view("sources.jsBreakpoints"),s=t.ViewManager.ViewManager.instance().view("sources.scopeChain");if(this.tabbedLocationHeader&&(this.splitWidget.uninstallResizer(this.tabbedLocationHeader),this.tabbedLocationHeader=null),e){const e=new t.SplitWidget.SplitWidget(!0,!0,"sourcesPanelDebuggerSidebarSplitViewState",.5);e.setMainWidget(o),this.sidebarPaneStack.showView(r),this.sidebarPaneStack.showView(this.callstackPane);const i=t.ViewManager.ViewManager.instance().createTabbedLocation(this.revealDebuggerSidebar.bind(this));e.setSidebarWidget(i.tabbedPane()),this.tabbedLocationHeader=i.tabbedPane().headerElement(),this.splitWidget.installResizer(this.tabbedLocationHeader),this.splitWidget.installResizer(this.debugToolbar.gripElementForResize()),i.appendView(s),i.appendView(this.watchSidebarPane),i.appendApplicableItems("sources.sidebar-tabs"),this.extensionSidebarPanesContainer=i,this.sidebarPaneView=e}else this.sidebarPaneStack.appendView(this.watchSidebarPane),this.sidebarPaneStack.showView(r),this.sidebarPaneStack.showView(s),this.sidebarPaneStack.showView(this.callstackPane),this.extensionSidebarPanesContainer=this.sidebarPaneStack,this.sidebarPaneView=o,this.splitWidget.uninstallResizer(this.debugToolbar.gripElementForResize());this.sidebarPaneStack.appendApplicableItems("sources.sidebar-bottom");const a=v.ExtensionServer.ExtensionServer.instance().sidebarPanes();for(let e=0;e<a.length;++e)this.addExtensionSidebarPane(a[e]);this.splitWidget.setSidebarWidget(this.sidebarPaneView)}setAsCurrentPanel(){return t.ViewManager.ViewManager.instance().showView("sources")}extensionSidebarPaneAdded(e){this.addExtensionSidebarPane(e.data)}addExtensionSidebarPane(e){e.panelName()===this.name&&this.extensionSidebarPanesContainer.appendView(e)}sourcesView(){return this.sourcesViewInternal}handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0].webkitGetAsEntry();i&&i.isDirectory&&r.InspectorFrontendHost.InspectorFrontendHostInstance.upgradeDraggedFileSystemPermissions(i.filesystem)}}let bi=200;const fi=215;let vi,Si,Ci,wi,Ii,ki;class xi{static instance(e={forceNew:null}){const{forceNew:t}=e;return vi&&!t||(vi=new xi),vi}reveal(e,t){return e instanceof d.UISourceCode.UILocation?(mi.instance().showUILocation(e,t),Promise.resolve()):Promise.reject(new Error("Internal error: not a ui location"))}}class yi{static instance(e={forceNew:null}){const{forceNew:t}=e;return Si&&!t||(Si=new yi),Si}async reveal(e,t){if(!(e instanceof a.DebuggerModel.Location))throw new Error("Internal error: not a debugger location");const i=await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e);i&&mi.instance().showUILocation(i,t)}}class Ei{static instance(e={forceNew:null}){const{forceNew:t}=e;return Ci&&!t||(Ci=new Ei),Ci}reveal(e,t){return e instanceof d.UISourceCode.UISourceCode?(mi.instance().showUISourceCode(e,void 0,void 0,t),Promise.resolve()):Promise.reject(new Error("Internal error: not a ui source code"))}}class Ti{static instance(e={forceNew:null}){const{forceNew:t}=e;return wi&&!t||(wi=new Ti),wi}reveal(e){return n.Settings.Settings.instance().moduleSetting("autoFocusOnDebuggerPausedEnabled").get()?mi.instance().setAsCurrentPanel():Promise.resolve()}}class Li{static instance(e={forceNew:null}){const{forceNew:t}=e;return Ii&&!t||(Ii=new Li),Ii}handleAction(e,i){const o=mi.instance();if(!o.ensureSourcesViewVisible())return!1;if("debugger.toggle-pause"===i){return e.flavor(t.ShortcutRegistry.ForwardedShortcut)&&!n.Settings.Settings.instance().moduleSetting("disablePausedStateOverlay").get()||o.togglePause(),!0}return!1}}class Mi{static instance(e={forceNew:null}){const{forceNew:t}=e;return ki&&!t||(ki=new Mi),ki}handleAction(e,i){const o=mi.instance();switch(i){case"debugger.step-over":return o.stepOver(),!0;case"debugger.step-into":return o.stepIntoAsync(),!0;case"debugger.step":return o.stepInto(),!0;case"debugger.step-out":return o.stepOut(),!0;case"debugger.run-snippet":return o.runSnippet(),!0;case"debugger.toggle-breakpoints-active":return o.toggleBreakpointsActive(),!0;case"debugger.evaluate-selection":{const e=t.Context.Context.instance().flavor(Bi);if(e){const{state:i}=e.textEditor;let o=i.sliceDoc(i.selection.main.from,i.selection.main.to);const n=t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);if(n){const e=a.ConsoleModel.ConsoleModel.instance().addCommandMessage(n,o);o=b.JavaScriptREPL.JavaScriptREPL.wrapObjectLiteral(o),a.ConsoleModel.ConsoleModel.instance().evaluateCommandInConsole(n,e,o,!0)}}return!0}}return!1}}class Fi extends t.Widget.VBox{view;constructor(){super(),this.element.classList.add("sources-view-wrapper"),this.view=mi.instance().sourcesView()}static instance(){return gi||(gi=new Fi),gi}static isShowing(){return Boolean(gi)&&gi.isShowing()}wasShown(){mi.instance().isShowing()?t.InspectorView.InspectorView.instance().setDrawerMinimized(!0):this.showViewInWrapper(),mi.updateResizerAndSidebarButtons(mi.instance())}willHide(){t.InspectorView.InspectorView.instance().setDrawerMinimized(!1),queueMicrotask((()=>{mi.updateResizerAndSidebarButtons(mi.instance())}))}showViewInWrapper(){this.view.show(this.element)}}const Pi=[{viewId:"navigator-network",navigatorView:Jt.instance,experiment:void 0},{viewId:"navigator-files",navigatorView:Yt.instance,experiment:void 0},{viewId:"navigator-snippets",navigatorView:Zt.instance,experiment:void 0},{viewId:"navigator-overrides",navigatorView:Xt.instance,experiment:void 0},{viewId:"navigator-contentScripts",navigatorView:Qt.instance,experiment:void 0}];var Di,Ai=Object.freeze({__proto__:null,SourcesPanel:mi,get lastModificationTimeout(){return bi},minToolbarWidth:fi,UILocationRevealer:xi,DebuggerLocationRevealer:yi,UISourceCodeRevealer:Ei,DebuggerPausedDetailsRevealer:Ti,RevealingActionDelegate:Li,DebuggingActionDelegate:Mi,WrapperView:Fi});class Bi extends(n.ObjectWrapper.eventMixin(h.SourceFrame.SourceFrameImpl)){uiSourceCodeInternal;muteSourceCodeEvents;persistenceBinding;uiSourceCodeEventListeners;messageAndDecorationListeners;boundOnBindingChanged;plugins=[];errorPopoverHelper;constructor(e){super((function(){if(e.isDirty())return Promise.resolve({content:e.workingCopy(),isEncoded:!1});return e.requestContent()})),this.uiSourceCodeInternal=e,this.muteSourceCodeEvents=!1,this.persistenceBinding=l.Persistence.PersistenceImpl.instance().binding(e),this.uiSourceCodeEventListeners=[],this.messageAndDecorationListeners=[],this.boundOnBindingChanged=this.onBindingChanged.bind(this),n.Settings.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").addChangeListener(this.onNetworkPersistenceChanged,this),this.errorPopoverHelper=new t.PopoverHelper.PopoverHelper(this.textEditor.editor.contentDOM,this.getErrorPopoverContent.bind(this)),this.errorPopoverHelper.setHasPadding(!0),this.errorPopoverHelper.setTimeout(100,100),this.initializeUISourceCode()}editorConfiguration(e){return[super.editorConfiguration(e),(t=[...this.allMessages()],[zi.init((e=>_i.create(Wi.create(t),e.doc))),Gi]),Vi.of(this.plugins.map((e=>e.editorExtension())))];var t}onFocus(){super.onFocus(),t.Context.Context.instance().setFlavor(Bi,this)}onBlur(){super.onBlur(),t.Context.Context.instance().setFlavor(Bi,null)}installMessageAndDecorationListeners(){if(this.persistenceBinding){const e=this.persistenceBinding.network,t=this.persistenceBinding.fileSystem;this.messageAndDecorationListeners=[e.addEventListener(d.UISourceCode.Events.MessageAdded,this.onMessageAdded,this),e.addEventListener(d.UISourceCode.Events.MessageRemoved,this.onMessageRemoved,this),e.addEventListener(d.UISourceCode.Events.DecorationChanged,this.onDecorationChanged,this),t.addEventListener(d.UISourceCode.Events.MessageAdded,this.onMessageAdded,this),t.addEventListener(d.UISourceCode.Events.MessageRemoved,this.onMessageRemoved,this)]}else this.messageAndDecorationListeners=[this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.MessageAdded,this.onMessageAdded,this),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.MessageRemoved,this.onMessageRemoved,this),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.DecorationChanged,this.onDecorationChanged,this)]}uiSourceCode(){return this.uiSourceCodeInternal}setUISourceCode(e){const t=e.contentLoaded()?Promise.resolve():e.requestContent(),i=this.uiSourceCodeInternal;t.then((()=>{this.uiSourceCodeInternal===i&&(this.unloadUISourceCode(),this.uiSourceCodeInternal=e,e.workingCopy()!==this.textEditor.state.doc.toString()?this.setContent(e.workingCopy()):this.reloadPlugins(),this.initializeUISourceCode())}),console.error)}unloadUISourceCode(){n.EventTarget.removeEventListeners(this.messageAndDecorationListeners),n.EventTarget.removeEventListeners(this.uiSourceCodeEventListeners),this.uiSourceCodeInternal.removeWorkingCopyGetter(),l.Persistence.PersistenceImpl.instance().unsubscribeFromBindingEvent(this.uiSourceCodeInternal,this.boundOnBindingChanged)}initializeUISourceCode(){if(this.uiSourceCodeEventListeners=[this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.WorkingCopyChanged,this.onWorkingCopyChanged,this),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.WorkingCopyCommitted,this.onWorkingCopyCommitted,this),this.uiSourceCodeInternal.addEventListener(d.UISourceCode.Events.TitleChanged,this.onTitleChanged,this)],l.Persistence.PersistenceImpl.instance().subscribeForBindingEvent(this.uiSourceCodeInternal,this.boundOnBindingChanged),this.installMessageAndDecorationListeners(),this.updateStyle(),g.Runtime.experiments.isEnabled("sourcesPrettyPrint")){const e=new Set(["text/html","text/css","text/javascript"]);this.setCanPrettyPrint(e.has(this.contentType),!0)}}wasShown(){super.wasShown(),this.setEditable(this.canEditSourceInternal())}willHide(){for(const e of this.plugins)e.willHide();super.willHide(),t.Context.Context.instance().setFlavor(Bi,null),this.uiSourceCodeInternal.removeWorkingCopyGetter()}getContentType(){const e=l.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);return e?e.network.mimeType():this.uiSourceCodeInternal.mimeType()}canEditSourceInternal(){return!this.hasLoadError()&&(!this.uiSourceCodeInternal.editDisabled()&&("application/wasm"!==this.uiSourceCodeInternal.mimeType()&&(!!l.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal)||(!!this.uiSourceCodeInternal.project().canSetFileContent()||!this.uiSourceCodeInternal.project().isServiceProject()&&(!(this.uiSourceCodeInternal.project().type()!==d.Workspace.projectTypes.Network||!l.NetworkPersistenceManager.NetworkPersistenceManager.instance().active())||(!this.pretty||!this.uiSourceCodeInternal.contentType().hasScripts())&&this.uiSourceCodeInternal.contentType()!==n.ResourceType.resourceTypes.Document)))))}onNetworkPersistenceChanged(){this.setEditable(this.canEditSourceInternal())}commitEditing(){this.uiSourceCodeInternal.isDirty()&&(this.muteSourceCodeEvents=!0,this.uiSourceCodeInternal.commitWorkingCopy(),this.muteSourceCodeEvents=!1)}async setContent(e){this.disposePlugins(),this.loadPlugins(),await super.setContent(e);for(const e of this.plugins)e.editorInitialized(this.textEditor);n.EventTarget.fireEvent("source-file-loaded",this.uiSourceCodeInternal.displayName(!0))}allMessages(){if(this.persistenceBinding){const e=this.persistenceBinding.network.messages();return s.SetUtilities.addAll(e,this.persistenceBinding.fileSystem.messages()),e}return this.uiSourceCodeInternal.messages()}onTextChanged(){const e=this.pretty;super.onTextChanged(),this.errorPopoverHelper.hidePopover(),mi.instance().updateLastModificationTime(),this.muteSourceCodeEvents=!0,this.isClean()?this.uiSourceCodeInternal.resetWorkingCopy():this.uiSourceCodeInternal.setWorkingCopyGetter((()=>this.textEditor.state.doc.toString())),this.muteSourceCodeEvents=!1,e!==this.pretty&&(this.updateStyle(),this.reloadPlugins())}onWorkingCopyChanged(){this.muteSourceCodeEvents||this.maybeSetContent(this.uiSourceCodeInternal.workingCopy())}onWorkingCopyCommitted(){this.muteSourceCodeEvents||this.maybeSetContent(this.uiSourceCode().workingCopy()),this.contentCommitted(),this.updateStyle()}reloadPlugins(){this.disposePlugins(),this.loadPlugins();const e=this.textEditor;e.dispatch({effects:Vi.reconfigure(this.plugins.map((e=>e.editorExtension())))});for(const t of this.plugins)t.editorInitialized(e)}onTitleChanged(){this.updateLanguageMode("").then((()=>this.reloadPlugins()),console.error)}loadPlugins(){const e=l.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal),t=e?e.network:this.uiSourceCodeInternal;for(const e of[ze,Ho,tt,ht,st,ce,Ze,et])e.accepts(t)&&this.plugins.push(new e(t,this));this.dispatchEventToListeners(Di.ToolbarItemsChanged)}disposePlugins(){for(const e of this.plugins)e.dispose();this.plugins=[]}onBindingChanged(){const e=l.Persistence.PersistenceImpl.instance().binding(this.uiSourceCodeInternal);e!==this.persistenceBinding&&(this.unloadUISourceCode(),this.persistenceBinding=e,this.initializeUISourceCode(),this.reloadPlugins())}updateStyle(){this.setEditable(this.canEditSourceInternal())}maybeSetContent(e){this.textEditor.state.doc.toString()!==e&&this.setContent(e)}populateTextAreaContextMenu(e,t,i){super.populateTextAreaContextMenu(e,t,i),e.appendApplicableItems(this.uiSourceCodeInternal);const o=this.editorLocationToUILocation(t,i);e.appendApplicableItems(new d.UISourceCode.UILocation(this.uiSourceCodeInternal,o.lineNumber,o.columnNumber));for(const o of this.plugins)o.populateTextAreaContextMenu(e,t,i)}populateLineGutterContextMenu(e,t){super.populateLineGutterContextMenu(e,t);for(const i of this.plugins)i.populateLineGutterContextMenu(e,t)}dispose(){this.errorPopoverHelper.dispose(),this.disposePlugins(),this.unloadUISourceCode(),this.textEditor.editor.destroy(),this.detach(),n.Settings.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").removeChangeListener(this.onNetworkPersistenceChanged,this)}onMessageAdded(e){const{editor:t}=this.textEditor,i=t.state.field(zi,!1);i&&t.dispatch({effects:Oi.of(i.messages.add(e.data))})}onMessageRemoved(e){const{editor:t}=this.textEditor,i=t.state.field(zi,!1);i&&t.dispatch({effects:Oi.of(i.messages.remove(e.data))})}onDecorationChanged(e){for(const t of this.plugins)t.decorationChanged(e.data,this.textEditor)}async toolbarItems(){const e=await super.toolbarItems(),i=[];for(const t of this.plugins)e.push(...t.leftToolbarItems()),i.push(...await t.rightToolbarItems());return i.length?[...e,new t.Toolbar.ToolbarSeparator(!0),...i]:e}getErrorPopoverContent(e){const t=e,i=e.target,o=i.enclosingNodeOrSelfWithClass("cm-messageIcon-error")||i.enclosingNodeOrSelfWithClass("cm-messageIcon-issue");if(!o)return null;const n=this.textEditor.state.field(zi,!1);if(!n||0===n.messages.rows.length)return null;const{editor:r}=this.textEditor,s=r.posAtCoords(t);if(null===s)return null;const a=r.state.doc.lineAt(s);if(s!==a.to)return null;const c=n.messages.rows.find((e=>e[0].lineNumber()===a.number-1));if(!c)return null;const l=o.classList.contains("cm-messageIcon-issue"),u=c.filter((e=>e.level()===d.UISourceCode.Message.Level.Issue===l));if(!u.length)return null;const h=o?o.boxInWindow():new AnchorBox(t.clientX,t.clientY,1,1),p=function(e){const t=[];for(let i=0;i<e.length;i++){t[i]=0;for(let o=0;o<=i;o++)if(e[o].isEqual(e[i])){t[o]++;break}}return t}(u),g=document.createElement("div");g.classList.add("text-editor-messages-description-container");for(let e=0;e<u.length;e++)p[e]&&g.appendChild(qi(u[e],p[e]));return{box:h,hide(){},show:e=>(e.contentElement.append(g),Promise.resolve(!0))}}}function Ni(e){return e===d.UISourceCode.Message.Level.Error?{color:"",width:"12px",height:"12px",iconName:"error_icon"}:e===d.UISourceCode.Message.Level.Warning?{color:"",width:"12px",height:"12px",iconName:"warning_icon"}:e===d.UISourceCode.Message.Level.Issue?{color:"var(--issue-color-yellow)",width:"12px",height:"12px",iconName:"issue-exclamation-icon"}:{color:"",width:"12px",height:"12px",iconName:"error_icon"}}function Ui(e,t){const i={[d.UISourceCode.Message.Level.Issue]:2,[d.UISourceCode.Message.Level.Warning]:3,[d.UISourceCode.Message.Level.Error]:4};return i[e.level()]-i[t.level()]}(Di||(Di={})).ToolbarItemsChanged="ToolbarItemsChanged";const Vi=new i.Compartment;function ji(e,t){const i=t.lineNumber();let o=0;for(;o<e.length;o++){const n=e[o][0].lineNumber()-i;if(0===n)return e[o]=e[o].concat(t),e;if(n>0)break}return e.splice(o,0,[t]),e}class Wi{rows;constructor(e){this.rows=e}static create(e){const t=[];for(const i of e)ji(t,i);return new Wi(t)}remove(e){const t=this.rows.slice();return function(e,t){for(let i=0;i<e.length;i++)if(e[i][0].lineNumber()===t.lineNumber()){const o=e[i].filter((e=>!e.isEqual(t)));o.length?e[i]=o:e.splice(i,1);break}}(t,e),new Wi(t)}add(e){return new Wi(ji(this.rows.slice(),e))}}const Oi=i.StateEffect.define(),Ri=i.Decoration.mark({class:"cm-waveUnderline"});class Hi extends i.WidgetType{messages;constructor(e){super(),this.messages=e}eq(e){return e.messages===this.messages}toDOM(){const e=document.createElement("span");e.classList.add("cm-messageIcon");const t=this.messages.filter((e=>e.level()!==d.UISourceCode.Message.Level.Issue));if(t.length){const i=t.sort(Ui)[t.length-1],o=e.appendChild(new w.Icon.Icon);o.data=Ni(i.level()),o.classList.add("cm-messageIcon-error")}const i=this.messages.find((e=>e.level()===d.UISourceCode.Message.Level.Issue));if(i){const t=e.appendChild(new w.Icon.Icon);t.data=Ni(d.UISourceCode.Message.Level.Issue),t.classList.add("cm-messageIcon-issue"),t.addEventListener("click",(()=>(i.clickHandler()||Math.min)()))}return e}ignoreEvents(){return!0}}class _i{messages;decorations;constructor(e,t){this.messages=e,this.decorations=t}static create(e,t){const o=new i.RangeSetBuilder;for(const n of e.rows){const e=t.line(n[0].lineNumber()+1),r=n.reduce(((e,t)=>Math.min(e,t.columnNumber()||0)),e.length);r<e.length&&o.add(e.from+r,e.to,Ri),o.add(e.to,e.to,i.Decoration.widget({side:1,widget:new Hi(n)}))}return new _i(e,o.finish())}apply(e){let t=this;e.docChanged&&(t=new _i(this.messages,this.decorations.map(e.changes)));for(const i of e.effects)i.is(Oi)&&(t=_i.create(i.value,e.state.doc));return t}}const zi=i.StateField.define({create:e=>_i.create(new Wi([]),e.doc),update:(e,t)=>e.apply(t),provide:e=>i.Prec.lowest(i.EditorView.decorations.from(e,(e=>e.decorations)))});function qi(e,t){const i=document.createElement("div");if(i.classList.add("text-editor-row-message"),1===t){const t=i.appendChild(new w.Icon.Icon);t.data=function(e){return e instanceof C.SourceFrameIssuesManager.IssueMessage?{...I.IssueCounter.getIssueKindIconData(e.getIssueKind()),width:"12px",height:"12px"}:Ni(e.level())}(e),t.classList.add("text-editor-row-message-icon"),t.addEventListener("click",(()=>(e.clickHandler()||Math.min)()))}else{const o=document.createElement("span",{is:"dt-small-bubble"});o.textContent=String(t),o.classList.add("text-editor-row-message-repeat-count"),i.appendChild(o),o.type=function(e){switch(e){case d.UISourceCode.Message.Level.Error:return"error";case d.UISourceCode.Message.Level.Warning:case d.UISourceCode.Message.Level.Issue:return"warning"}}(e.level())}const o=i.createChild("div");for(const t of e.text().split("\n"))o.createChild("div").textContent=t;return i}const Gi=i.EditorView.baseTheme({".cm-tooltip-message":{padding:"4px"},".cm-waveUnderline":{backgroundImage:"var(--image-file-errorWave)",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",paddingBottom:"1px"},".cm-messageIcon":{cursor:"pointer","& > *":{verticalAlign:"text-bottom",marginLeft:"2px"}}});var Ki=Object.freeze({__proto__:null,UISourceCodeFrame:Bi,get Events(){return Di}});const $i={areYouSureYouWantToCloseUnsaved:"Are you sure you want to close unsaved file: {PH1}?",unableToLoadThisContent:"Unable to load this content.",changesToThisFileWereNotSavedTo:"Changes to this file were not saved to file system."},Ji=e.i18n.registerUIStrings("panels/sources/TabbedEditorContainer.ts",$i),Yi=e.i18n.getLocalizedString.bind(void 0,Ji);class Xi extends n.ObjectWrapper.ObjectWrapper{delegate;tabbedPane;tabIds;files;previouslyViewedFilesSetting;history;uriToUISourceCode;currentFileInternal;currentView;scrollTimer;constructor(e,i,o,n){super(),this.delegate=e,this.tabbedPane=new t.TabbedPane.TabbedPane,this.tabbedPane.setPlaceholderElement(o,n),this.tabbedPane.setTabDelegate(new oo(this)),this.tabbedPane.setCloseableTabs(!0),this.tabbedPane.setAllowTabReorder(!0,!0),this.tabbedPane.addEventListener(t.TabbedPane.Events.TabClosed,this.tabClosed,this),this.tabbedPane.addEventListener(t.TabbedPane.Events.TabSelected,this.tabSelected,this),l.Persistence.PersistenceImpl.instance().addEventListener(l.Persistence.Events.BindingCreated,this.onBindingCreated,this),l.Persistence.PersistenceImpl.instance().addEventListener(l.Persistence.Events.BindingRemoved,this.onBindingRemoved,this),this.tabIds=new Map,this.files=new Map,this.previouslyViewedFilesSetting=i,this.history=io.fromObject(this.previouslyViewedFilesSetting.get()),this.uriToUISourceCode=new Map}onBindingCreated(e){const t=e.data;this.updateFileTitle(t.fileSystem);const i=this.tabIds.get(t.network);let o=this.tabIds.get(t.fileSystem);const n=this.currentFileInternal===t.network,r=this.history.selectionRange(t.network.url()),s=this.history.scrollLineNumber(t.network.url());if(this.history.remove(t.network.url()),i){if(!o){const e=this.tabbedPane.tabView(i),n=this.tabbedPane.tabIndex(i);if(e instanceof Bi)this.delegate.recycleUISourceCodeFrame(e,t.fileSystem),o=this.appendFileTab(t.fileSystem,!1,n,e);else{o=this.appendFileTab(t.fileSystem,!1,n);const e=this.tabbedPane.tabView(o);this.restoreEditorProperties(e,r,s)}}this.closeTabs([i],!0),n&&this.tabbedPane.selectTab(o,!1),this.updateHistory()}}onBindingRemoved(e){const t=e.data;this.updateFileTitle(t.fileSystem)}get view(){return this.tabbedPane}get visibleView(){return this.tabbedPane.visibleView}fileViews(){return this.tabbedPane.tabViews()}leftToolbar(){return this.tabbedPane.leftToolbar()}rightToolbar(){return this.tabbedPane.rightToolbar()}show(e){this.tabbedPane.show(e)}showFile(e){const i=l.Persistence.PersistenceImpl.instance().binding(e);e=i?i.fileSystem:e;const o=t.Context.Context.instance().flavor(co);o?.currentSourceFrame()?.contentSet&&this.currentFileInternal===e&&o?.currentUISourceCode()===e?n.EventTarget.fireEvent("source-file-loaded",e.displayName(!0)):this.innerShowFile(this.canonicalUISourceCode(e),!0)}closeFile(e){const t=this.tabIds.get(e);t&&this.closeTabs([t])}closeAllFiles(){this.closeTabs(this.tabbedPane.tabIds())}historyUISourceCodes(){const e=[],t=this.history.urls();for(const i of t){const t=this.uriToUISourceCode.get(i);t&&e.push(t)}return e}addViewListeners(){this.currentView&&this.currentView instanceof h.SourceFrame.SourceFrameImpl&&(this.currentView.addEventListener("EditorUpdate",this.onEditorUpdate,this),this.currentView.addEventListener("EditorScroll",this.onScrollChanged,this))}removeViewListeners(){this.currentView&&this.currentView instanceof h.SourceFrame.SourceFrameImpl&&(this.currentView.removeEventListener("EditorUpdate",this.onEditorUpdate,this),this.currentView.removeEventListener("EditorScroll",this.onScrollChanged,this))}onScrollChanged(){if(this.currentView instanceof h.SourceFrame.SourceFrameImpl&&(this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout((()=>this.history.save(this.previouslyViewedFilesSetting)),100),this.currentFileInternal)){const{editor:e}=this.currentView.textEditor,t=e.blockAtHeight(e.scrollDOM.getBoundingClientRect().top),i=e.state.doc.lineAt(t.from).number-1;this.history.updateScrollLineNumber(this.currentFileInternal.url(),i)}}onEditorUpdate({data:e}){if(e.docChanged||e.selectionSet){const{main:t}=e.state.selection,i=e.state.doc.lineAt(t.from),o=e.state.doc.lineAt(t.to),n=new m.TextRange.TextRange(i.number-1,t.from-i.from,o.number-1,t.to-o.from);this.currentFileInternal&&this.history.updateSelectionRange(this.currentFileInternal.url(),n),this.history.save(this.previouslyViewedFilesSetting),this.currentFileInternal&&v.ExtensionServer.ExtensionServer.instance().sourceSelectionChanged(this.currentFileInternal.url(),n)}}innerShowFile(e,t){const i=l.Persistence.PersistenceImpl.instance().binding(e);if(e=i?i.fileSystem:e,this.currentFileInternal===e)return;this.removeViewListeners(),this.currentFileInternal=e;const o=this.tabIds.get(e)||this.appendFileTab(e,t);this.tabbedPane.selectTab(o,t),t&&this.editorSelectedByUserAction();const n=this.currentView;this.currentView=this.visibleView,this.addViewListeners();const r={currentFile:this.currentFileInternal,currentView:this.currentView,previousView:n,userGesture:t};this.dispatchEventToListeners(Qi.EditorSelected,r)}titleForFile(e){let t=s.StringUtilities.trimMiddle(e.displayName(!0),30);return e.isDirty()&&(t+="*"),t}maybeCloseTab(e,t){const i=this.files.get(e);if(!i)return!1;return!(i.isDirty()&&i.project().canSetFileContent()&&!confirm(Yi($i.areYouSureYouWantToCloseUnsaved,{PH1:i.name()})))&&(i.resetWorkingCopy(),t&&this.tabbedPane.selectTab(t,!0),this.tabbedPane.closeTab(e,!0),!0)}closeTabs(e,t){const i=[],o=[];for(let n=0;n<e.length;++n){const r=e[n],s=this.files.get(r);s&&(!t&&s.isDirty()?i.push(r):o.push(r))}i.length&&this.tabbedPane.selectTab(i[0],!0),this.tabbedPane.closeTabs(o,!0);for(let e=0;e<i.length;++e){const t=e+1<i.length?i[e+1]:null;if(!this.maybeCloseTab(i[e],t))break}}onContextMenu(e,t){const i=this.files.get(e);i&&t.appendApplicableItems(i)}canonicalUISourceCode(e){const t=this.uriToUISourceCode.get(e.url());return t||(this.uriToUISourceCode.set(e.url(),e),e)}addUISourceCode(e){const t=this.canonicalUISourceCode(e),i=t!==e,o=l.Persistence.PersistenceImpl.instance().binding(t);if(e=o?o.fileSystem:t,i&&e.project().type()!==d.Workspace.projectTypes.FileSystem&&e.disableEdit(),this.currentFileInternal===e)return;const n=e.url(),r=this.history.index(n);if(-1===r)return;if(this.tabIds.has(e)||this.appendFileTab(e,!1),!r)return void this.innerShowFile(e,!1);if(!this.currentFileInternal)return;const s=S.ScriptSnippetFileSystem.isSnippetsUISourceCode(this.currentFileInternal),a=S.ScriptSnippetFileSystem.isSnippetsUISourceCode(e);this.history.index(this.currentFileInternal.url())&&s&&!a&&this.innerShowFile(e,!1)}removeUISourceCode(e){this.removeUISourceCodes([e])}removeUISourceCodes(e){const t=[];for(const i of e){const e=this.tabIds.get(i);e&&t.push(e),this.uriToUISourceCode.get(i.url())===i&&this.uriToUISourceCode.delete(i.url())}this.tabbedPane.closeTabs(t)}editorClosedByUserAction(e){this.history.remove(e.url()),this.updateHistory()}editorSelectedByUserAction(){this.updateHistory()}updateHistory(){const e=this.tabbedPane.lastOpenedTabIds(eo);this.history.update(e.map(function(e){const t=this.files.get(e);return t?t.url():""}.bind(this))),this.history.save(this.previouslyViewedFilesSetting)}tooltipForFile(e){return(e=l.Persistence.PersistenceImpl.instance().network(e)||e).url()}appendFileTab(e,t,i,o){const n=o||this.delegate.viewForFile(e),r=this.titleForFile(e),s=this.tooltipForFile(e),a=this.generateTabId();if(this.tabIds.set(e,a),this.files.set(a,e),!o){const t=this.history.selectionRange(e.url()),i=this.history.scrollLineNumber(e.url());this.restoreEditorProperties(n,t,i)}return this.tabbedPane.appendTab(a,r,n,s,t,void 0,void 0,i),this.updateFileTitle(e),this.addUISourceCodeListeners(e),e.loadError()?this.addLoadErrorIcon(a):e.contentLoaded()||e.requestContent().then((t=>{e.loadError()&&this.addLoadErrorIcon(a)})),a}addLoadErrorIcon(e){const i=t.Icon.Icon.create("smallicon-error");t.Tooltip.Tooltip.install(i,Yi($i.unableToLoadThisContent)),this.tabbedPane.tabView(e)&&this.tabbedPane.setTabIcon(e,i)}restoreEditorProperties(e,t,i){const o=e instanceof h.SourceFrame.SourceFrameImpl?e:null;o&&(t&&o.setSelection(t),"number"==typeof i&&o.scrollToLine(i))}tabClosed(e){const{tabId:t,isUserGesture:i}=e.data,o=this.files.get(t);this.currentFileInternal===o&&(this.removeViewListeners(),this.currentView=null,this.currentFileInternal=null),o&&this.tabIds.delete(o),this.files.delete(t),o&&(this.removeUISourceCodeListeners(o),this.dispatchEventToListeners(Qi.EditorClosed,o),i&&this.editorClosedByUserAction(o))}tabSelected(e){const{tabId:t,isUserGesture:i}=e.data,o=this.files.get(t);o&&this.innerShowFile(o,i)}addUISourceCodeListeners(e){e.addEventListener(d.UISourceCode.Events.TitleChanged,this.uiSourceCodeTitleChanged,this),e.addEventListener(d.UISourceCode.Events.WorkingCopyChanged,this.uiSourceCodeWorkingCopyChanged,this),e.addEventListener(d.UISourceCode.Events.WorkingCopyCommitted,this.uiSourceCodeWorkingCopyCommitted,this)}removeUISourceCodeListeners(e){e.removeEventListener(d.UISourceCode.Events.TitleChanged,this.uiSourceCodeTitleChanged,this),e.removeEventListener(d.UISourceCode.Events.WorkingCopyChanged,this.uiSourceCodeWorkingCopyChanged,this),e.removeEventListener(d.UISourceCode.Events.WorkingCopyCommitted,this.uiSourceCodeWorkingCopyCommitted,this)}updateFileTitle(e){const i=this.tabIds.get(e);if(i){const o=this.titleForFile(e),n=this.tooltipForFile(e);this.tabbedPane.changeTabTitle(i,o,n);let r=null;e.loadError()?(r=t.Icon.Icon.create("smallicon-error"),t.Tooltip.Tooltip.install(r,Yi($i.unableToLoadThisContent))):l.Persistence.PersistenceImpl.instance().hasUnsavedCommittedChanges(e)?(r=t.Icon.Icon.create("smallicon-warning"),t.Tooltip.Tooltip.install(r,Yi($i.changesToThisFileWereNotSavedTo))):r=l.PersistenceUtils.PersistenceUtils.iconForUISourceCode(e),this.tabbedPane.setTabIcon(i,r)}}uiSourceCodeTitleChanged(e){const t=e.data;this.updateFileTitle(t),this.updateHistory()}uiSourceCodeWorkingCopyChanged(e){const t=e.data;this.updateFileTitle(t)}uiSourceCodeWorkingCopyCommitted(e){const t=e.data.uiSourceCode;this.updateFileTitle(t)}generateTabId(){return"tab_"+Zi++}currentFile(){return this.currentFileInternal||null}}var Qi;!function(e){e.EditorSelected="EditorSelected",e.EditorClosed="EditorClosed"}(Qi||(Qi={}));let Zi=0;const eo=30;class to{url;isSerializable;selectionRange;scrollLineNumber;constructor(e,t,i){this.url=e,this.isSerializable=e.length<to.serializableUrlLengthLimit,this.selectionRange=t,this.scrollLineNumber=i}static fromObject(e){const t=e.selectionRange?m.TextRange.TextRange.fromObject(e.selectionRange):void 0;return new to(e.url,t,e.scrollLineNumber)}serializeToObject(){if(!this.isSerializable)return null;return{url:this.url,selectionRange:this.selectionRange,scrollLineNumber:this.scrollLineNumber}}static serializableUrlLengthLimit=4096}class io{items;itemsIndex;constructor(e){this.items=e,this.itemsIndex=new Map,this.rebuildItemIndex()}static fromObject(e){const t=[];for(let i=0;i<e.length;++i)"url"in e[i]&&e[i].url&&t.push(to.fromObject(e[i]));return new io(t)}index(e){const t=this.itemsIndex.get(e);return void 0!==t?t:-1}rebuildItemIndex(){this.itemsIndex=new Map;for(let e=0;e<this.items.length;++e)console.assert(!this.itemsIndex.has(this.items[e].url)),this.itemsIndex.set(this.items[e].url,e)}selectionRange(e){const t=this.index(e);return-1!==t?this.items[t].selectionRange:void 0}updateSelectionRange(e,t){if(!t)return;const i=this.index(e);-1!==i&&(this.items[i].selectionRange=t)}scrollLineNumber(e){const t=this.index(e);return-1!==t?this.items[t].scrollLineNumber:void 0}updateScrollLineNumber(e,t){const i=this.index(e);-1!==i&&(this.items[i].scrollLineNumber=t)}update(e){for(let t=e.length-1;t>=0;--t){const i=this.index(e[t]);let o;-1!==i?(o=this.items[i],this.items.splice(i,1)):o=new to(e[t]),this.items.unshift(o),this.rebuildItemIndex()}}remove(e){const t=this.index(e);-1!==t&&(this.items.splice(t,1),this.rebuildItemIndex())}save(e){e.set(this.serializeToObject())}serializeToObject(){const e=[];for(let t=0;t<this.items.length;++t){const i=this.items[t].serializeToObject();if(i&&e.push(i),e.length===eo)break}return e}urls(){const e=[];for(let t=0;t<this.items.length;++t)e.push(this.items[t].url);return e}}class oo{editorContainer;constructor(e){this.editorContainer=e}closeTabs(e,t){this.editorContainer.closeTabs(t)}onContextMenu(e,t){this.editorContainer.onContextMenu(e,t)}}var no=Object.freeze({__proto__:null,TabbedEditorContainer:Xi,get Events(){return Qi},get tabId(){return Zi},maximalPreviouslyViewedFilesCount:eo,HistoryItem:to,History:io,EditorContainerTabDelegate:oo});const ro={openFile:"Open file",runCommand:"Run command",dropInAFolderToAddToWorkspace:"Drop in a folder to add to workspace",sourceViewActions:"Source View Actions"},so=e.i18n.registerUIStrings("panels/sources/SourcesView.ts",ro),ao=e.i18n.getLocalizedString.bind(void 0,so);class co extends(n.ObjectWrapper.eventMixin(t.Widget.VBox)){placeholderOptionArray;selectedIndex;searchableViewInternal;sourceViewByUISourceCode;editorContainer;historyManager;toolbarContainerElementInternal;scriptViewToolbar;bottomToolbarInternal;toolbarChangedListener;shortcuts;focusedPlaceholderElement;searchView;searchConfig;constructor(){super(),this.element.id="sources-panel-sources-view",this.setMinimumAndPreferredSizes(250,52,250,100),this.placeholderOptionArray=[],this.selectedIndex=0;const e=d.Workspace.WorkspaceImpl.instance();if(this.searchableViewInternal=new t.SearchableView.SearchableView(this,this,"sourcesViewSearchConfig"),this.searchableViewInternal.setMinimalSearchQuerySize(0),this.searchableViewInternal.show(this.element),this.sourceViewByUISourceCode=new Map,this.editorContainer=new Xi(this,n.Settings.Settings.instance().createLocalSetting("previouslyViewedFiles",[]),this.placeholderElement(),this.focusedPlaceholderElement),this.editorContainer.show(this.searchableViewInternal.element),this.editorContainer.addEventListener(Qi.EditorSelected,this.editorSelected,this),this.editorContainer.addEventListener(Qi.EditorClosed,this.editorClosed,this),this.historyManager=new ye(this),this.toolbarContainerElementInternal=this.element.createChild("div","sources-toolbar"),!g.Runtime.experiments.isEnabled("sourcesPrettyPrint")){const e=new t.Toolbar.Toolbar("",this.toolbarContainerElementInternal);for(const t of po())e.appendToolbarItem(t.getOrCreateButton(this))}this.scriptViewToolbar=new t.Toolbar.Toolbar("",this.toolbarContainerElementInternal),this.scriptViewToolbar.element.style.flex="auto",this.bottomToolbarInternal=new t.Toolbar.Toolbar("",this.toolbarContainerElementInternal),this.toolbarChangedListener=null,t.UIUtils.startBatchUpdate(),e.uiSourceCodes().forEach(this.addUISourceCode.bind(this)),t.UIUtils.endBatchUpdate(),e.addEventListener(d.Workspace.Events.UISourceCodeAdded,this.uiSourceCodeAdded,this),e.addEventListener(d.Workspace.Events.UISourceCodeRemoved,this.uiSourceCodeRemoved,this),e.addEventListener(d.Workspace.Events.ProjectRemoved,this.projectRemoved.bind(this),this),window.opener||window.addEventListener("beforeunload",(function(e){if(e.returnValue)return;const i=[],o=d.Workspace.WorkspaceImpl.instance().projectsForType(d.Workspace.projectTypes.FileSystem);for(const e of o)i.push(...e.uiSourceCodes().filter((e=>e.isDirty())));if(i.length){e.returnValue=!0,t.ViewManager.ViewManager.instance().showView("sources");for(const e of i)n.Revealer.reveal(e)}}),!0),this.shortcuts=new Map,this.element.addEventListener("keydown",this.handleKeyDown.bind(this),!1)}placeholderElement(){this.placeholderOptionArray=[];const e=[{actionId:"quickOpen.show",description:ao(ro.openFile)},{actionId:"commandMenu.show",description:ao(ro.runCommand)},{actionId:"sources.add-folder-to-workspace",description:ao(ro.dropInAFolderToAddToWorkspace)}],i=document.createElement("div"),o=i.createChild("div","tabbed-pane-placeholder");o.addEventListener("keydown",this.placeholderOnKeyDown.bind(this),!1),t.ARIAUtils.markAsList(o),t.ARIAUtils.setAccessibleName(o,ao(ro.sourceViewActions));for(let i=0;i<e.length;i++){const n=e[i],r=t.ShortcutRegistry.ShortcutRegistry.instance().shortcutTitleForAction(n.actionId),s=o.createChild("div");t.ARIAUtils.markAsListitem(s);const a=s.createChild("div","tabbed-pane-placeholder-row");a.tabIndex=-1,t.ARIAUtils.markAsButton(a),r?(a.createChild("div","tabbed-pane-placeholder-key").textContent=r,a.createChild("div","tabbed-pane-placeholder-value").textContent=n.description):a.createChild("div","tabbed-pane-no-shortcut").textContent=n.description;const c=t.ActionRegistry.ActionRegistry.instance().action(n.actionId);c&&this.placeholderOptionArray.push({element:a,handler(){c.execute()}})}return i.appendChild(t.XLink.XLink.create("https://developer.chrome.com/docs/devtools/workspaces/","Learn more about Workspaces")),i}placeholderOnKeyDown(e){const i=e;if(isEnterOrSpaceKey(i))return void this.placeholderOptionArray[this.selectedIndex].handler();let o=0;"ArrowDown"===i.key?o=1:"ArrowUp"===i.key&&(o=-1);const n=Math.max(Math.min(this.placeholderOptionArray.length-1,this.selectedIndex+o),0),r=this.placeholderOptionArray[n].element,s=this.placeholderOptionArray[this.selectedIndex].element;r!==s&&(s.tabIndex=-1,r.tabIndex=0,t.ARIAUtils.setSelected(s,!1),t.ARIAUtils.setSelected(r,!0),this.selectedIndex=n,r.focus())}static defaultUISourceCodeScores(){const e=new Map,i=t.Context.Context.instance().flavor(co);if(i){const t=i.editorContainer.historyUISourceCodes();for(let i=1;i<t.length;++i)e.set(t[i],t.length-i)}return e}leftToolbar(){return this.editorContainer.leftToolbar()}rightToolbar(){return this.editorContainer.rightToolbar()}bottomToolbar(){return this.bottomToolbarInternal}registerShortcuts(e,t){for(let i=0;i<e.length;++i)this.shortcuts.set(e[i].key,t)}handleKeyDown(e){const i=t.KeyboardShortcut.KeyboardShortcut.makeKeyFromEvent(e),o=this.shortcuts.get(i);o&&o()&&e.consume(!0)}wasShown(){super.wasShown(),this.registerCSSFiles([Le]),t.Context.Context.instance().setFlavor(co,this)}willHide(){t.Context.Context.instance().setFlavor(co,null),super.willHide()}toolbarContainerElement(){return this.toolbarContainerElementInternal}searchableView(){return this.searchableViewInternal}visibleView(){return this.editorContainer.visibleView}currentSourceFrame(){const e=this.visibleView();return e instanceof Bi?e:null}currentUISourceCode(){return this.editorContainer.currentFile()}onCloseEditorTab(){const e=this.editorContainer.currentFile();return!!e&&(this.editorContainer.closeFile(e),!0)}onJumpToPreviousLocation(){this.historyManager.rollback()}onJumpToNextLocation(){this.historyManager.rollover()}uiSourceCodeAdded(e){const t=e.data;this.addUISourceCode(t)}addUISourceCode(e){e.project().isServiceProject()||e.project().type()===d.Workspace.projectTypes.FileSystem&&"overrides"===l.FileSystemWorkspaceBinding.FileSystemWorkspaceBinding.fileSystemType(e.project())||this.editorContainer.addUISourceCode(e)}uiSourceCodeRemoved(e){const t=e.data;this.removeUISourceCodes([t])}removeUISourceCodes(e){this.editorContainer.removeUISourceCodes(e);for(let t=0;t<e.length;++t)this.removeSourceFrame(e[t]),this.historyManager.removeHistoryForSourceCode(e[t])}projectRemoved(e){const t=e.data.uiSourceCodes();this.removeUISourceCodes(t)}updateScriptViewToolbarItems(){const e=this.visibleView();e instanceof t.View.SimpleView&&e.toolbarItems().then((e=>{this.scriptViewToolbar.removeToolbarItems(),e.map((e=>this.scriptViewToolbar.appendToolbarItem(e)))}))}showSourceLocation(e,t,i,o){const n=this.currentSourceFrame();n&&this.historyManager.updateCurrentState(n.uiSourceCode(),n.textEditor.state.selection.main.head),this.editorContainer.showFile(e);const r=this.currentSourceFrame();r&&t&&r.revealPosition(t,!o);const s=this.visibleView();!i&&s&&s.focus()}createSourceView(e){let t,i;const o=e.contentType();o===n.ResourceType.resourceTypes.Image?i=new h.ImageView.ImageView(e.mimeType(),e):o===n.ResourceType.resourceTypes.Font?i=new h.FontView.FontView(e.mimeType(),e):t=new Bi(e),t&&this.historyManager.trackSourceFrameCursorJumps(t);const r=t||i;return this.sourceViewByUISourceCode.set(e,r),r}getOrCreateSourceView(e){return this.sourceViewByUISourceCode.get(e)||this.createSourceView(e)}recycleUISourceCodeFrame(e,t){this.sourceViewByUISourceCode.delete(e.uiSourceCode()),e.setUISourceCode(t),this.sourceViewByUISourceCode.set(t,e)}viewForFile(e){return this.getOrCreateSourceView(e)}removeSourceFrame(e){const t=this.sourceViewByUISourceCode.get(e);this.sourceViewByUISourceCode.delete(e),t&&t instanceof Bi&&t.dispose()}editorClosed(e){const t=e.data;this.historyManager.removeHistoryForSourceCode(t);let i=!1;this.editorContainer.currentFile()||(i=!0),this.removeToolbarChangedListener(),this.updateScriptViewToolbarItems(),this.searchableViewInternal.resetSearch();const o={uiSourceCode:t,wasSelected:i};this.dispatchEventToListeners(lo.EditorClosed,o)}editorSelected(e){const t=e.data.previousView instanceof Bi?e.data.previousView:null;t&&t.setSearchableView(null);const i=e.data.currentView instanceof Bi?e.data.currentView:null;i&&i.setSearchableView(this.searchableViewInternal),this.searchableViewInternal.setReplaceable(Boolean(i?.canEditSource())),this.searchableViewInternal.refreshSearch(),this.updateToolbarChangedListener(),this.updateScriptViewToolbarItems();const o=this.editorContainer.currentFile();o&&this.dispatchEventToListeners(lo.EditorSelected,o)}removeToolbarChangedListener(){this.toolbarChangedListener&&n.EventTarget.removeEventListeners([this.toolbarChangedListener]),this.toolbarChangedListener=null}updateToolbarChangedListener(){this.removeToolbarChangedListener();const e=this.currentSourceFrame();e&&(this.toolbarChangedListener=e.addEventListener(Di.ToolbarItemsChanged,this.updateScriptViewToolbarItems,this))}searchCanceled(){this.searchView&&this.searchView.searchCanceled(),delete this.searchView,delete this.searchConfig}performSearch(e,t,i){const o=this.currentSourceFrame();o&&(this.searchView=o,this.searchConfig=e,this.searchView.performSearch(this.searchConfig,t,i))}jumpToNextSearchResult(){this.searchView&&(this.searchConfig&&this.searchView!==this.currentSourceFrame()?this.performSearch(this.searchConfig,!0):this.searchView.jumpToNextSearchResult())}jumpToPreviousSearchResult(){if(this.searchView)return this.searchConfig&&this.searchView!==this.currentSourceFrame()?(this.performSearch(this.searchConfig,!0),void(this.searchView&&this.searchView.jumpToLastSearchResult())):void this.searchView.jumpToPreviousSearchResult()}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}replaceSelectionWith(e,t){const i=this.currentSourceFrame();i?i.replaceSelectionWith(e,t):console.assert(Boolean(i))}replaceAllWith(e,t){const i=this.currentSourceFrame();i?i.replaceAllWith(e,t):console.assert(Boolean(i))}showOutlineQuickOpen(){f.QuickOpen.QuickOpenImpl.show("@")}showGoToLineQuickOpen(){this.editorContainer.currentFile()&&f.QuickOpen.QuickOpenImpl.show(":")}save(){this.saveSourceFrame(this.currentSourceFrame())}saveAll(){this.editorContainer.fileViews().forEach(this.saveSourceFrame.bind(this))}saveSourceFrame(e){if(!(e instanceof Bi))return;e.commitEditing()}toggleBreakpointsActiveState(e){this.editorContainer.view.element.classList.toggle("breakpoints-deactivated",!e)}}var lo;!function(e){e.EditorClosed="EditorClosed",e.EditorSelected="EditorSelected"}(lo||(lo={}));const uo=[];function ho(e){uo.push(e)}function po(){return uo.map((e=>e()))}let go,mo;class bo{static instance(e={forceNew:null}){const{forceNew:t}=e;return go&&!t||(go=new bo),go}static nextFile(e){function t(e){const t=e.lastIndexOf(".");return e.substr(0,-1!==t?t:e.length).toLowerCase()}const i=e.project().uiSourceCodes(),o=[],n=e.parentURL(),r=e.name(),a=t(r);for(let e=0;e<i.length;++e){const r=i[e];n===r.parentURL()&&(t(r.name())===a&&o.push(r.name()))}o.sort(s.StringUtilities.naturalOrderComparator);const c=s.NumberUtilities.mod(o.indexOf(r)+1,o.length),l=(n?n+"/":"")+o[c],d=e.project().uiSourceCodeForURL(l);return d!==e?d:null}handleAction(e,i){const o=t.Context.Context.instance().flavor(co);if(!o)return!1;const n=o.currentUISourceCode();if(!n)return!1;const r=bo.nextFile(n);return!!r&&(o.showSourceLocation(r),!0)}}class fo{static instance(e={forceNew:null}){const{forceNew:t}=e;return mo&&!t||(mo=new fo),mo}handleAction(e,i){const o=t.Context.Context.instance().flavor(co);if(!o)return!1;switch(i){case"sources.close-all":return o.editorContainer.closeAllFiles(),!0;case"sources.jump-to-previous-location":return o.onJumpToPreviousLocation(),!0;case"sources.jump-to-next-location":return o.onJumpToNextLocation(),!0;case"sources.close-editor-tab":return o.onCloseEditorTab();case"sources.go-to-line":return o.showGoToLineQuickOpen(),!0;case"sources.go-to-member":return o.showOutlineQuickOpen(),!0;case"sources.save":return o.save(),!0;case"sources.save-all":return o.saveAll(),!0}return!1}}var vo=Object.freeze({__proto__:null,SourcesView:co,get Events(){return lo},registerEditorAction:ho,getRegisteredEditorActions:po,SwitchFileActionDelegate:bo,ActionDelegate:fo});const So={prettyPrintS:"Pretty print {PH1}",prettyPrint:"Pretty print"},Co=e.i18n.registerUIStrings("panels/sources/ScriptFormatterEditorAction.ts",So),wo=e.i18n.getLocalizedString.bind(void 0,Co);let Io;class ko{pathsToFormatOnLoad;sourcesView;button;constructor(){this.pathsToFormatOnLoad=new Set}static instance(e={forceNew:null}){const{forceNew:t}=e;return Io&&!t||(Io=new ko),Io}editorSelected(e){const t=e.data;this.updateButton(t),this.isFormattableScript(t)&&this.pathsToFormatOnLoad.has(t.url())&&!u.SourceFormatter.SourceFormatter.instance().hasFormatted(t)&&this.showFormatted(t)}async editorClosed(e){const{uiSourceCode:t,wasSelected:i}=e.data;i&&this.updateButton(null);const o=await u.SourceFormatter.SourceFormatter.instance().discardFormattedUISourceCode(t);o&&this.pathsToFormatOnLoad.delete(o.url())}updateButton(e){const t=this.isFormattableScript(e);this.button.element.classList.toggle("hidden",!t),e&&this.button.setTitle(wo(So.prettyPrintS,{PH1:e.name()}))}getOrCreateButton(e){return this.button||(this.sourcesView=e,this.sourcesView.addEventListener(lo.EditorSelected,(e=>{this.editorSelected(e)})),this.sourcesView.addEventListener(lo.EditorClosed,(e=>{this.editorClosed(e)})),this.button=new t.Toolbar.ToolbarButton(wo(So.prettyPrint),"largeicon-pretty-print"),this.button.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.onFormatScriptButtonClicked,this),this.updateButton(e.currentUISourceCode())),this.button}isFormattableScript(e){return!!e&&(!e.project().canSetFileContent()&&(e.project().type()!==d.Workspace.projectTypes.Formatter&&(!l.Persistence.PersistenceImpl.instance().binding(e)&&("application/wasm"!==e.mimeType()&&e.contentType().hasScripts()))))}isCurrentUISourceCodeFormattable(){const e=this.sourcesView.currentUISourceCode();return this.isFormattableScript(e)}onFormatScriptButtonClicked(){this.toggleFormatScriptSource()}toggleFormatScriptSource(){const e=this.sourcesView.currentUISourceCode();e&&this.isFormattableScript(e)&&(this.pathsToFormatOnLoad.add(e.url()),this.showFormatted(e))}async showFormatted(e){const t=await u.SourceFormatter.SourceFormatter.instance().format(e);if(e!==this.sourcesView.currentUISourceCode())return;const i=this.sourcesView.viewForFile(e);let o=[0,0];if(i instanceof h.SourceFrame.SourceFrameImpl){const e=i.textEditor.toLineColumn(i.textEditor.state.selection.main.head);o=t.mapping.originalToFormatted(e.lineNumber,e.columnNumber)}this.sourcesView.showSourceLocation(t.formattedSourceCode,{lineNumber:o[0],columnNumber:o[1]})}}ho(ko.instance);var xo=Object.freeze({__proto__:null,ScriptFormatterEditorAction:ko});const yo=new WeakMap,Eo=new WeakMap;class To{name;lineNumber;columnNumber;constructor(e,t,i){this.name=e,this.lineNumber=t,this.columnNumber=i}}const Lo=async function(e){if("global"===e.type())return[];const t=e.startLocation(),i=e.endLocation();if(!t||!i)return[];const o=t.script();if(!o||!o.sourceMapURL||o!==i.script())return[];const{content:n}=await o.requestContent();if(!n)return[];const r=new m.Text.Text(n),s=new m.TextRange.TextRange(t.lineNumber,t.columnNumber,i.lineNumber,i.columnNumber),a=r.extract(s),c=r.toSourceRange(s).offset,l="function fui",d=await u.FormatterWorkerPool.formatterWorkerPool().javaScriptIdentifiers(l+a),h=[],p=new m.TextCursor.TextCursor(r.lineEndings());for(const e of d){if(e.offset<l.length)continue;const t=c+e.offset-l.length;p.resetTo(t),h.push(new To(e.name,p.lineNumber(),p.columnNumber()))}return h},Mo=async function(e){if(!e)return null;const{pluginManager:t}=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance();if(t){const i=await t.resolveScopeChain(e);if(i)return i}return e.scopeChain()},Fo=async e=>{let t=yo.get(e);return t||(t=(async()=>{const t=new Map,o=e.callFrame().script,n=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().sourceMapForScript(o);if(n){const r=new Map,s=[];for(const a of await Lo(e)){const e=n.findEntry(a.lineNumber,a.columnNumber);e&&e.name?t.set(a.name,e.name):s.push(i(o,n,a,r).then((e=>{e&&t.set(a.name,e)})))}await Promise.all(s).then(Vo())}return t})(),yo.set(e,t)),await t;async function i(e,t,i,o){const n=t.findEntry(i.lineNumber,i.columnNumber),r=t.findEntry(i.lineNumber,i.columnNumber+i.name.length);if(!(n&&r&&n.sourceURL&&n.sourceURL===r.sourceURL&&n.sourceLineNumber&&n.sourceColumnNumber&&r.sourceLineNumber&&r.sourceColumnNumber))return null;const s=new m.TextRange.TextRange(n.sourceLineNumber,n.sourceColumnNumber,r.sourceLineNumber,r.sourceColumnNumber),a=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiSourceCodeForSourceMapSourceURL(e.debuggerModel,n.sourceURL,e.isContentScript());if(!a)return null;const{content:l}=await a.requestContent();if(!l)return null;let d=o.get(l);d||(d=new m.Text.Text(l),o.set(l,d));const u=d.extract(s).trim();return/[a-zA-Z0-9_$]+/.test(u)?u:null}},Po=async e=>{const t=Eo.get(e);if(t)return t;const i=e.scopeChain(),o=await Promise.all(i.map(Fo)),n=new Map;for(const e of o)for(const[t,i]of e)i&&!n.has(i)&&n.set(i,t);return Eo.set(e,n),n},Do=async(e,t,i,o,n,r)=>{if("application/wasm"===i.mimeType())return`memories["${t}"] ?? locals["${t}"] ?? tables["${t}"] ?? functions["${t}"] ?? globals["${t}"]`;if(!i.contentType().isFromSourceMap())return"";const s=await Po(e);if(s.has(t))return s.get(t);const a=(await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(i,o,n)).find((t=>t.debuggerModel===e.debuggerModel));if(!a)return"";const l=a.script();if(!l)return"";const d=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().sourceMapForScript(l);if(!d)return"";const{content:h}=await l.requestContent();if(!h)return"";const p=new m.Text.Text(h),g=d.reverseMapTextRange(i.url(),new m.TextRange.TextRange(o,n,o,r));if(!g)return"";const b=p.extract(g);return b?await u.FormatterWorkerPool.formatterWorkerPool().evaluatableJavaScriptSubstring(b):""},Ao=async e=>{if(!e)return null;const t=e.scopeChain();if(0===t.length)return e.thisObject();const i=await Fo(t[0]),o=s.MapUtilities.inverse(i).get("this");if(!o||1!==o.size)return e.thisObject();const[n]=o.values(),r=await e.evaluate({expression:n,objectGroup:"backtrace",includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!0});return"exceptionDetails"in r?!r.exceptionDetails&&r.object?r.object:e.thisObject():null},Bo=function(e){const t=e.startLocation(),i=e.endLocation(),o=t?t.script():null;return"global"!==e.type()&&o&&i&&o.sourceMapURL&&o===i.script()?new No(e):e.object()};class No extends a.RemoteObject.RemoteObject{scope;object;constructor(e){super(),this.scope=e,this.object=e.object()}customPreview(){return this.object.customPreview()}get objectId(){return this.object.objectId}get type(){return this.object.type}get subtype(){return this.object.subtype}get value(){return this.object.value}get description(){return this.object.description}get hasChildren(){return this.object.hasChildren}get preview(){return this.object.preview}arrayLength(){return this.object.arrayLength()}getOwnProperties(e){return this.object.getOwnProperties(e)}async getAllProperties(e,t){const i=await this.object.getAllProperties(e,t),o=await Fo(this.scope),n=i.properties,r=i.internalProperties,s=[];if(n)for(let e=0;e<n.length;++e){const t=n[e],i=o.get(t.name)||n[e].name;t.value&&s.push(new a.RemoteObject.RemoteObjectProperty(i,t.value,t.enumerable,t.writable,t.isOwn,t.wasThrown,t.symbol,t.synthetic))}return{properties:s,internalProperties:r}}async setPropertyValue(e,t){const i=await Fo(this.scope);let o;o="string"==typeof e?e:e.value;let n=o;for(const e of i.keys())if(i.get(e)===o){n=e;break}return this.object.setPropertyValue(n,t)}async deleteProperty(e){return this.object.deleteProperty(e)}callFunction(e,t){return this.object.callFunction(e,t)}callFunctionJSON(e,t){return this.object.callFunctionJSON(e,t)}release(){this.object.release()}debuggerModel(){return this.object.debuggerModel()}runtimeModel(){return this.object.runtimeModel()}isNode(){return this.object.isNode()}}let Uo=function(){};const Vo=()=>Uo;var jo=Object.freeze({__proto__:null,Identifier:To,scopeIdentifiers:Lo,resolveScopeChain:Mo,resolveScope:Fo,allVariablesInCallFrame:Po,resolveExpression:Do,resolveThisObject:Ao,resolveScopeInObject:Bo,RemoteObject:No,getScopeResolvedForTest:Vo,setScopeResolvedForTest:e=>{Uo=e}});const Wo={thisScriptIsOnTheDebuggersIgnore:"This script is on the debugger's ignore list",removeFromIgnoreList:"Remove from ignore list",configure:"Configure",sourceMapFoundButIgnoredForFile:"Source map found, but ignored for file on ignore list.",addBreakpoint:"Add breakpoint",addConditionalBreakpoint:"Add conditional breakpointâ€¦",addLogpoint:"Add logpointâ€¦",neverPauseHere:"Never pause here",removeBreakpoint:"{n, plural, =1 {Remove breakpoint} other {Remove all breakpoints in line}}",editBreakpoint:"Edit breakpointâ€¦",disableBreakpoint:"{n, plural, =1 {Disable breakpoint} other {Disable all breakpoints in line}}",enableBreakpoint:"{n, plural, =1 {Enable breakpoint} other {Enable all breakpoints in line}}",addSourceMap:"Add source mapâ€¦",sourceMapDetected:"Source map detected.",prettyprintThisMinifiedFile:"Pretty-print this minified file?",prettyprint:"Pretty-print",prettyprintingWillFormatThisFile:"Pretty-printing will format this file in a new tab where you can continue debugging. You can also pretty-print this file by clicking the {PH1} button on the bottom status bar.",associatedFilesAreAvailable:"Associated files are available via file tree or {PH1}.",associatedFilesShouldBeAdded:"Associated files should be added to the file tree. You can debug these resolved source files as regular JavaScript files.",theDebuggerWillSkipStepping:"The debugger will skip stepping through this script, and will not stop on exceptions."},Oo=e.i18n.registerUIStrings("panels/sources/DebuggerPlugin.ts",Wo),Ro=e.i18n.getLocalizedString.bind(void 0,Oo);class Ho extends oe{transformer;editor=void 0;executionLocation=null;controlDown=!1;sourceMapInfobar=null;controlTimeout=void 0;scriptsPanel;breakpointManager;popoverHelper;scriptFileForDebuggerModel;breakpoints=[];continueToLocations=null;liveLocationPool;muted;initializedMuted;ignoreListInfobar;prettyPrintInfobar;scheduledBreakpointDecorationUpdates;refreshBreakpointsTimeout=void 0;constructor(e,i){super(e),this.transformer=i,this.scriptsPanel=mi.instance(),this.breakpointManager=c.BreakpointManager.BreakpointManager.instance(),this.popoverHelper=new t.PopoverHelper.PopoverHelper(this.scriptsPanel.element,this.getPopoverRequest.bind(this)),this.popoverHelper.setDisableOnClick(!0),this.popoverHelper.setTimeout(250,250),this.popoverHelper.setHasPadding(!0),this.breakpointManager.addEventListener(c.BreakpointManager.Events.BreakpointAdded,this.breakpointChange,this),this.breakpointManager.addEventListener(c.BreakpointManager.Events.BreakpointRemoved,this.breakpointChange,this),this.uiSourceCode.addEventListener(d.UISourceCode.Events.WorkingCopyChanged,this.workingCopyChanged,this),this.uiSourceCode.addEventListener(d.UISourceCode.Events.WorkingCopyCommitted,this.workingCopyCommitted,this),this.scriptFileForDebuggerModel=new Map,n.Settings.Settings.instance().moduleSetting("skipStackFramesPattern").addChangeListener(this.showIgnoreListInfobarIfNeeded,this),n.Settings.Settings.instance().moduleSetting("skipContentScripts").addChangeListener(this.showIgnoreListInfobarIfNeeded,this),t.Context.Context.instance().addFlavorChangeListener(a.DebuggerModel.CallFrame,this.callFrameChanged,this),this.liveLocationPool=new c.LiveLocation.LiveLocationPool,this.updateScriptFiles(),this.muted=this.uiSourceCode.isDirty(),this.initializedMuted=this.muted,this.ignoreListInfobar=null,this.showIgnoreListInfobarIfNeeded();for(const e of this.scriptFileForDebuggerModel.values())e.checkMapping();g.Runtime.experiments.isEnabled("sourcesPrettyPrint")||(this.prettyPrintInfobar=null,this.detectMinified())}editorExtension(){const e=this.shortcutHandlers();return[i.EditorView.updateListener.of((e=>this.onEditorUpdate(e))),i.EditorView.domEventHandlers({keydown:t=>!!this.onKeyDown(t)||(e(t),t.defaultPrevented),keyup:e=>this.onKeyUp(e),mousemove:e=>this.onMouseMove(e),mousedown:e=>this.onMouseDown(e),focusout:e=>this.onBlur(e),wheel:e=>this.onWheel(e)}),i.lineNumbers({domEventHandlers:{mousedown:(e,t,i)=>this.handleGutterClick(e.state.doc.lineAt(t.from),i)}}),qo,Jo,i.Prec.highest(on.field),i.Prec.lowest(sn.field),ln,un.field,i.Prec.lowest(pn.field),gn,this.uiSourceCode.project().type()===d.Workspace.projectTypes.Debugger?i.EditorView.editorAttributes.of({class:"source-frame-debugger-script"}):[]]}shortcutHandlers(){const e=e=>e.state.doc.lineAt(e.state.selection.main.head);return t.ShortcutRegistry.ShortcutRegistry.instance().getShortcutListener({"debugger.toggle-breakpoint":async()=>!(this.muted||!this.editor)&&(await this.toggleBreakpoint(e(this.editor),!1),!0),"debugger.toggle-breakpoint-enabled":async()=>!(this.muted||!this.editor)&&(await this.toggleBreakpoint(e(this.editor),!0),!0),"debugger.breakpoint-input-window":async()=>{if(this.muted||!this.editor)return!1;const t=e(this.editor),i=this.breakpoints.find((e=>e.position>=t.from&&e.position<=t.to))?.breakpoint||null,o=!!i&&i.condition().includes(O);return this.editBreakpointCondition(t,i,null,o),!0}})}editorInitialized(e){this.editor=e,async function(e,t){const i=[];if(c.CompilerScriptMapping.CompilerScriptMapping.uiSourceCodeOrigin(t).length)for(let o=0;o<e.doc.lines;o++){c.CompilerScriptMapping.CompilerScriptMapping.uiLineHasMapping(t,o)||i.push(e.doc.line(o+1).from)}else{const{pluginManager:o}=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance();if(!o)return[];const n=await o.getMappedLines(t);if(!n)return[];for(let t=0;t<e.doc.lines;t++)n.has(t)||i.push(e.doc.line(t+1).from)}return i}(e.state,this.uiSourceCode).then((t=>{t.length&&e.dispatch({effects:h.SourceFrame.addNonBreakableLines.of(t)})}),console.error),this.muted||this.refreshBreakpoints(),this.callFrameChanged()}static accepts(e){return e.contentType().hasScripts()}showIgnoreListInfobarIfNeeded(){const e=this.uiSourceCode;if(!e.contentType().hasScripts())return;const i=e.project().type();if(!c.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(e))return void this.hideIgnoreListInfobar();this.ignoreListInfobar&&this.ignoreListInfobar.dispose();const o=new t.Infobar.Infobar(t.Infobar.Type.Warning,Ro(Wo.thisScriptIsOnTheDebuggersIgnore),[{text:Ro(Wo.removeFromIgnoreList),highlight:!1,delegate:function(){c.IgnoreListManager.IgnoreListManager.instance().unIgnoreListUISourceCode(e),i===d.Workspace.projectTypes.ContentScripts&&c.IgnoreListManager.IgnoreListManager.instance().unIgnoreListContentScripts()},dismiss:!0},{text:Ro(Wo.configure),highlight:!1,delegate:t.ViewManager.ViewManager.instance().showView.bind(t.ViewManager.ViewManager.instance(),"blackbox"),dismiss:!1}]);this.ignoreListInfobar=o,o.setCloseCallback((()=>this.removeInfobar(this.ignoreListInfobar))),o.createDetailsRowMessage(Ro(Wo.theDebuggerWillSkipStepping));const n=this.scriptFileForDebuggerModel.size?this.scriptFileForDebuggerModel.values().next().value:null;n&&n.hasSourceMapURL()&&o.createDetailsRowMessage(Ro(Wo.sourceMapFoundButIgnoredForFile)),this.attachInfobar(this.ignoreListInfobar)}attachInfobar(e){this.editor&&this.editor.dispatch({effects:_o.of(e)})}removeInfobar(e){this.editor&&e&&this.editor.dispatch({effects:zo.of(e)})}hideIgnoreListInfobar(){this.ignoreListInfobar&&(this.ignoreListInfobar.dispose(),this.ignoreListInfobar=null)}willHide(){this.popoverHelper.hidePopover()}populateLineGutterContextMenu(e,t){const i=new d.UISourceCode.UILocation(this.uiSourceCode,t,0);if(this.scriptsPanel.appendUILocationItems(e,i),this.muted||!this.editor)return;const o=this.editor.state.doc.line(t+1),n=this.lineBreakpoints(o),r=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().supportsConditionalBreakpoints(this.uiSourceCode);if(n.length){const t=Ro(Wo.removeBreakpoint,{n:n.length});e.debugSection().appendItem(t,(()=>n.forEach((e=>e.remove(!1))))),1===n.length&&r&&e.debugSection().appendItem(Ro(Wo.editBreakpoint),this.editBreakpointCondition.bind(this,o,n[0],null,!1));if(n.some((e=>e.enabled()))){const t=Ro(Wo.disableBreakpoint,{n:n.length});e.debugSection().appendItem(t,(()=>n.forEach((e=>e.setEnabled(!1)))))}if(n.some((e=>!e.enabled()))){const t=Ro(Wo.enableBreakpoint,{n:n.length});e.debugSection().appendItem(t,(()=>n.forEach((e=>e.setEnabled(!0)))))}}else this.editor&&h.SourceFrame.isBreakableLine(this.editor.state,o)&&(e.debugSection().appendItem(Ro(Wo.addBreakpoint),this.createNewBreakpoint.bind(this,o,"",!0)),r&&(e.debugSection().appendItem(Ro(Wo.addConditionalBreakpoint),this.editBreakpointCondition.bind(this,o,null,null,!1)),e.debugSection().appendItem(Ro(Wo.addLogpoint),this.editBreakpointCondition.bind(this,o,null,null,!0)),e.debugSection().appendItem(Ro(Wo.neverPauseHere),this.createNewBreakpoint.bind(this,o,"false",!0))))}populateTextAreaContextMenu(e){function t(e,t){t&&e.addSourceMapURL(t)}if(this.uiSourceCode.project().type()===d.Workspace.projectTypes.Network&&n.Settings.Settings.instance().moduleSetting("jsSourceMapsEnabled").get()&&!c.IgnoreListManager.IgnoreListManager.instance().isIgnoreListedUISourceCode(this.uiSourceCode)&&this.scriptFileForDebuggerModel.size){const i=this.scriptFileForDebuggerModel.values().next().value,o=Ro(Wo.addSourceMap);e.debugSection().appendItem(o,function(e){new A(t.bind(null,e)).show()}.bind(null,i))}}workingCopyChanged(){this.scriptFileForDebuggerModel.size||this.setMuted(this.uiSourceCode.isDirty())}workingCopyCommitted(){this.scriptsPanel.updateLastModificationTime(),this.scriptFileForDebuggerModel.size||this.setMuted(!1)}didMergeToVM(){this.consistentScripts()&&this.setMuted(!1)}didDivergeFromVM(){this.setMuted(!0)}setMuted(e){this.initializedMuted||e!==this.muted&&(this.muted=e,e?this.editor&&this.editor.dispatch({effects:Ko.of(null)}):this.restoreBreakpointsAfterEditing())}consistentScripts(){for(const e of this.scriptFileForDebuggerModel.values())if(e.hasDivergedFromVM()||e.isMergingToVM())return!1;return!0}isIdentifier(e){return"VariableName"===e||"VariableDefinition"===e||"PropertyName"===e||"PropertyDefinition"===e}getPopoverRequest(e){if(t.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e))return null;const o=t.Context.Context.instance().flavor(a.Target.Target),n=o?o.model(a.DebuggerModel.DebuggerModel):null,{editor:r}=this;if(!n||!n.isPaused()||!r)return null;const s=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);if(!s)return null;let c=r.editor.posAtCoords(e);if(!c)return null;const l=r.editor.coordsAtPos(c);if(!l||e.clientY<l.top||e.clientY>l.bottom||e.clientX<l.left-30||e.clientX>l.right+30)return null;e.clientX<l.left&&c>r.state.doc.lineAt(c).from&&(c-=1);const d=r.state.selection.main;let u;if(d.empty)if("application/wasm"===this.uiSourceCode.mimeType()){const e=i.syntaxTree(r.state).resolveInner(c,1);if("Identifier"!==e.name)return null;const t=["block","loop","if","else","end","br","br_if","br_table"];for(let i=e.parent;i;i=i.parent)if("App"===i.name){const e=i.firstChild,o="Keyword"===e?.name&&r.state.sliceDoc(e.from,e.to);if(o&&t.includes(o))return null}u=e}else if(/^text\/(javascript|typescript|jsx)/.test(this.uiSourceCode.mimeType())){let e=i.syntaxTree(r.state).resolveInner(c,1);if(e.firstChild)return null;for(;e&&"VariableDefinition"!==e.name&&"VariableName"!==e.name&&"MemberExpression"!==e.name&&("PropertyName"!==e.name||"PatternProperty"!==e.parent?.name||":"===e.nextSibling?.name)&&("PropertyDefinition"!==e.name||"Property"!==e.parent?.name||":"===e.nextSibling?.name);)e=e.parent;if(!e)return null;u=e}else{const e=i.syntaxTree(r.state).resolveInner(c,1);if(e.to-e.from>50||/[^\w_\-$]/.test(r.state.sliceDoc(e.from,e.to)))return null;u=e}else{if(c<d.from||c>d.to)return null;u=d}const h=r.state.doc.lineAt(u.from);if(u.to>h.to)return null;const p=r.editor.coordsAtPos(u.from),g=r.editor.coordsAtPos(u.to);if(!p||!g)return null;const m=new AnchorBox(p.left,p.top-2,g.right-p.left,g.bottom-p.top),f=r.state.sliceDoc(u.from,u.to);let v=null;return{box:m,show:async e=>{const o=await async function(e,t){const i=await Do(s,t,e,h.number-1,u.from-h.from,u.to-h.from);return await s.evaluate({expression:i||t,objectGroup:"popover",includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:void 0,timeout:void 0,disableBreaks:void 0,replMode:void 0,allowUnsafeEvalBlockedByCSP:void 0})}(this.uiSourceCode,f);if(!o||"error"in o||!o.object||"object"===o.object.type&&"error"===o.object.subtype)return!1;v=await b.ObjectPopoverHelper.ObjectPopoverHelper.buildObjectPopover(o.object,e);const c=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);if(!v||s!==c)return n.runtimeModel().releaseObjectGroup("popover"),v&&v.dispose(),!1;const l=i.Decoration.set(hn.range(u.from,u.to));return r.dispatch({effects:pn.update.of(l)}),!0},hide:()=>{v&&v.dispose(),n.runtimeModel().releaseObjectGroup("popover"),r.dispatch({effects:pn.update.of(i.Decoration.none)})}}}onEditorUpdate(e){if(!e.changes.empty)for(const t of this.breakpoints)t.position=e.changes.mapPos(t.position)}onWheel(e){this.executionLocation&&t.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e)&&e.preventDefault()}onKeyDown(e){const i=t.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e);return i||this.setControlDown(!1),e.key===s.KeyboardUtilities.ESCAPE_KEY&&this.popoverHelper.isPopoverVisible()?(this.popoverHelper.hidePopover(),e.consume(),!0):(i&&this.executionLocation&&this.setControlDown(!0),!1)}onMouseMove(e){this.executionLocation&&this.controlDown&&t.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e)&&(this.continueToLocations||this.showContinueToLocations())}onMouseDown(e){if(!this.executionLocation||!t.KeyboardShortcut.KeyboardShortcut.eventHasCtrlEquivalentKey(e))return;if(!this.continueToLocations||!this.editor)return;e.consume();const i=this.editor.editor.posAtCoords(e);if(null!==i)for(const{from:e,to:t,click:o}of this.continueToLocations)if(e<=i&&t>=i){o();break}}onBlur(e){this.setControlDown(!1)}onKeyUp(e){this.setControlDown(!1)}setControlDown(e){e!==this.controlDown&&(this.controlDown=e,clearTimeout(this.controlTimeout),this.controlTimeout=void 0,e&&this.executionLocation?this.controlTimeout=window.setTimeout((()=>{this.executionLocation&&this.controlDown&&this.showContinueToLocations()}),150):this.clearContinueToLocations())}editBreakpointCondition(e,t,o,n){const r=this.editor,s=t?t.condition():"",a=document.createElement("div"),c=new i.Compartment,l=new W(e.number-1,s,Boolean(n),(async i=>{l.detach(),r.dispatch({effects:c.reconfigure([])}),i.committed&&(t?t.setCondition(i.condition):o?await this.setBreakpoint(o.lineNumber,o.columnNumber,i.condition,!0):await this.createNewBreakpoint(e,i.condition,!0))}));r.dispatch({effects:i.StateEffect.appendConfig.of(c.of(i.EditorView.decorations.of(i.Decoration.set([i.Decoration.widget({block:!0,widget:new class extends i.WidgetType{toDOM(){return a}},side:1}).range(e.from)]))))}),l.markAsExternallyManaged(),l.show(a),l.focusEditor()}computeExecutionDecorations(e,t,o){const{doc:n}=e;if(t>=n.lines)return i.Decoration.none;const r=n.line(t+1),s=[en.range(r.from)],a=Math.min(r.to,r.from+o);let c=i.syntaxTree(e).resolveInner(a,1);c.to===c.from-1&&/[(.]/.test(n.sliceString(c.from,c.to))&&(c=c.resolve(c.to,1));const l=Math.min(r.to,c.to);return l>a&&s.push(tn.range(a,l)),i.Decoration.set(s)}async updateValueDecorations(){if(!this.editor)return;const e=this.executionLocation?await this.computeValueDecorations():null;(e||this.editor.state.field(un.field).size)&&this.editor.dispatch({effects:un.update.of(e||i.Decoration.none)})}async computeValueDecorations(){if(!this.editor)return null;if(!n.Settings.Settings.instance().moduleSetting("inlineVariableValues").get())return null;if(!t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext))return null;const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);if(!e)return null;const o=e.localScope();if(!o||!e.functionLocation())return null;const{properties:r}=await Bo(o).getAllProperties(!1,!1);if(!r||!r.length||r.length>500)return null;const s=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.functionLocation()),l=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.location()),[d,u]=await Promise.all([s,l]);if(!d||!u||d.uiSourceCode.url()!==this.uiSourceCode.url()||u.uiSourceCode.url()!==this.uiSourceCode.url())return null;const h=this.transformer.uiLocationToEditorLocation(d.lineNumber,d.columnNumber),p=this.transformer.uiLocationToEditorLocation(u.lineNumber,u.columnNumber);if(h.lineNumber>=p.lineNumber||p.lineNumber-h.lineNumber>500||h.lineNumber<0||p.lineNumber>=this.editor.state.doc.lines)return null;const g=new Map(r.map((e=>[e.name,e.value]))),m=this.getVariablesByLine(this.editor.state,g,h,p);if(!m)return null;const b=[];for(const[e,t]of m){const o=m.get(e-1);let n=o?Array.from(t).filter((e=>!o.has(e))):Array.from(t);if(!n.length)continue;n.length>10&&(n=n.slice(0,10));const r=n.map((e=>[e,g.get(e)]));b.push(i.Decoration.widget({widget:new dn(r),side:1}).range(this.editor.state.doc.line(e+1).to))}return i.Decoration.set(b,!0)}getVariablesByLine(e,t,o,n){const r=e.doc.line(o.lineNumber+1),s=Math.min(r.to,r.from+o.columnNumber),a=e.doc.line(n.lineNumber+1).from,c=i.ensureSyntaxTree(e,a,100);if(!c)return null;const l=new Map;let d=r;return c.iterate({from:s,to:a,enter(i,o,n){const r="VariableName"===i.name&&e.sliceDoc(o,n);if(r&&t.has(r)){o>d.to&&(d=e.doc.lineAt(o));let t=l.get(d.number-1);t||(t=new Set,l.set(d.number-1,t)),t.add(r)}}}),l}async showContinueToLocations(){this.popoverHelper.hidePopover();if(!t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext)||!this.editor)return;const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);if(!e)return;const o=e.functionLocation()||e.location(),n=e.debuggerModel,{state:r}=this.editor,s=await n.getPossibleBreakpoints(o,null,!0);this.continueToLocations=[];let c=-1;for(const e of s.reverse()){const t=this.transformer.uiLocationToEditorLocation(e.lineNumber,e.columnNumber);if(c===t.lineNumber&&"call"!==e.type||t.lineNumber>=r.doc.lines)continue;const o=r.doc.line(t.lineNumber+1),n=Math.min(o.to,o.from+t.columnNumber);let s=i.syntaxTree(r).resolveInner(n,1);if(s.firstChild||s.from<o.from||s.to>o.to)continue;if("."===s.name){const e=s.resolve(s.to,1);if(e.firstChild||e.from<o.from||e.to>o.to)continue;s=e}const a=s.name,l="this"===a||"return"===a||"new"===a||"break"===a||"continue"===a;if(!l&&!this.isIdentifier(a))continue;this.continueToLocations.push({from:s.from,to:s.to,async:!1,click:()=>e.continueToLocation()}),"call"===e.type&&(c=t.lineNumber);const d=l?"":o.text.slice(s.from-o.from,s.to-o.from);let u=null;if("then"===d&&"MemberExpression"===s.parent?.name?u=s.parent.parent:"setTimeout"!==d&&"setInterval"!==d&&"postMessage"!==d||(u=s.parent),"new"===a){const e=s.parent?.getChild("Expression");e&&"VariableName"===e.name&&"Worker"===r.sliceDoc(e.from,e.to)&&(u=s.parent)}if(u&&("CallExpression"===u.name||"NewExpression"===u.name)&&"call"===e.type){const t=u.getChild("ArgList")?.firstChild?.nextSibling;let i;if("VariableName"===t?.name?i=t:"ArrowFunction"!==t?.name&&"FunctionExpression"!==t?.name||(i=t.firstChild,"async"===i?.name&&(i=i.nextSibling)),i){const t=this.executionLocation&&e.lineNumber===this.executionLocation.lineNumber&&e.columnNumber===this.executionLocation.columnNumber;this.continueToLocations.push({from:i.from,to:i.to,async:!0,click:()=>this.asyncStepIn(e,Boolean(t))})}}}const l=i.Decoration.set(this.continueToLocations.map((e=>(e.async?rn:nn).range(e.from,e.to))),!0);this.editor.dispatch({effects:sn.update.of(l)})}clearContinueToLocations(){this.editor&&this.editor.state.field(sn.field).size&&this.editor.dispatch({effects:sn.update.of(i.Decoration.none)})}asyncStepIn(e,t){function i(){e.debuggerModel.scheduleStepIntoAsync()}t?i():e.continueToLocation(i)}fetchBreakpoints(){if(!this.editor)return[];const{editor:e}=this;return this.breakpointManager.breakpointLocationsForUISourceCode(this.uiSourceCode).map((({uiLocation:t,breakpoint:i})=>{const o=this.transformer.uiLocationToEditorLocation(t.lineNumber,t.columnNumber);return{position:e.toOffset(o),breakpoint:i}}))}lineBreakpoints(e){return this.breakpoints.filter((t=>t.position>=e.from&&t.position<=e.to)).map((e=>e.breakpoint))}async computeBreakpointDecoration(e,t){const o=[],n=[],r=new Map,s=new Map,a=[],c=new Set,l=(e,t,i)=>{let o=s.get(e);o||(o=[],s.set(e,o)),o.push({breakpoint:i,column:t})};for(const{position:i,breakpoint:o}of t){const t=e.doc.lineAt(i);let n=r.get(t.from);if(n||(n=[],r.set(t.from,n)),o.enabled()&&n.every((e=>!e.enabled()))){const e=this.transformer.editorLocationToUILocation(t.number-1,0),i=this.transformer.editorLocationToUILocation(t.number-1,Math.min(t.length,2500)),o=new m.TextRange.TextRange(e.lineNumber,e.columnNumber||0,i.lineNumber,i.columnNumber||0);a.push(this.breakpointManager.possibleBreakpoints(this.uiSourceCode,o).then((e=>d(t,e))))}n.push(o),o.enabled()&&(c.add(i),l(t.from,i-t.from,o))}for(const[e,t]of r){const i=t.sort(Qo)[0];let o="cm-breakpoint";i.enabled()||(o+=" cm-breakpoint-disabled"),i.bound()||(o+=" cm-breakpoint-unbound"),i.condition().includes(O)?o+=" cm-breakpoint-logpoint":i.condition()&&(o+=" cm-breakpoint-conditional"),n.push(new Xo(o).range(e))}const d=(e,t)=>{for(const i of t){const t=this.transformer.uiLocationToEditorLocation(i.lineNumber,i.columnNumber);if(t.lineNumber!==e.number-1)continue;const o=Math.min(e.to,e.from+t.columnNumber);c.has(o)||l(e.from,t.columnNumber,null)}};await Promise.all(a);for(const[e,t]of s)if(t.length>1)for(const{column:n,breakpoint:r}of t){const t=new Yo(r,this);o.push(i.Decoration.widget({widget:t,side:-1}).range(e+n))}return{content:i.Decoration.set(o,!0),gutter:i.RangeSet.of(n,!0)}}restoreBreakpointsAfterEditing(){const{breakpoints:e}=this,t=this.editor;this.breakpoints=[];for(const{breakpoint:i,position:o}of e){const e=i.condition(),n=i.enabled();i.remove(!1);const r=t.toLineColumn(o),s=this.transformer.editorLocationToUILocation(r.lineNumber,r.columnNumber);this.setBreakpoint(s.lineNumber,s.columnNumber,e,n)}}async refreshBreakpoints(){if(this.editor){this.breakpoints=this.fetchBreakpoints();const e=this.breakpoints,t=await this.computeBreakpointDecoration(this.editor.state,e);this.breakpoints===e&&(t.gutter.size||this.editor.state.field(Jo).gutter.size)&&this.editor.dispatch({effects:Go.of(t)})}}breakpointChange(e){const{uiLocation:t}=e.data;if(t.uiSourceCode===this.uiSourceCode&&!this.muted){for(const e of this.scriptFileForDebuggerModel.values())if(e.isDivergingFromVM()||e.isMergingToVM())return;window.clearTimeout(this.refreshBreakpointsTimeout),this.refreshBreakpointsTimeout=window.setTimeout((()=>this.refreshBreakpoints()),50)}}onInlineBreakpointMarkerClick(e,t){if(e.consume(!0),t)e.shiftKey?t.setEnabled(!t.enabled()):t.remove(!1);else if(this.editor){const t=this.editor.editor.posAtDOM(e.target),i=this.editor.state.doc.lineAt(t),o=this.transformer.editorLocationToUILocation(i.number-1,t-i.from);this.setBreakpoint(o.lineNumber,o.columnNumber,"",!0)}}onInlineBreakpointMarkerContextMenu(e,i){e.consume(!0);const o=this.editor,n=o.editor.posAtDOM(e.target),r=o.state.doc.lineAt(n);if(!h.SourceFrame.isBreakableLine(o.state,r)||!c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().supportsConditionalBreakpoints(this.uiSourceCode))return;const s=new t.ContextMenu.ContextMenu(e);if(i)s.debugSection().appendItem(Ro(Wo.editBreakpoint),this.editBreakpointCondition.bind(this,r,i,null,!1));else{const e=this.transformer.editorLocationToUILocation(r.number-1,n-r.from);s.debugSection().appendItem(Ro(Wo.addConditionalBreakpoint),this.editBreakpointCondition.bind(this,r,null,e,!1)),s.debugSection().appendItem(Ro(Wo.addLogpoint),this.editBreakpointCondition.bind(this,r,null,e,!0)),s.debugSection().appendItem(Ro(Wo.neverPauseHere),this.setBreakpoint.bind(this,e.lineNumber,e.columnNumber,"false",!0))}s.show()}updateScriptFiles(){for(const e of a.TargetManager.TargetManager.instance().models(a.DebuggerModel.DebuggerModel)){c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptFile(this.uiSourceCode,e)&&this.updateScriptFile(e)}}updateScriptFile(e){const t=this.scriptFileForDebuggerModel.get(e),i=c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().scriptFile(this.uiSourceCode,e);this.scriptFileForDebuggerModel.delete(e),t&&(t.removeEventListener("DidMergeToVM",this.didMergeToVM,this),t.removeEventListener("DidDivergeFromVM",this.didDivergeFromVM,this),this.muted&&!this.uiSourceCode.isDirty()&&this.consistentScripts()&&this.setMuted(!1)),i&&(this.scriptFileForDebuggerModel.set(e,i),i.addEventListener("DidMergeToVM",this.didMergeToVM,this),i.addEventListener("DidDivergeFromVM",this.didDivergeFromVM,this),i.checkMapping(),i.hasSourceMapURL()&&this.showSourceMapInfobar())}showSourceMapInfobar(){this.sourceMapInfobar||(this.sourceMapInfobar=t.Infobar.Infobar.create(t.Infobar.Type.Info,Ro(Wo.sourceMapDetected),[],n.Settings.Settings.instance().createSetting("sourceMapInfobarDisabled",!1)),this.sourceMapInfobar&&(this.sourceMapInfobar.createDetailsRowMessage(Ro(Wo.associatedFilesShouldBeAdded)),this.sourceMapInfobar.createDetailsRowMessage(Ro(Wo.associatedFilesAreAvailable,{PH1:String(t.ShortcutRegistry.ShortcutRegistry.instance().shortcutTitleForAction("quickOpen.show"))})),this.sourceMapInfobar.setCloseCallback((()=>{this.removeInfobar(this.sourceMapInfobar),this.sourceMapInfobar=null})),this.attachInfobar(this.sourceMapInfobar)))}async detectMinified(){const i=this.uiSourceCode.content();if(!i||!m.TextUtils.isMinified(i))return;const o=po();let r=null;for(const e of o)if(e instanceof ko){if(!e.isCurrentUISourceCodeFormattable())return;r=e.toggleFormatScriptSource.bind(e);break}if(this.prettyPrintInfobar=t.Infobar.Infobar.create(t.Infobar.Type.Info,Ro(Wo.prettyprintThisMinifiedFile),[{text:Ro(Wo.prettyprint),delegate:r,highlight:!0,dismiss:!0}],n.Settings.Settings.instance().createSetting("prettyPrintInfobarDisabled",!1)),!this.prettyPrintInfobar)return;this.prettyPrintInfobar.setCloseCallback((()=>{this.removeInfobar(this.prettyPrintInfobar),this.prettyPrintInfobar=null}));const s=new t.Toolbar.Toolbar(""),a=new t.Toolbar.ToolbarButton("","largeicon-pretty-print");s.appendToolbarItem(a),s.element.style.display="inline",s.element.style.verticalAlign="middle",s.element.style.marginBottom="3px",s.element.style.pointerEvents="none",s.element.tabIndex=-1;const c=this.prettyPrintInfobar.createDetailsRowMessage();c.appendChild(e.i18n.getFormatLocalizedString(Oo,Wo.prettyprintingWillFormatThisFile,{PH1:s.element})),t.ARIAUtils.markAsAlert(c),this.attachInfobar(this.prettyPrintInfobar)}handleGutterClick(e,t){return!(this.muted||0!==t.button||t.altKey||t.ctrlKey||t.metaKey)&&(this.toggleBreakpoint(e,t.shiftKey),!0)}async toggleBreakpoint(e,t){if(this.muted)return;const i=this.lineBreakpoints(e);if(!i.length)return void await this.createNewBreakpoint(e,"",!0);const o=i.some((e=>!e.enabled()));for(const e of i)t?e.setEnabled(o):e.remove(!1)}async createNewBreakpoint(e,t,i){if(!this.editor||!h.SourceFrame.isBreakableLine(this.editor.state,e))return;r.userMetrics.actionTaken(r.UserMetrics.Action.ScriptsBreakpointSet);const o=this.transformer.editorLocationToUILocation(e.number-1);await this.setBreakpoint(o.lineNumber,o.columnNumber,t,i)}async setBreakpoint(e,t,i,o){n.Settings.Settings.instance().moduleSetting("breakpointsActive").set(!0),await this.breakpointManager.setBreakpoint(this.uiSourceCode,e,t,i,o),this.breakpointWasSetForTest(e,t,i,o)}breakpointWasSetForTest(e,t,i,o){}async callFrameChanged(){this.liveLocationPool.disposeAll();const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame);e?await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),(async e=>{const t=await e.uiLocation();t&&t.uiSourceCode.url()===this.uiSourceCode.url()?this.setExecutionLocation(t):this.setExecutionLocation(null)}),this.liveLocationPool):this.setExecutionLocation(null)}setExecutionLocation(e){if(this.executionLocation!==e&&this.editor)if(this.executionLocation=e,e){const t=this.transformer.uiLocationToEditorLocation(e.lineNumber,e.columnNumber),i=this.computeExecutionDecorations(this.editor.state,t.lineNumber,t.columnNumber);this.editor.dispatch({effects:on.update.of(i)}),this.updateValueDecorations(),this.controlDown&&this.showContinueToLocations()}else this.editor.dispatch({effects:[on.update.of(i.Decoration.none),sn.update.of(i.Decoration.none),un.update.of(i.Decoration.none)]})}dispose(){this.hideIgnoreListInfobar(),this.sourceMapInfobar&&this.sourceMapInfobar.dispose(),this.prettyPrintInfobar&&this.prettyPrintInfobar.dispose();for(const e of this.scriptFileForDebuggerModel.values())e.removeEventListener("DidMergeToVM",this.didMergeToVM,this),e.removeEventListener("DidDivergeFromVM",this.didDivergeFromVM,this);this.scriptFileForDebuggerModel.clear(),this.popoverHelper.hidePopover(),this.popoverHelper.dispose(),this.breakpointManager.removeEventListener(c.BreakpointManager.Events.BreakpointAdded,this.breakpointChange,this),this.breakpointManager.removeEventListener(c.BreakpointManager.Events.BreakpointRemoved,this.breakpointChange,this),this.uiSourceCode.removeEventListener(d.UISourceCode.Events.WorkingCopyChanged,this.workingCopyChanged,this),this.uiSourceCode.removeEventListener(d.UISourceCode.Events.WorkingCopyCommitted,this.workingCopyCommitted,this),n.Settings.Settings.instance().moduleSetting("skipStackFramesPattern").removeChangeListener(this.showIgnoreListInfobarIfNeeded,this),n.Settings.Settings.instance().moduleSetting("skipContentScripts").removeChangeListener(this.showIgnoreListInfobarIfNeeded,this),super.dispose(),t.Context.Context.instance().removeFlavorChangeListener(a.DebuggerModel.CallFrame,this.callFrameChanged,this),this.liveLocationPool.disposeAll()}}const _o=i.StateEffect.define(),zo=i.StateEffect.define(),qo=i.StateField.define({create:()=>[],update(e,t){for(const i of t.effects)i.is(_o)?e=e.concat(i.value):i.is(zo)&&(e=e.filter((e=>e!==i.value)));return e},provide:e=>i.showPanel.computeN([e],(t=>t.field(e).map((e=>()=>({dom:e.element})))))});const Go=i.StateEffect.define(),Ko=i.StateEffect.define();function $o(e,t){const o=[];return e.between(0,t.length,((e,t,i)=>{let n=i.elementClass;/cm-breakpoint-disabled/.test(n)||(n+=" cm-breakpoint-disabled"),o.push(new Xo(n).range(e))})),i.RangeSet.of(o,!1)}const Jo=i.StateField.define({create:()=>({content:i.RangeSet.empty,gutter:i.RangeSet.empty}),update(e,t){t.changes.empty||(e={content:e.content.map(t.changes),gutter:e.gutter.map(t.changes)});for(const o of t.effects)o.is(Go)?e=o.value:o.is(Ko)&&(e={content:i.RangeSet.empty,gutter:$o(e.gutter,t.state.doc)});return e},provide:e=>[i.EditorView.decorations.from(e,(e=>e.content)),i.lineNumberMarkers.from(e,(e=>e.gutter))]});class Yo extends i.WidgetType{breakpoint;parent;class;constructor(e,t){super(),this.breakpoint=e,this.parent=t,this.class="cm-inlineBreakpoint";const i=e?e.condition():"";i.includes(O)?this.class+=" cm-inlineBreakpoint-logpoint":i&&(this.class+=" cm-inlineBreakpoint-conditional"),e?.enabled()||(this.class+=" cm-inlineBreakpoint-disabled")}eq(e){return e.class===this.class&&e.breakpoint===this.breakpoint}toDOM(){const e=document.createElement("span");return e.className=this.class,e.addEventListener("click",(e=>{this.parent.onInlineBreakpointMarkerClick(e,this.breakpoint),e.consume()})),e.addEventListener("contextmenu",(e=>{this.parent.onInlineBreakpointMarkerContextMenu(e,this.breakpoint),e.consume()})),e}ignoreEvent(){return!0}}class Xo extends i.GutterMarker{elementClass;constructor(e){super(),this.elementClass=e}eq(e){return e.elementClass===this.elementClass}}function Qo(e,t){return e.enabled()!==t.enabled()?e.enabled()?-1:1:e.bound()!==t.bound()?e.bound()?-1:1:Boolean(e.condition())!==Boolean(t.condition())?Boolean(e.condition())?-1:1:0}function Zo(){const e=i.StateEffect.define(),t=i.StateField.define({create:()=>i.Decoration.none,update:(t,i)=>i.effects.reduce(((t,i)=>i.is(e)?i.value:t),t.map(i.changes)),provide:e=>i.EditorView.decorations.from(e)});return{update:e,field:t}}const en=i.Decoration.line({attributes:{class:"cm-executionLine"}}),tn=i.Decoration.mark({attributes:{class:"cm-executionToken"}}),on=Zo(),nn=i.Decoration.mark({class:"cm-continueToLocation"}),rn=i.Decoration.mark({class:"cm-continueToLocation cm-continueToLocation-async"}),sn=Zo(),an={},cn={class:"cm-hasContinueMarkers"},ln=i.EditorView.contentAttributes.compute([sn.field],(e=>e.field(sn.field).size?cn:an));class dn extends i.WidgetType{pairs;constructor(e){super(),this.pairs=e}eq(e){return this.pairs.length===e.pairs.length&&this.pairs.every(((t,i)=>t[0]===e.pairs[i][0]&&t[1]===e.pairs[i][1]))}toDOM(){const e=new b.RemoteObjectPreviewFormatter.RemoteObjectPreviewFormatter,i=document.createElement("div");i.classList.add("cm-variableValues");let o=!0;for(const[n,r]of this.pairs){o?o=!1:t.UIUtils.createTextChild(i,", ");const s=i.createChild("span");t.UIUtils.createTextChild(s,n+" = ");const a=r.preview?r.preview.properties.length:0,c=r.preview&&r.preview.entries?r.preview.entries.length:0;if(r.preview&&a+c<10)e.appendObjectPreview(s,r.preview,!1);else{const e=b.ObjectPropertiesSection.ObjectPropertiesSection.createPropertyValue(r,!1,!1);s.appendChild(e.element)}}return i}}const un=Zo(),hn=i.Decoration.mark({class:"cm-evaluatedExpression"}),pn=Zo(),gn=i.EditorView.baseTheme({".cm-lineNumbers .cm-gutterElement":{"&:hover, &.cm-breakpoint":{borderStyle:"solid",borderWidth:"1px 4px 1px 1px",marginRight:"-4px",paddingLeft:"8px",lineHeight:"calc(1.2em - 2px)",position:"relative"},"&:hover":{WebkitBorderImage:mn("#ebeced","#ebeced")},"&.cm-breakpoint":{color:"#fff",WebkitBorderImage:mn("#4285f4","#1a73e8")},"&.cm-breakpoint-conditional":{WebkitBorderImage:mn("#f29900","#e37400"),"&::before":{content:'"?"',position:"absolute",top:0,left:"1px"}},"&.cm-breakpoint-logpoint":{WebkitBorderImage:mn("#f439a0","#d01884"),"&::before":{content:'"â€¥"',position:"absolute",top:"-3px",left:"1px"}}},"&dark .cm-lineNumbers .cm-gutterElement":{"&:hover":{WebkitBorderImage:mn("#3c4043","#3c4043")},"&.cm-breakpoint":{WebkitBorderImage:mn("#5186EC","#1a73e8")},"&.cm-breakpoint-conditional":{WebkitBorderImage:mn("#e9a33a","#e37400")},"&.cm-breakpoint-logpoint":{WebkitBorderImage:mn("#E54D9B","#d01884")}},":host-context(.breakpoints-deactivated) & .cm-lineNumbers .cm-gutterElement.cm-breakpoint, .cm-lineNumbers .cm-gutterElement.cm-breakpoint-disabled":{color:"#1a73e8",WebkitBorderImage:mn("#d9e7fd","#1a73e8"),"&.cm-breakpoint-conditional":{color:"#e37400",WebkitBorderImage:mn("#fcebcc","#e37400")},"&.cm-breakpoint-logpoint":{color:"#d01884",WebkitBorderImage:mn("#fdd7ec","#f439a0")}},":host-context(.breakpoints-deactivated) &dark .cm-lineNumbers .cm-gutterElement.cm-breakpoint, &dark .cm-lineNumbers .cm-gutterElement.cm-breakpoint-disabled":{WebkitBorderImage:mn("#2a384e","#1a73e8"),"&.cm-breakpoint-conditional":{WebkitBorderImage:mn("#4d3c1d","#e37400")},"&.cm-breakpoint-logpoint":{WebkitBorderImage:mn("#4e283d","#f439a0")}},".cm-inlineBreakpoint":{cursor:"pointer",position:"relative",top:"1px",content:bn("#4285F4","#1A73E8"),height:"10px","&.cm-inlineBreakpoint-conditional":{content:fn("#F29900","#E37400")},"&.cm-inlineBreakpoint-logpoint":{content:vn("#F439A0","#D01884")}},"&dark .cm-inlineBreakpoint":{content:bn("#5186EC","#1A73E8"),"&.cm-inlineBreakpoint-conditional":{content:fn("#e9a33a","#E37400")},"&.cm-inlineBreakpoint-logpoint":{content:vn("#E54D9B","#D01884")}},":host-context(.breakpoints-deactivated) & .cm-inlineBreakpoint, .cm-inlineBreakpoint-disabled":{content:bn("#4285F4","#1A73E8","0.2"),"&.cm-inlineBreakpoint-conditional":{content:fn("#F9AB00","#E37400","0.2")},"&.cm-inlineBreakpoint-logpoint":{content:vn("#F439A0","#D01884","0.2")}},".cm-executionLine":{backgroundColor:"var(--color-execution-line-background)",outline:"1px solid var(--color-execution-line-outline)",".cm-hasContinueMarkers &":{backgroundColor:"transparent"},"&.cm-highlightedLine":{animation:"cm-fading-highlight-execution 2s 0s"}},".cm-executionToken":{backgroundColor:"var(--color-execution-token-background)"},"@keyframes cm-fading-highlight-execution":{from:{backgroundColor:"var(--color-highlighted-line)"},to:{backgroundColor:"var(--color-execution-line-background)"}},".cm-continueToLocation":{cursor:"pointer",backgroundColor:"var(--color-continue-to-location)","&:hover":{backgroundColor:"var(--color-continue-to-location-hover)",border:"1px solid var(--color-continue-to-location-hover-border)",margin:"0 -1px"},"&.cm-continueToLocation-async":{backgroundColor:"var(--color-continue-to-location-async)","&:hover":{backgroundColor:"var(--color-continue-to-location-async-hover)",border:"1px solid var(--color-continue-to-location-async-hover-border)",margin:"0 -1px"}}},".cm-evaluatedExpression":{backgroundColor:"var(--color-evaluated-expression)",border:"1px solid var(--color-evaluated-expression-border)",margin:"0 -1px"},".cm-variableValues":{display:"inline",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"1000px",opacity:"80%",backgroundColor:"var(--color-variable-values)",marginLeft:"10px",padding:"0 5px",userSelect:"text",".cm-executionLine &":{backgroundColor:"transparent",opacity:"50%"}}});function mn(e,t){return`url('data:image/svg+xml,<svg height="11" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M22.8.5l2.7 5-2.7 5H.5V.5z" fill="${encodeURIComponent(e)}" stroke="${encodeURIComponent(t)}"/></svg>') 1 3 1 1`}function bn(e,t,i="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.7549 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.7549 11.2583 6.29382 11.5 5.80139 11.5H0.5V0.5Z" fill="${encodeURIComponent(e)}" stroke="${encodeURIComponent(t)}" fill-opacity="${encodeURIComponent(i)}"/></svg>')`}function fn(e,t,i="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.75489 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.75489 11.2583 6.29382 11.5 5.80138 11.5H0.5V0.5Z" fill="${encodeURIComponent(e)}" fill-opacity="${encodeURIComponent(i)}" stroke="${encodeURIComponent(t)}"/><path d="M3.51074 7.75635H4.68408V9H3.51074V7.75635ZM4.68408 7.23779H3.51074V6.56104C3.51074 6.271 3.55615 6.02344 3.64697 5.81836C3.73779 5.61328 3.90039 5.39648 4.13477 5.16797L4.53027 4.77686C4.71484 4.59814 4.83936 4.4502 4.90381 4.33301C4.97119 4.21582 5.00488 4.09424 5.00488 3.96826C5.00488 3.77197 4.9375 3.62402 4.80273 3.52441C4.66797 3.4248 4.46582 3.375 4.19629 3.375C3.9502 3.375 3.69238 3.42773 3.42285 3.5332C3.15625 3.63574 2.88232 3.78955 2.60107 3.99463V2.81689C2.88818 2.65283 3.17822 2.52979 3.47119 2.44775C3.76709 2.36279 4.06299 2.32031 4.35889 2.32031C4.95068 2.32031 5.41504 2.45801 5.75195 2.7334C6.08887 3.00879 6.25732 3.38818 6.25732 3.87158C6.25732 4.09424 6.20752 4.30225 6.10791 4.49561C6.0083 4.68604 5.8208 4.91602 5.54541 5.18555L5.15869 5.56348C4.95947 5.75684 4.83203 5.91504 4.77637 6.03809C4.7207 6.16113 4.69287 6.31201 4.69287 6.49072C4.69287 6.51709 4.69141 6.54785 4.68848 6.58301C4.68848 6.61816 4.68701 6.65625 4.68408 6.69727V7.23779Z" fill="white"/></svg>')`}function vn(e,t,i="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.7549 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.7549 11.2583 6.29382 11.5 5.80139 11.5H0.5V0.5Z" fill="${encodeURIComponent(e)}" stroke="${encodeURIComponent(t)}" fill-opacity="${encodeURIComponent(i)}"/><circle cx="3" cy="6" r="1" fill="white"/><circle cx="7" cy="6" r="1" fill="white"/></svg>')`}var Sn=Object.freeze({__proto__:null,DebuggerPlugin:Ho});class Cn{query;queryUpperCase;score;sequence;dataUpperCase;fileNameIndex;constructor(e){this.query=e,this.queryUpperCase=e.toUpperCase(),this.score=new Int32Array(2e3),this.sequence=new Int32Array(2e3),this.dataUpperCase="",this.fileNameIndex=0}calculateScore(e,t){if(!e||!this.query)return 0;const i=this.query.length,o=e.length;(!this.score||this.score.length<i*o)&&(this.score=new Int32Array(i*o*2),this.sequence=new Int32Array(i*o*2));const n=this.score,r=this.sequence;this.dataUpperCase=e.toUpperCase(),this.fileNameIndex=e.lastIndexOf("/");for(let t=0;t<i;++t)for(let i=0;i<o;++i){const s=0===i?0:n[t*o+i-1],a=0===t||0===i?0:n[(t-1)*o+i-1],c=0===t||0===i?0:r[(t-1)*o+i-1],l=this.match(this.query,e,t,i,c);l&&a+l>=s?(r[t*o+i]=c+1,n[t*o+i]=a+l):(r[t*o+i]=0,n[t*o+i]=s)}t&&this.restoreMatchIndexes(r,i,o,t);return 256*n[i*o-1]+(256-e.length)}testWordStart(e,t){if(0===t)return!0;const i=e.charAt(t-1);return"_"===i||"-"===i||"/"===i||"."===i||" "===i||e[t-1]!==this.dataUpperCase[t-1]&&e[t]===this.dataUpperCase[t]}restoreMatchIndexes(e,t,i,o){let n=t-1,r=i-1;for(;n>=0&&r>=0;)if(0===e[n*i+r])--r;else o.push(r),--n,--r;o.reverse()}singleCharScore(e,t,i,o){const n=this.testWordStart(t,o),r=o>this.fileNameIndex;let s=10;return(0===o||"/"===t[o-1])&&(s+=4),n&&(s+=2),e[i]===t[o]&&e[i]===this.queryUpperCase[i]&&(s+=6),r&&(s+=4),o===this.fileNameIndex+1&&0===i&&(s+=5),r&&n&&(s+=3),s}sequenceCharScore(e,t,i,o,n){let r=10;return o>this.fileNameIndex&&(r+=4),(0===o||"/"===t[o-1])&&(r+=5),r+=4*n,r}match(e,t,i,o,n){return this.queryUpperCase[i]!==this.dataUpperCase[o]?0:n?this.sequenceCharScore(e,t,i,o-n,n):this.singleCharScore(e,t,i,o)}}var wn=Object.freeze({__proto__:null,FilePathScoreFunction:Cn});const In={noFilesFound:"No files found"},kn=e.i18n.registerUIStrings("panels/sources/FilteredUISourceCodeListProvider.ts",In),xn=e.i18n.getLocalizedString.bind(void 0,kn);class yn extends f.FilteredListWidget.Provider{queryLineNumberAndColumnNumber;defaultScores;scorer;uiSourceCodes;uiSourceCodeUrls;query;constructor(){super(),this.queryLineNumberAndColumnNumber="",this.defaultScores=null,this.scorer=new Cn(""),this.uiSourceCodes=[],this.uiSourceCodeUrls=new Set}projectRemoved(e){const t=e.data;this.populate(t),this.refresh()}populate(e){this.uiSourceCodes=[],this.uiSourceCodeUrls.clear();for(const t of d.Workspace.WorkspaceImpl.instance().projects())if(t!==e&&this.filterProject(t))for(const e of t.uiSourceCodes())this.filterUISourceCode(e)&&(this.uiSourceCodes.push(e),this.uiSourceCodeUrls.add(e.url()))}filterUISourceCode(e){if(this.uiSourceCodeUrls.has(e.url()))return!1;const t=l.Persistence.PersistenceImpl.instance().binding(e);return!t||t.fileSystem===e}uiSourceCodeSelected(e,t,i){}filterProject(e){return!0}itemCount(){return this.uiSourceCodes.length}itemContentTypeAt(e){return this.uiSourceCodes[e].contentType()}itemKeyAt(e){return this.uiSourceCodes[e].url()}setDefaultScores(e){this.defaultScores=e}itemScoreAt(e,t){const i=this.uiSourceCodes[e],o=this.defaultScores&&this.defaultScores.get(i)||0;if(!t||t.length<2)return o;this.query!==t&&(this.query=t,this.scorer=new Cn(t));let n=10;i.project().type()!==d.Workspace.projectTypes.FileSystem||l.Persistence.PersistenceImpl.instance().binding(i)||(n=5);const r=i.fullDisplayName();return o+n*this.scorer.calculateScore(r,null)}renderItem(e,i,o,n){i=this.rewriteQuery(i);const r=this.uiSourceCodes[e],s=r.fullDisplayName(),a=[];new Cn(i).calculateScore(s,a);const c=s.lastIndexOf("/");o.textContent=r.displayName()+(this.queryLineNumberAndColumnNumber||""),this.renderSubtitleElement(n,s.substring(0,c+1)),t.Tooltip.Tooltip.install(n,s);const l=[];for(let e=0;e<a.length;++e)l.push({offset:a[e],length:1});if(a[0]>c){for(let e=0;e<l.length;++e)l[e].offset-=c+1;t.UIUtils.highlightRangesWithStyleClass(o,l,"highlight")}else t.UIUtils.highlightRangesWithStyleClass(n,l,"highlight")}renderSubtitleElement(e,i){e.removeChildren();let o=i.lastIndexOf("/");i.length>43&&(o=i.length-43);e.createChild("div","first-part").textContent=i.substring(0,o);e.createChild("div","second-part").textContent=i.substring(o),t.Tooltip.Tooltip.install(e,i)}selectItem(e,t){const i=t.trim().match(/^([^:]*)(:\d+)?(:\d+)?$/);if(!i)return;let o,n;i[2]&&(o=parseInt(i[2].substr(1),10)-1),i[3]&&(n=parseInt(i[3].substr(1),10)-1);const r=null!==e?this.uiSourceCodes[e]:null;this.uiSourceCodeSelected(r,o,n)}rewriteQuery(e){if(!(e=e?e.trim():"")||":"===e)return"";const t=e.match(/^([^:]+)((?::[^:]*){0,2})$/);return this.queryLineNumberAndColumnNumber=t?t[2]:"",t?t[1]:e}uiSourceCodeAdded(e){const t=e.data;this.filterUISourceCode(t)&&this.filterProject(t.project())&&(this.uiSourceCodes.push(t),this.uiSourceCodeUrls.add(t.url()),this.refresh())}notFoundText(){return xn(In.noFilesFound)}attach(){d.Workspace.WorkspaceImpl.instance().addEventListener(d.Workspace.Events.UISourceCodeAdded,this.uiSourceCodeAdded,this),d.Workspace.WorkspaceImpl.instance().addEventListener(d.Workspace.Events.ProjectRemoved,this.projectRemoved,this),this.populate()}detach(){d.Workspace.WorkspaceImpl.instance().removeEventListener(d.Workspace.Events.UISourceCodeAdded,this.uiSourceCodeAdded,this),d.Workspace.WorkspaceImpl.instance().removeEventListener(d.Workspace.Events.ProjectRemoved,this.projectRemoved,this),this.queryLineNumberAndColumnNumber="",this.defaultScores=null}}var En=Object.freeze({__proto__:null,FilteredUISourceCodeListProvider:yn});const Tn={noFileSelected:"No file selected.",noResultsFound:"No results found",typeANumberToGoToThatLine:"Type a number to go to that line.",currentPositionXsTypeAnOffset:"Current position: 0x{PH1}. Type an offset between 0x{PH2} and 0x{PH3} to navigate to.",currentLineSTypeALineNumber:"Current line: {PH1}. Type a line number between 1 and {PH2} to navigate to.",goToOffsetXs:"Go to offset 0x{PH1}.",goToLineSAndColumnS:"Go to line {PH1} and column {PH2}.",goToLineS:"Go to line {PH1}."},Ln=e.i18n.registerUIStrings("panels/sources/GoToLineQuickOpen.ts",Tn),Mn=e.i18n.getLocalizedString.bind(void 0,Ln);let Fn;class Pn extends f.FilteredListWidget.Provider{#e=[];static instance(e={forceNew:null}){const{forceNew:t}=e;return Fn&&!t||(Fn=new Pn),Fn}selectItem(e,t){const i=this.currentUISourceCode();if(!i)return;const o=this.parsePosition(t);o&&n.Revealer.reveal(i.uiLocation(o.line-1,o.column-1))}updateGoToLineStrings(e){if(this.#e=[],!this.currentUISourceCode())return;const t=this.parsePosition(e),i=this.currentSourceFrame();if(t)i&&i.wasmDisassembly?this.#e.push(Mn(Tn.goToOffsetXs,{PH1:(t.column-1).toString(16)})):t.column&&t.column>1?this.#e.push(Mn(Tn.goToLineSAndColumnS,{PH1:t.line,PH2:t.column})):i&&t.line>i.textEditor.state.doc.lines||this.#e.push(Mn(Tn.goToLineS,{PH1:t.line}));else{if(!i)return void this.#e.push(Mn(Tn.typeANumberToGoToThatLine));const e=i.textEditor.state,t=i.wasmDisassembly,o=e.doc.lineAt(e.selection.main.head).number-1;if(t){const e=t.lineNumberToBytecodeOffset(t.lineNumbers-1),i=e.toString(16).length,n=t.lineNumberToBytecodeOffset(o);return void this.#e.push(Mn(Tn.currentPositionXsTypeAnOffset,{PH1:n.toString(16).padStart(i,"0"),PH2:"0".padStart(i,"0"),PH3:e.toString(16)}))}const n=e.doc.lines;this.#e.push(Mn(Tn.currentLineSTypeALineNumber,{PH1:o+1,PH2:n}))}}itemCount(){return this.#e.length}renderItem(e,i,o,n){t.UIUtils.createTextChild(o,this.#e[e])}rewriteQuery(e){return""}queryChanged(e){this.updateGoToLineStrings(e)}notFoundText(e){return this.currentUISourceCode()?Mn(Tn.noResultsFound):Mn(Tn.noFileSelected)}parsePosition(e){const t=this.currentSourceFrame();if(t&&t.wasmDisassembly){const t=e.match(/0x([0-9a-fA-F]+)/);if(!t||!t[0]||t[0].length!==e.length)return null;return{line:0,column:parseInt(t[0],16)+1}}const i=e.match(/([0-9]+)(\:[0-9]*)?/);if(!i||!i[0]||i[0].length!==e.length)return null;const o=parseInt(i[1],10);let n=0;return i[2]&&(n=parseInt(i[2].substring(1),10)),{line:Math.max(0|o,1),column:Math.max(0|n,1)}}currentUISourceCode(){const e=t.Context.Context.instance().flavor(co);return e?e.currentUISourceCode():null}currentSourceFrame(){const e=t.Context.Context.instance().flavor(co);return e?e.currentSourceFrame():null}}var Dn=Object.freeze({__proto__:null,GoToLineQuickOpen:Pn});const An={formatS:"Format {PH1}",format:"Format"},Bn=e.i18n.registerUIStrings("panels/sources/InplaceFormatterEditorAction.ts",An),Nn=e.i18n.getLocalizedString.bind(void 0,Bn);let Un;class Vn{button;sourcesView;constructor(){}static instance(e={forceNew:null}){const{forceNew:t}=e;return Un&&!t||(Un=new Vn),Un}editorSelected(e){const t=e.data;this.updateButton(t)}editorClosed(e){const{wasSelected:t}=e.data;t&&this.updateButton(null)}updateButton(e){const t=this.isFormattable(e);this.button.element.classList.toggle("hidden",!t),e&&t&&this.button.setTitle(Nn(An.formatS,{PH1:e.name()}))}getOrCreateButton(e){return this.button||(this.sourcesView=e,this.sourcesView.addEventListener(lo.EditorSelected,this.editorSelected.bind(this)),this.sourcesView.addEventListener(lo.EditorClosed,this.editorClosed.bind(this)),this.button=new t.Toolbar.ToolbarButton(Nn(An.format),"largeicon-pretty-print"),this.button.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.formatSourceInPlace,this),this.updateButton(e.currentUISourceCode())),this.button}isFormattable(e){return!!e&&(!!e.project().canSetFileContent()||(!!l.Persistence.PersistenceImpl.instance().binding(e)||e.contentType().isStyleSheet()))}formatSourceInPlace(){const e=this.sourcesView.currentUISourceCode();e&&this.isFormattable(e)&&(e.isDirty()?this.contentLoaded(e,e.workingCopy()):e.requestContent().then((t=>{this.contentLoaded(e,t.content||"")})))}async contentLoaded(e,t){const i=e.mimeType(),{formattedContent:o,formattedMapping:n}=await u.ScriptFormatter.format(e.contentType(),i,t);this.formattingComplete(e,o,n)}formattingComplete(e,t,i){if(e.workingCopy()===t)return;const o=this.sourcesView.viewForFile(e);let n=[0,0];if(o){const e=o.textEditor.toLineColumn(o.textEditor.state.selection.main.head);n=i.originalToFormatted(e.lineNumber,e.columnNumber)}e.setWorkingCopy(t),this.sourcesView.showSourceLocation(e,{lineNumber:n[0],columnNumber:n[1]})}}ho(Vn.instance);var jn=Object.freeze({__proto__:null,InplaceFormatterEditorAction:Vn});const Wn=new CSSStyleSheet;Wn.replaceSync(".breakpoint-entry{padding:3px 0;min-height:18px;line-height:15px;border-top:1px solid var(--color-details-hairline-light)}.breakpoint-entry:focus{background-color:var(--legacy-focus-bg-color)}.breakpoint-entry [is=dt-checkbox]{max-width:100%;white-space:nowrap;border-left-width:3px}:not(.breakpoints-list-deactivated)>.breakpoint-entry:hover{background-color:var(--color-background-elevation-1)}.decoration-and-content{--override-color-breakpoint-conditional:#f29900;--override-color-logpoint:#f439a0;padding:0 8px;border-left:4px solid;border-color:transparent}.-theme-with-dark-background .decoration-and-content,:host-context(.-theme-with-dark-background) .decoration-and-content{--override-color-breakpoint-conditional:#e9a33a;--override-color-logpoint:#e54d9b}.decoration-and-content.breakpoint-conditional{border-color:var(--override-color-breakpoint-conditional)}.decoration-and-content.logpoint{border-color:var(--override-color-logpoint)}.decoration-and-content>.source-text{cursor:pointer;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;margin-left:22px}.breakpoints-list-deactivated{background-color:var(--color-background-elevation-1);opacity:30%}.breakpoint-hit{--override-breakpoint-hit-background:rgb(255 255 194);--override-breakpoint-hit-border-color:rgb(107 97 48);background-color:var(--override-breakpoint-hit-background);border-right:3px solid var(--override-breakpoint-hit-border-color)}:host-context(.-theme-with-dark-background) .breakpoint-hit{background-color:hsl(46deg 98% 22%);color:var(--color-text-primary)}@media (forced-colors:active){.breakpoint-entry:focus,:not(.breakpoints-list-deactivated)>.breakpoint-entry:hover{forced-color-adjust:none;background-color:Highlight}.breakpoint-entry:focus>*,:not(.breakpoints-list-deactivated)>.breakpoint-entry:hover>*{color:HighlightText}}\n/*# sourceURL=javaScriptBreakpointsSidebarPane.css */\n");const On={noBreakpoints:"No breakpoints",checked:"checked",unchecked:"unchecked",mixed:"mixed",sBreakpointHit:"{PH1} breakpoint hit",removeAllBreakpointsInLine:"Remove all breakpoints in line",removeBreakpoint:"Remove breakpoint",revealLocation:"Reveal location",deactivateBreakpoints:"Deactivate breakpoints",activateBreakpoints:"Activate breakpoints",enableAllBreakpoints:"Enable all breakpoints",enableBreakpointsInFile:"Enable breakpoints in file",disableAllBreakpoints:"Disable all breakpoints",disableBreakpointsInFile:"Disable breakpoints in file",removeAllBreakpoints:"Remove all breakpoints",removeOtherBreakpoints:"Remove other breakpoints"},Rn=e.i18n.registerUIStrings("panels/sources/JavaScriptBreakpointsSidebarPane.ts",On),Hn=e.i18n.getLocalizedString.bind(void 0,Rn);let _n;class zn extends t.ThrottledWidget.ThrottledWidget{breakpointManager;breakpoints;list;emptyElement;constructor(){super(!0),this.breakpointManager=c.BreakpointManager.BreakpointManager.instance(),this.breakpointManager.addEventListener(c.BreakpointManager.Events.BreakpointAdded,this.update,this),this.breakpointManager.addEventListener(c.BreakpointManager.Events.BreakpointRemoved,this.update,this),n.Settings.Settings.instance().moduleSetting("breakpointsActive").addChangeListener(this.update,this),this.breakpoints=new t.ListModel.ListModel,this.list=new t.ListControl.ListControl(this.breakpoints,this,t.ListControl.ListMode.NonViewport),t.ARIAUtils.markAsList(this.list.element),this.contentElement.appendChild(this.list.element),this.emptyElement=this.contentElement.createChild("div","gray-info-message"),this.emptyElement.textContent=Hn(On.noBreakpoints),this.emptyElement.tabIndex=-1,this.update()}static instance(){return _n||(_n=new zn),_n}getBreakpointLocations(){const e=this.breakpointManager.allBreakpointLocations().filter((e=>e.uiLocation.uiSourceCode.project().type()!==d.Workspace.projectTypes.Debugger));e.sort(((e,t)=>e.uiLocation.compareTo(t.uiLocation)));const t=[];let i=null,o=null;for(const n of e)(n.breakpoint!==i||o&&n.uiLocation.compareTo(o))&&(t.push(n),i=n.breakpoint,o=n.uiLocation);return t}hideList(){this.list.element.classList.add("hidden"),this.emptyElement.classList.remove("hidden")}ensureListShown(){this.list.element.classList.remove("hidden"),this.emptyElement.classList.add("hidden")}groupBreakpointLocationsById(e){const t=new s.MapUtilities.Multimap;for(const i of e){const e=i.uiLocation;t.set(e.id(),i)}const i=[];for(const e of t.keysArray()){const o=Array.from(t.get(e));o.length&&i.push(o)}return i}getLocationIdsByLineId(e){const t=new s.MapUtilities.Multimap;for(const i of e){const e=i.uiLocation;t.set(e.lineId(),e.id())}return t}async getSelectedUILocation(){const e=t.Context.Context.instance().flavor(a.DebuggerModel.DebuggerPausedDetails);return e&&e.callFrames.length?await c.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.callFrames[0].location()):null}getContent(e){const t=new Map;return Promise.all(e.map((async([{uiLocation:{uiSourceCode:e}}])=>{if("application/wasm"===e.mimeType())return new m.Text.Text("");const{content:i}=await e.requestContent(),o=i||"";if(t.has(o))return t.get(o);const n=new m.Text.Text(o);return t.set(o,n),n})))}async doUpdate(){const e=this.hasFocus(),i=this.getBreakpointLocations();if(!i.length)return this.hideList(),this.setBreakpointItems([]),this.didUpdateForTest();this.ensureListShown();const o=this.groupBreakpointLocationsById(i),r=this.getLocationIdsByLineId(i),s=await this.getContent(o),a=await this.getSelectedUILocation(),c=[];for(let e=0;e<o.length;e++){const t=o[e],i=t[0].uiLocation,n=null!==a&&t.some((e=>e.uiLocation.id()===a.id())),l="application/wasm"!==i.uiSourceCode.mimeType()&&r.get(i.lineId()).size>1,d=s[e];c.push(new qn(t,d,n,l))}return c.some((e=>e.isSelected))&&t.ViewManager.ViewManager.instance().showView("sources.jsBreakpoints"),this.list.element.classList.toggle("breakpoints-list-deactivated",!n.Settings.Settings.instance().moduleSetting("breakpointsActive").get()),this.setBreakpointItems(c),e&&this.focus(),this.didUpdateForTest()}setBreakpointItems(e){if(this.breakpoints.length===e.length)for(let t=0;t<this.breakpoints.length;t++)this.breakpoints.at(t).isSimilar(e[t])||this.breakpoints.replace(t,e[t],!0);else this.breakpoints.replaceAll(e);!this.list.selectedItem()&&this.breakpoints.at(0)&&this.list.selectItem(this.breakpoints.at(0))}createElementForItem(e){const i=document.createElement("div");i.classList.add("breakpoint-entry"),t.ARIAUtils.markAsListitem(i),i.tabIndex=this.list.selectedItem()===e?0:-1,i.addEventListener("contextmenu",this.breakpointContextMenu.bind(this),!0),i.addEventListener("click",this.revealLocation.bind(this,i),!1);const o=e.locations.some((e=>e.breakpoint.condition().includes(O))),n=e.locations.some((e=>Boolean(e.breakpoint.condition()))),r=i.createChild("div","decoration-and-content");o?r.classList.add("logpoint"):n&&r.classList.add("breakpoint-conditional");const a=t.UIUtils.CheckboxLabel.create(""),c=e.locations[0].uiLocation,l=e.locations.some((e=>e.breakpoint.enabled())),d=e.locations.some((e=>!e.breakpoint.enabled()));a.textElement.textContent=c.linkText()+(e.showColumn&&"number"==typeof c.columnNumber?":"+(c.columnNumber+1):""),a.checkboxElement.checked=l,a.checkboxElement.indeterminate=l&&d,a.checkboxElement.tabIndex=-1,a.addEventListener("click",this.breakpointCheckboxClicked.bind(this),!1),r.appendChild(a);let u=Hn(l?On.checked:On.unchecked);l&&d&&(u=Hn(On.mixed)),e.isSelected?(t.ARIAUtils.setDescription(r,Hn(On.sBreakpointHit,{PH1:u})),i.classList.add("breakpoint-hit"),this.setDefaultFocusedElement(i)):t.ARIAUtils.setDescription(r,u),i.addEventListener("keydown",(e=>{" "===e.key&&(a.checkboxElement.click(),e.consume(!0))}));const h=r.createChild("div","source-text monospace"),p=c.lineNumber;if(e.text&&p<e.text.lineCount()){const t=e.text.lineAt(p),i=200;h.textContent=s.StringUtilities.trimEndWithMaxLength(t.substring(e.showColumn&&c.columnNumber||0),i)}return Kn.set(i,e.locations),Gn.set(i,c),i}heightForItem(e){return 0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,o){i&&(i.tabIndex=-1),o&&(o.tabIndex=0,this.setDefaultFocusedElement(o),this.hasFocus()&&o.focus())}updateSelectedItemARIA(e,t){return!0}breakpointLocations(e){return e.target instanceof Element?this.breakpointLocationsForElement(e.target):[]}breakpointLocationsForElement(e){const t=e.enclosingNodeOrSelfWithClass("breakpoint-entry");return t&&Kn.get(t)||[]}breakpointCheckboxClicked(e){const t=this.hasFocus(),i=this.breakpointLocations(e).map((e=>e.breakpoint)),o=e.target.checkboxElement.checked;for(const e of i){e.setEnabled(o);const t=this.breakpoints.find((t=>t.locations.some((t=>t.breakpoint===e))));t&&(this.list.selectItem(t),this.list.refreshItem(t))}t&&this.focus(),e.consume()}revealLocation(e){const t=this.breakpointLocationsForElement(e).map((e=>e.uiLocation));let i=null;for(const e of t)(!i||e.compareTo(i)<0)&&(i=e);i&&n.Revealer.reveal(i)}breakpointContextMenu(e){const i=this.breakpointLocations(e).map((e=>e.breakpoint)),o=new t.ContextMenu.ContextMenu(e),r=i.length>1?Hn(On.removeAllBreakpointsInLine):Hn(On.removeBreakpoint);o.defaultSection().appendItem(r,(()=>i.map((e=>e.remove(!1))))),e.target instanceof Element&&o.defaultSection().appendItem(Hn(On.revealLocation),this.revealLocation.bind(this,e.target));const s=n.Settings.Settings.instance().moduleSetting("breakpointsActive").get(),a=Hn(s?On.deactivateBreakpoints:On.activateBreakpoints);if(o.defaultSection().appendItem(a,(()=>n.Settings.Settings.instance().moduleSetting("breakpointsActive").set(!s))),i.some((e=>!e.enabled()))){const t=Hn(On.enableAllBreakpoints);if(o.defaultSection().appendItem(t,this.toggleAllBreakpoints.bind(this,!0)),e.target instanceof Element){const t=Hn(On.enableBreakpointsInFile);o.defaultSection().appendItem(t,this.toggleAllBreakpointsInFile.bind(this,e.target,!0))}}if(i.some((e=>e.enabled()))){const t=Hn(On.disableAllBreakpoints);if(o.defaultSection().appendItem(t,this.toggleAllBreakpoints.bind(this,!1)),e.target instanceof Element){const t=Hn(On.disableBreakpointsInFile);o.defaultSection().appendItem(t,this.toggleAllBreakpointsInFile.bind(this,e.target,!1))}}const c=Hn(On.removeAllBreakpoints);o.defaultSection().appendItem(c,this.removeAllBreakpoints.bind(this));const l=Hn(On.removeOtherBreakpoints);o.defaultSection().appendItem(l,this.removeOtherBreakpoints.bind(this,new Set(i))),o.show()}toggleAllBreakpointsInFile(e,t){const i=this.getBreakpointLocations(),o=this.breakpointLocationsForElement(e);i.forEach((e=>{o.some((t=>t.breakpoint.url()===e.breakpoint.url()))&&e.breakpoint.setEnabled(t)}))}toggleAllBreakpoints(e){for(const t of this.breakpointManager.allBreakpointLocations())t.breakpoint.setEnabled(e)}removeAllBreakpoints(){for(const e of this.breakpointManager.allBreakpointLocations())e.breakpoint.remove(!1)}removeOtherBreakpoints(e){for(const t of this.breakpointManager.allBreakpointLocations())e.has(t.breakpoint)||t.breakpoint.remove(!1)}flavorChanged(e){this.update()}didUpdateForTest(){}wasShown(){super.wasShown(),this.registerCSSFiles([Wn])}}class qn{locations;text;isSelected;showColumn;constructor(e,t,i,o){this.locations=e,this.text=t,this.isSelected=i,this.showColumn=o}isSimilar(e){return this.locations.length===e.locations.length&&this.locations.every(((t,i)=>t.uiLocation===e.locations[i].uiLocation))&&this.locations.every(((t,i)=>t.breakpoint===e.locations[i].breakpoint))&&(this.text===e.text||this.text&&e.text&&this.text.value()===e.text.value())&&this.isSelected===e.isSelected&&this.showColumn===e.showColumn}}const Gn=new WeakMap;const Kn=new WeakMap;var $n=Object.freeze({__proto__:null,JavaScriptBreakpointsSidebarPane:zn,retrieveLocationForElement:function(e){return Gn.get(e)}});let Jn;class Yn extends yn{static instance(e={forceNew:null}){const{forceNew:t}=e;return Jn&&!t||(Jn=new Yn),Jn}attach(){this.setDefaultScores(co.defaultUISourceCodeScores()),super.attach()}uiSourceCodeSelected(e,t,i){r.userMetrics.actionTaken(r.UserMetrics.Action.SelectFileFromFilePicker),e&&("number"==typeof t?n.Revealer.reveal(e.uiLocation(t,i)):n.Revealer.reveal(e))}filterProject(e){return!e.isServiceProject()}renderItem(e,t,i,o){super.renderItem(e,t,i,o);const n=new w.Icon.Icon,r=T(this.itemContentTypeAt(e));n.data={iconName:r,color:"var(--icon-color)",width:"18px",height:"18px"},n.classList.add(r),i.parentElement?.parentElement?.insertBefore(n,i.parentElement)}renderAsTwoRows(){return!0}}var Xn=Object.freeze({__proto__:null,OpenFileQuickOpen:Yn});const Qn={noFileSelected:"No file selected.",openAJavascriptOrCssFileToSee:"Open a JavaScript or CSS file to see symbols",noResultsFound:"No results found"},Zn=e.i18n.registerUIStrings("panels/sources/OutlineQuickOpen.ts",Qn),er=e.i18n.getLocalizedString.bind(void 0,Zn);let tr;class ir extends f.FilteredListWidget.Provider{items;active;constructor(){super(),this.items=[],this.active=!1}static instance(e={forceNew:null}){const{forceNew:t}=e;return tr&&!t||(tr=new ir),tr}attach(){this.items=[],this.active=!1;const e=this.currentUISourceCode();e&&(this.active=u.FormatterWorkerPool.formatterWorkerPool().outlineForMimetype(e.workingCopy(),e.contentType().canonicalMimeType(),this.didBuildOutlineChunk.bind(this)))}didBuildOutlineChunk(e,t){this.items.push(...t),this.refresh()}itemCount(){return this.items.length}itemKeyAt(e){const t=this.items[e];return t.title+(t.subtitle?t.subtitle:"")}itemScoreAt(e,t){const i=this.items[e];return t.split("(")[0].toLowerCase()===i.title.toLowerCase()?1/(1+i.line):-i.line-1}renderItem(e,t,i,o){const n=this.items[e];i.textContent=n.title+(n.subtitle?n.subtitle:""),f.FilteredListWidget.FilteredListWidget.highlightRanges(i,t);const r=i.parentElement?.parentElement?.createChild("span","tag");r&&(r.textContent=":"+(n.line+1))}selectItem(e,t){if(null===e)return;const i=this.currentUISourceCode();if(!i)return;const o=this.items[e].line;!isNaN(o)&&o>=0&&n.Revealer.reveal(i.uiLocation(o,this.items[e].column))}currentUISourceCode(){const e=t.Context.Context.instance().flavor(co);return e?e.currentUISourceCode():null}notFoundText(){return this.currentUISourceCode()?this.active?er(Qn.noResultsFound):er(Qn.openAJavascriptOrCssFileToSee):er(Qn.noFileSelected)}}var or=Object.freeze({__proto__:null,OutlineQuickOpen:ir});const nr=new CSSStyleSheet;nr.replaceSync(".scope-chain-sidebar-pane-section-header{flex:auto}.scope-chain-sidebar-pane-section-icon{float:left;margin-right:5px}.scope-chain-sidebar-pane-section-subtitle{float:right;margin-left:5px;max-width:55%;text-overflow:ellipsis;overflow:hidden}.scope-chain-sidebar-pane-section-title{font-weight:400;word-wrap:break-word;white-space:normal}.scope-chain-sidebar-pane-section{padding:2px 4px;flex:none}\n/*# sourceURL=scopeChainSidebarPane.css */\n");const rr={loading:"Loading...",notPaused:"Not paused",noVariables:"No variables",closureS:"Closure ({PH1})",closure:"Closure",exception:"Exception",returnValue:"Return value",revealInMemoryInspectorPanel:"Reveal in Memory Inspector panel",couldNotOpenLinearMemory:"Could not open linear memory inspector: failed locating buffer."},sr=e.i18n.registerUIStrings("panels/sources/ScopeChainSidebarPane.ts",rr),ar=e.i18n.getLocalizedString.bind(void 0,sr);let cr,lr;class dr extends t.Widget.VBox{treeOutline;expandController;linkifier;infoElement;constructor(){super(!0),this.treeOutline=new b.ObjectPropertiesSection.ObjectPropertiesSectionsTreeOutline,this.treeOutline.setShowSelectionOnKeyboardFocus(!0),this.expandController=new b.ObjectPropertiesSection.ObjectPropertiesSectionsTreeExpandController(this.treeOutline),this.linkifier=new y.Linkifier.Linkifier,this.infoElement=document.createElement("div"),this.infoElement.className="gray-info-message",this.infoElement.tabIndex=-1,this.update()}static instance(){return cr||(cr=new dr),cr}flavorChanged(e){this.update()}focus(){this.hasFocus()||t.Context.Context.instance().flavor(a.DebuggerModel.DebuggerPausedDetails)&&this.treeOutline.forceSelect()}async update(){this.infoElement.textContent=ar(rr.loading),this.contentElement.removeChildren(),this.contentElement.appendChild(this.infoElement),this.linkifier.reset();const e=t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame),[i,o]=await Promise.all([Ao(e),Mo(e)]);if(e===t.Context.Context.instance().flavor(a.DebuggerModel.CallFrame)){const n=t.Context.Context.instance().flavor(a.DebuggerModel.DebuggerPausedDetails);if(this.treeOutline.removeChildren(),!n||!e||!o)return void(this.infoElement.textContent=ar(rr.notPaused));this.contentElement.removeChildren(),this.contentElement.appendChild(this.treeOutline.element);let r=!1;for(let t=0;t<o.length;++t){const s=o[t],a=this.extraPropertiesForScope(s,n,e,i,0===t);"local"===s.type()&&(r=!0);const c=this.createScopeSectionTreeElement(s,a);"global"===s.type()?c.collapse():r&&"local"!==s.type()||c.expand(),this.treeOutline.appendChild(c),0===t&&c.select(!0)}this.sidebarPaneUpdatedForTest()}}createScopeSectionTreeElement(e,i){let o=null;e.type(),o=ar(rr.noVariables);let n=e.typeName();if("closure"===e.type()){const i=e.name();n=i?ar(rr.closureS,{PH1:t.UIUtils.beautifyFunctionName(i)}):ar(rr.closure)}let r=e.description();n&&n!==r||(r=null);const s=e.icon(),a=document.createElement("div");if(a.classList.add("scope-chain-sidebar-pane-section-header"),a.classList.add("tree-element-title"),s){const e=document.createElement("img");e.classList.add("scope-chain-sidebar-pane-section-icon"),e.src=s,a.appendChild(e)}a.createChild("div","scope-chain-sidebar-pane-section-subtitle").textContent=r,a.createChild("div","scope-chain-sidebar-pane-section-title").textContent=n;const c=new b.ObjectPropertiesSection.RootElement(Bo(e),this.linkifier,o,0,i);return c.title=a,c.listItemElement.classList.add("scope-chain-sidebar-pane-section"),c.listItemElement.setAttribute("aria-label",n),this.expandController.watchSection(n+(r?":"+r:""),c),c}extraPropertiesForScope(e,t,i,o,n){if("local"!==e.type()||i.script.isWasm())return[];const r=[];if(o&&r.push(new a.RemoteObject.RemoteObjectProperty("this",o,void 0,void 0,void 0,void 0,void 0,!0)),n){const e=t.exception();e&&r.push(new a.RemoteObject.RemoteObjectProperty(ar(rr.exception),e,void 0,void 0,void 0,void 0,void 0,!0));const o=i.returnValue();o&&r.push(new a.RemoteObject.RemoteObjectProperty(ar(rr.returnValue),o,void 0,void 0,void 0,void 0,void 0,!0,i.setReturnValue.bind(i)))}return r}sidebarPaneUpdatedForTest(){}wasShown(){super.wasShown(),this.treeOutline.registerCSSFiles([nr]),this.registerCSSFiles([nr])}}class ur extends t.Widget.VBox{static instance(e={forceNew:null}){const{forceNew:t}=e;return lr&&!t||(lr=new ur),lr}isMemoryObjectProperty(e){if("object"===e.type&&e.subtype&&L.LinearMemoryInspectorController.ACCEPTED_MEMORY_TYPES.includes(e.subtype))return!0;if(e instanceof c.DebuggerLanguagePlugins.ValueNode){return void 0!==e.inspectableAddress}return!1}appendApplicableItems(e,t,i){i instanceof b.ObjectPropertiesSection.ObjectPropertyTreeElement&&i.property&&i.property.value&&this.isMemoryObjectProperty(i.property.value)&&t.debugSection().appendItem(ar(rr.revealInMemoryInspectorPanel),this.openMemoryInspector.bind(this,i.property.value))}async openMemoryInspector(e){const t=L.LinearMemoryInspectorController.LinearMemoryInspectorController.instance();let i=0,o=e;if(e instanceof c.DebuggerLanguagePlugins.ValueNode){const t=e;i=t.inspectableAddress||0;const r=t.callFrame,s=await e.debuggerModel().agent.invoke_evaluateOnCallFrame({callFrameId:r.id,expression:"memories[0]"}),a=s.getError();a&&(console.error(a),n.Console.Console.instance().error(ar(rr.couldNotOpenLinearMemory)));o=e.debuggerModel().runtimeModel().createRemoteObject(s.result)}r.userMetrics.linearMemoryInspectorRevealedFrom(r.UserMetrics.LinearMemoryInspectorRevealedFrom.ContextMenu),t.openInspectorView(o,i)}}var hr=Object.freeze({__proto__:null,ScopeChainSidebarPane:dr,OpenLinearMemoryInspector:ur});const pr=new CSSStyleSheet;pr.replaceSync(".value.object-value-node:hover{background-color:var(--item-hover-color)}.object-value-boolean,.object-value-function-prefix{color:var(--color-syntax-3)}.object-value-function{font-style:italic}.object-value-function.linkified:hover{--override-linkified-hover-background:rgb(0 0 0 / 10%);background-color:var(--override-linkified-hover-background);cursor:pointer}.-theme-with-dark-background .object-value-function.linkified:hover,:host-context(.-theme-with-dark-background) .object-value-function.linkified:hover{--override-linkified-hover-background:rgb(230 230 230 / 10%)}.object-value-number{color:var(--color-syntax-3)}.object-value-bigint{color:var(--color-syntax-6)}.object-value-regexp,.object-value-string,.object-value-symbol{white-space:pre;unicode-bidi:-webkit-isolate;color:var(--color-syntax-1)}.object-value-node{position:relative;vertical-align:baseline;color:var(--color-syntax-7);display:inline-block}.object-value-with-memory-icon{display:inline-flex}.object-value-arraybuffer devtools-icon,.object-value-dataview devtools-icon,.object-value-typedarray devtools-icon,.object-value-webassemblymemory devtools-icon{cursor:pointer}.object-value-null,.object-value-undefined{color:var(--color-text-disabled)}.object-value-calculate-value-button:hover{text-decoration:underline}.object-properties-section-custom-section{display:inline-flex;flex-direction:column}.-theme-with-dark-background .object-value-boolean,.-theme-with-dark-background .object-value-number,:host-context(.-theme-with-dark-background) .object-value-boolean,:host-context(.-theme-with-dark-background) .object-value-number{--override-primitive-dark-mode-color:hsl(252deg 100% 75%);color:var(--override-primitive-dark-mode-color)}.object-properties-section .object-description{color:var(--color-text-secondary)}.value .object-properties-preview{white-space:nowrap}.name{color:var(--color-syntax-2);flex-shrink:0}.object-properties-preview .name{color:var(--color-text-secondary)}@media (forced-colors:active){.object-value-calculate-value-button:hover{forced-color-adjust:none;color:Highlight}}\n/*# sourceURL=objectValue.css */\n");const gr=new CSSStyleSheet;gr.replaceSync(".watch-expression-delete-button{position:absolute;top:5px;cursor:pointer;opacity:0%}.right-aligned{right:16px}.left-aligned{left:-11px}.watch-expression-title:hover .watch-expression-delete-button{opacity:100%}.watch-expressions{overflow-x:hidden;min-height:26px}.watch-expression-title{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;line-height:20px}.watch-expression-title:hover{padding-right:26px}.watch-expression-object-header .watch-expression-title{margin-left:1px}.watch-expression{position:relative;flex:auto;min-height:20px}.watch-expressions .name{--override-watch-expression-name-color:rgb(136 19 145);color:var(--override-watch-expression-name-color);flex:none;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.-theme-with-dark-background .watch-expressions .name,:host-context(.-theme-with-dark-background) .watch-expressions .name{--override-watch-expression-name-color:rgb(227 110 236)}.watch-expression-error{color:var(--color-red)}.watch-expressions-separator{flex:none}.watch-expressions .value{white-space:nowrap;display:inline}.watch-expression .text-prompt{text-overflow:clip;overflow:hidden;white-space:nowrap;padding-left:4px;min-height:18px;line-height:18px;user-select:text}.watch-expression-text-prompt-proxy{margin:2px 12px 2px -4px;padding-bottom:3px}.watch-expression-header{flex:auto;margin-left:-16px;padding-left:15px}li.watch-expression-tree-item{padding-left:4px}li.watch-expression-tree-item:hover{background-color:var(--color-background-elevation-1)}.watch-expression-header:focus-visible{background:var(--legacy-focus-bg-color)}li.watch-expression-editing::before{background-color:transparent}@media (forced-colors:active){.watch-expression-title:hover .watch-expression-delete-button,.watch-expressions .dimmed{opacity:100%}li.watch-expression-tree-item *{forced-color-adjust:none;color:ButtonText}li.watch-expression-tree-item:hover{forced-color-adjust:none;background-color:Highlight}li.watch-expression-tree-item:hover *{color:HighlightText}}\n/*# sourceURL=watchExpressionsSidebarPane.css */\n");const mr={addWatchExpression:"Add watch expression",refreshWatchExpressions:"Refresh watch expressions",noWatchExpressions:"No watch expressions",deleteAllWatchExpressions:"Delete all watch expressions",addPropertyPathToWatch:"Add property path to watch",deleteWatchExpression:"Delete watch expression",notAvailable:"<not available>",copyValue:"Copy value"},br=e.i18n.registerUIStrings("panels/sources/WatchExpressionsSidebarPane.ts",mr),fr=e.i18n.getLocalizedString.bind(void 0,br);let vr;class Sr extends t.ThrottledWidget.ThrottledWidget{watchExpressions;emptyElement;watchExpressionsSetting;addButton;refreshButton;treeOutline;expandController;linkifier;constructor(){super(!0),this.watchExpressions=[],this.watchExpressionsSetting=n.Settings.Settings.instance().createLocalSetting("watchExpressions",[]),this.addButton=new t.Toolbar.ToolbarButton(fr(mr.addWatchExpression),"largeicon-add"),this.addButton.addEventListener(t.Toolbar.ToolbarButton.Events.Click,(e=>{this.addButtonClicked()})),this.refreshButton=new t.Toolbar.ToolbarButton(fr(mr.refreshWatchExpressions),"largeicon-refresh"),this.refreshButton.addEventListener(t.Toolbar.ToolbarButton.Events.Click,this.update,this),this.contentElement.classList.add("watch-expressions"),this.contentElement.addEventListener("contextmenu",this.contextMenu.bind(this),!1),this.treeOutline=new b.ObjectPropertiesSection.ObjectPropertiesSectionsTreeOutline,this.treeOutline.setShowSelectionOnKeyboardFocus(!0),this.expandController=new b.ObjectPropertiesSection.ObjectPropertiesSectionsTreeExpandController(this.treeOutline),t.Context.Context.instance().addFlavorChangeListener(a.RuntimeModel.ExecutionContext,this.update,this),t.Context.Context.instance().addFlavorChangeListener(a.DebuggerModel.CallFrame,this.update,this),this.linkifier=new y.Linkifier.Linkifier,this.update()}static instance(){return vr||(vr=new Sr),vr}toolbarItems(){return[this.addButton,this.refreshButton]}focus(){this.hasFocus()||this.watchExpressions.length>0&&this.treeOutline.forceSelect()}hasExpressions(){return Boolean(this.watchExpressionsSetting.get().length)}saveExpressions(){const e=[];for(let t=0;t<this.watchExpressions.length;t++){const i=this.watchExpressions[t].expression();i&&e.push(i)}this.watchExpressionsSetting.set(e)}async addButtonClicked(){await t.ViewManager.ViewManager.instance().showView("sources.watch"),this.emptyElement.classList.add("hidden"),this.createWatchExpression(null).startEditing()}doUpdate(){this.linkifier.reset(),this.contentElement.removeChildren(),this.treeOutline.removeChildren(),this.watchExpressions=[],this.emptyElement=this.contentElement.createChild("div","gray-info-message"),this.emptyElement.textContent=fr(mr.noWatchExpressions),this.emptyElement.tabIndex=-1;const e=this.watchExpressionsSetting.get();e.length&&this.emptyElement.classList.add("hidden");for(let t=0;t<e.length;++t){const i=e[t];i&&this.createWatchExpression(i)}return Promise.resolve()}createWatchExpression(e){this.contentElement.appendChild(this.treeOutline.element);const t=new Cr(e,this.expandController,this.linkifier);return t.addEventListener("ExpressionUpdated",this.watchExpressionUpdated,this),this.treeOutline.appendChild(t.treeElement()),this.watchExpressions.push(t),t}watchExpressionUpdated({data:e}){e.expression()||(s.ArrayUtilities.removeElement(this.watchExpressions,e),this.treeOutline.removeChild(e.treeElement()),this.emptyElement.classList.toggle("hidden",Boolean(this.watchExpressions.length)),0===this.watchExpressions.length&&this.treeOutline.element.remove()),this.saveExpressions()}contextMenu(e){const i=new t.ContextMenu.ContextMenu(e);this.populateContextMenu(i,e),i.show()}populateContextMenu(e,t){let i=!1;for(const e of this.watchExpressions)i=i||e.isEditing();i||e.debugSection().appendItem(fr(mr.addWatchExpression),this.addButtonClicked.bind(this)),this.watchExpressions.length>1&&e.debugSection().appendItem(fr(mr.deleteAllWatchExpressions),this.deleteAllButtonClicked.bind(this));const o=this.treeOutline.treeElementFromEvent(t);if(!o)return;const n=this.watchExpressions.find((e=>o.hasAncestorOrSelf(e.treeElement())));n&&n.populateContextMenu(e,t)}deleteAllButtonClicked(){this.watchExpressions=[],this.saveExpressions(),this.update()}async focusAndAddExpressionToWatch(e){await t.ViewManager.ViewManager.instance().showView("sources.watch"),this.createWatchExpression(e),this.saveExpressions(),this.update()}handleAction(e,i){const o=t.Context.Context.instance().flavor(Bi);if(!o)return!1;const{state:n}=o.textEditor,r=n.sliceDoc(n.selection.main.from,n.selection.main.to);return this.focusAndAddExpressionToWatch(r),!0}appendApplicableItems(e,i,o){globalThis.chii||o instanceof b.ObjectPropertiesSection.ObjectPropertyTreeElement&&!o.property.synthetic&&i.debugSection().appendItem(fr(mr.addPropertyPathToWatch),(()=>this.focusAndAddExpressionToWatch(o.path())));const n=t.Context.Context.instance().flavor(Bi);n&&!n.textEditor.state.selection.main.empty&&i.debugSection().appendAction("sources.add-to-watch")}wasShown(){super.wasShown(),this.treeOutline.registerCSSFiles([gr]),this.registerCSSFiles([gr,pr])}}class Cr extends n.ObjectWrapper.ObjectWrapper{treeElementInternal;nameElement;valueElement;expressionInternal;expandController;element;editing;linkifier;textPrompt;result;preventClickTimeout;resizeObserver;constructor(e,t,i){super(),this.expressionInternal=e,this.expandController=t,this.element=document.createElement("div"),this.element.classList.add("watch-expression"),this.element.classList.add("monospace"),this.editing=!1,this.linkifier=i,this.createWatchExpression(),this.update()}treeElement(){return this.treeElementInternal}expression(){return this.expressionInternal}update(){const e=t.Context.Context.instance().flavor(a.RuntimeModel.ExecutionContext);e&&this.expressionInternal?e.evaluate({expression:this.expressionInternal,objectGroup:Cr.watchObjectGroupId,includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0,throwOnSideEffect:void 0,timeout:void 0},!1,!1).then((e=>{"object"in e?this.createWatchExpression(e.object,e.exceptionDetails):this.createWatchExpression()})):this.createWatchExpression()}startEditing(){this.editing=!0,this.treeElementInternal.setDisableSelectFocus(!0),this.element.removeChildren();const e=this.element.createChild("div");e.textContent=this.nameElement.textContent,this.textPrompt=new b.ObjectPropertiesSection.ObjectPropertyPrompt,this.textPrompt.renderAsBlock();const t=this.textPrompt.attachAndStartEditing(e,this.finishEditing.bind(this));this.treeElementInternal.listItemElement.classList.add("watch-expression-editing"),this.treeElementInternal.collapse(),t.classList.add("watch-expression-text-prompt-proxy"),t.addEventListener("keydown",this.promptKeyDown.bind(this),!1);const i=this.element.getComponentSelection();i&&i.selectAllChildren(e)}isEditing(){return Boolean(this.editing)}finishEditing(e,t){if(e&&e.consume(t),this.editing=!1,this.treeElementInternal.setDisableSelectFocus(!1),this.treeElementInternal.listItemElement.classList.remove("watch-expression-editing"),this.textPrompt){this.textPrompt.detach();const e=t?this.expressionInternal:this.textPrompt.text();this.textPrompt=void 0,this.element.removeChildren(),this.updateExpression(e)}}dblClickOnWatchExpression(e){e.consume(),this.isEditing()||this.startEditing()}updateExpression(e){this.expressionInternal&&this.expandController.stopWatchSectionsWithId(this.expressionInternal),this.resizeObserver?.disconnect(),this.expressionInternal=e,this.update(),this.dispatchEventToListeners("ExpressionUpdated",this)}deleteWatchExpression(e){e.consume(!0),this.updateExpression(null)}createWatchExpression(e,t){this.result=e||null,this.element.removeChildren();const i=this.treeElementInternal;if(this.createWatchExpressionTreeElement(e,t),i&&i.parent){const e=i.parent,t=e.indexOfChild(i);e.removeChild(i),e.insertChild(this.treeElementInternal,t)}this.treeElementInternal.select()}createWatchExpressionHeader(e,i){const o=this.element.createChild("div","watch-expression-header"),n=t.Icon.Icon.create("smallicon-cross","watch-expression-delete-button");this.resizeObserver=new ResizeObserver((e=>{e.forEach((e=>{e.contentRect.width<55?(n.classList.remove("right-aligned"),n.classList.add("left-aligned")):(n.classList.remove("left-aligned"),n.classList.add("right-aligned"))}))})),this.resizeObserver.observe(o),t.Tooltip.Tooltip.install(n,fr(mr.deleteWatchExpression)),n.addEventListener("click",this.deleteWatchExpression.bind(this),!1);const r=o.createChild("div","watch-expression-title tree-element-title");if(r.appendChild(n),this.nameElement=b.ObjectPropertiesSection.ObjectPropertiesSection.createNameElement(this.expressionInternal),Boolean(i)||!e)this.valueElement=document.createElement("span"),this.valueElement.classList.add("watch-expression-error"),this.valueElement.classList.add("value"),r.classList.add("dimmed"),this.valueElement.textContent=fr(mr.notAvailable),void 0!==i&&void 0!==i.exception&&void 0!==i.exception.description&&t.Tooltip.Tooltip.install(this.valueElement,i.exception.description);else{const t=b.ObjectPropertiesSection.ObjectPropertiesSection.createPropertyValueWithCustomSupport(e,Boolean(i),!1,r,this.linkifier);this.valueElement=t.element}const s=document.createElement("span");return s.classList.add("watch-expressions-separator"),s.textContent=": ",r.append(this.nameElement,s,this.valueElement),o}createWatchExpressionTreeElement(e,i){const o=this.createWatchExpressionHeader(e,i);!i&&e&&e.hasChildren&&!e.customPreview()?(o.classList.add("watch-expression-object-header"),this.treeElementInternal=new b.ObjectPropertiesSection.RootElement(e,this.linkifier),this.expandController.watchSection(this.expressionInternal,this.treeElementInternal),this.treeElementInternal.toggleOnClick=!1,this.treeElementInternal.listItemElement.addEventListener("click",this.onSectionClick.bind(this),!1),this.treeElementInternal.listItemElement.addEventListener("dblclick",this.dblClickOnWatchExpression.bind(this))):(o.addEventListener("dblclick",this.dblClickOnWatchExpression.bind(this)),this.treeElementInternal=new t.TreeOutline.TreeElement),this.treeElementInternal.title=this.element,this.treeElementInternal.listItemElement.classList.add("watch-expression-tree-item"),this.treeElementInternal.listItemElement.addEventListener("keydown",(e=>{"Enter"!==e.key||this.isEditing()||(this.startEditing(),e.consume(!0))}))}onSectionClick(e){e.consume(!0);1===e.detail?this.preventClickTimeout=window.setTimeout(function(){if(!this.treeElementInternal)return;this.treeElementInternal.expanded?this.treeElementInternal.collapse():this.editing||this.treeElementInternal.expand()}.bind(this),333):void 0!==this.preventClickTimeout&&(window.clearTimeout(this.preventClickTimeout),this.preventClickTimeout=void 0)}promptKeyDown(e){("Enter"===e.key||isEscKey(e))&&this.finishEditing(e,isEscKey(e))}populateContextMenu(e,i){this.isEditing()||e.editSection().appendItem(fr(mr.deleteWatchExpression),this.updateExpression.bind(this,null)),this.isEditing()||!this.result||"number"!==this.result.type&&"string"!==this.result.type||e.clipboardSection().appendItem(fr(mr.copyValue),this.copyValueButtonClicked.bind(this));const o=t.UIUtils.deepElementFromEvent(i);o&&this.valueElement.isSelfOrAncestor(o)&&this.result&&e.appendApplicableItems(this.result)}copyValueButtonClicked(){r.InspectorFrontendHost.InspectorFrontendHostInstance.copyText(this.valueElement.textContent)}static watchObjectGroupId="watch-group"}var wr=Object.freeze({__proto__:null,WatchExpressionsSidebarPane:Sr,WatchExpression:Cr});export{B as AddSourceMapURLDialog,_ as BreakpointEditDialog,ie as CallStackSidebarPane,be as CoveragePlugin,xe as DebuggerPausedMessage,Sn as DebuggerPlugin,Te as EditingLocationHistoryManager,wn as FilePathScoreFunction,En as FilteredUISourceCodeListProvider,Dn as GoToLineQuickOpen,jn as InplaceFormatterEditorAction,$n as JavaScriptBreakpointsSidebarPane,ot as JavaScriptCompilerPlugin,Wt as NavigatorView,Xn as OpenFileQuickOpen,or as OutlineQuickOpen,ne as Plugin,hr as ScopeChainSidebarPane,xo as ScriptFormatterEditorAction,ct as ScriptOriginPlugin,xt as SearchSourcesView,pt as SnippetsPlugin,jo as SourceMapNamesResolver,ti as SourcesNavigator,Ai as SourcesPanel,St as SourcesSearchScope,vo as SourcesView,no as TabbedEditorContainer,ci as ThreadsSidebarPane,Ki as UISourceCodeFrame,wr as WatchExpressionsSidebarPane};
