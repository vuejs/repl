import*as e from"../../core/common/common.js";import*as t from"../../core/i18n/i18n.js";import*as s from"../../core/platform/platform.js";import*as i from"../../core/sdk/sdk.js";import*as o from"../../ui/legacy/legacy.js";import*as n from"../../models/text_utils/text_utils.js";import*as r from"../../third_party/codemirror.next/codemirror.next.js";import*as l from"../../ui/components/text_editor/text_editor.js";import*as a from"../../ui/legacy/components/object_ui/object_ui.js";import*as c from"../../ui/legacy/components/utils/utils.js";import*as h from"../../models/bindings/bindings.js";import*as d from"../../models/logs/logs.js";import*as u from"../../models/workspace/workspace.js";import*as m from"../../ui/components/code_highlighter/code_highlighter.js";import*as p from"../../ui/components/issue_counter/issue_counter.js";import*as g from"../../ui/components/request_link_icon/request_link_icon.js";import*as v from"../../ui/legacy/components/data_grid/data_grid.js";import*as f from"../../ui/legacy/theme_support/theme_support.js";import*as b from"../../core/host/host.js";import*as C from"../../models/issues_manager/issues_manager.js";const x=new CSSStyleSheet;x.replaceSync(":host{padding:2px 1px 2px 2px;white-space:nowrap;display:flex;flex-direction:column;height:36px;justify-content:center;overflow-y:auto}.title{overflow:hidden;text-overflow:ellipsis;flex-grow:0}.badge{pointer-events:none;margin-right:4px;display:inline-block;height:15px}.subtitle{color:var(--color-text-secondary);margin-right:3px;overflow:hidden;text-overflow:ellipsis;flex-grow:0}:host(.highlighted) .subtitle{color:inherit}\n/*# sourceURL=consoleContextSelector.css */\n");const w={javascriptContextNotSelected:"JavaScript context: Not selected",extension:"Extension",javascriptContextS:"JavaScript context: {PH1}"},S=t.i18n.registerUIStrings("panels/console/ConsoleContextSelector.ts",w),I=t.i18n.getLocalizedString.bind(void 0,S);class E{items;dropDown;toolbarItemInternal;constructor(){this.items=new o.ListModel.ListModel,this.dropDown=new o.SoftDropDown.SoftDropDown(this.items,this),this.dropDown.setRowHeight(36),this.toolbarItemInternal=new o.Toolbar.ToolbarItem(this.dropDown.element),this.toolbarItemInternal.setEnabled(!1),this.toolbarItemInternal.setTitle(I(w.javascriptContextNotSelected)),this.items.addEventListener(o.ListModel.Events.ItemsReplaced,(()=>this.toolbarItemInternal.setEnabled(Boolean(this.items.length)))),this.toolbarItemInternal.element.classList.add("toolbar-has-dropdown"),i.TargetManager.TargetManager.instance().addModelListener(i.RuntimeModel.RuntimeModel,i.RuntimeModel.Events.ExecutionContextCreated,this.onExecutionContextCreated,this),i.TargetManager.TargetManager.instance().addModelListener(i.RuntimeModel.RuntimeModel,i.RuntimeModel.Events.ExecutionContextChanged,this.onExecutionContextChanged,this),i.TargetManager.TargetManager.instance().addModelListener(i.RuntimeModel.RuntimeModel,i.RuntimeModel.Events.ExecutionContextDestroyed,this.onExecutionContextDestroyed,this),i.TargetManager.TargetManager.instance().addModelListener(i.ResourceTreeModel.ResourceTreeModel,i.ResourceTreeModel.Events.FrameNavigated,this.frameNavigated,this),o.Context.Context.instance().addFlavorChangeListener(i.RuntimeModel.ExecutionContext,this.executionContextChangedExternally,this),o.Context.Context.instance().addFlavorChangeListener(i.DebuggerModel.CallFrame,this.callFrameSelectedInUI,this),i.TargetManager.TargetManager.instance().observeModels(i.RuntimeModel.RuntimeModel,this),i.TargetManager.TargetManager.instance().addModelListener(i.DebuggerModel.DebuggerModel,i.DebuggerModel.Events.CallFrameSelected,this.callFrameSelectedInModel,this)}toolbarItem(){return this.toolbarItemInternal}highlightedItemChanged(e,t,s,o){if(i.OverlayModel.OverlayModel.hideDOMNodeHighlight(),t&&t.frameId){const e=i.FrameManager.FrameManager.instance().getFrame(t.frameId);e&&!e.isTopFrame()&&e.highlight()}s&&s.classList.remove("highlighted"),o&&o.classList.add("highlighted")}titleFor(e){const t=e.target(),s=e.label();let o=s?t.decorateLabel(s):"";if(e.frameId){const s=t.model(i.ResourceTreeModel.ResourceTreeModel),n=s&&s.frameForId(e.frameId);n&&(o=o||n.displayName())}return o=o||e.origin,o}depthFor(e){let t=e.target(),s=0;if(e.isDefault||s++,e.frameId){let o=i.FrameManager.FrameManager.instance().getFrame(e.frameId);for(;o;)o=o.parentFrame(),o&&(s++,t=o.resourceTreeModel().target())}let o=0,n=t.parentTarget();for(;n&&t.type()!==i.Target.Type.ServiceWorker;)o++,t=n,n=t.parentTarget();return s+=o,s}executionContextCreated(e){this.items.insertWithComparator(e,e.runtimeModel.executionContextComparator()),e===o.Context.Context.instance().flavor(i.RuntimeModel.ExecutionContext)&&this.dropDown.selectItem(e)}onExecutionContextCreated(e){const t=e.data;this.executionContextCreated(t)}onExecutionContextChanged(e){const t=e.data;-1!==this.items.indexOf(t)&&(this.executionContextDestroyed(t),this.executionContextCreated(t))}executionContextDestroyed(e){const t=this.items.indexOf(e);-1!==t&&this.items.remove(t)}onExecutionContextDestroyed(e){const t=e.data;this.executionContextDestroyed(t)}executionContextChangedExternally({data:e}){this.dropDown.selectItem(e)}isTopContext(e){if(!e||!e.isDefault)return!1;const t=e.target().model(i.ResourceTreeModel.ResourceTreeModel),s=e.frameId&&t&&t.frameForId(e.frameId);return!!s&&s.isTopFrame()}hasTopContext(){return this.items.some((e=>this.isTopContext(e)))}modelAdded(e){e.executionContexts().forEach(this.executionContextCreated,this)}modelRemoved(e){for(let t=this.items.length-1;t>=0;t--)this.items.at(t).runtimeModel===e&&this.executionContextDestroyed(this.items.at(t))}createElementForItem(e){const t=document.createElement("div"),i=o.Utils.createShadowRootWithCoreStyles(t,{cssFile:[x],delegatesFocus:void 0}),n=i.createChild("div","title");o.UIUtils.createTextChild(n,s.StringUtilities.trimEndWithMaxLength(this.titleFor(e),100));const r=i.createChild("div","subtitle");return o.UIUtils.createTextChild(r,this.subtitleFor(e)),t.style.paddingLeft=8+15*this.depthFor(e)+"px",t}subtitleFor(t){const s=t.target();let o=null;if(t.frameId){const e=s.model(i.ResourceTreeModel.ResourceTreeModel);o=e&&e.frameForId(t.frameId)}if(t.origin.startsWith("chrome-extension://"))return I(w.extension);const n=o&&o.sameTargetParentFrame();if(!o||!n||n.securityOrigin!==t.origin){const s=e.ParsedURL.ParsedURL.fromString(t.origin);if(s)return s.domain()}if(o&&o.securityOrigin){const t=new e.ParsedURL.ParsedURL(o.securityOrigin).domain();if(t)return t}return"IFrame"}isItemSelectable(e){const t=e.debuggerModel.selectedCallFrame(),s=t&&t.script.executionContext();return!s||e===s}itemSelected(e){this.toolbarItemInternal.element.classList.toggle("highlight",!this.isTopContext(e)&&this.hasTopContext());const t=e?I(w.javascriptContextS,{PH1:this.titleFor(e)}):I(w.javascriptContextNotSelected);this.toolbarItemInternal.setTitle(t),o.Context.Context.instance().setFlavor(i.RuntimeModel.ExecutionContext,e)}callFrameSelectedInUI(){const e=o.Context.Context.instance().flavor(i.DebuggerModel.CallFrame),t=e&&e.script.executionContext();t&&o.Context.Context.instance().setFlavor(i.RuntimeModel.ExecutionContext,t)}callFrameSelectedInModel(e){const t=e.data;for(const e of this.items)e.debuggerModel===t&&this.dropDown.refreshItem(e)}frameNavigated(e){const t=e.data,s=t.resourceTreeModel().target().model(i.RuntimeModel.RuntimeModel);if(s)for(const e of s.executionContexts())t.id===e.frameId&&this.dropDown.refreshItem(e)}}var M,T=Object.freeze({__proto__:null,ConsoleContextSelector:E});class y{name;parsedFilters;executionContext;levelsMask;constructor(e,t,s,i){this.name=e,this.parsedFilters=t,this.executionContext=s,this.levelsMask=i||y.defaultLevelsFilterValue()}static allLevelsFilterValue(){const e={},t={Verbose:"verbose",Info:"info",Warning:"warning",Error:"error"};for(const s of Object.values(t))e[s]=!0;return e}static defaultLevelsFilterValue(){const e=y.allLevelsFilterValue();return e.verbose=!1,e}static singleLevelMask(e){const t={};return t[e]=!0,t}clone(){const e=this.parsedFilters.map(n.TextUtils.FilterParser.cloneFilter),t=Object.assign({},this.levelsMask);return new y(this.name,e,this.executionContext,t)}shouldBeVisible(e){const t=e.consoleMessage();if(this.executionContext&&(this.executionContext.runtimeModel!==t.runtimeModel()||this.executionContext.id!==t.getExecutionContextId()))return!1;if(t.type===i.ConsoleModel.FrontendMessageType.Command||t.type===i.ConsoleModel.FrontendMessageType.Result||t.isGroupMessage())return!0;if(t.level&&!this.levelsMask[t.level])return!1;for(const o of this.parsedFilters)if(o.key)switch(o.key){case M.Context:if(!s(o,t.context,!1))return!1;break;case M.Source:if(!s(o,t.source?i.ConsoleModel.MessageSourceDisplayName.get(t.source):t.source,!0))return!1;break;case M.Url:if(!s(o,t.url,!1))return!1}else{if(o.regex&&e.matchesFilterRegex(o.regex)===o.negative)return!1;if(o.text&&e.matchesFilterText(o.text)===o.negative)return!1}return!0;function s(e,t,s){if(!e.text)return Boolean(t)===e.negative;if(!t)return!e.text==!e.negative;const i=e.text.toLowerCase(),o=t.toLowerCase();return(!s||o===i!==e.negative)&&!(!s&&o.includes(i)===e.negative)}}}!function(e){e.Context="context",e.Source="source",e.Url="url"}(M||(M={}));var k=Object.freeze({__proto__:null,ConsoleFilter:y,get FilterType(){return M}});const L=new CSSStyleSheet;L.replaceSync(".value.object-value-node:hover{background-color:var(--item-hover-color)}.object-value-boolean,.object-value-function-prefix{color:var(--color-syntax-3)}.object-value-function{font-style:italic}.object-value-function.linkified:hover{--override-linkified-hover-background:rgb(0 0 0 / 10%);background-color:var(--override-linkified-hover-background);cursor:pointer}.-theme-with-dark-background .object-value-function.linkified:hover,:host-context(.-theme-with-dark-background) .object-value-function.linkified:hover{--override-linkified-hover-background:rgb(230 230 230 / 10%)}.object-value-number{color:var(--color-syntax-3)}.object-value-bigint{color:var(--color-syntax-6)}.object-value-regexp,.object-value-string,.object-value-symbol{white-space:pre;unicode-bidi:-webkit-isolate;color:var(--color-syntax-1)}.object-value-node{position:relative;vertical-align:baseline;color:var(--color-syntax-7);display:inline-block}.object-value-with-memory-icon{display:inline-flex}.object-value-arraybuffer devtools-icon,.object-value-dataview devtools-icon,.object-value-typedarray devtools-icon,.object-value-webassemblymemory devtools-icon{cursor:pointer}.object-value-null,.object-value-undefined{color:var(--color-text-disabled)}.object-value-calculate-value-button:hover{text-decoration:underline}.object-properties-section-custom-section{display:inline-flex;flex-direction:column}.-theme-with-dark-background .object-value-boolean,.-theme-with-dark-background .object-value-number,:host-context(.-theme-with-dark-background) .object-value-boolean,:host-context(.-theme-with-dark-background) .object-value-number{--override-primitive-dark-mode-color:hsl(252deg 100% 75%);color:var(--override-primitive-dark-mode-color)}.object-properties-section .object-description{color:var(--color-text-secondary)}.value .object-properties-preview{white-space:nowrap}.name{color:var(--color-syntax-2);flex-shrink:0}.object-properties-preview .name{color:var(--color-text-secondary)}@media (forced-colors:active){.object-value-calculate-value-button:hover{forced-color-adjust:none;color:Highlight}}\n/*# sourceURL=objectValue.css */\n");const F=new CSSStyleSheet;F.replaceSync(".close-button{position:absolute;top:7px;left:5px}.console-pins{max-height:200px;overflow-y:auto;background:var(--color-background-elevation-1);--override-error-background-color:rgb(255 240 240);--override-error-border-color:rgb(225 214 214);--override-error-text-color:rgb(255 0 0)}.console-pins:not(:empty){border-bottom:1px solid var(--color-details-hairline)}.-theme-with-dark-background .console-pins,:host-context(.-theme-with-dark-background) .console-pins{--override-error-background-color:rgb(41 0 0);--override-error-border-color:rgb(92 0 0);--override-error-text-color:rgb(255 128 128)}.console-pin{position:relative;user-select:text;flex:none;padding:2px 0 6px 24px}.console-pin:not(:last-child){border-bottom:1px solid var(--color-background-elevation-2)}.console-pin.error-level:not(:focus-within){background-color:var(--override-error-background-color);color:var(--override-error-text-color)}.console-pin:not(:last-child).error-level:not(:focus-within){border-top:1px solid var(--override-error-border-color);border-bottom:1px solid var(--override-error-border-color);margin-top:-1px}.console-pin-name{margin-left:-4px;margin-bottom:1px;height:auto}.console-pin-name,.console-pin-preview{width:100%;text-overflow:ellipsis;white-space:nowrap;min-height:13px}.console-pin-preview{overflow:hidden}.console-delete-pin{position:absolute;top:8px;left:8px;opacity:70%;cursor:pointer}.console-delete-pin:focus-visible,.console-delete-pin:hover{opacity:100%}:host-context(.-theme-with-dark-background) .console-delete-pin{filter:brightness(2)}.console-pin-name:focus-within{background:var(--color-background);box-shadow:var(--legacy-focus-ring-active-shadow) inset}.console-pin-name:not(:focus-within):not(:hover),.console-pin:focus-within .console-pin-preview{opacity:60%}\n/*# sourceURL=consolePinPane.css */\n");const R={removeExpression:"Remove expression",removeAllExpressions:"Remove all expressions",removeExpressionS:"Remove expression: {PH1}",removeBlankExpression:"Remove blank expression",liveExpressionEditor:"Live expression editor",expression:"Expression",evaluateAllowingSideEffects:"Evaluate, allowing side effects",notAvailable:"not available"},P=t.i18n.registerUIStrings("panels/console/ConsolePinPane.ts",R),A=t.i18n.getLocalizedString.bind(void 0,P),B=new WeakMap;class H extends o.ThrottledWidget.ThrottledWidget{liveExpressionButton;focusOut;pins;pinsSetting;constructor(t,s){super(!0,250),this.liveExpressionButton=t,this.focusOut=s,this.contentElement.classList.add("console-pins","monospace"),this.contentElement.addEventListener("contextmenu",this.contextMenuEventFired.bind(this),!1),this.pins=new Set,this.pinsSetting=e.Settings.Settings.instance().createLocalSetting("consolePins",[]);for(const e of this.pinsSetting.get())this.addPin(e)}wasShown(){super.wasShown(),this.registerCSSFiles([F,L])}willHide(){for(const e of this.pins)e.setHovered(!1)}savePins(){const e=Array.from(this.pins).map((e=>e.expression()));this.pinsSetting.set(e)}contextMenuEventFired(e){const t=new o.ContextMenu.ContextMenu(e),s=o.UIUtils.deepElementFromEvent(e);if(s){const e=s.enclosingNodeOrSelfWithClass("console-pin");if(e){const s=B.get(e);s&&(t.editSection().appendItem(A(R.removeExpression),this.removePin.bind(this,s)),s.appendToContextMenu(t))}}t.editSection().appendItem(A(R.removeAllExpressions),this.removeAllPins.bind(this)),t.show()}removeAllPins(){for(const e of this.pins)this.removePin(e)}removePin(e){e.element().remove();const t=this.focusedPinAfterDeletion(e);this.pins.delete(e),this.savePins(),t?t.focus():this.liveExpressionButton.focus()}addPin(e,t){const s=new O(e,this,this.focusOut);this.contentElement.appendChild(s.element()),this.pins.add(s),this.savePins(),t&&s.focus(),this.update()}focusedPinAfterDeletion(e){const t=Array.from(this.pins);for(let s=0;s<t.length;s++)if(t[s]===e)return 1===t.length?null:s===t.length-1?t[s-1]:t[s+1];return null}async doUpdate(){if(!this.pins.size||!this.isShowing())return;this.isShowing()&&this.update();const e=Array.from(this.pins,(e=>e.updatePreview()));await Promise.all(e),this.updatedForTest()}updatedForTest(){}}class O{pinPane;focusOut;pinElement;pinPreview;lastResult;lastExecutionContext;editor;committedExpression;hovered;lastNode;deletePinIcon;constructor(t,s,i){this.pinPane=s,this.focusOut=i,this.deletePinIcon=document.createElement("div",{is:"dt-close-button"}),this.deletePinIcon.gray=!0,this.deletePinIcon.classList.add("close-button"),this.deletePinIcon.setTabbable(!0),t.length?this.deletePinIcon.setAccessibleName(A(R.removeExpressionS,{PH1:t})):this.deletePinIcon.setAccessibleName(A(R.removeBlankExpression)),self.onInvokeElement(this.deletePinIcon,(e=>{s.removePin(this),e.consume(!0)}));const n=o.Fragment.Fragment.build`
  <div class='console-pin'>
  ${this.deletePinIcon}
  <div class='console-pin-name' $='name'></div>
  <div class='console-pin-preview' $='preview'></div>
  </div>`;this.pinElement=n.element(),this.pinPreview=n.$("preview");const r=n.$("name");o.Tooltip.Tooltip.install(r,t),B.set(this.pinElement,this),this.lastResult=null,this.lastExecutionContext=null,this.committedExpression=t,this.hovered=!1,this.lastNode=null,this.editor=this.createEditor(t,r),this.pinPreview.addEventListener("mouseenter",this.setHovered.bind(this,!0),!1),this.pinPreview.addEventListener("mouseleave",this.setHovered.bind(this,!1),!1),this.pinPreview.addEventListener("click",(t=>{this.lastNode&&(e.Revealer.reveal(this.lastNode),t.consume())}),!1),r.addEventListener("keydown",(e=>{"Escape"===e.key&&e.consume()}))}createEditor(e,t){const s=new l.TextEditor.TextEditor(r.EditorState.create({doc:e,extensions:[r.EditorView.contentAttributes.of({"aria-label":A(R.liveExpressionEditor)}),r.EditorView.lineWrapping,r.javascript.javascriptLanguage,l.JavaScript.completion(),l.Config.showCompletionHint,r.placeholder(A(R.expression)),r.keymap.of([{key:"Escape",run:e=>(e.dispatch({changes:{from:0,to:e.state.doc.length,insert:this.committedExpression}}),this.focusOut(),!0)},{key:"Mod-Enter",run:()=>(this.focusOut(),!0)}]),r.EditorView.domEventHandlers({blur:(e,t)=>this.onBlur(t)}),l.Config.baseConfiguration(e),l.Config.closeBrackets,l.Config.autocompletion]}));return t.appendChild(s),s}onBlur(e){const t=e.state.doc.toString(),s=t.trim();this.committedExpression=s,this.pinPane.savePins(),this.committedExpression.length?this.deletePinIcon.setAccessibleName(A(R.removeExpressionS,{PH1:this.committedExpression})):this.deletePinIcon.setAccessibleName(A(R.removeBlankExpression)),e.dispatch({selection:{anchor:s.length},changes:s!==t?{from:0,to:t.length,insert:s}:void 0})}setHovered(e){this.hovered!==e&&(this.hovered=e,!e&&this.lastNode&&i.OverlayModel.OverlayModel.hideDOMNodeHighlight())}expression(){return this.committedExpression}element(){return this.pinElement}async focus(){const e=this.editor;e.editor.focus(),e.dispatch({selection:{anchor:e.state.doc.length}})}appendToContextMenu(e){this.lastResult&&!("error"in this.lastResult)&&this.lastResult.object&&(e.appendApplicableItems(this.lastResult.object),this.lastResult=null)}async updatePreview(){if(!this.editor)return;const e=l.Config.contentIncludingHint(this.editor.editor),t=this.pinElement.hasFocus(),s=t&&e!==this.committedExpression,n=s?250:void 0,r=o.Context.Context.instance().flavor(i.RuntimeModel.ExecutionContext),c=a.JavaScriptREPL.JavaScriptREPL.preprocessExpression(e),{preview:h,result:d}=await a.JavaScriptREPL.JavaScriptREPL.evaluateAndBuildPreview(c,s,!1,n,!t,"console",!0);this.lastResult&&this.lastExecutionContext&&this.lastExecutionContext.runtimeModel.releaseEvaluationResult(this.lastResult),this.lastResult=d||null,this.lastExecutionContext=r||null;const u=h.deepTextContent();if(!u||u!==this.pinPreview.deepTextContent()){if(this.pinPreview.removeChildren(),d&&i.RuntimeModel.RuntimeModel.isSideEffectFailure(d)){const e=this.pinPreview.createChild("span","object-value-calculate-value-button");e.textContent="(â€¦)",o.Tooltip.Tooltip.install(e,A(R.evaluateAllowingSideEffects))}else u?this.pinPreview.appendChild(h):t||o.UIUtils.createTextChild(this.pinPreview,A(R.notAvailable));o.Tooltip.Tooltip.install(this.pinPreview,u)}let m=null;d&&!("error"in d)&&"object"===d.object.type&&"node"===d.object.subtype&&(m=d.object),this.hovered&&(m?i.OverlayModel.OverlayModel.highlightObjectAsDOMNode(m):this.lastNode&&i.OverlayModel.OverlayModel.hideDOMNodeHighlight()),this.lastNode=m||null;const p=d&&!("error"in d)&&d.exceptionDetails&&!i.RuntimeModel.RuntimeModel.isSideEffectFailure(d);this.pinElement.classList.toggle("error-level",Boolean(p))}}var U=Object.freeze({__proto__:null,ConsolePinPane:H,ConsolePin:O});const V=new CSSStyleSheet;V.replaceSync(":host{overflow:auto;background-color:var(--color-background-elevation-1)}.tree-outline-disclosure{max-width:100%;padding-left:6px}.count{flex:none;margin:0 8px}[is=ui-icon]{margin:0 5px}li{height:24px}li .largeicon-navigator-file{margin:0}li .largeicon-navigator-folder{margin:-3px -3px 0 -5px}.tree-element-title{flex-shrink:100;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.tree-outline li:hover:not(.selected) .selection{display:block;background-color:var(--item-hover-color)}@media (forced-colors:active){[is=ui-icon].icon-mask{background-color:ButtonText}.tree-outline li:hover:not(.selected) .selection{forced-color-adjust:none;background-color:Highlight}.tree-outline li.selected .count,.tree-outline li.selected .tree-element-title,.tree-outline li:hover .count,.tree-outline li:hover .tree-element-title{forced-color-adjust:none;color:HighlightText}.tree-outline li.selected [is=ui-icon].icon-mask,.tree-outline li.selected:focus .spritesheet-mediumicons:not(.icon-mask),.tree-outline li:hover [is=ui-icon].icon-mask{background-color:HighlightText!important}}\n/*# sourceURL=consoleSidebar.css */\n");const N={other:"<other>",dUserMessages:"{n, plural, =0 {No user messages} =1 {# user message} other {# user messages}}",dMessages:"{n, plural, =0 {No messages} =1 {# message} other {# messages}}",dErrors:"{n, plural, =0 {No errors} =1 {# error} other {# errors}}",dWarnings:"{n, plural, =0 {No warnings} =1 {# warning} other {# warnings}}",dInfo:"{n, plural, =0 {No info} =1 {# info} other {# info}}",dVerbose:"{n, plural, =0 {No verbose} =1 {# verbose} other {# verbose}}"},j=t.i18n.registerUIStrings("panels/console/ConsoleSidebar.ts",N),G=t.i18n.getLocalizedString.bind(void 0,j);class D extends(e.ObjectWrapper.eventMixin(o.Widget.VBox)){tree;selectedTreeElement;treeElements;constructor(){super(!0),this.setMinimumSize(125,0),this.tree=new o.TreeOutline.TreeOutlineInShadow,this.tree.addEventListener(o.TreeOutline.Events.ElementSelected,this.selectionChanged.bind(this)),this.contentElement.appendChild(this.tree.element),this.selectedTreeElement=null,this.treeElements=[];const t=e.Settings.Settings.instance().createSetting("console.sidebarSelectedFilter",null),s=[{key:M.Source,text:i.ConsoleModel.FrontendMessageSource.ConsoleAPI,negative:!1,regex:void 0}];this.appendGroup("message",[],y.allLevelsFilterValue(),o.Icon.Icon.create("mediumicon-list"),t),this.appendGroup("user message",s,y.allLevelsFilterValue(),o.Icon.Icon.create("mediumicon-account-circle"),t),this.appendGroup("error",[],y.singleLevelMask("error"),o.Icon.Icon.create("mediumicon-error-circle"),t),this.appendGroup("warning",[],y.singleLevelMask("warning"),o.Icon.Icon.create("mediumicon-warning-triangle"),t),this.appendGroup("info",[],y.singleLevelMask("info"),o.Icon.Icon.create("mediumicon-info-circle"),t),this.appendGroup("verbose",[],y.singleLevelMask("verbose"),o.Icon.Icon.create("mediumicon-bug"),t);const n=t.get();(this.treeElements.find((e=>e.name()===n))||this.treeElements[0]).select()}appendGroup(e,t,s,i,o){const n=new y(e,t,null,s),r=new q(n,i,o);this.tree.appendChild(r),this.treeElements.push(r)}clear(){for(const e of this.treeElements)e.clear()}onMessageAdded(e){for(const t of this.treeElements)t.onMessageAdded(e)}shouldBeVisible(e){return!(this.selectedTreeElement instanceof W)||this.selectedTreeElement.filter().shouldBeVisible(e)}selectionChanged(e){this.selectedTreeElement=e.data,this.dispatchEventToListeners("FilterSelected")}wasShown(){super.wasShown(),this.tree.registerCSSFiles([V])}}class W extends o.TreeOutline.TreeElement{filterInternal;constructor(e,t){super(e),this.filterInternal=t}filter(){return this.filterInternal}}class z extends W{countElement;messageCount;constructor(e){super(e.name,e),this.countElement=this.listItemElement.createChild("span","count");const t=[o.Icon.Icon.create("largeicon-navigator-file")];this.setLeadingIcons(t),this.messageCount=0}incrementAndUpdateCounter(){this.messageCount++,this.countElement.textContent=`${this.messageCount}`}}const _=new Map([["user message",N.dUserMessages],["message",N.dMessages],["error",N.dErrors],["warning",N.dWarnings],["info",N.dInfo],["verbose",N.dVerbose]]);class q extends W{selectedFilterSetting;urlTreeElements;messageCount;uiStringForFilterCount;constructor(e,t,s){super(e.name,e),this.uiStringForFilterCount=_.get(e.name)||"",this.selectedFilterSetting=s,this.urlTreeElements=new Map,this.setLeadingIcons([t]),this.messageCount=0,this.updateCounter()}clear(){this.urlTreeElements.clear(),this.removeChildren(),this.messageCount=0,this.updateCounter()}name(){return this.filterInternal.name}onselect(e){return this.selectedFilterSetting.set(this.filterInternal.name),super.onselect(e)}updateCounter(){this.title=this.updateGroupTitle(this.messageCount),this.setExpandable(Boolean(this.childCount()))}updateGroupTitle(e){return this.uiStringForFilterCount?G(this.uiStringForFilterCount,{n:e}):""}onMessageAdded(e){const t=e.consoleMessage(),s=t.type!==i.ConsoleModel.FrontendMessageType.Command&&t.type!==i.ConsoleModel.FrontendMessageType.Result&&!t.isGroupMessage();if(!this.filterInternal.shouldBeVisible(e)||!s)return;this.childElement(t.url).incrementAndUpdateCounter(),this.messageCount++,this.updateCounter()}childElement(t){const s=t||null;let i=this.urlTreeElements.get(s);if(i)return i;const o=this.filterInternal.clone(),n=s?e.ParsedURL.ParsedURL.fromString(s):null;return o.name=s?n?n.displayName:s:G(N.other),o.parsedFilters.push({key:M.Url,text:s,negative:!1,regex:void 0}),i=new z(o),s&&(i.tooltip=s),this.urlTreeElements.set(s,i),this.appendChild(i),i}}var K=Object.freeze({__proto__:null,ConsoleSidebar:D,URLGroupTreeElement:z,FilterTreeElement:q});class ${element;topGapElement;topGapElementActive;contentElementInternal;bottomGapElement;bottomGapElementActive;provider;virtualSelectedIndex;firstActiveIndex;lastActiveIndex;renderedItems;anchorSelection;headSelection;itemCount;cumulativeHeights;muteCopyHandler;observer;observerConfig;stickToBottomInternal;selectionIsBackward;lastSelectedElement;cachedProviderElements;constructor(e){this.element=document.createElement("div"),this.element.style.overflow="auto",this.topGapElement=this.element.createChild("div"),this.topGapElement.style.height="0px",this.topGapElement.style.color="transparent",this.topGapElementActive=!1,this.contentElementInternal=this.element.createChild("div"),this.bottomGapElement=this.element.createChild("div"),this.bottomGapElement.style.height="0px",this.bottomGapElement.style.color="transparent",this.bottomGapElementActive=!1,this.topGapElement.textContent="\ufeff",this.bottomGapElement.textContent="\ufeff",o.ARIAUtils.markAsHidden(this.topGapElement),o.ARIAUtils.markAsHidden(this.bottomGapElement),this.provider=e,this.element.addEventListener("scroll",this.onScroll.bind(this),!1),this.element.addEventListener("copy",this.onCopy.bind(this),!1),this.element.addEventListener("dragstart",this.onDragStart.bind(this),!1),this.contentElementInternal.addEventListener("focusin",this.onFocusIn.bind(this),!1),this.contentElementInternal.addEventListener("focusout",this.onFocusOut.bind(this),!1),this.contentElementInternal.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.virtualSelectedIndex=-1,this.contentElementInternal.tabIndex=-1,this.firstActiveIndex=-1,this.lastActiveIndex=-1,this.renderedItems=[],this.anchorSelection=null,this.headSelection=null,this.itemCount=0,this.cumulativeHeights=new Int32Array(0),this.muteCopyHandler=!1,this.observer=new MutationObserver(this.refresh.bind(this)),this.observerConfig={childList:!0,subtree:!0},this.stickToBottomInternal=!1,this.selectionIsBackward=!1}stickToBottom(){return this.stickToBottomInternal}setStickToBottom(e){this.stickToBottomInternal=e,this.stickToBottomInternal?this.observer.observe(this.contentElementInternal,this.observerConfig):this.observer.disconnect()}hasVirtualSelection(){return-1!==this.virtualSelectedIndex}copyWithStyles(){this.muteCopyHandler=!0,this.element.ownerDocument.execCommand("copy"),this.muteCopyHandler=!1}onCopy(e){if(this.muteCopyHandler)return;const t=this.selectedText();t&&(e.preventDefault(),this.selectionContainsTable()?this.copyWithStyles():e.clipboardData&&e.clipboardData.setData("text/plain",t))}onFocusIn(e){const t=this.renderedItems.findIndex((t=>t.element().isSelfOrAncestor(e.target)));-1!==t&&(this.virtualSelectedIndex=this.firstActiveIndex+t);let s=!1;-1===this.virtualSelectedIndex&&this.isOutsideViewport(e.relatedTarget)&&e.target===this.contentElementInternal&&this.itemCount&&(s=!0,this.virtualSelectedIndex=this.itemCount-1,this.refresh(),this.scrollItemIntoView(this.virtualSelectedIndex)),this.updateFocusedItem(s)}onFocusOut(e){this.isOutsideViewport(e.relatedTarget)&&(this.virtualSelectedIndex=-1),this.updateFocusedItem()}isOutsideViewport(e){return null!==e&&!e.isSelfOrDescendant(this.contentElementInternal)}onDragStart(e){const t=this.selectedText();return!!t&&(e.dataTransfer&&(e.dataTransfer.clearData(),e.dataTransfer.setData("text/plain",t),e.dataTransfer.effectAllowed="copy"),!0)}onKeyDown(e){if(o.UIUtils.isEditing()||!this.itemCount||e.shiftKey)return;let t=!1;switch(e.key){case"ArrowUp":if(!(this.virtualSelectedIndex>0))return;t=!0,this.virtualSelectedIndex--;break;case"ArrowDown":if(!(this.virtualSelectedIndex<this.itemCount-1))return;this.virtualSelectedIndex++;break;case"Home":this.virtualSelectedIndex=0;break;case"End":this.virtualSelectedIndex=this.itemCount-1;break;default:return}e.consume(!0),this.scrollItemIntoView(this.virtualSelectedIndex),this.updateFocusedItem(t)}updateFocusedItem(e){const t=this.renderedElementAt(this.virtualSelectedIndex),s=this.lastSelectedElement!==t,i=this.contentElementInternal===this.element.ownerDocument.deepActiveElement();this.lastSelectedElement&&s&&this.lastSelectedElement.classList.remove("console-selected"),t&&(e||s||i)&&this.element.hasFocus()&&(t.classList.add("console-selected"),e?(this.setStickToBottom(!1),this.renderedItems[this.virtualSelectedIndex-this.firstActiveIndex].focusLastChildOrSelf()):t.hasFocus()||t.focus({preventScroll:!0})),this.itemCount&&!this.contentElementInternal.hasFocus()?this.contentElementInternal.tabIndex=0:this.contentElementInternal.tabIndex=-1,this.lastSelectedElement=t}contentElement(){return this.contentElementInternal}invalidate(){delete this.cachedProviderElements,this.itemCount=this.provider.itemCount(),this.virtualSelectedIndex>this.itemCount-1&&(this.virtualSelectedIndex=this.itemCount-1),this.rebuildCumulativeHeights(),this.refresh()}providerElement(e){this.cachedProviderElements||(this.cachedProviderElements=new Array(this.itemCount));let t=this.cachedProviderElements[e];return t||(t=this.provider.itemElement(e),this.cachedProviderElements[e]=t),t}rebuildCumulativeHeights(){const e=this.firstActiveIndex,t=this.lastActiveIndex;let s=0;this.cumulativeHeights=new Int32Array(this.itemCount);for(let i=0;i<this.itemCount;++i)e<=i&&i-e<this.renderedItems.length&&i<=t?s+=this.renderedItems[i-e].element().offsetHeight:s+=this.provider.fastHeight(i),this.cumulativeHeights[i]=s}rebuildCumulativeHeightsIfNeeded(){let e=0,t=0;for(let s=0;s<this.renderedItems.length;++s){const i=this.cachedItemHeight(this.firstActiveIndex+s),o=this.renderedItems[s].element().offsetHeight;if(Math.abs(i-o)>1)return void this.rebuildCumulativeHeights();if(t+=o,e+=i,Math.abs(e-t)>1)return void this.rebuildCumulativeHeights()}}cachedItemHeight(e){return 0===e?this.cumulativeHeights[0]:this.cumulativeHeights[e]-this.cumulativeHeights[e-1]}isSelectionBackwards(e){if(!(e&&e.rangeCount&&e.anchorNode&&e.focusNode))return!1;const t=document.createRange();return t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t.collapsed}createSelectionModel(e,t,s){return{item:e,node:t,offset:s}}updateSelectionModel(e){const t=e&&e.rangeCount?e.getRangeAt(0):null;if(!t||!e||e.isCollapsed||!this.element.hasSelection())return this.headSelection=null,this.anchorSelection=null,!1;let s=Number.MAX_VALUE,i=-1,o=!1;for(let e=0;e<this.renderedItems.length;++e)if(t.intersectsNode(this.renderedItems[e].element())){const t=e+this.firstActiveIndex;s=Math.min(s,t),i=Math.max(i,t),o=!0}const n=t.intersectsNode(this.topGapElement)&&this.topGapElementActive,r=t.intersectsNode(this.bottomGapElement)&&this.bottomGapElementActive;if(!n&&!r&&!o)return this.headSelection=null,this.anchorSelection=null,!1;this.anchorSelection&&this.headSelection||(this.anchorSelection=this.createSelectionModel(0,this.element,0),this.headSelection=this.createSelectionModel(this.itemCount-1,this.element,this.element.children.length),this.selectionIsBackward=!1);const l=this.isSelectionBackwards(e),a=this.selectionIsBackward?this.headSelection:this.anchorSelection,c=this.selectionIsBackward?this.anchorSelection:this.headSelection;let h=null,d=null;return o&&(h=this.createSelectionModel(s,t.startContainer,t.startOffset),d=this.createSelectionModel(i,t.endContainer,t.endOffset)),n&&r&&o?(h=h&&h.item<a.item?h:a,d=d&&d.item>c.item?d:c):o?n?h=l?this.headSelection:this.anchorSelection:r&&(d=l?this.anchorSelection:this.headSelection):(h=a,d=c),l?(this.anchorSelection=d,this.headSelection=h):(this.anchorSelection=h,this.headSelection=d),this.selectionIsBackward=l,!0}restoreSelection(e){if(!e||!this.anchorSelection||!this.headSelection)return;const t=(e,t)=>{if(this.firstActiveIndex<=e.item&&e.item<=this.lastActiveIndex)return{element:e.node,offset:e.offset};return{element:e.item<this.firstActiveIndex?this.topGapElement:this.bottomGapElement,offset:t?1:0}},{element:s,offset:i}=t(this.anchorSelection,Boolean(this.selectionIsBackward)),{element:o,offset:n}=t(this.headSelection,!this.selectionIsBackward);e.setBaseAndExtent(s,i,o,n)}selectionContainsTable(){if(!this.anchorSelection||!this.headSelection)return!1;const e=this.selectionIsBackward?this.headSelection.item:this.anchorSelection.item,t=this.selectionIsBackward?this.anchorSelection.item:this.headSelection.item;for(let s=e;s<=t;s++){const e=this.providerElement(s);if(e&&"table"===e.consoleMessage().type)return!0}return!1}refresh(){this.observer.disconnect(),this.innerRefresh(),this.stickToBottomInternal&&this.observer.observe(this.contentElementInternal,this.observerConfig)}innerRefresh(){if(!this.visibleHeight())return;if(!this.itemCount){for(let e=0;e<this.renderedItems.length;++e)this.renderedItems[e].willHide();return this.renderedItems=[],this.contentElementInternal.removeChildren(),this.topGapElement.style.height="0px",this.bottomGapElement.style.height="0px",this.firstActiveIndex=-1,this.lastActiveIndex=-1,void this.updateFocusedItem()}const e=this.element.getComponentSelection(),t=this.updateSelectionModel(e),i=this.element.scrollTop,o=this.visibleHeight(),n=2*o;this.rebuildCumulativeHeightsIfNeeded(),this.stickToBottomInternal?(this.firstActiveIndex=Math.max(this.itemCount-Math.ceil(n/this.provider.minimumRowHeight()),0),this.lastActiveIndex=this.itemCount-1):(this.firstActiveIndex=Math.max(s.ArrayUtilities.lowerBound(this.cumulativeHeights,i+1-(n-o)/2,s.ArrayUtilities.DEFAULT_COMPARATOR),0),this.lastActiveIndex=this.firstActiveIndex+Math.ceil(n/this.provider.minimumRowHeight())-1,this.lastActiveIndex=Math.min(this.lastActiveIndex,this.itemCount-1));const r=this.cumulativeHeights[this.firstActiveIndex-1]||0,l=this.cumulativeHeights[this.cumulativeHeights.length-1]-this.cumulativeHeights[this.lastActiveIndex];this.partialViewportUpdate(function(){this.topGapElement.style.height=r+"px",this.bottomGapElement.style.height=l+"px",this.topGapElementActive=Boolean(r),this.bottomGapElementActive=Boolean(l),this.contentElementInternal.style.setProperty("height","10000000px")}.bind(this)),this.contentElementInternal.style.removeProperty("height"),t&&this.restoreSelection(e),this.stickToBottomInternal&&(this.element.scrollTop=1e7)}partialViewportUpdate(e){const t=new Set;for(let e=this.firstActiveIndex;e<=this.lastActiveIndex;++e){const s=this.providerElement(e);console.assert(Boolean(s),"Expected provider element to be defined"),s&&t.add(s)}const s=this.renderedItems.filter((e=>!t.has(e)));for(let e=0;e<s.length;++e)s[e].willHide();e();let i=!1;for(let e=0;e<s.length;++e)i=i||s[e].element().hasFocus(),s[e].element().remove();const o=[];let n=this.contentElementInternal.firstChild;for(const e of t){const t=e.element();if(t!==n){!t.parentElement&&o.push(e),this.contentElementInternal.insertBefore(t,n)}else n=n.nextSibling}for(let e=0;e<o.length;++e)o[e].wasShown();this.renderedItems=Array.from(t),i&&this.contentElementInternal.focus(),this.updateFocusedItem()}selectedText(){if(this.updateSelectionModel(this.element.getComponentSelection()),!this.headSelection||!this.anchorSelection)return null;let e=null,t=null;this.selectionIsBackward?(e=this.headSelection,t=this.anchorSelection):(e=this.anchorSelection,t=this.headSelection);const s=[];for(let i=e.item;i<=t.item;++i){const e=this.providerElement(i);if(console.assert(Boolean(e)),!e)continue;const t=e.element().childTextNodes().map(c.Linkifier.Linkifier.untruncatedNodeText).join("");s.push(t)}const i=this.providerElement(t.item),o=i&&i.element();if(o&&t.node&&t.node.isSelfOrDescendant(o)){const e=this.textOffsetInNode(o,t.node,t.offset);s.length>0&&(s[s.length-1]=s[s.length-1].substring(0,e))}const n=this.providerElement(e.item),r=n&&n.element();if(r&&e.node&&e.node.isSelfOrDescendant(r)){const t=this.textOffsetInNode(r,e.node,e.offset);s[0]=s[0].substring(t)}return s.join("\n")}textOffsetInNode(e,t,s){const i=t.textContent?t.textContent.length:0;t.nodeType!==Node.TEXT_NODE&&(s<t.childNodes.length?(t=t.childNodes.item(s),s=0):s=i);let o=0,n=e;for(;(n=n.traverseNextNode(e))&&n!==t;)n.nodeType!==Node.TEXT_NODE||n.parentElement&&("STYLE"===n.parentElement.nodeName||"SCRIPT"===n.parentElement.nodeName)||(o+=c.Linkifier.Linkifier.untruncatedNodeText(n).length);const r=c.Linkifier.Linkifier.untruncatedNodeText(t).length;return s>0&&r!==i&&(s=r),o+s}onScroll(e){this.refresh()}firstVisibleIndex(){return this.cumulativeHeights.length?(this.rebuildCumulativeHeightsIfNeeded(),s.ArrayUtilities.lowerBound(this.cumulativeHeights,this.element.scrollTop+1,s.ArrayUtilities.DEFAULT_COMPARATOR)):-1}lastVisibleIndex(){if(!this.cumulativeHeights.length)return-1;this.rebuildCumulativeHeightsIfNeeded();const e=this.element.scrollTop+this.element.clientHeight,t=this.itemCount-1;return s.ArrayUtilities.lowerBound(this.cumulativeHeights,e,s.ArrayUtilities.DEFAULT_COMPARATOR,void 0,t)}renderedElementAt(e){return-1===e||e<this.firstActiveIndex||e>this.lastActiveIndex?null:this.renderedItems[e-this.firstActiveIndex].element()}scrollItemIntoView(e,t){const s=this.firstVisibleIndex(),i=this.lastVisibleIndex();e>s&&e<i||e===i&&this.cumulativeHeights[e]<=this.element.scrollTop+this.visibleHeight()||(t?this.forceScrollItemToBeLast(e):e<=s?this.forceScrollItemToBeFirst(e):e>=i&&this.forceScrollItemToBeLast(e))}forceScrollItemToBeFirst(e){console.assert(e>=0&&e<this.itemCount,"Cannot scroll item at invalid index"),this.setStickToBottom(!1),this.rebuildCumulativeHeightsIfNeeded(),this.element.scrollTop=e>0?this.cumulativeHeights[e-1]:0,o.UIUtils.isScrolledToBottom(this.element)&&this.setStickToBottom(!0),this.refresh();const t=this.renderedElementAt(e);t&&t.scrollIntoView(!0)}forceScrollItemToBeLast(e){console.assert(e>=0&&e<this.itemCount,"Cannot scroll item at invalid index"),this.setStickToBottom(!1),this.rebuildCumulativeHeightsIfNeeded(),this.element.scrollTop=this.cumulativeHeights[e]-this.visibleHeight(),o.UIUtils.isScrolledToBottom(this.element)&&this.setStickToBottom(!0),this.refresh();const t=this.renderedElementAt(e);t&&t.scrollIntoView(!1)}visibleHeight(){return this.element.offsetHeight}}var J=Object.freeze({__proto__:null,ConsoleViewport:$});const X=new CSSStyleSheet;X.replaceSync('.console-view{background-color:var(--color-background);overflow:hidden;--override-error-text-color:var(--color-error-text);--override-console-error-background-color:var(--color-error-background);--override-error-border-color:var(--color-error-border);--override-message-border-color:rgb(240 240 240);--override-warning-border-color:hsl(50deg 100% 88%);--override-focused-message-border-color:hsl(214deg 67% 88%);--override-focused-message-background-color:hsl(214deg 48% 95%);--override-console-warning-background-color:hsl(50deg 100% 95%);--override-console-warning-text-color:hsl(39deg 100% 18%)}.-theme-with-dark-background .console-view{--override-message-border-color:rgb(58 58 58);--override-warning-border-color:rgb(102 85 0);--override-focused-message-border-color:hsl(214deg 47% 48%);--override-focused-message-background-color:hsl(214deg 19% 20%);--override-console-warning-background-color:hsl(50deg 100% 10%);--override-console-warning-text-color:hsl(39deg 89% 55%)}.console-toolbar-container{display:flex;flex:none}.console-main-toolbar{flex:1 1 auto}.console-toolbar-container>.toolbar{background-color:var(--color-background-elevation-1);border-bottom:var(--legacy-divider-border)}.console-view-fix-select-all{height:0;overflow:hidden}.console-settings-pane{flex:none;background-color:var(--color-background-elevation-1);border-bottom:var(--legacy-divider-border)}.console-settings-pane .toolbar{flex:1 1}#console-messages{flex:1 1;overflow-y:auto;word-wrap:break-word;user-select:text;transform:translateZ(0);overflow-anchor:none;background-color:var(--color-background)}#console-prompt{clear:right;position:relative;margin:0 22px 0 20px}.console-prompt-editor-container{min-height:21px}.console-message,.console-user-command{clear:right;position:relative;padding:3px 22px 1px 0;margin-left:24px;min-height:17px;flex:auto;display:flex}.console-message>*{flex:auto}.console-timestamp{color:var(--color-text-secondary);user-select:none;flex:none;margin-right:5px}.command-result-icon,.message-level-icon{position:absolute;left:-17px;top:4px;user-select:none}.console-message-repeat-count{margin:2px 0 0 10px;flex:none}.repeated-message{margin-left:4px}.repeated-message .message-level-icon{display:none}.console-message-stack-trace-toggle{display:flex;flex-direction:row;align-items:flex-start}.repeated-message .console-message-stack-trace-toggle,.repeated-message>.console-message-text{flex:1}.console-error-level .repeated-message,.console-info-level .repeated-message,.console-verbose-level .repeated-message,.console-warning-level .repeated-message{display:flex}.console-info{color:var(--color-text-secondary);font-style:italic;padding-bottom:2px}.console-group .console-group>.console-group-messages{margin-left:16px}.console-group-title.console-from-api{font-weight:700}.console-group-title .console-message{margin-left:12px}.expand-group-icon{user-select:none;flex:none;position:relative;left:10px;top:5px;margin-right:2px}.console-group-title .message-level-icon{display:none}.console-message-repeat-count .expand-group-icon{left:2px;top:2px;background-color:var(--color-background);margin-right:4px}.console-group{position:relative}.console-message-wrapper{display:flex;border-top:1px solid var(--override-message-border-color);border-bottom:1px solid transparent}.console-message-wrapper:first-of-type{border-top-color:transparent}.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level){border-top-width:0}.console-message-wrapper:last-of-type{border-bottom-color:var(--override-message-border-color)}.console-message-wrapper:focus{border-top-color:var(--override-focused-message-border-color);border-bottom-color:var(--override-focused-message-border-color);background-color:var(--override-focused-message-background-color)}.console-message-wrapper:focus+.console-message-wrapper{border-top-color:transparent}.console-message-wrapper.console-error-level,.console-message-wrapper.console-error-level:not(:focus)+.console-message-wrapper:not(.console-warning-level):not(:focus){border-top-color:var(--override-error-border-color)}.console-message-wrapper.console-warning-level,.console-message-wrapper.console-warning-level:not(:focus)+.console-message-wrapper:not(.console-error-level):not(:focus){border-top-color:var(--override-warning-border-color)}.console-message-wrapper.console-error-level:last-of-type{border-bottom-color:var(--override-error-border-color)}.console-message-wrapper.console-warning-level:last-of-type{border-bottom-color:var(--override-warning-border-color)}.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus{border-top-width:1px}.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus .console-message{padding-top:2px;min-height:16px}.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus .command-result-icon{top:3px}.console-message-wrapper.console-error-level:focus{--override-error-text-color:rgb(200 0 0)}.-theme-with-dark-background .console-message-wrapper.console-error-level:focus{--override-error-text-color:hsl(0deg 100% 75%)}.console-message-wrapper .nesting-level-marker{width:14px;flex:0 0 auto;border-right:1px solid var(--color-details-hairline);position:relative;margin-bottom:-1px;margin-top:-1px}.console-message-wrapper .nesting-level-marker::before{border-bottom:1px solid var(--color-details-hairline);position:absolute;top:0;left:0;margin-left:100%;width:3px;height:100%;box-sizing:border-box}.console-message-wrapper .nesting-level-marker.group-closed::before,.console-message-wrapper:last-child .nesting-level-marker::before{content:""}.console-error-level{background-color:var(--override-console-error-background-color)}.console-warning-level{background-color:var(--override-console-warning-background-color)}.console-warning-level .console-message-text{color:var(--override-console-warning-text-color)}.console-view-object-properties-section{padding:0;position:relative;vertical-align:baseline;color:inherit;display:inline-block;overflow-wrap:break-word;max-width:100%}.info-note{background-color:var(--color-primary-variant)}.info-note::before{content:"i"}.console-view-object-properties-section:not(.expanded) .info-note{display:none}.console-error-level .console-message-text,.console-error-level .console-view-object-properties-section{color:var(--override-error-text-color)!important}.console-system-type.console-info-level{color:#00f}.-theme-with-dark-background .console-system-type.console-info-level,.-theme-with-dark-background .console-verbose-level:not(.console-warning-level) .console-message-text{color:hsl(220deg 100% 65%)!important}#console-messages .link{cursor:pointer;text-decoration:underline}#console-messages .devtools-link,#console-messages .link{color:var(--color-text-secondary);word-break:break-all}#console-messages .resource-links{vertical-align:bottom}#console-messages .devtools-link:hover,#console-messages .link:hover{color:var(--color-text-primary)}.console-object-preview{white-space:normal;word-wrap:break-word;font-style:italic}.console-object-preview .name{flex-shrink:0}.console-message-text .object-value-regexp,.console-message-text .object-value-string,.console-message-text .object-value-symbol{white-space:pre-wrap;word-break:break-all}.console-message-formatted-table{clear:both}.console-message .source-code{line-height:1.2}.console-message-anchor{float:right;text-align:right;max-width:100%;margin-left:4px}.console-message-badge{float:right;margin-left:4px}.console-message-nowrap-below,.console-message-nowrap-below div,.console-message-nowrap-below span{white-space:nowrap!important}.object-state-note{display:inline-block;width:11px;height:11px;color:var(--color-background);text-align:center;border-radius:3px;line-height:13px;margin:0 6px;font-size:9px}.-theme-with-dark-background .object-state-note{background-color:hsl(230deg 100% 80%)}.console-object{white-space:pre-wrap;word-break:break-all}.console-message-stack-trace-wrapper{flex:1 1 auto;display:flex;flex-direction:column;align-items:stretch}.console-message-stack-trace-wrapper>*{flex:none}.console-message-expand-icon{margin-bottom:-2px}.console-searchable-view{max-height:100%}.console-view-pinpane{flex:none;max-height:50%}.message-count{width:0;height:0}@media (forced-colors:active){.console-message-expand-icon,.console-warning-level [is=ui-icon].icon-mask.expand-group-icon{forced-color-adjust:none;background-color:ButtonText}.console-message-wrapper:focus,.console-message-wrapper:focus:last-of-type{forced-color-adjust:none;background-color:Highlight;border-top-color:Highlight;border-bottom-color:Highlight}.console-message-wrapper:focus *,.console-message-wrapper:focus .devtools-link,.console-message-wrapper:focus:last-of-type *,.console-message-wrapper:focus:last-of-type .devtools-link{color:HighlightText!important}#console-messages .devtools-link,#console-messages .devtools-link:hover{color:linktext}#console-messages .devtools-link:focus-visible,#console-messages .link:focus-visible{background:Highlight;color:HighlightText}.console-message-wrapper:focus [is=ui-icon].icon-mask{background-color:HighlightText}.console-message-wrapper.console-error-level:focus,.console-message-wrapper.console-error-level:focus:last-of-type{--override-error-text-color:HighlightText}}\n/*# sourceURL=consoleView.css */\n');const Z={consoleclearWasPreventedDueTo:"`console.clear()` was prevented due to 'Preserve log'",consoleWasCleared:"Console was cleared",clearAllMessagesWithS:"Clear all messages with {PH1}",assertionFailed:"Assertion failed: ",violationS:"`[Violation]` {PH1}",interventionS:"`[Intervention]` {PH1}",deprecationS:"`[Deprecation]` {PH1}",thisValueWillNotBeCollectedUntil:"This value will not be collected until console is cleared.",thisValueWasEvaluatedUponFirst:"This value was evaluated upon first expanding. It may have changed since then.",functionWasResolvedFromBound:"Function was resolved from bound function.",exception:"<exception>",warning:"Warning",error:"Error",repeatS:"{n, plural, =1 {Repeated # time} other {Repeated # times}}",warningS:"{n, plural, =1 {Warning, Repeated # time} other {Warning, Repeated # times}}",errorS:"{n, plural, =1 {Error, Repeated # time} other {Error, Repeated # times}}",url:"<URL>",tookNms:"took <N>ms",someEvent:"<some> event",Mxx:" M<XX>",attribute:"<attribute>",index:"(index)",value:"Value",console:"Console",stackMessageExpanded:"Stack table expanded",stackMessageCollapsed:"Stack table collapsed"},Q=t.i18n.registerUIStrings("panels/console/ConsoleViewMessage.ts",Z),Y=t.i18n.getLocalizedString.bind(void 0,Q),ee=new WeakMap,te=e=>ee.get(e),se=e=>t=>t instanceof i.RemoteObject.RemoteObject?t:e?"object"==typeof t?e.createRemoteObject(t):e.createRemoteObjectFromPrimitiveValue(t):i.RemoteObject.RemoteObject.fromLocalObject(t);class ie{message;linkifier;repeatCountInternal;closeGroupDecorationCount;nestingLevelInternal;selectableChildren;messageResized;elementInternal;previewFormatter;searchRegexInternal;messageLevelIcon;traceExpanded;expandTrace;anchorElement;contentElementInternal;nestingLevelMarkers;searchHighlightNodes;searchHighlightNodeChanges;isVisibleInternal;cachedHeight;messagePrefix;timestampElement;inSimilarGroup;similarGroupMarker;lastInSimilarGroup;groupKeyInternal;repeatCountElement;requestResolver;issueResolver;constructor(e,t,s,i,o,n){this.message=e,this.linkifier=t,this.requestResolver=s,this.issueResolver=i,this.repeatCountInternal=1,this.closeGroupDecorationCount=0,this.nestingLevelInternal=o,this.selectableChildren=[],this.messageResized=n,this.elementInternal=null,this.previewFormatter=new a.RemoteObjectPreviewFormatter.RemoteObjectPreviewFormatter,this.searchRegexInternal=null,this.messageLevelIcon=null,this.traceExpanded=!1,this.expandTrace=null,this.anchorElement=null,this.contentElementInternal=null,this.nestingLevelMarkers=null,this.searchHighlightNodes=[],this.searchHighlightNodeChanges=[],this.isVisibleInternal=!1,this.cachedHeight=0,this.messagePrefix="",this.timestampElement=null,this.inSimilarGroup=!1,this.similarGroupMarker=null,this.lastInSimilarGroup=!1,this.groupKeyInternal="",this.repeatCountElement=null}element(){return this.toMessageElement()}wasShown(){this.isVisibleInternal=!0}onResize(){}willHide(){this.isVisibleInternal=!1,this.cachedHeight=this.element().offsetHeight}isVisible(){return this.isVisibleInternal}fastHeight(){return this.cachedHeight?this.cachedHeight:this.approximateFastHeight()}approximateFastHeight(){return 19}consoleMessage(){return this.message}buildMessage(){let t,s=this.message.messageText;if(this.message.source===i.ConsoleModel.FrontendMessageSource.ConsoleAPI)switch(this.message.type){case"trace":t=this.format(this.message.parameters||["console.trace"]);break;case"clear":t=document.createElement("span"),t.classList.add("console-info"),e.Settings.Settings.instance().moduleSetting("preserveConsoleLog").get()?t.textContent=Y(Z.consoleclearWasPreventedDueTo):t.textContent=Y(Z.consoleWasCleared),o.Tooltip.Tooltip.install(t,Y(Z.clearAllMessagesWithS,{PH1:String(o.ShortcutRegistry.ShortcutRegistry.instance().shortcutTitleForAction("console.clear"))}));break;case"dir":{const e=["%O",this.message.parameters?this.message.parameters[0]:void 0];t=this.format(e);break}case"profile":case"profileEnd":t=this.format([s]);break;default:{if("assert"===this.message.type&&(this.messagePrefix=Y(Z.assertionFailed)),this.message.parameters&&1===this.message.parameters.length){const e=this.message.parameters[0];"string"!=typeof e&&"string"===e.type&&(t=this.tryFormatAsError(e.value))}const e=this.message.parameters||[s];t=t||this.format(e)}}else if("network"===this.message.source)t=this.formatAsNetworkRequest()||this.format([s]);else{const e=this.message.parameters&&s===this.message.parameters[0];"violation"===this.message.source?s=Y(Z.violationS,{PH1:s}):"intervention"===this.message.source?s=Y(Z.interventionS,{PH1:s}):"deprecation"===this.message.source&&(s=Y(Z.deprecationS,{PH1:s}));const i=this.message.parameters||[s];e&&(i[0]=s),t=this.format(i)}t.classList.add("console-message-text");const n=document.createElement("span");return n.classList.add("source-code"),this.anchorElement=this.buildMessageAnchor(),this.anchorElement&&n.appendChild(this.anchorElement),n.appendChild(t),n}formatAsNetworkRequest(){const e=d.NetworkLog.NetworkLog.requestForConsoleMessage(this.message);if(!e)return null;const t=document.createElement("span");if("error"===this.message.level){o.UIUtils.createTextChild(t,e.requestMethod+" ");const s=c.Linkifier.Linkifier.linkifyRevealable(e,e.url(),e.url());s.tabIndex=-1,this.selectableChildren.push({element:s,forceSelect:()=>s.focus()}),t.appendChild(s),e.failed&&o.UIUtils.createTextChildren(t," ",e.localizedFailDescription||""),0!==e.statusCode&&o.UIUtils.createTextChildren(t," ",String(e.statusCode)),e.statusText&&o.UIUtils.createTextChildren(t," (",e.statusText,")")}else{const s=this.message.messageText,i=this.linkifyWithCustomLinkifier(s,((t,s,i,o)=>{const n=s===e.url()?c.Linkifier.Linkifier.linkifyRevealable(e,s,e.url()):c.Linkifier.Linkifier.linkifyURL(s,{text:t,lineNumber:i,columnNumber:o});return n.tabIndex=-1,this.selectableChildren.push({element:n,forceSelect:()=>n.focus()}),n}));t.appendChild(i)}return t}createAffectedResourceLinks(){const e=[],t=this.message.getAffectedResources()?.requestId;if(t){const s=new g.RequestLinkIcon.RequestLinkIcon;s.classList.add("resource-links"),s.data={affectedRequest:{requestId:t},requestResolver:this.requestResolver,displayURL:!1},e.push(s)}const s=this.message.getAffectedResources()?.issueId;if(s){const t=new p.IssueLinkIcon.IssueLinkIcon;t.classList.add("resource-links"),t.data={issueId:s,issueResolver:this.issueResolver},e.push(t)}return e}buildMessageAnchor(){const e=(e=>e.scriptId?this.linkifyScriptId(e.scriptId,e.url||"",e.line,e.column):e.stackTrace&&e.stackTrace.callFrames.length?this.linkifyStackTraceTopFrame(e.stackTrace):e.url&&"undefined"!==e.url?this.linkifyLocation(e.url,e.line,e.column):null)(this.message);if(e){e.tabIndex=-1,this.selectableChildren.push({element:e,forceSelect:()=>e.focus()});const t=document.createElement("span");t.classList.add("console-message-anchor"),t.appendChild(e);for(const e of this.createAffectedResourceLinks())o.UIUtils.createTextChild(t," "),t.append(e);return o.UIUtils.createTextChild(t," "),t}return null}buildMessageWithStackTrace(e){const t=document.createElement("div");t.classList.add("console-message-stack-trace-toggle");const s=t.createChild("div","console-message-stack-trace-wrapper"),i=this.buildMessage(),n=o.Icon.Icon.create("smallicon-triangle-right","console-message-expand-icon"),r=s.createChild("div");o.ARIAUtils.setExpanded(r,!1),r.appendChild(n),r.tabIndex=-1,r.appendChild(i);const l=s.createChild("div"),a=c.JSPresentationUtils.buildStackTracePreviewContents(e.target(),this.linkifier,{stackTrace:this.message.stackTrace,tabStops:void 0});l.appendChild(a.element);for(const e of a.links)this.selectableChildren.push({element:e,forceSelect:()=>e.focus()});l.classList.add("hidden"),o.ARIAUtils.setAccessibleName(s,`${i.textContent} ${Y(Z.stackMessageCollapsed)}`),o.ARIAUtils.markAsGroup(l),this.expandTrace=e=>{n.setIconType(e?"smallicon-triangle-down":"smallicon-triangle-right"),l.classList.toggle("hidden",!e);const t=Y(e?Z.stackMessageExpanded:Z.stackMessageCollapsed);o.ARIAUtils.setAccessibleName(s,`${i.textContent} ${t}`),o.ARIAUtils.alert(t),o.ARIAUtils.setExpanded(r,e),this.traceExpanded=e};return r.addEventListener("click",(e=>{o.UIUtils.isEditing()||s.hasSelection()||(this.expandTrace&&this.expandTrace(l.classList.contains("hidden")),e.consume())}),!1),"trace"===this.message.type&&this.expandTrace(!0),t._expandStackTraceForTest=this.expandTrace.bind(this,!0),t}linkifyLocation(e,t,s){const i=this.message.runtimeModel();return i?this.linkifier.linkifyScriptLocation(i.target(),null,e,t,{columnNumber:s,className:void 0,tabStop:void 0,inlineFrameIndex:0}):null}linkifyStackTraceTopFrame(e){const t=this.message.runtimeModel();return t?this.linkifier.linkifyStackTraceTopFrame(t.target(),e):null}linkifyScriptId(e,t,s,i){const o=this.message.runtimeModel();return o?this.linkifier.linkifyScriptLocation(o.target(),e,t,s,{columnNumber:i,className:void 0,tabStop:void 0,inlineFrameIndex:0}):null}format(e){const t=document.createElement("span");if(this.messagePrefix&&(t.createChild("span").textContent=this.messagePrefix),!e.length)return t;let s=e.map(se(this.message.runtimeModel()));const n="string"===i.RemoteObject.RemoteObject.type(s[0])&&(this.message.type!==i.ConsoleModel.FrontendMessageType.Result||"error"===this.message.level);if(n){const e=this.formatWithSubstitutionString(s[0].description,s.slice(1),t);s=Array.from(e.unusedSubstitutions||[]),s.length&&o.UIUtils.createTextChild(t," ")}for(let e=0;e<s.length;++e)n&&"string"===s[e].type?t.appendChild(this.linkifyStringAsFragment(s[e].description||"")):t.appendChild(this.formatParameter(s[e],!1,!0)),e<s.length-1&&o.UIUtils.createTextChild(t," ");return t}formatParameter(e,t,s){if(e.customPreview())return new a.CustomPreviewComponent.CustomPreviewComponent(e).element;const i=t?"object":e.subtype||e.type;let o;switch(i){case"error":o=this.formatParameterAsError(e);break;case"function":o=this.formatParameterAsFunction(e,s);break;case"array":case"arraybuffer":case"blob":case"dataview":case"generator":case"iterator":case"map":case"object":case"promise":case"proxy":case"set":case"typedarray":case"wasmvalue":case"weakmap":case"weakset":case"webassemblymemory":o=this.formatParameterAsObject(e,s);break;case"node":o=e.isNode()?this.formatParameterAsNode(e):this.formatParameterAsObject(e,!1);break;case"trustedtype":o=this.formatParameterAsObject(e,!1);break;case"string":o=this.formatParameterAsString(e);break;case"boolean":case"date":case"null":case"number":case"regexp":case"symbol":case"undefined":case"bigint":o=this.formatParameterAsValue(e);break;default:o=this.formatParameterAsValue(e),console.error(`Tried to format remote object of unknown type ${i}.`)}return o.classList.add(`object-value-${i}`),o.classList.add("source-code"),o}formatParameterAsValue(e){const t=document.createElement("span"),s=e.description||"";if(s.length>pe()){const e=new a.ObjectPropertiesSection.ExpandableTextPropertyValue(document.createElement("span"),s,ge());t.appendChild(e.element)}else o.UIUtils.createTextChild(t,s);return t.addEventListener("contextmenu",this.contextMenuEventFired.bind(this,e),!1),t}formatParameterAsTrustedType(e){const t=document.createElement("span"),s=document.createElement("span");return s.appendChild(this.formatParameterAsString(e)),s.classList.add("object-value-string"),o.UIUtils.createTextChild(t,`${e.className} `),t.appendChild(s),t}formatParameterAsObject(e,t){const s=document.createElement("span");if(s.classList.add("console-object"),t&&e.preview)s.classList.add("console-object-preview"),this.previewFormatter.appendObjectPreview(s,e.preview,!1);else if("function"===e.type){const t=s.createChild("span");a.ObjectPropertiesSection.ObjectPropertiesSection.formatObjectAsFunction(e,t,!1),s.classList.add("object-value-function")}else"trustedtype"===e.subtype?s.appendChild(this.formatParameterAsTrustedType(e)):o.UIUtils.createTextChild(s,e.description||"");if(!e.hasChildren||e.customPreview())return s;const n=s.createChild("span","object-state-note info-note");this.message.type===i.ConsoleModel.FrontendMessageType.QueryObjectResult?o.Tooltip.Tooltip.install(n,Y(Z.thisValueWillNotBeCollectedUntil)):o.Tooltip.Tooltip.install(n,Y(Z.thisValueWasEvaluatedUponFirst));const r=new a.ObjectPropertiesSection.ObjectPropertiesSection(e,s,this.linkifier);return r.element.classList.add("console-view-object-properties-section"),r.enableContextMenu(),r.setShowSelectionOnKeyboardFocus(!0,!0),this.selectableChildren.push(r),r.addEventListener(o.TreeOutline.Events.ElementAttached,this.messageResized),r.addEventListener(o.TreeOutline.Events.ElementExpanded,this.messageResized),r.addEventListener(o.TreeOutline.Events.ElementCollapsed,this.messageResized),r.element}formatParameterAsFunction(e,t){const s=document.createElement("span");return i.RemoteObject.RemoteFunction.objectAsFunction(e).targetFunction().then(function(i){const n=document.createElement("span"),r=a.ObjectPropertiesSection.ObjectPropertiesSection.formatObjectAsFunction(i,n,!0,t);if(s.appendChild(n),i!==e){const e=s.createChild("span","object-state-note info-note");o.Tooltip.Tooltip.install(e,Y(Z.functionWasResolvedFromBound))}s.addEventListener("contextmenu",this.contextMenuEventFired.bind(this,i),!1),r.then((()=>this.formattedParameterAsFunctionForTest()))}.bind(this)),s}formattedParameterAsFunctionForTest(){}contextMenuEventFired(e,t){const s=new o.ContextMenu.ContextMenu(t);s.appendApplicableItems(e),s.show()}renderPropertyPreviewOrAccessor(e,t,s){return"accessor"===t.type?this.formatAsAccessorProperty(e,s.map((e=>e.name.toString())),!1):this.previewFormatter.renderPropertyPreview(t.type,"subtype"in t?t.subtype:void 0,null,t.value)}formatParameterAsNode(e){const t=document.createElement("span"),s=e.runtimeModel().target().model(i.DOMModel.DOMModel);return s?(s.pushObjectAsNodeToFrontend(e).then((async s=>{if(!s)return void t.appendChild(this.formatParameterAsObject(e,!1));const i=await o.UIUtils.Renderer.render(s);i?(i.tree&&(this.selectableChildren.push(i.tree),i.tree.addEventListener(o.TreeOutline.Events.ElementAttached,this.messageResized),i.tree.addEventListener(o.TreeOutline.Events.ElementExpanded,this.messageResized),i.tree.addEventListener(o.TreeOutline.Events.ElementCollapsed,this.messageResized)),t.appendChild(i.node)):t.appendChild(this.formatParameterAsObject(e,!1)),this.formattedParameterAsNodeForTest()})),t):t}formattedParameterAsNodeForTest(){}formatParameterAsString(e){const t=e.description??"",i=s.StringUtilities.formatAsJSLiteral(t),o=document.createElement("span");return o.addEventListener("contextmenu",this.contextMenuEventFired.bind(this,e),!1),o.appendChild(this.linkifyStringAsFragment(i)),o}formatParameterAsError(e){const t=document.createElement("span"),s=this.tryFormatAsError(e.description||"");return t.appendChild(s||this.linkifyStringAsFragment(e.description||"")),t}formatAsArrayEntry(e){return this.previewFormatter.renderPropertyPreview(e.type,e.subtype,e.className,e.description)}formatAsAccessorProperty(e,t,i){const n=a.ObjectPropertiesSection.ObjectPropertyTreeElement.createRemoteObjectAccessorPropertySpan(e,t,function(e){const t=e.wasThrown,r=e.object;if(!r)return;if(n.removeChildren(),t){const e=n.createChild("span");e.textContent=Y(Z.exception),o.Tooltip.Tooltip.install(e,r.description)}else if(i)n.appendChild(this.formatAsArrayEntry(r));else{const e=100,t=r.type,i=r.subtype;let o="";"function"!==t&&r.description&&(o="string"===t||"regexp"===i||"trustedtype"===i?s.StringUtilities.trimMiddle(r.description,e):s.StringUtilities.trimEndWithMaxLength(r.description,e)),n.appendChild(this.previewFormatter.renderPropertyPreview(t,i,r.className,o))}}.bind(this));return n}formatWithSubstitutionString(e,t,o){function n(e,t,s){return s instanceof i.RemoteObject.RemoteObject?this.formatParameter(s,e,t):r(s)}function r(e){if(void 0!==e)return"string"==typeof e?e:e.description}function l(e){if(e instanceof i.RemoteObject.RemoteObject)return"bigint"===e.type?e.description:"number"!=typeof e.value?"NaN":Math.floor(e.value)}let a=null;function c(e){const t=["background","border","color","font","line","margin","padding","text","-webkit-background","-webkit-border","-webkit-font","-webkit-margin","-webkit-padding","-webkit-text"];for(const s of t)if(e.startsWith(s))return!0;return!1}const h={};function d(e){if(a)for(const[t,{value:s,priority:i}]of a.entries())e.style.setProperty(t,s,i)}return h.o=n.bind(this,!1,!0),h.s=r,h.f=function(e){if(e instanceof i.RemoteObject.RemoteObject)return"number"!=typeof e.value?"NaN":e.value},h.i=l,h.d=l,h.c=function(e){a=new Map;const t=document.createElement("span");if(void 0!==e&&"string"!=typeof e&&e.description){t.setAttribute("style",e.description);for(const e of t.style)if(c(e)){const s={value:t.style.getPropertyValue(e),priority:t.style.getPropertyPriority(e)};a.set(e,s)}}},h.O=n.bind(this,!0,!1),h._=function(e){return e instanceof Node?e:""},s.StringUtilities.format(e,t,h,o,function(e,t){if(t instanceof Node)return e.appendChild(t),e;if(void 0===t)return e;if(!a)return e.appendChild(this.linkifyStringAsFragment(String(t))),e;const s=String(t).split("\n");for(let t=0;t<s.length;t++){const i=s[t],o=this.linkifyStringAsFragment(i),n=document.createElement("span");n.style.setProperty("contain","paint"),n.style.setProperty("display","inline-block"),n.style.setProperty("max-width","100%"),n.appendChild(o),d(n);for(const e of n.children)e.classList.contains("devtools-link")&&e instanceof HTMLElement&&this.applyForcedVisibleStyle(e);e.appendChild(n),t<s.length-1&&e.appendChild(document.createElement("br"))}return e}.bind(this))}applyForcedVisibleStyle(e){e.style.setProperty("-webkit-text-stroke","0","important"),e.style.setProperty("text-decoration","underline","important");const t=f.ThemeSupport.instance().patchColorText("rgb(33%, 33%, 33%)",f.ThemeSupport.ColorUsage.Foreground);e.style.setProperty("color",t,"important");let s="hsl(0, 0%, 100%)";"error"===this.message.level?s="hsl(0, 100%, 97%)":("warning"===this.message.level||this.shouldRenderAsWarning())&&(s="hsl(50, 100%, 95%)");const i=f.ThemeSupport.instance().patchColorText(s,f.ThemeSupport.ColorUsage.Background);e.style.setProperty("background-color",i,"important")}matchesFilterRegex(e){e.lastIndex=0;const t=this.contentElement(),s=this.anchorElement?this.anchorElement.deepTextContent():"";return Boolean(s)&&e.test(s.trim())||e.test(t.deepTextContent().slice(s.length))}matchesFilterText(e){return this.contentElement().deepTextContent().toLowerCase().includes(e.toLowerCase())}updateTimestamp(){this.contentElementInternal&&(e.Settings.Settings.instance().moduleSetting("consoleTimestampsEnabled").get()?(this.timestampElement||(this.timestampElement=document.createElement("span"),this.timestampElement.classList.add("console-timestamp")),this.timestampElement.textContent=o.UIUtils.formatTimestamp(this.message.timestamp,!1)+" ",o.Tooltip.Tooltip.install(this.timestampElement,o.UIUtils.formatTimestamp(this.message.timestamp,!0)),this.contentElementInternal.insertBefore(this.timestampElement,this.contentElementInternal.firstChild)):this.timestampElement&&(this.timestampElement.remove(),this.timestampElement=null))}nestingLevel(){return this.nestingLevelInternal}setInSimilarGroup(e,t){this.inSimilarGroup=e,this.lastInSimilarGroup=e&&Boolean(t),this.similarGroupMarker&&!e?(this.similarGroupMarker.remove(),this.similarGroupMarker=null):this.elementInternal&&!this.similarGroupMarker&&e&&(this.similarGroupMarker=document.createElement("div"),this.similarGroupMarker.classList.add("nesting-level-marker"),this.elementInternal.insertBefore(this.similarGroupMarker,this.elementInternal.firstChild),this.similarGroupMarker.classList.toggle("group-closed",this.lastInSimilarGroup))}isLastInSimilarGroup(){return Boolean(this.inSimilarGroup)&&Boolean(this.lastInSimilarGroup)}resetCloseGroupDecorationCount(){this.closeGroupDecorationCount&&(this.closeGroupDecorationCount=0,this.updateCloseGroupDecorations())}incrementCloseGroupDecorationCount(){++this.closeGroupDecorationCount,this.updateCloseGroupDecorations()}updateCloseGroupDecorations(){if(this.nestingLevelMarkers)for(let e=0,t=this.nestingLevelMarkers.length;e<t;++e){this.nestingLevelMarkers[e].classList.toggle("group-closed",t-e<=this.closeGroupDecorationCount)}}focusedChildIndex(){return this.selectableChildren.length?this.selectableChildren.findIndex((e=>e.element.hasFocus())):-1}onKeyDown(e){!o.UIUtils.isEditing()&&this.elementInternal&&this.elementInternal.hasFocus()&&!this.elementInternal.hasSelection()&&this.maybeHandleOnKeyDown(e)&&e.consume(!0)}maybeHandleOnKeyDown(e){const t=this.focusedChildIndex(),s=-1===t;if(this.expandTrace&&s&&("ArrowLeft"===e.key&&this.traceExpanded||"ArrowRight"===e.key&&!this.traceExpanded))return this.expandTrace(!this.traceExpanded),!0;if(!this.selectableChildren.length)return!1;if("ArrowLeft"===e.key)return this.elementInternal&&this.elementInternal.focus(),!0;if("ArrowRight"===e.key&&s&&this.selectNearestVisibleChild(0))return!0;if("ArrowUp"===e.key){const e=this.nearestVisibleChild(0);if(this.selectableChildren[t]===e&&e)return this.elementInternal&&this.elementInternal.focus(),!0;if(this.selectNearestVisibleChild(t-1,!0))return!0}if("ArrowDown"===e.key){if(s&&this.selectNearestVisibleChild(0))return!0;if(!s&&this.selectNearestVisibleChild(t+1))return!0}return!1}selectNearestVisibleChild(e,t){const s=this.nearestVisibleChild(e,t);return!!s&&(s.forceSelect(),!0)}nearestVisibleChild(e,t){const s=this.selectableChildren.length;if(e<0||e>=s)return null;const i=t?-1:1;let o=e;for(;!this.selectableChildren[o].element.offsetParent;)if(o+=i,o<0||o>=s)return null;return this.selectableChildren[o]}focusLastChildOrSelf(){this.elementInternal&&!this.selectNearestVisibleChild(this.selectableChildren.length-1,!0)&&this.elementInternal.focus()}setContentElement(e){console.assert(!this.contentElementInternal,"Cannot set content element twice"),this.contentElementInternal=e}getContentElement(){return this.contentElementInternal}contentElement(){if(this.contentElementInternal)return this.contentElementInternal;const e=document.createElement("div");e.classList.add("console-message"),this.messageLevelIcon&&e.appendChild(this.messageLevelIcon),this.contentElementInternal=e;const t=this.message.runtimeModel();let s;const i=Boolean(this.message.stackTrace)&&("network"===this.message.source||"violation"===this.message.source||"error"===this.message.level||"warning"===this.message.level||"trace"===this.message.type);return s=t&&i?this.buildMessageWithStackTrace(t):this.buildMessage(),e.appendChild(s),this.updateTimestamp(),this.contentElementInternal}toMessageElement(){return this.elementInternal||(this.elementInternal=document.createElement("div"),this.elementInternal.tabIndex=-1,this.elementInternal.addEventListener("keydown",this.onKeyDown.bind(this)),this.updateMessageElement()),this.elementInternal}updateMessageElement(){if(this.elementInternal){this.elementInternal.className="console-message-wrapper",this.elementInternal.removeChildren(),this.message.isGroupStartMessage()&&this.elementInternal.classList.add("console-group-title"),this.message.source===i.ConsoleModel.FrontendMessageSource.ConsoleAPI&&this.elementInternal.classList.add("console-from-api"),this.inSimilarGroup&&(this.similarGroupMarker=this.elementInternal.createChild("div","nesting-level-marker"),this.similarGroupMarker.classList.toggle("group-closed",this.lastInSimilarGroup)),this.nestingLevelMarkers=[];for(let e=0;e<this.nestingLevelInternal;++e)this.nestingLevelMarkers.push(this.elementInternal.createChild("div","nesting-level-marker"));switch(this.updateCloseGroupDecorations(),ee.set(this.elementInternal,this),this.message.level){case"verbose":this.elementInternal.classList.add("console-verbose-level");break;case"info":this.elementInternal.classList.add("console-info-level"),this.message.type===i.ConsoleModel.FrontendMessageType.System&&this.elementInternal.classList.add("console-system-type");break;case"warning":this.elementInternal.classList.add("console-warning-level");break;case"error":this.elementInternal.classList.add("console-error-level")}this.updateMessageLevelIcon(),this.shouldRenderAsWarning()&&this.elementInternal.classList.add("console-warning-level"),this.elementInternal.appendChild(this.contentElement()),this.repeatCountInternal>1&&this.showRepeatCountElement()}}shouldRenderAsWarning(){return!("verbose"!==this.message.level&&"info"!==this.message.level||"violation"!==this.message.source&&"deprecation"!==this.message.source&&"intervention"!==this.message.source&&"recommendation"!==this.message.source)}updateMessageLevelIcon(){let e="",t="";if("warning"===this.message.level?(e="smallicon-warning",t=Y(Z.warning)):"error"===this.message.level&&(e="smallicon-error",t=Y(Z.error)),!this.messageLevelIcon){if(!e)return;this.messageLevelIcon=o.Icon.Icon.create("","message-level-icon"),this.contentElementInternal&&this.contentElementInternal.insertBefore(this.messageLevelIcon,this.contentElementInternal.firstChild)}this.messageLevelIcon.setIconType(e),o.ARIAUtils.setAccessibleName(this.messageLevelIcon,t)}repeatCount(){return this.repeatCountInternal||1}resetIncrementRepeatCount(){this.repeatCountInternal=1,this.repeatCountElement&&(this.repeatCountElement.remove(),this.contentElementInternal&&this.contentElementInternal.classList.remove("repeated-message"),this.repeatCountElement=null)}incrementRepeatCount(){this.repeatCountInternal++,this.showRepeatCountElement()}setRepeatCount(e){this.repeatCountInternal=e,this.showRepeatCountElement()}showRepeatCountElement(){if(!this.elementInternal)return;if(!this.repeatCountElement){switch(this.repeatCountElement=document.createElement("span",{is:"dt-small-bubble"}),this.repeatCountElement.classList.add("console-message-repeat-count"),this.message.level){case"warning":this.repeatCountElement.type="warning";break;case"error":this.repeatCountElement.type="error";break;case"verbose":this.repeatCountElement.type="verbose";break;default:this.repeatCountElement.type="info"}this.shouldRenderAsWarning()&&(this.repeatCountElement.type="warning"),this.elementInternal.insertBefore(this.repeatCountElement,this.contentElementInternal),this.contentElement().classList.add("repeated-message")}let e;this.repeatCountElement.textContent=`${this.repeatCountInternal}`,e="warning"===this.message.level?Y(Z.warningS,{n:this.repeatCountInternal}):"error"===this.message.level?Y(Z.errorS,{n:this.repeatCountInternal}):Y(Z.repeatS,{n:this.repeatCountInternal}),o.ARIAUtils.setAccessibleName(this.repeatCountElement,e)}get text(){return this.message.messageText}toExportString(){const e=[],t=this.contentElement().childTextNodes().map(c.Linkifier.Linkifier.untruncatedNodeText).join("");for(let s=0;s<this.repeatCount();++s)e.push(t);return e.join("\n")}setSearchRegex(e){if(this.searchHighlightNodeChanges&&this.searchHighlightNodeChanges.length&&o.UIUtils.revertDomChanges(this.searchHighlightNodeChanges),this.searchRegexInternal=e,this.searchHighlightNodes=[],this.searchHighlightNodeChanges=[],!this.searchRegexInternal)return;const t=this.contentElement().deepTextContent();let s;this.searchRegexInternal.lastIndex=0;const i=[];for(;(s=this.searchRegexInternal.exec(t))&&s[0];)i.push(new n.TextRange.SourceRange(s.index,s[0].length));i.length&&(this.searchHighlightNodes=o.UIUtils.highlightSearchResults(this.contentElement(),i,this.searchHighlightNodeChanges))}searchRegex(){return this.searchRegexInternal}searchCount(){return this.searchHighlightNodes.length}searchHighlightNode(e){return this.searchHighlightNodes[e]}async getInlineFrames(e,t,s,o){const n=h.DebuggerWorkspaceBinding.DebuggerWorkspaceBinding.instance();if(n.pluginManager){const r=u.Workspace.WorkspaceImpl.instance().projects().map((e=>e.uiSourceCodeForURL(t))).flat().filter((e=>Boolean(e))).map((e=>n.scriptsForUISourceCode(e))).flat();if(r.length){const t=new i.DebuggerModel.Location(e,r[0].scriptId,s||0,o);return await n.pluginManager.getFunctionInfo(r[0],t)??{frames:[]}}}return{frames:[]}}async expandInlineStackFrames(e,t,s,i,o,n,r,l){const{frames:a}=await this.getInlineFrames(e,i,o,n);if(!a.length)return!1;for(let c=0;c<a.length;++c){const{name:h}=a[c],d=document.createElement("span");d.appendChild(this.linkifyStringAsFragment(`${t} ${h} (`));const u=this.linkifier.linkifyScriptLocation(e.target(),null,i,o,{columnNumber:n,className:void 0,tabStop:void 0,inlineFrameIndex:c});u.tabIndex=-1,this.selectableChildren.push({element:u,forceSelect:()=>u.focus()}),d.appendChild(u),d.appendChild(this.linkifyStringAsFragment(s)),r.insertBefore(d,l)}return!0}tryFormatAsError(t){const s=this.message.runtimeModel();if(!s||!["AggregateError","Error","EvalError","RangeError","ReferenceError","SyntaxError","TypeError","URIError"].some((function(e){return t.startsWith(e)}))&&!/^[\w.]+Error\b/.test(t))return null;const i=s.debuggerModel(),o=s.target().inspectedURL(),n=t.split("\n"),r=[];for(const t of n){const s=/^\s*at\s/.test(t);if(!s&&r.length&&r[r.length-1].link)return null;if(!s){r.push({line:t});continue}let i=-1,n=-1;const l=/\([^\)\(]+:\d+:\d+\)/g,c=/\([^\)\(]+\)/g;let h,d=null;for(;h=l.exec(t);)d=h;if(!d)for(;h=c.exec(t);)d=h;d&&(i=d.index,n=d.index+d[0].length-1);const u=-1!==i;let m=u?i+1:t.indexOf("at")+3;u||t.indexOf("async ")!==m||(m+=6);const p=u?n:t.length,g=t.substring(m,p),v=e.ParsedURL.ParsedURL.splitLineAndColumn(g);if(!v)return null;if("<anonymous>"===v.url){r.push({line:t});continue}let f=a(v.url);if(!f&&e.ParsedURL.ParsedURL.isRelativeURL(v.url)&&(f=a(e.ParsedURL.ParsedURL.completeURL(o,v.url))),!f)return null;r.push({line:t,link:{url:f,enclosedInBraces:u,positionLeft:m,positionRight:p,lineNumber:v.lineNumber,columnNumber:v.columnNumber}})}if(!r.length)return null;const l=document.createElement("span");for(let e=0;e<r.length;++e){const t=e<r.length-1?"\n":"",{line:s,link:o}=r[e];if(!o){l.appendChild(this.linkifyStringAsFragment(`${s}${t}`));continue}const n=document.createElement("span"),a=s.substring(0,o.positionLeft),c=`${s.substring(o.positionRight)}${t}`;n.appendChild(this.linkifyStringAsFragment(a));const h=this.linkifier.linkifyScriptLocation(i.target(),null,o.url,o.lineNumber,{columnNumber:o.columnNumber,className:void 0,tabStop:void 0,inlineFrameIndex:0,showColumnNumber:!0});if(h.tabIndex=-1,this.selectableChildren.push({element:h,forceSelect:()=>h.focus()}),n.appendChild(h),n.appendChild(this.linkifyStringAsFragment(c)),l.appendChild(n),!o.enclosedInBraces)continue;const d=a.substring(0,a.lastIndexOf(" ",a.length-3)),u=this.selectableChildren.length-1;this.expandInlineStackFrames(i,d,c,o.url,o.lineNumber,o.columnNumber,l,n).then((e=>{e&&(l.removeChild(n),this.selectableChildren.splice(u,1))}))}return l;function a(t){if(!t)return null;const s=e.ParsedURL.ParsedURL.fromString(t);if(s)return s.url;if(i.scriptsForSourceURL(t).length)return t;const o=new URL(t,"file://");return i.scriptsForSourceURL(o.href).length?o.href:null}}linkifyWithCustomLinkifier(t,s){if(t.length>pe()){const e=new a.ObjectPropertiesSection.ExpandableTextPropertyValue(document.createElement("span"),t,ge()),s=document.createDocumentFragment();return s.appendChild(e.element),s}const i=document.createDocumentFragment(),o=ie.tokenizeMessageText(t);let n=!1;for(const t of o)if(t.text)switch(n&&(t.text=`blob:${t.text}`,n=!n),"'blob:"===t.text&&t===o[0]&&(n=!0,t.text="'"),t.type){case"url":{const o=t.text.startsWith("www.")?"http://"+t.text:t.text,n=e.ParsedURL.ParsedURL.splitLineAndColumn(o),r=e.ParsedURL.ParsedURL.removeWasmFunctionInfoFromURL(n.url);let l;l=n?s(t.text,r,n.lineNumber,n.columnNumber):s(t.text,""),i.appendChild(l);break}default:i.appendChild(document.createTextNode(t.text))}return i}linkifyStringAsFragment(e){return this.linkifyWithCustomLinkifier(e,((e,t,s,i)=>{const o={text:e,lineNumber:s,columnNumber:i},n=c.Linkifier.Linkifier.linkifyURL(t,o);return n.tabIndex=-1,this.selectableChildren.push({element:n,forceSelect:()=>n.focus()}),n}))}static tokenizeMessageText(e){const{tokenizerRegexes:t,tokenizerTypes:s}=re();if(e.length>pe())return[{text:e,type:void 0}];return n.TextUtils.Utils.splitStringByRegexes(e,t).map((e=>({text:e.value,type:s[e.regexIndex]})))}groupKey(){return this.groupKeyInternal||(this.groupKeyInternal=this.message.groupCategoryKey()+":"+this.groupTitle()),this.groupKeyInternal}groupTitle(){return ie.tokenizeMessageText(this.message.messageText).reduce(((e,t)=>{let s=t.text;return"url"===t.type?s=Y(Z.url):"time"===t.type?s=Y(Z.tookNms):"event"===t.type?s=Y(Z.someEvent):"milestone"===t.type?s=Y(Z.Mxx):"autofill"===t.type&&(s=Y(Z.attribute)),e+s}),"").replace(/[%]o/g,"")}}let oe=null,ne=null;function re(){if(!oe||!ne){const e="\\u0000-\\u0020\\u007f-\\u009f",t=new RegExp("(?:[a-zA-Z][a-zA-Z0-9+.-]{2,}:\\/\\/|data:|www\\.)[^\\s"+e+'"]{2,}[^\\s'+e+"\"')}\\],:;.!?]","u"),s=/(?:\/[\w\.-]*)+\:[\d]+/,i=/took [\d]+ms/,o=/'\w+' event/,n=/\sM[6-7]\d/,r=/\(suggested: \"[\w-]+\"\)/,l=new Map;return l.set(t,"url"),l.set(s,"url"),l.set(i,"time"),l.set(o,"event"),l.set(n,"milestone"),l.set(r,"autofill"),oe=Array.from(l.keys()),ne=Array.from(l.values()),{tokenizerRegexes:oe,tokenizerTypes:ne}}return{tokenizerRegexes:oe,tokenizerTypes:ne}}class le extends ie{collapsedInternal;expandGroupIcon;onToggle;constructor(e,t,s,i,o,n,r){console.assert(e.isGroupStartMessage()),super(e,t,s,i,o,r),this.collapsedInternal="startGroupCollapsed"===e.type,this.expandGroupIcon=null,this.onToggle=n}setCollapsed(e){this.collapsedInternal=e,this.expandGroupIcon&&this.expandGroupIcon.setIconType(this.collapsedInternal?"smallicon-triangle-right":"smallicon-triangle-down"),this.onToggle.call(null)}collapsed(){return this.collapsedInternal}maybeHandleOnKeyDown(e){return-1===this.focusedChildIndex()&&("ArrowLeft"===e.key&&!this.collapsedInternal||"ArrowRight"===e.key&&this.collapsedInternal)?(this.setCollapsed(!this.collapsedInternal),!0):super.maybeHandleOnKeyDown(e)}toMessageElement(){let e=this.elementInternal||null;if(!e){e=super.toMessageElement();const t=this.collapsedInternal?"smallicon-triangle-right":"smallicon-triangle-down";this.expandGroupIcon=o.Icon.Icon.create(t,"expand-group-icon"),this.contentElement().tabIndex=-1,this.repeatCountElement?this.repeatCountElement.insertBefore(this.expandGroupIcon,this.repeatCountElement.firstChild):e.insertBefore(this.expandGroupIcon,this.contentElementInternal),e.addEventListener("click",(()=>this.setCollapsed(!this.collapsedInternal)))}return e}showRepeatCountElement(){super.showRepeatCountElement(),this.repeatCountElement&&this.expandGroupIcon&&this.repeatCountElement.insertBefore(this.expandGroupIcon,this.repeatCountElement.firstChild)}}class ae extends ie{formattedCommand;constructor(e,t,s,i,o,n){super(e,t,s,i,o,n),this.formattedCommand=null}contentElement(){const e=this.getContentElement();if(e)return e;const t=document.createElement("div");this.setContentElement(t),t.classList.add("console-user-command");const i=o.Icon.Icon.create("smallicon-user-command","command-result-icon");return t.appendChild(i),ee.set(t,this),this.formattedCommand=document.createElement("span"),this.formattedCommand.classList.add("source-code"),this.formattedCommand.textContent=s.StringUtilities.replaceControlCharacters(this.text),t.appendChild(this.formattedCommand),this.formattedCommand.textContent.length<de?m.CodeHighlighter.highlightNode(this.formattedCommand,"text/javascript").then(this.updateSearch.bind(this)):this.updateSearch(),this.updateTimestamp(),t}updateSearch(){this.setSearchRegex(this.searchRegex())}}class ce extends ie{contentElement(){const e=super.contentElement();if(!e.classList.contains("console-user-command-result")&&(e.classList.add("console-user-command-result"),"info"===this.consoleMessage().level)){const t=o.Icon.Icon.create("smallicon-command-result","command-result-icon");e.insertBefore(t,e.firstChild)}return e}}class he extends ie{dataGrid;constructor(e,t,s,i,o,n){super(e,t,s,i,o,n),console.assert("table"===e.type),this.dataGrid=null}wasShown(){this.dataGrid&&this.dataGrid.updateWidths(),super.wasShown()}onResize(){this.isVisible()&&this.dataGrid&&this.dataGrid.onResize()}contentElement(){const e=this.getContentElement();if(e)return e;const t=document.createElement("div");return t.classList.add("console-message"),this.messageLevelIcon&&t.appendChild(this.messageLevelIcon),this.setContentElement(t),t.appendChild(this.buildTableMessage()),this.updateTimestamp(),t}buildTableMessage(){const e=document.createElement("span");e.classList.add("source-code"),this.anchorElement=this.buildMessageAnchor(),this.anchorElement&&e.appendChild(this.anchorElement);const t=this.message.parameters&&this.message.parameters.length?this.message.parameters[0]:null;if(!t)return this.buildMessage();const s=se(this.message.runtimeModel())(t);if(!s||!s.preview)return this.buildMessage();const i=Symbol("rawValueColumn"),o=[],n=s.preview,r=[];for(let e=0;e<n.properties.length;++e){const t=n.properties[e];let l;if(t.valuePreview&&t.valuePreview.properties.length)l=t.valuePreview.properties;else{if(!t.value)continue;l=[{name:i,type:t.type,value:t.value}]}const a=new Map,c=20;for(let e=0;e<l.length;++e){const i=l[e];let n=-1!==o.indexOf(i.name);if(!n){if(o.length===c)continue;n=!0,o.push(i.name)}if(n){const e=this.renderPropertyPreviewOrAccessor(s,i,[t,i]);e.classList.add("console-message-nowrap-below"),a.set(i.name,e)}}r.push({rowName:t.name,rowValue:a})}const l=[];for(const{rowName:e,rowValue:t}of r){l.push(e);for(let e=0;e<o.length;++e)l.push(t.get(o[e]))}o.unshift(Y(Z.index));const a=o.map((e=>e===i?Y(Z.value):e.toString()));if(l.length&&(this.dataGrid=v.SortableDataGrid.SortableDataGrid.create(a,l,Y(Z.console)),this.dataGrid)){this.dataGrid.setStriped(!0),this.dataGrid.setFocusable(!1);const t=document.createElement("span");t.classList.add("console-message-text");const i=t.createChild("div","console-message-formatted-table"),o=i.createChild("span");i.appendChild(this.formatParameter(s,!0,!1));const n=o.attachShadow({mode:"open"}),r=this.dataGrid.asWidget();r.markAsRoot(),r.show(n),r.registerCSSFiles([X,L]),e.appendChild(t),this.dataGrid.renderInline()}return e}approximateFastHeight(){const e=this.message.parameters&&this.message.parameters[0];return e&&"string"!=typeof e&&e.preview?19*e.preview.properties.length:19}}const de=1e4;let ue=1e4,me=5e3;const pe=()=>ue,ge=()=>me;var ve=Object.freeze({__proto__:null,getMessageForElement:te,ConsoleViewMessage:ie,ConsoleGroupViewMessage:le,ConsoleCommand:ae,ConsoleCommandResult:ce,ConsoleTableMessageView:he,MaxLengthForLinks:40,getMaxTokenizableStringLength:pe,setMaxTokenizableStringLength:e=>{ue=e},getLongStringVisibleLength:ge,setLongStringVisibleLength:e=>{me=e}});const fe={issuesWithColon:"{n, plural, =0 {No Issues} =1 {# Issue:} other {# Issues:}}",issueToolbarTooltipGeneral:"Some problems no longer generate console messages, but are surfaced in the issues tab.",issueToolbarClickToView:"Click to view {issueEnumeration}",issueToolbarClickToGoToTheIssuesTab:"Click to go to the issues tab",findStringInLogs:"Find string in logs",consoleSettings:"Console settings",groupSimilarMessagesInConsole:"Group similar messages in console",showCorsErrorsInConsole:"Show `CORS` errors in console",showConsoleSidebar:"Show console sidebar",hideConsoleSidebar:"Hide console sidebar",doNotClearLogOnPageReload:"Do not clear log on page reload / navigation",preserveLog:"Preserve log",hideNetwork:"Hide network",onlyShowMessagesFromTheCurrentContext:"Only show messages from the current context (`top`, `iframe`, `worker`, extension)",selectedContextOnly:"Selected context only",eagerlyEvaluateTextInThePrompt:"Eagerly evaluate text in the prompt",sHidden:"{n, plural, =1 {# hidden} other {# hidden}}",consoleCleared:"Console cleared",hideMessagesFromS:"Hide messages from {PH1}",saveAs:"Save as...",copyVisibleStyledSelection:"Copy visible styled selection",replayXhr:"Replay XHR",writingFile:"Writing fileâ€¦",searching:"Searchingâ€¦",filter:"Filter",egEventdCdnUrlacom:"e.g. `/eventd/ -cdn url:a.com`",verbose:"Verbose",info:"Info",warnings:"Warnings",errors:"Errors",logLevels:"Log levels",overriddenByFilterSidebar:"Overridden by filter sidebar",customLevels:"Custom levels",sOnly:"{PH1} only",allLevels:"All levels",defaultLevels:"Default levels",hideAll:"Hide all",logLevelS:"Log level: {PH1}",default:"Default",filteredMessagesInConsole:"{PH1} messages in console"},be=t.i18n.registerUIStrings("panels/console/ConsoleView.ts",fe),Ce=t.i18n.getLocalizedString.bind(void 0,be);let xe;class we extends o.Widget.VBox{searchableViewInternal;sidebar;isSidebarOpen;filter;consoleToolbarContainer;splitWidget;contentsElement;visibleViewMessages;hiddenByFilterCount;shouldBeHiddenCache;lastShownHiddenByFilterCount;currentMatchRangeIndex;searchRegex;groupableMessages;groupableMessageTitle;shortcuts;regexMatchRanges;consoleContextSelector;filterStatusText;showSettingsPaneSetting;showSettingsPaneButton;progressToolbarItem;groupSimilarSetting;showCorsErrorsSetting;preserveLogCheckbox;hideNetworkMessagesCheckbox;timestampsSetting;consoleHistoryAutocompleteSetting;pinPane;viewport;messagesElement;messagesCountElement;viewportThrottler;pendingBatchResize;onMessageResizedBound;topGroup;currentGroup;promptElement;linkifier;consoleMessages;viewMessageSymbol;consoleHistorySetting;prompt;immediatelyFilterMessagesForTest;maybeDirtyWhileMuted;scheduledRefreshPromiseForTest;needsFullUpdate;buildHiddenCacheTimeout;searchShouldJumpBackwards;searchProgressIndicator;innerSearchTimeoutId;muteViewportUpdates;waitForScrollTimeout;issueCounter;pendingSidebarMessages=[];userHasOpenedSidebarAtLeastOnce=!1;issueToolbarThrottle;requestResolver=new d.RequestResolver.RequestResolver;issueResolver=new C.IssueResolver.IssueResolver;constructor(){super(),this.setMinimumSize(0,35),this.searchableViewInternal=new o.SearchableView.SearchableView(this,null),this.searchableViewInternal.element.classList.add("console-searchable-view"),this.searchableViewInternal.setPlaceholder(Ce(fe.findStringInLogs)),this.searchableViewInternal.setMinimalSearchQuerySize(0),this.sidebar=new D,this.sidebar.addEventListener("FilterSelected",this.onFilterChanged.bind(this)),this.isSidebarOpen=!1,this.filter=new Ie(this.onFilterChanged.bind(this)),this.consoleToolbarContainer=this.element.createChild("div","console-toolbar-container"),this.splitWidget=new o.SplitWidget.SplitWidget(!0,!1,"console.sidebar.width",100),this.splitWidget.setMainWidget(this.searchableViewInternal),this.splitWidget.setSidebarWidget(this.sidebar),this.splitWidget.show(this.element),this.splitWidget.hideSidebar(),this.splitWidget.enableShowModeSaving(),this.isSidebarOpen=this.splitWidget.showMode()===o.SplitWidget.ShowMode.Both,this.filter.setLevelMenuOverridden(this.isSidebarOpen),this.splitWidget.addEventListener(o.SplitWidget.Events.ShowModeChanged,(e=>{this.isSidebarOpen=e.data===o.SplitWidget.ShowMode.Both,this.isSidebarOpen&&(this.userHasOpenedSidebarAtLeastOnce||(b.userMetrics.actionTaken(b.UserMetrics.Action.ConsoleSidebarOpened),this.userHasOpenedSidebarAtLeastOnce=!0),this.pendingSidebarMessages.forEach((e=>{this.sidebar.onMessageAdded(e)})),this.pendingSidebarMessages=[]),this.filter.setLevelMenuOverridden(this.isSidebarOpen),this.onFilterChanged()})),this.contentsElement=this.searchableViewInternal.element,this.element.classList.add("console-view"),this.visibleViewMessages=[],this.hiddenByFilterCount=0,this.shouldBeHiddenCache=new Set,this.groupableMessages=new Map,this.groupableMessageTitle=new Map,this.shortcuts=new Map,this.regexMatchRanges=[],this.consoleContextSelector=new E,this.filterStatusText=new o.Toolbar.ToolbarText,this.filterStatusText.element.classList.add("dimmed"),this.showSettingsPaneSetting=e.Settings.Settings.instance().createSetting("consoleShowSettingsToolbar",!1),this.showSettingsPaneButton=new o.Toolbar.ToolbarSettingToggle(this.showSettingsPaneSetting,"largeicon-settings-gear",Ce(fe.consoleSettings)),this.progressToolbarItem=new o.Toolbar.ToolbarItem(document.createElement("div")),this.groupSimilarSetting=e.Settings.Settings.instance().moduleSetting("consoleGroupSimilar"),this.groupSimilarSetting.addChangeListener((()=>this.updateMessageList()));const t=new o.Toolbar.ToolbarSettingCheckbox(this.groupSimilarSetting,Ce(fe.groupSimilarMessagesInConsole));this.showCorsErrorsSetting=e.Settings.Settings.instance().moduleSetting("consoleShowsCorsErrors"),this.showCorsErrorsSetting.addChangeListener((()=>{b.userMetrics.showCorsErrorsSettingChanged(this.showCorsErrorsSetting.get()),this.updateMessageList()}));const s=new o.Toolbar.ToolbarSettingCheckbox(this.showCorsErrorsSetting,Ce(fe.showCorsErrorsInConsole)),n=new o.Toolbar.Toolbar("console-main-toolbar",this.consoleToolbarContainer);n.makeWrappable(!0);const r=new o.Toolbar.Toolbar("",this.consoleToolbarContainer);n.appendToolbarItem(this.splitWidget.createShowHideSidebarButton(Ce(fe.showConsoleSidebar),Ce(fe.hideConsoleSidebar))),n.appendToolbarItem(o.Toolbar.Toolbar.createActionButton(o.ActionRegistry.ActionRegistry.instance().action("console.clear"))),n.appendSeparator(),n.appendToolbarItem(this.consoleContextSelector.toolbarItem()),n.appendSeparator();const l=o.Toolbar.Toolbar.createActionButton(o.ActionRegistry.ActionRegistry.instance().action("console.create-pin"));n.appendToolbarItem(l),n.appendSeparator(),n.appendToolbarItem(this.filter.textFilterUI),n.appendToolbarItem(this.filter.levelMenuButton),n.appendToolbarItem(this.progressToolbarItem),n.appendSeparator(),this.issueCounter=new p.IssueCounter.IssueCounter,this.issueCounter.id="console-issues-counter";const a=new o.Toolbar.ToolbarItem(this.issueCounter);this.issueCounter.data={clickHandler:()=>{b.userMetrics.issuesPanelOpenedFrom(b.UserMetrics.IssueOpener.StatusBarIssuesCounter),o.ViewManager.ViewManager.instance().showView("issues-pane")},issuesManager:C.IssuesManager.IssuesManager.instance(),accessibleName:Ce(fe.issueToolbarTooltipGeneral),displayMode:"OmitEmpty"},n.appendToolbarItem(a),r.appendSeparator(),r.appendToolbarItem(this.filterStatusText),r.appendToolbarItem(this.showSettingsPaneButton),this.preserveLogCheckbox=new o.Toolbar.ToolbarSettingCheckbox(e.Settings.Settings.instance().moduleSetting("preserveConsoleLog"),Ce(fe.doNotClearLogOnPageReload),Ce(fe.preserveLog)),this.hideNetworkMessagesCheckbox=new o.Toolbar.ToolbarSettingCheckbox(this.filter.hideNetworkMessagesSetting,this.filter.hideNetworkMessagesSetting.title(),Ce(fe.hideNetwork));const h=new o.Toolbar.ToolbarSettingCheckbox(this.filter.filterByExecutionContextSetting,Ce(fe.onlyShowMessagesFromTheCurrentContext),Ce(fe.selectedContextOnly)),d=e.Settings.Settings.instance().moduleSetting("monitoringXHREnabled");this.timestampsSetting=e.Settings.Settings.instance().moduleSetting("consoleTimestampsEnabled"),this.consoleHistoryAutocompleteSetting=e.Settings.Settings.instance().moduleSetting("consoleHistoryAutocomplete");const u=new o.Widget.HBox;u.show(this.contentsElement),u.element.classList.add("console-settings-pane"),o.ARIAUtils.setAccessibleName(u.element,Ce(fe.consoleSettings)),o.ARIAUtils.markAsGroup(u.element);const m=new o.Toolbar.Toolbar("",u.element);m.makeVertical(),m.appendToolbarItem(this.hideNetworkMessagesCheckbox),m.appendToolbarItem(this.preserveLogCheckbox),m.appendToolbarItem(h),m.appendToolbarItem(t),m.appendToolbarItem(s);const g=new o.Toolbar.Toolbar("",u.element);g.makeVertical(),g.appendToolbarItem(new o.Toolbar.ToolbarSettingCheckbox(d));const v=new o.Toolbar.ToolbarSettingCheckbox(e.Settings.Settings.instance().moduleSetting("consoleEagerEval"),Ce(fe.eagerlyEvaluateTextInThePrompt));g.appendToolbarItem(v),g.appendToolbarItem(new o.Toolbar.ToolbarSettingCheckbox(this.consoleHistoryAutocompleteSetting));const f=new o.Toolbar.ToolbarSettingCheckbox(e.Settings.Settings.instance().moduleSetting("consoleUserActivationEval"));g.appendToolbarItem(f),this.showSettingsPaneSetting.get()||u.element.classList.add("hidden"),this.showSettingsPaneSetting.addChangeListener((()=>u.element.classList.toggle("hidden",!this.showSettingsPaneSetting.get()))),this.pinPane=new H(l,(()=>this.prompt.focus())),this.pinPane.element.classList.add("console-view-pinpane"),this.pinPane.show(this.contentsElement),this.viewport=new $(this),this.viewport.setStickToBottom(!0),this.viewport.contentElement().classList.add("console-group","console-group-messages"),this.contentsElement.appendChild(this.viewport.element),this.messagesElement=this.viewport.element,this.messagesElement.id="console-messages",this.messagesElement.classList.add("monospace"),this.messagesElement.addEventListener("click",this.messagesClicked.bind(this),!1),this.messagesElement.addEventListener("paste",this.messagesPasted.bind(this),!0),this.messagesElement.addEventListener("clipboard-paste",this.messagesPasted.bind(this),!0),this.messagesCountElement=this.consoleToolbarContainer.createChild("div","message-count"),o.ARIAUtils.markAsPoliteLiveRegion(this.messagesCountElement,!1),this.viewportThrottler=new e.Throttler.Throttler(50),this.pendingBatchResize=!1,this.onMessageResizedBound=e=>{this.onMessageResized(e)},this.topGroup=Ee.createTopGroup(),this.currentGroup=this.topGroup,this.promptElement=this.messagesElement.createChild("div","source-code"),this.promptElement.id="console-prompt";const x=this.messagesElement.createChild("div","console-view-fix-select-all");x.textContent=".",o.ARIAUtils.markAsHidden(x),this.registerShortcuts(),this.messagesElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1);const w=new e.Throttler.Throttler(100);this.linkifier=new c.Linkifier.Linkifier(40,void 0,(()=>w.schedule((async()=>this.onFilterChanged())))),this.consoleMessages=[],this.viewMessageSymbol=Symbol("viewMessage"),this.consoleHistorySetting=e.Settings.Settings.instance().createLocalSetting("consoleHistory",[]),this.prompt=new Ge,this.prompt.show(this.promptElement),this.prompt.element.addEventListener("keydown",this.promptKeyDown.bind(this),!0),this.prompt.addEventListener("TextChanged",this.promptTextChanged,this),this.messagesElement.addEventListener("keydown",this.messagesKeyDown.bind(this),!1),this.prompt.element.addEventListener("focusin",(()=>{this.isScrolledToBottom()&&this.viewport.setStickToBottom(!0)})),this.consoleHistoryAutocompleteSetting.addChangeListener(this.consoleHistoryAutocompleteChanged,this);const S=this.consoleHistorySetting.get();this.prompt.history().setHistoryData(S),this.consoleHistoryAutocompleteChanged(),this.updateFilterStatus(),this.timestampsSetting.addChangeListener(this.consoleTimestampsSettingChanged,this),this.registerWithMessageSink(),o.Context.Context.instance().addFlavorChangeListener(i.RuntimeModel.ExecutionContext,this.executionContextChanged,this),this.messagesElement.addEventListener("mousedown",(e=>this.updateStickToBottomOnPointerDown(2===e.button)),!1),this.messagesElement.addEventListener("mouseup",this.updateStickToBottomOnPointerUp.bind(this),!1),this.messagesElement.addEventListener("mouseleave",this.updateStickToBottomOnPointerUp.bind(this),!1),this.messagesElement.addEventListener("wheel",this.updateStickToBottomOnWheel.bind(this),!1),this.messagesElement.addEventListener("touchstart",this.updateStickToBottomOnPointerDown.bind(this,!1),!1),this.messagesElement.addEventListener("touchend",this.updateStickToBottomOnPointerUp.bind(this),!1),this.messagesElement.addEventListener("touchcancel",this.updateStickToBottomOnPointerUp.bind(this),!1),i.ConsoleModel.ConsoleModel.instance().addEventListener(i.ConsoleModel.Events.ConsoleCleared,this.consoleCleared,this),i.ConsoleModel.ConsoleModel.instance().addEventListener(i.ConsoleModel.Events.MessageAdded,this.onConsoleMessageAdded,this),i.ConsoleModel.ConsoleModel.instance().addEventListener(i.ConsoleModel.Events.MessageUpdated,this.onConsoleMessageUpdated,this),i.ConsoleModel.ConsoleModel.instance().addEventListener(i.ConsoleModel.Events.CommandEvaluated,this.commandEvaluated,this),i.ConsoleModel.ConsoleModel.instance().messages().forEach(this.addConsoleMessage,this);const I=C.IssuesManager.IssuesManager.instance();this.issueToolbarThrottle=new e.Throttler.Throttler(100),I.addEventListener("IssuesCountUpdated",(()=>this.issueToolbarThrottle.schedule((async()=>this.updateIssuesToolbarItem()))),this)}static instance(){return xe||(xe=new we),xe}static clearConsole(){i.ConsoleModel.ConsoleModel.instance().requestClearMessages()}onFilterChanged(){if(this.filter.currentFilter.levelsMask=this.isSidebarOpen?y.allLevelsFilterValue():this.filter.messageLevelFiltersSetting.get(),this.cancelBuildHiddenCache(),this.immediatelyFilterMessagesForTest){for(const e of this.consoleMessages)this.computeShouldMessageBeVisible(e);this.updateMessageList()}else this.buildHiddenCache(0,this.consoleMessages.slice())}setImmediatelyFilterMessagesForTest(){this.immediatelyFilterMessagesForTest=!0}searchableView(){return this.searchableViewInternal}clearHistory(){this.consoleHistorySetting.set([]),this.prompt.history().setHistoryData([])}consoleHistoryAutocompleteChanged(){this.prompt.setAddCompletionsFromHistory(this.consoleHistoryAutocompleteSetting.get())}itemCount(){return this.visibleViewMessages.length}itemElement(e){return this.visibleViewMessages[e]}fastHeight(e){return this.visibleViewMessages[e].fastHeight()}minimumRowHeight(){return 16}registerWithMessageSink(){e.Console.Console.instance().messages().forEach(this.addSinkMessage,this),e.Console.Console.instance().addEventListener(e.Console.Events.MessageAdded,(({data:e})=>{this.addSinkMessage(e)}),this)}addSinkMessage(t){let s="verbose";switch(t.level){case e.Console.MessageLevel.Info:s="info";break;case e.Console.MessageLevel.Error:s="error";break;case e.Console.MessageLevel.Warning:s="warning"}const o=new i.ConsoleModel.ConsoleMessage(null,"other",s,t.text,{type:i.ConsoleModel.FrontendMessageType.System,timestamp:t.timestamp});this.addConsoleMessage(o)}consoleTimestampsSettingChanged(){this.updateMessageList(),this.consoleMessages.forEach((e=>e.updateTimestamp())),this.groupableMessageTitle.forEach((e=>e.updateTimestamp()))}executionContextChanged(){this.prompt.clearAutocomplete()}willHide(){this.hidePromptSuggestBox()}wasShown(){super.wasShown(),this.updateIssuesToolbarItem(),this.viewport.refresh(),this.registerCSSFiles([X,L,m.Style.default])}focus(){this.viewport.hasVirtualSelection()?this.viewport.contentElement().focus():this.focusPrompt()}focusPrompt(){if(!this.prompt.hasFocus()){const e=this.viewport.stickToBottom(),t=this.viewport.element.scrollTop;this.prompt.focus(),this.viewport.setStickToBottom(e),this.viewport.element.scrollTop=t}}restoreScrollPositions(){this.viewport.stickToBottom()?this.immediatelyScrollToBottom():super.restoreScrollPositions()}onResize(){this.scheduleViewportRefresh(),this.hidePromptSuggestBox(),this.viewport.stickToBottom()&&this.immediatelyScrollToBottom();for(let e=0;e<this.visibleViewMessages.length;++e)this.visibleViewMessages[e].onResize()}hidePromptSuggestBox(){this.prompt.clearAutocomplete()}async invalidateViewport(){this.updateIssuesToolbarItem(),this.muteViewportUpdates?this.maybeDirtyWhileMuted=!0:this.needsFullUpdate?(this.updateMessageList(),delete this.needsFullUpdate):this.viewport.invalidate()}updateIssuesToolbarItem(){const e=C.IssuesManager.IssuesManager.instance(),t=p.IssueCounter.getIssueCountsEnumeration(e),s=0===e.numberOfIssues()?Ce(fe.issueToolbarClickToGoToTheIssuesTab):Ce(fe.issueToolbarClickToView,{issueEnumeration:t}),i=`${Ce(fe.issueToolbarTooltipGeneral)} ${s}`;o.Tooltip.Tooltip.install(this.issueCounter,i),this.issueCounter.data={...this.issueCounter.data,leadingText:Ce(fe.issuesWithColon,{n:e.numberOfIssues()}),accessibleName:i}}scheduleViewportRefresh(){if(this.muteViewportUpdates)return this.maybeDirtyWhileMuted=!0,void this.scheduleViewportRefreshForTest(!0);this.scheduleViewportRefreshForTest(!1),this.scheduledRefreshPromiseForTest=this.viewportThrottler.schedule(this.invalidateViewport.bind(this))}scheduleViewportRefreshForTest(e){}immediatelyScrollToBottom(){this.viewport.setStickToBottom(!0),this.promptElement.scrollIntoView(!0)}updateFilterStatus(){this.hiddenByFilterCount!==this.lastShownHiddenByFilterCount&&(this.filterStatusText.setText(Ce(fe.sHidden,{n:this.hiddenByFilterCount})),this.filterStatusText.setVisible(Boolean(this.hiddenByFilterCount)),this.lastShownHiddenByFilterCount=this.hiddenByFilterCount)}onConsoleMessageAdded(e){const t=e.data;this.addConsoleMessage(t)}addConsoleMessage(e){const t=this.createViewMessage(e);if(ke.set(e,t),e.type===i.ConsoleModel.FrontendMessageType.Command||e.type===i.ConsoleModel.FrontendMessageType.Result){const e=this.consoleMessages[this.consoleMessages.length-1],s=e&&ye.get(e)||0;ye.set(t,s)}else ye.set(t,t.consoleMessage().timestamp);let o;o=!this.consoleMessages.length||a(t,this.consoleMessages[this.consoleMessages.length-1])>0?this.consoleMessages.length:s.ArrayUtilities.upperBound(this.consoleMessages,t,a);const n=o<this.consoleMessages.length;this.consoleMessages.splice(o,0,t),this.filter.onMessageAdded(e),this.isSidebarOpen?this.sidebar.onMessageAdded(t):this.pendingSidebarMessages.push(t);let r=!1;const l=this.groupSimilarSetting.get();if(e.isGroupable()){const e=t.groupKey();r=l&&this.groupableMessages.has(e);let s=this.groupableMessages.get(e);s||(s=[],this.groupableMessages.set(e,s)),s.push(t)}function a(e,t){return(ye.get(e)||0)-(ye.get(t)||0)}this.computeShouldMessageBeVisible(t),r||n?this.needsFullUpdate=!0:(this.appendMessageToEnd(t,!l),this.updateFilterStatus(),this.searchableViewInternal.updateSearchMatchesCount(this.regexMatchRanges.length)),this.scheduleViewportRefresh(),this.consoleMessageAddedForTest(t)}onConsoleMessageUpdated(e){const t=e.data,s=ke.get(t);s&&(s.updateMessageElement(),this.computeShouldMessageBeVisible(s),this.updateMessageList())}consoleMessageAddedForTest(e){}shouldMessageBeVisible(e){return!this.shouldBeHiddenCache.has(e)}computeShouldMessageBeVisible(e){!this.filter.shouldBeVisible(e)||this.isSidebarOpen&&!this.sidebar.shouldBeVisible(e)?this.shouldBeHiddenCache.add(e):this.shouldBeHiddenCache.delete(e)}appendMessageToEnd(e,t){if("cors"===e.consoleMessage().category&&!this.showCorsErrorsSetting.get())return;if(!this.shouldMessageBeVisible(e))return void this.hiddenByFilterCount++;if(!t&&this.tryToCollapseMessages(e,this.visibleViewMessages[this.visibleViewMessages.length-1]))return;const s=this.visibleViewMessages[this.visibleViewMessages.length-1];if("endGroup"===e.consoleMessage().type)return s&&!this.currentGroup.messagesHidden()&&s.incrementCloseGroupDecorationCount(),void(this.currentGroup=this.currentGroup.parentGroup()||this.currentGroup);if(!this.currentGroup.messagesHidden()){const t=e.consoleMessage().originatingMessage();s&&t&&s.consoleMessage()===t&&e.toMessageElement().classList.add("console-adjacent-user-command-result"),this.visibleViewMessages.push(e),this.searchMessage(this.visibleViewMessages.length-1)}e.consoleMessage().isGroupStartMessage()&&(this.currentGroup=new Ee(this.currentGroup,e)),this.messageAppendedForTests()}messageAppendedForTests(){}createViewMessage(e){const t=this.currentGroup.nestingLevel();switch(e.type){case i.ConsoleModel.FrontendMessageType.Command:return new ae(e,this.linkifier,this.requestResolver,this.issueResolver,t,this.onMessageResizedBound);case i.ConsoleModel.FrontendMessageType.Result:return new ce(e,this.linkifier,this.requestResolver,this.issueResolver,t,this.onMessageResizedBound);case"startGroupCollapsed":case"startGroup":return new le(e,this.linkifier,this.requestResolver,this.issueResolver,t,this.updateMessageList.bind(this),this.onMessageResizedBound);case"table":return new he(e,this.linkifier,this.requestResolver,this.issueResolver,t,this.onMessageResizedBound);default:return new ie(e,this.linkifier,this.requestResolver,this.issueResolver,t,this.onMessageResizedBound)}}async onMessageResized(e){const t=e.data;if(this.pendingBatchResize||!t.treeOutline)return;this.pendingBatchResize=!0,await Promise.resolve();const s=t.treeOutline.element;this.viewport.setStickToBottom(this.isScrolledToBottom()),s.offsetHeight<=this.messagesElement.offsetHeight&&s.scrollIntoViewIfNeeded(),this.pendingBatchResize=!1}consoleCleared(){const e=this.viewport.element.hasFocus();this.cancelBuildHiddenCache(),this.currentMatchRangeIndex=-1,this.consoleMessages=[],this.groupableMessages.clear(),this.groupableMessageTitle.clear(),this.sidebar.clear(),this.updateMessageList(),this.hidePromptSuggestBox(),this.viewport.setStickToBottom(!0),this.linkifier.reset(),this.filter.clear(),this.requestResolver.clear(),e&&this.prompt.focus(),o.ARIAUtils.alert(Ce(fe.consoleCleared))}handleContextMenuEvent(t){const s=new o.ContextMenu.ContextMenu(t),n=t.target;if(n.isSelfOrDescendant(this.promptElement))return void s.show();const r=n.enclosingNodeOrSelfWithClass("console-message-wrapper"),l=r&&te(r),a=l?l.consoleMessage():null;if(a&&a.url){const t=Ce(fe.hideMessagesFromS,{PH1:new e.ParsedURL.ParsedURL(a.url).displayName});s.headerSection().appendItem(t,this.filter.addMessageURLFilter.bind(this.filter,a.url))}if(s.defaultSection().appendAction("console.clear"),s.defaultSection().appendAction("console.clear.history"),s.saveSection().appendItem(Ce(fe.saveAs),this.saveConsole.bind(this)),this.element.hasSelection()&&s.clipboardSection().appendItem(Ce(fe.copyVisibleStyledSelection),this.viewport.copyWithStyles.bind(this.viewport)),a){const e=d.NetworkLog.NetworkLog.requestForConsoleMessage(a);e&&i.NetworkManager.NetworkManager.canReplayRequest(e)&&s.debugSection().appendItem(Ce(fe.replayXhr),i.NetworkManager.NetworkManager.replayRequest.bind(null,e))}s.show()}async saveConsole(){const t=i.TargetManager.TargetManager.instance().mainTarget().inspectedURL(),n=e.ParsedURL.ParsedURL.fromString(t),r=s.StringUtilities.sprintf("%s-%d.log",n?n.host:"console",Date.now()),l=new h.FileUtils.FileOutputStream,a=new o.ProgressIndicator.ProgressIndicator;a.setTitle(Ce(fe.writingFile)),a.setTotalWork(this.itemCount());if(!await l.open(r))return;this.progressToolbarItem.element.appendChild(a.element);let c=0;for(;c<this.itemCount()&&!a.isCanceled();){const e=[];let t;for(t=0;t<350&&t+c<this.itemCount();++t){const s=this.itemElement(c+t);e.push(s.toExportString())}c+=t,await l.write(e.join("\n")+"\n"),a.setWorked(c)}l.close(),a.done()}tryToCollapseMessages(e,t){return!(this.timestampsSetting.get()||!t||e.consoleMessage().isGroupMessage()||e.consoleMessage().type===i.ConsoleModel.FrontendMessageType.Command||e.consoleMessage().type===i.ConsoleModel.FrontendMessageType.Result||!e.consoleMessage().isEqual(t.consoleMessage()))&&(t.incrementRepeatCount(),e.isLastInSimilarGroup()&&t.setInSimilarGroup(!0,!0),!0)}buildHiddenCache(e,t){const s=Date.now();let i;for(i=e;i<t.length&&(this.computeShouldMessageBeVisible(t[i]),!(i%10==0&&Date.now()-s>12));++i);i!==t.length?this.buildHiddenCacheTimeout=this.element.window().requestAnimationFrame(this.buildHiddenCache.bind(this,i,t)):this.updateMessageList()}cancelBuildHiddenCache(){this.shouldBeHiddenCache.clear(),this.buildHiddenCacheTimeout&&(this.element.window().cancelAnimationFrame(this.buildHiddenCacheTimeout),delete this.buildHiddenCacheTimeout)}updateMessageList(){this.topGroup=Ee.createTopGroup(),this.currentGroup=this.topGroup,this.regexMatchRanges=[],this.hiddenByFilterCount=0;for(const e of this.visibleViewMessages)e.resetCloseGroupDecorationCount(),e.resetIncrementRepeatCount();if(this.visibleViewMessages=[],this.groupSimilarSetting.get())this.addGroupableMessagesToEnd();else for(const e of this.consoleMessages)e.setInSimilarGroup(!1),this.appendMessageToEnd(e,!0);this.updateFilterStatus(),this.searchableViewInternal.updateSearchMatchesCount(this.regexMatchRanges.length),this.viewport.invalidate(),this.messagesCountElement.setAttribute("aria-label",Ce(fe.filteredMessagesInConsole,{PH1:this.visibleViewMessages.length}))}addGroupableMessagesToEnd(){const e=new Set,t=new Set;for(const o of this.consoleMessages){const n=o.consoleMessage();if(e.has(n))continue;if(!n.isGroupable()){this.appendMessageToEnd(o),e.add(n);continue}const r=o.groupKey(),l=this.groupableMessages.get(r);if(!l||l.length<5){o.setInSimilarGroup(!1),this.appendMessageToEnd(o),e.add(n);continue}if(t.has(r))continue;if(!l.find((e=>this.shouldMessageBeVisible(e)))){s.SetUtilities.addAll(e,l),t.add(r);continue}let a=this.groupableMessageTitle.get(r);if(!a){const e=new i.ConsoleModel.ConsoleMessage(null,n.source,n.level,o.groupTitle(),{type:"startGroupCollapsed"});a=this.createViewMessage(e),this.groupableMessageTitle.set(r,a)}a.setRepeatCount(l.length),this.appendMessageToEnd(a);for(const t of l)t.setInSimilarGroup(!0,l[l.length-1]===t),this.appendMessageToEnd(t,!0),e.add(t.consoleMessage());const c=new i.ConsoleModel.ConsoleMessage(null,n.source,n.level,n.messageText,{type:"endGroup"});this.appendMessageToEnd(this.createViewMessage(c))}}messagesClicked(e){const t=e.target;if(!this.messagesElement.hasSelection()){(t===this.messagesElement||this.prompt.belowEditorElement().isSelfOrAncestor(t))&&(this.prompt.moveCaretToEndOfPrompt(),this.focusPrompt())}}messagesKeyDown(e){const t=e;t.ctrlKey||t.altKey||t.metaKey||1!==t.key.length||o.UIUtils.isEditing()||this.messagesElement.hasSelection()||(this.prompt.moveCaretToEndOfPrompt(),this.focusPrompt())}messagesPasted(e){o.UIUtils.isEditing()||this.prompt.focus()}registerShortcuts(){this.shortcuts.set(o.KeyboardShortcut.KeyboardShortcut.makeKey("u",o.KeyboardShortcut.Modifiers.Ctrl),this.clearPromptBackwards.bind(this))}clearPromptBackwards(){this.prompt.clear()}promptKeyDown(e){const t=e;if("PageUp"===t.key)return void this.updateStickToBottomOnWheel();const s=o.KeyboardShortcut.KeyboardShortcut.makeKeyFromEvent(t),i=this.shortcuts.get(s);i&&(i(),t.preventDefault())}printResult(e,t,s){if(!e)return;const o=Boolean(s)?"error":"info";let n;n=s?i.ConsoleModel.ConsoleMessage.fromException(e.runtimeModel(),s,i.ConsoleModel.FrontendMessageType.Result,void 0,void 0):new i.ConsoleModel.ConsoleMessage(e.runtimeModel(),"javascript",o,"",{type:i.ConsoleModel.FrontendMessageType.Result,parameters:[e]}),n.setOriginatingMessage(t),i.ConsoleModel.ConsoleModel.instance().addMessage(n)}commandEvaluated(e){const{data:t}=e;this.prompt.history().pushHistoryItem(t.commandMessage.messageText),this.consoleHistorySetting.set(this.prompt.history().historyData().slice(-Se)),this.printResult(t.result,t.commandMessage,t.exceptionDetails)}elementsToRestoreScrollPositionsFor(){return[this.messagesElement]}searchCanceled(){this.cleanupAfterSearch();for(const e of this.visibleViewMessages)e.setSearchRegex(null);this.currentMatchRangeIndex=-1,this.regexMatchRanges=[],this.searchRegex=null,this.viewport.refresh()}performSearch(e,t,s){this.searchCanceled(),this.searchableViewInternal.updateSearchMatchesCount(0),this.searchRegex=e.toSearchRegex(!0),this.regexMatchRanges=[],this.currentMatchRangeIndex=-1,t&&(this.searchShouldJumpBackwards=Boolean(s)),this.searchProgressIndicator=new o.ProgressIndicator.ProgressIndicator,this.searchProgressIndicator.setTitle(Ce(fe.searching)),this.searchProgressIndicator.setTotalWork(this.visibleViewMessages.length),this.progressToolbarItem.element.appendChild(this.searchProgressIndicator.element),this.innerSearch(0)}cleanupAfterSearch(){delete this.searchShouldJumpBackwards,this.innerSearchTimeoutId&&(clearTimeout(this.innerSearchTimeoutId),delete this.innerSearchTimeoutId),this.searchProgressIndicator&&(this.searchProgressIndicator.done(),delete this.searchProgressIndicator)}searchFinishedForTests(){}innerSearch(e){if(delete this.innerSearchTimeoutId,this.searchProgressIndicator&&this.searchProgressIndicator.isCanceled())return void this.cleanupAfterSearch();const t=Date.now();for(;e<this.visibleViewMessages.length&&Date.now()-t<100;++e)this.searchMessage(e);if(this.searchableViewInternal.updateSearchMatchesCount(this.regexMatchRanges.length),void 0!==this.searchShouldJumpBackwards&&this.regexMatchRanges.length&&(this.jumpToMatch(this.searchShouldJumpBackwards?-1:0),delete this.searchShouldJumpBackwards),e===this.visibleViewMessages.length)return this.cleanupAfterSearch(),void setTimeout(this.searchFinishedForTests.bind(this),0);this.innerSearchTimeoutId=window.setTimeout(this.innerSearch.bind(this,e),100),this.searchProgressIndicator&&this.searchProgressIndicator.setWorked(e)}searchMessage(e){const t=this.visibleViewMessages[e];t.setSearchRegex(this.searchRegex);for(let s=0;s<t.searchCount();++s)this.regexMatchRanges.push({messageIndex:e,matchIndex:s})}jumpToNextSearchResult(){this.jumpToMatch(this.currentMatchRangeIndex+1)}jumpToPreviousSearchResult(){this.jumpToMatch(this.currentMatchRangeIndex-1)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}jumpToMatch(e){if(!this.regexMatchRanges.length)return;let t;if(this.currentMatchRangeIndex>=0){t=this.regexMatchRanges[this.currentMatchRangeIndex];this.visibleViewMessages[t.messageIndex].searchHighlightNode(t.matchIndex).classList.remove(o.UIUtils.highlightedCurrentSearchResultClassName)}e=s.NumberUtilities.mod(e,this.regexMatchRanges.length),this.currentMatchRangeIndex=e,this.searchableViewInternal.updateCurrentMatchIndex(e),t=this.regexMatchRanges[e];const i=this.visibleViewMessages[t.messageIndex].searchHighlightNode(t.matchIndex);i.classList.add(o.UIUtils.highlightedCurrentSearchResultClassName),this.viewport.scrollItemIntoView(t.messageIndex),i.scrollIntoViewIfNeeded()}updateStickToBottomOnPointerDown(e){this.muteViewportUpdates=!e,this.viewport.setStickToBottom(!1),this.waitForScrollTimeout&&(clearTimeout(this.waitForScrollTimeout),delete this.waitForScrollTimeout)}updateStickToBottomOnPointerUp(){this.muteViewportUpdates&&(this.waitForScrollTimeout=window.setTimeout(function(){this.muteViewportUpdates=!1,this.isShowing()&&this.viewport.setStickToBottom(this.isScrolledToBottom());this.maybeDirtyWhileMuted&&(this.scheduleViewportRefresh(),delete this.maybeDirtyWhileMuted);delete this.waitForScrollTimeout,this.updateViewportStickinessForTest()}.bind(this),200))}updateViewportStickinessForTest(){}updateStickToBottomOnWheel(){this.updateStickToBottomOnPointerDown(),this.updateStickToBottomOnPointerUp()}promptTextChanged(){const e=this.viewport.stickToBottom(),t=this.isScrolledToBottom();this.viewport.setStickToBottom(t),t&&!e&&this.scheduleViewportRefresh(),this.promptTextChangedForTest()}promptTextChangedForTest(){}isScrolledToBottom(){return this.messagesElement.scrollHeight-this.messagesElement.scrollTop-this.messagesElement.clientHeight-this.prompt.belowEditorElement().offsetHeight<=2}}globalThis.Console=globalThis.Console||{},globalThis.Console.ConsoleView=we;const Se=300;class Ie{filterChanged;messageLevelFiltersSetting;hideNetworkMessagesSetting;filterByExecutionContextSetting;suggestionBuilder;textFilterUI;textFilterSetting;filterParser;currentFilter;levelLabels;levelMenuButton;constructor(t){this.filterChanged=t,this.messageLevelFiltersSetting=Ie.levelFilterSetting(),this.hideNetworkMessagesSetting=e.Settings.Settings.instance().moduleSetting("hideNetworkMessages"),this.filterByExecutionContextSetting=e.Settings.Settings.instance().moduleSetting("selectedContextFilterEnabled"),this.messageLevelFiltersSetting.addChangeListener(this.onFilterChanged.bind(this)),this.hideNetworkMessagesSetting.addChangeListener(this.onFilterChanged.bind(this)),this.filterByExecutionContextSetting.addChangeListener(this.onFilterChanged.bind(this)),o.Context.Context.instance().addFlavorChangeListener(i.RuntimeModel.ExecutionContext,this.onFilterChanged,this);const s=Object.values(M);this.suggestionBuilder=new o.FilterSuggestionBuilder.FilterSuggestionBuilder(s),this.textFilterUI=new o.Toolbar.ToolbarInput(Ce(fe.filter),"",1,1,Ce(fe.egEventdCdnUrlacom),this.suggestionBuilder.completions.bind(this.suggestionBuilder),!0),this.textFilterSetting=e.Settings.Settings.instance().createSetting("console.textFilter",""),this.textFilterSetting.get()&&this.textFilterUI.setValue(this.textFilterSetting.get()),this.textFilterUI.addEventListener(o.Toolbar.ToolbarInput.Event.TextChanged,(()=>{this.textFilterSetting.set(this.textFilterUI.value()),this.onFilterChanged()})),this.filterParser=new n.TextUtils.FilterParser(s),this.currentFilter=new y("",[],null,this.messageLevelFiltersSetting.get()),this.updateCurrentFilter(),this.levelLabels=new Map([["verbose",Ce(fe.verbose)],["info",Ce(fe.info)],["warning",Ce(fe.warnings)],["error",Ce(fe.errors)]]),this.levelMenuButton=new o.Toolbar.ToolbarButton(Ce(fe.logLevels)),this.levelMenuButton.turnIntoSelect(),this.levelMenuButton.addEventListener(o.Toolbar.ToolbarButton.Events.Click,this.showLevelContextMenu.bind(this)),o.ARIAUtils.markAsMenuButton(this.levelMenuButton.element),this.updateLevelMenuButtonText(),this.messageLevelFiltersSetting.addChangeListener(this.updateLevelMenuButtonText.bind(this))}onMessageAdded(e){e.type===i.ConsoleModel.FrontendMessageType.Command||e.type===i.ConsoleModel.FrontendMessageType.Result||e.isGroupMessage()||(e.context&&this.suggestionBuilder.addItem(M.Context,e.context),e.source&&this.suggestionBuilder.addItem(M.Source,e.source),e.url&&this.suggestionBuilder.addItem(M.Url,e.url))}setLevelMenuOverridden(e){this.levelMenuButton.setEnabled(!e),e?this.levelMenuButton.setTitle(Ce(fe.overriddenByFilterSidebar)):this.updateLevelMenuButtonText()}static levelFilterSetting(){return e.Settings.Settings.instance().createSetting("messageLevelFilters",y.defaultLevelsFilterValue())}updateCurrentFilter(){const e=this.filterParser.parse(this.textFilterUI.value());this.hideNetworkMessagesSetting.get()&&e.push({key:M.Source,text:"network",negative:!0,regex:void 0}),this.currentFilter.executionContext=this.filterByExecutionContextSetting.get()?o.Context.Context.instance().flavor(i.RuntimeModel.ExecutionContext):null,this.currentFilter.parsedFilters=e,this.currentFilter.levelsMask=this.messageLevelFiltersSetting.get()}onFilterChanged(){this.updateCurrentFilter(),this.filterChanged()}updateLevelMenuButtonText(){let e=!0,t=!0;const s=y.allLevelsFilterValue(),i=y.defaultLevelsFilterValue();let o=null;const n=this.messageLevelFiltersSetting.get(),r={Verbose:"verbose",Info:"info",Warning:"warning",Error:"error"};for(const l of Object.values(r))e=e&&n[l]===s[l],t=t&&n[l]===i[l],n[l]&&(o=o?Ce(fe.customLevels):Ce(fe.sOnly,{PH1:String(this.levelLabels.get(l))}));o=e?Ce(fe.allLevels):t?Ce(fe.defaultLevels):o||Ce(fe.hideAll),this.levelMenuButton.element.classList.toggle("warning",!e&&!t),this.levelMenuButton.setText(o),this.levelMenuButton.setTitle(Ce(fe.logLevelS,{PH1:o}))}showLevelContextMenu(e){const t=e.data,s=this.messageLevelFiltersSetting,i=s.get(),n=new o.ContextMenu.ContextMenu(t,{useSoftMenu:!0,x:this.levelMenuButton.element.totalOffsetLeft(),y:this.levelMenuButton.element.totalOffsetTop()+this.levelMenuButton.element.offsetHeight});n.headerSection().appendItem(Ce(fe.default),(()=>s.set(y.defaultLevelsFilterValue())));for(const[e,t]of this.levelLabels.entries())n.defaultSection().appendCheckboxItem(t,r.bind(null,e),i[e]);function r(e){i[e]=!i[e],s.set(i)}n.show()}addMessageURLFilter(e){if(!e)return;const t=this.textFilterUI.value()?` ${this.textFilterUI.value()}`:"";this.textFilterUI.setValue(`-url:${e}${t}`),this.textFilterSetting.set(this.textFilterUI.value()),this.onFilterChanged()}shouldBeVisible(e){return this.currentFilter.shouldBeVisible(e)}clear(){this.suggestionBuilder.clear()}reset(){this.messageLevelFiltersSetting.set(y.defaultLevelsFilterValue()),this.filterByExecutionContextSetting.set(!1),this.hideNetworkMessagesSetting.set(!1),this.textFilterUI.setValue(""),this.onFilterChanged()}}class Ee{parentGroupInternal;nestingLevelInternal;messagesHiddenInternal;constructor(e,t){this.parentGroupInternal=e,this.nestingLevelInternal=e?e.nestingLevel()+1:0,this.messagesHiddenInternal=t&&t.collapsed()||this.parentGroupInternal&&this.parentGroupInternal.messagesHidden()||!1}static createTopGroup(){return new Ee(null,null)}messagesHidden(){return this.messagesHiddenInternal}nestingLevel(){return this.nestingLevelInternal}parentGroup(){return this.parentGroupInternal}}let Me;class Te{handleAction(t,s){switch(s){case"console.show":return b.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront(),e.Console.Console.instance().show(),we.instance().focusPrompt(),!0;case"console.clear":return we.clearConsole(),!0;case"console.clear.history":return we.instance().clearHistory(),!0;case"console.create-pin":return we.instance().pinPane.addPin("",!0),!0}return!1}static instance(e={forceNew:null}){const{forceNew:t}=e;return Me&&!t||(Me=new Te),Me}}const ye=new WeakMap,ke=new WeakMap;var Le=Object.freeze({__proto__:null,ConsoleView:we,ConsoleViewFilter:Ie,ConsoleGroup:Ee,ActionDelegate:Te});let Fe;class Re extends o.Panel.Panel{view;constructor(){super("console"),this.view=we.instance()}static instance(e={forceNew:null}){const{forceNew:t}=e;return Fe&&!t||(Fe=new Re),Fe}static updateContextFlavor(){const e=Re.instance().view;o.Context.Context.instance().setFlavor(we,e.isShowing()?e:null)}wasShown(){super.wasShown();Ae&&Ae.isShowing()&&o.InspectorView.InspectorView.instance().setDrawerMinimized(!0),this.view.show(this.element),Re.updateContextFlavor()}willHide(){super.willHide(),o.InspectorView.InspectorView.instance().setDrawerMinimized(!1),Ae&&Ae.showViewInWrapper(),Re.updateContextFlavor()}searchableView(){return we.instance().searchableView()}}let Pe,Ae=null;class Be extends o.Widget.VBox{view;constructor(){super(),this.view=we.instance()}static instance(){return Ae||(Ae=new Be),Ae}wasShown(){Re.instance().isShowing()?o.InspectorView.InspectorView.instance().setDrawerMinimized(!0):this.showViewInWrapper(),Re.updateContextFlavor()}willHide(){o.InspectorView.InspectorView.instance().setDrawerMinimized(!1),Re.updateContextFlavor()}showViewInWrapper(){this.view.show(this.element)}}class He{static instance(e={forceNew:null}){const{forceNew:t}=e;return Pe&&!t||(Pe=new He),Pe}async reveal(e){const t=we.instance();t.isShowing()?t.focus():await o.ViewManager.ViewManager.instance().showView("console-view")}}var Oe=Object.freeze({__proto__:null,ConsolePanel:Re,WrapperView:Be,ConsoleRevealer:He});const Ue=new CSSStyleSheet;Ue.replaceSync("#console-prompt .CodeMirror{padding:3px 0 1px}#console-prompt .CodeMirror-line{padding-top:0}#console-prompt .CodeMirror-lines{padding-top:0}#console-prompt .console-prompt-icon{position:absolute;left:-13px;top:5px;user-select:none}.console-eager-preview{padding-bottom:2px;opacity:60%;position:relative;height:15px}.console-eager-inner-preview{text-overflow:ellipsis;overflow:hidden;margin-left:4px;height:100%;white-space:nowrap}.preview-result-icon{position:absolute;left:-13px;top:1px}.console-eager-inner-preview:empty,.console-eager-inner-preview:empty+.preview-result-icon{opacity:0%}.console-prompt-icon.console-prompt-incomplete{opacity:65%}\n/*# sourceURL=consolePrompt.css */\n");const Ve={consolePrompt:"Console prompt"},Ne=t.i18n.registerUIStrings("panels/console/ConsolePrompt.ts",Ve),je=t.i18n.getLocalizedString.bind(void 0,Ne);class Ge extends(e.ObjectWrapper.eventMixin(o.Widget.Widget)){addCompletionsFromHistory;historyInternal;initialText;editor;eagerPreviewElement;textChangeThrottler;formatter;requestPreviewBound;requestPreviewCurrent=0;innerPreviewElement;promptIcon;iconThrottler;eagerEvalSetting;previewRequestForTest;highlightingNode;constructor(){super(),this.addCompletionsFromHistory=!0,this.historyInternal=new De,this.initialText="",this.eagerPreviewElement=document.createElement("div"),this.eagerPreviewElement.classList.add("console-eager-preview"),this.textChangeThrottler=new e.Throttler.Throttler(150),this.formatter=new a.RemoteObjectPreviewFormatter.RemoteObjectPreviewFormatter,this.requestPreviewBound=this.requestPreview.bind(this),this.innerPreviewElement=this.eagerPreviewElement.createChild("div","console-eager-inner-preview"),this.eagerPreviewElement.appendChild(o.Icon.Icon.create("smallicon-command-result","preview-result-icon"));const t=this.element.createChild("div","console-prompt-editor-container");this.element.appendChild(this.eagerPreviewElement),this.promptIcon=o.Icon.Icon.create("smallicon-text-prompt","console-prompt-icon"),this.element.appendChild(this.promptIcon),this.iconThrottler=new e.Throttler.Throttler(0),this.eagerEvalSetting=e.Settings.Settings.instance().moduleSetting("consoleEagerEval"),this.eagerEvalSetting.addChangeListener(this.eagerSettingChanged.bind(this)),this.eagerPreviewElement.classList.toggle("hidden",!this.eagerEvalSetting.get()),this.element.tabIndex=0,this.previewRequestForTest=null,this.highlightingNode=!1;const s=r.EditorState.create({doc:this.initialText,extensions:[r.keymap.of(this.editorKeymap()),r.EditorView.updateListener.of((e=>this.editorUpdate(e))),l.JavaScript.argumentHints(),l.JavaScript.completion(),l.Config.showCompletionHint,r.javascript.javascript(),l.Config.baseConfiguration(this.initialText),l.Config.autocompletion,r.javascript.javascriptLanguage.data.of({autocomplete:e=>this.historyCompletions(e)}),r.EditorView.contentAttributes.of({"aria-label":je(Ve.consolePrompt)}),r.EditorView.lineWrapping,r.autocompletion({aboveCursor:!0})]});this.editor=new l.TextEditor.TextEditor(s),this.editor.addEventListener("keydown",(e=>{e.defaultPrevented&&e.stopPropagation()})),t.appendChild(this.editor),this.hasFocus()&&this.focus(),this.element.removeAttribute("tabindex"),this.editorSetForTest(),b.userMetrics.panelLoaded("console","DevTools.Launch.Console")}eagerSettingChanged(){const e=this.eagerEvalSetting.get();this.eagerPreviewElement.classList.toggle("hidden",!e),e&&this.requestPreview()}belowEditorElement(){return this.eagerPreviewElement}onTextChanged(){if(this.eagerEvalSetting.get()){const e=!l.Config.contentIncludingHint(this.editor.editor);this.previewRequestForTest=this.textChangeThrottler.schedule(this.requestPreviewBound,e)}this.updatePromptIcon(),this.dispatchEventToListeners("TextChanged")}async requestPreview(){const e=++this.requestPreviewCurrent,t=l.Config.contentIncludingHint(this.editor.editor).trim(),s=o.Context.Context.instance().flavor(i.RuntimeModel.ExecutionContext),{preview:n,result:r}=await a.JavaScriptREPL.JavaScriptREPL.evaluateAndBuildPreview(t,!0,!0,500);this.requestPreviewCurrent===e&&(this.innerPreviewElement.removeChildren(),n.deepTextContent()!==l.Config.contentIncludingHint(this.editor.editor).trim()&&this.innerPreviewElement.appendChild(n),r&&"object"in r&&r.object&&"node"===r.object.subtype?(this.highlightingNode=!0,i.OverlayModel.OverlayModel.highlightObjectAsDOMNode(r.object)):this.highlightingNode&&(this.highlightingNode=!1,i.OverlayModel.OverlayModel.hideDOMNodeHighlight()),r&&s&&s.runtimeModel.releaseEvaluationResult(r))}wasShown(){super.wasShown(),this.registerCSSFiles([Ue])}willHide(){this.highlightingNode&&(this.highlightingNode=!1,i.OverlayModel.OverlayModel.hideDOMNodeHighlight())}history(){return this.historyInternal}clearAutocomplete(){r.closeCompletion(this.editor.editor)}isCaretAtEndOfPrompt(){return this.editor.state.selection.main.head===this.editor.state.doc.length}moveCaretToEndOfPrompt(){this.editor.dispatch({selection:r.EditorSelection.cursor(this.editor.state.doc.length)})}clear(){this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length}})}text(){return this.editor.state.doc.toString()}setAddCompletionsFromHistory(e){this.addCompletionsFromHistory=e}editorKeymap(){return[{key:"ArrowUp",run:()=>this.moveHistory(-1)},{key:"ArrowDown",run:()=>this.moveHistory(1)},{mac:"Ctrl-p",run:()=>this.moveHistory(-1,!0)},{mac:"Ctrl-n",run:()=>this.moveHistory(1,!0)},{key:"Enter",run:()=>this.evaluate(),shift:r.insertNewlineAndIndent}]}moveHistory(e,t=!1){const{editor:s}=this.editor,{main:i}=s.state.selection;if(!t){if(!i.empty)return!1;const t=s.coordsAtPos(i.head),o=s.coordsAtPos(e<0?0:s.state.doc.length);if(t&&o&&(e<0?t.top>o.top+5:t.bottom<o.bottom-5))return!1}const o=this.historyInternal,n=e<0?o.previous(this.text()):o.next();if(void 0===n)return!1;const l=e<0?n.search(/\n|$/):n.length;return this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length,insert:n},selection:r.EditorSelection.cursor(l),scrollIntoView:!0}),!0}enterWillEvaluate(){const{state:e}=this.editor;return e.doc.length>0&&l.JavaScript.isExpressionComplete(e)}evaluate(){if(this.enterWillEvaluate())this.appendCommand(this.text(),!0),this.editor.dispatch({changes:{from:0,to:this.editor.state.doc.length},scrollIntoView:!0});else{if(this.editor.state.doc.length)return r.insertNewlineAndIndent(this.editor.editor);this.editor.dispatch({scrollIntoView:!0})}return this.enterProcessedForTest(),!0}updatePromptIcon(){this.iconThrottler.schedule((async()=>{this.promptIcon.classList.toggle("console-prompt-incomplete",!this.enterWillEvaluate())}))}appendCommand(e,t){const s=o.Context.Context.instance().flavor(i.RuntimeModel.ExecutionContext);if(s){const o=s,n=i.ConsoleModel.ConsoleModel.instance().addCommandMessage(o,e),r=a.JavaScriptREPL.JavaScriptREPL.preprocessExpression(e);i.ConsoleModel.ConsoleModel.instance().evaluateCommandInConsole(o,n,r,t),Re.instance().isShowing()&&b.userMetrics.actionTaken(b.UserMetrics.Action.CommandEvaluatedInConsolePanel)}}enterProcessedForTest(){}editorUpdate(e){e.docChanged||r.selectedCompletion(e.state)!==r.selectedCompletion(e.startState)?this.onTextChanged():e.selectionSet&&this.updatePromptIcon()}historyCompletions(e){const t=this.text();if(!this.addCompletionsFromHistory||!this.isCaretAtEndOfPrompt()||!t.length&&!e.explicit)return null;const s=[],i=new Set,o=this.historyInternal.historyData();for(let e=o.length-1;e>=0&&s.length<50;--e){const n=o[e];n.startsWith(t)&&(i.has(n)||(i.add(n),s.push({label:n,type:"secondary",boost:-1e5})))}return s.length?{from:0,to:t.length,options:s}:null}focus(){this.editor.focus()}editorSetForTest(){}}class De{data;historyOffset;uncommittedIsTop;constructor(){this.data=[],this.historyOffset=1}historyData(){return this.data}setHistoryData(e){this.data=e.slice(),this.historyOffset=1}pushHistoryItem(e){this.uncommittedIsTop&&(this.data.pop(),delete this.uncommittedIsTop),this.historyOffset=1,e!==this.currentHistoryItem()&&this.data.push(e)}pushCurrentText(e){this.uncommittedIsTop&&this.data.pop(),this.uncommittedIsTop=!0,this.data.push(e)}previous(e){if(!(this.historyOffset>this.data.length))return 1===this.historyOffset&&this.pushCurrentText(e),++this.historyOffset,this.currentHistoryItem()}next(){if(1!==this.historyOffset)return--this.historyOffset,this.currentHistoryItem()}currentHistoryItem(){return this.data[this.data.length-this.historyOffset]}}var We=Object.freeze({__proto__:null,ConsolePrompt:Ge,ConsoleHistoryManager:De});export{T as ConsoleContextSelector,k as ConsoleFilter,Oe as ConsolePanel,U as ConsolePinPane,We as ConsolePrompt,K as ConsoleSidebar,Le as ConsoleView,ve as ConsoleViewMessage,J as ConsoleViewport};
